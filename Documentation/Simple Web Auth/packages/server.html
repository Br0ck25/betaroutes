<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-packages/server" data-has-hydrated=false>
<!-- Mirrored from simplewebauthn.dev/docs/packages/server by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 26 Dec 2025 17:01:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>@simplewebauthn/server | SimpleWebAuthn</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://simplewebauthn.dev/docs/packages/server><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="@simplewebauthn/server | SimpleWebAuthn"><meta data-rh=true name=description content="Current version"><meta data-rh=true property=og:description content="Current version"><link data-rh=true rel=icon href=../../img/logo_favicon.png><link data-rh=true rel=canonical href=server.html><link data-rh=true rel=alternate href=server.html hreflang=en><link data-rh=true rel=alternate href=server.html hreflang=x-default><link data-rh=true rel=preconnect href=https://e0fzf1rzxd-dsn.algolia.net/ crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://simplewebauthn.dev/docs/packages/server","name":"@simplewebauthn/server","position":1}]}</script><link rel=search type=application/opensearchdescription+xml title=SimpleWebAuthn href=https://simplewebauthn.dev/opensearch.xml><link rel=stylesheet href=../../assets/css/styles.bd7c59d7.css><script src=../../assets/js/runtime_main.87ca4247.js defer></script><script src=../../assets/js/main.5371bc05.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=../../img/logo_favicon.png><link rel=preload as=image href=../../img/docs/packages/server-sample-db-schema.png><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=https://simplewebauthn.dev/><div class=navbar__logo><img src=../../img/logo_favicon.png alt="SimpleWebAuthn Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=../../img/logo_favicon.png alt="SimpleWebAuthn Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">SimpleWebAuthn</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=../index.html>Docs</a><a href=https://debugger.simplewebauthn.dev/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Debugger<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/MasterKale/SimpleWebAuthn target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=true href=../index.html>SimpleWebAuthn</a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=../index.html>Introduction</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=../simplewebauthn/philosophy.html>Philosophy</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true href=browser.html>Packages</a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=browser.html>@simplewebauthn/browser</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=server.html>@simplewebauthn/server</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=types.html>@simplewebauthn/types</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=true href=../advanced/browser-quirks.html>Advanced Guides</a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/browser-quirks.html>Browser Quirks</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/example-project.html>Example Project</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/fido-conformance.html>FIDO Conformance</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/passkeys.html>Passkeys</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/supported-devices.html>Supported Devices</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=true tabindex=0 href=../advanced/server/custom-challenges.html>@simplewebauthn/server</a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/server/custom-challenges.html>Custom Challenges</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/server/custom-user-ids.html>Custom User IDs</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/server/metadata-service.html>Metadata Service</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/server/secure-payment-confirmation.html>Secure Payment Confirmation</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=../advanced/server/settings-service.html>Settings Service</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=../advanced/prf.html>Danger Zone</a></div></ul></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=https://simplewebauthn.dev/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>Packages</span><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>@simplewebauthn/server</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>@simplewebauthn/server</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id=current-version>Current version<a href=#current-version class=hash-link aria-label="Direct link to Current version" title="Direct link to Current version">​</a></h2>
<p>The content below should be accurate for <strong>@simplewebauthn/server@^13.0.0</strong>. Please open an issue <a href=https://github.com/MasterKale/SimpleWebAuthn-homepage/issues target=_blank rel="noopener noreferrer">here</a> to report any inaccuracies.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=installation>Installation<a href=#installation class=hash-link aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h2>
<p>This package can be installed from <strong><a href=https://www.npmjs.com/package/@simplewebauthn/server target=_blank rel="noopener noreferrer">NPM</a></strong>
and <strong><a href=https://jsr.io/@simplewebauthn/server target=_blank rel="noopener noreferrer">JSR</a></strong>:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=node-lts-20x-and-higher>Node LTS 20.x and higher<a href=#node-lts-20x-and-higher class=hash-link aria-label="Direct link to Node LTS 20.x and higher" title="Direct link to Node LTS 20.x and higher">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">npm install @simplewebauthn/server</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=deno-v143-and-higher>Deno v1.43 and higher<a href=#deno-v143-and-higher class=hash-link aria-label="Direct link to Deno v1.43 and higher" title="Direct link to Deno v1.43 and higher">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">deno add jsr:@simplewebauthn/server</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=types>Types<a href=#types class=hash-link aria-label="Direct link to Types" title="Direct link to Types">​</a></h2>
<p>This package exports almost all of its types for TypeScript projects to import. For example:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> WebAuthnCredential </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@simplewebauthn/server'</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">WebAuthnCredential</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@simplewebauthn/server'</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>See the <a href=https://jsr.io/@simplewebauthn/server/doc target=_blank rel="noopener noreferrer">auto-generated API docs for this project on JSR</a> for a comprehensive list of available imports.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=additional-data-structures>Additional data structures<a href=#additional-data-structures class=hash-link aria-label="Direct link to Additional data structures" title="Direct link to Additional data structures">​</a></h2>
<p>Documentation below will refer to the following TypeScript types. These are intended to be inspirational, a simple means of communicating the shape of the values you'll need to be capable of persisting in your database:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  AuthenticatorTransportFuture</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  CredentialDeviceType</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  Base64URLString</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@simplewebauthn/server'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">UserModel</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  username</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token doc-comment comment" style=color:#999988;font-style:italic>/**</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * It is strongly advised that credentials get their own DB</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * table, ideally with a foreign key somewhere connecting it</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * to a specific UserModel.</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> *</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * "SQL" tags below are suggestions for column data types and</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * how best to store data received during registration for use</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * in subsequent authentications.</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">Passkey</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// SQL: Store as `TEXT`. Index this column</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Base64URLString</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// SQL: Store raw bytes as `BYTEA`/`BLOB`/etc...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>//      Caution: Node ORM's may map this to a Buffer on retrieval,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>//      convert to Uint8Array as necessary</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  publicKey</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Uint8Array</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// SQL: Foreign Key to an instance of your internal user model</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  user</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> UserModel</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// SQL: Store as `TEXT`. Index this column. A UNIQUE constraint on</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>//      (webAuthnUserID + user) also achieves maximum user privacy</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  webauthnUserID</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Base64URLString</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// SQL: Consider `BIGINT` since some authenticators return atomic timestamps as counters</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  counter</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// SQL: `VARCHAR(32)` or similar, longest possible value is currently 12 characters</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Ex: 'singleDevice' | 'multiDevice'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  deviceType</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> CredentialDeviceType</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// SQL: `BOOL` or whatever similar type is supported</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  backedUp</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// SQL: `VARCHAR(255)` and store string array as a CSV string</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Ex: ['ble' | 'cable' | 'hybrid' | 'internal' | 'nfc' | 'smart-card' | 'usb']</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  transports</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> AuthenticatorTransportFuture</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>Below is a sample database schema showing how a <strong>passkeys</strong> table can track WebAuthn-specific user IDs while still allowing use of typical internal database user IDs through the rest of the site (<a href=https://dbdiagram.io/d/SimpleWebAuthn-Example-DB-Schema-661a046303593b6b61e34628 target=_blank rel="noopener noreferrer">click here for an interactive version of the schema</a>):</p>
<img alt="FIDO2 Metadata download button" src=../../img/docs/packages/server-sample-db-schema.png>
<p>Keep this table structure in mind as you proceed through the following sections.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=identifying-your-rp>Identifying your RP<a href=#identifying-your-rp class=hash-link aria-label="Direct link to Identifying your RP" title="Direct link to Identifying your RP">​</a></h2>
<p>Start by defining some constants that describe your "Relying Party" (RP) server to authenticators:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic>/**</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * Human-readable title for your website</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> rpName </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'SimpleWebAuthn Example'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token doc-comment comment" style=color:#999988;font-style:italic>/**</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * A unique identifier for your website. 'localhost' is okay for</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * local dev</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> rpID </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'simplewebauthn.dev'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token doc-comment comment" style=color:#999988;font-style:italic>/**</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * The URL at which registrations and authentications should occur.</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * 'http://localhost' and 'http://localhost:PORT' are also valid.</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * Do NOT include any trailing /</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> origin </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token template-string string" style=color:#e3116c>https://</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string interpolation">rpID</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>These will be referenced throughout registrations and authentications to ensure that authenticators generate and return credentials specifically for your server.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=registration>Registration<a href=#registration class=hash-link aria-label="Direct link to Registration" title="Direct link to Registration">​</a></h2>
<p>"Registration" is analogous to new account creation. Registration uses the following exported methods from this package:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  generateRegistrationOptions</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  verifyRegistrationResponse</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@simplewebauthn/server'</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>Registration occurs in two steps:</p>
<ol>
<li>Generate registration options for the browser to pass to a supported authenticator</li>
<li>Verify the authenticator's response</li>
</ol>
<p>Each of these steps need their own API endpoints:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-generate-registration-options>1. Generate registration options<a href=#1-generate-registration-options class=hash-link aria-label="Direct link to 1. Generate registration options" title="Direct link to 1. Generate registration options">​</a></h3>
<p>One endpoint (<code>GET</code>) needs to return the result of a call to <code>generateRegistrationOptions()</code>:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Retrieve the user from the database</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// after they've logged in</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> user</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> UserModel </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUserFromDB</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">loggedInUserId</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Retrieve any of the user's previously-</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// registered authenticators</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> userPasskeys</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Passkey</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUserPasskeys</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> options</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> PublicKeyCredentialCreationOptionsJSON </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>generateRegistrationOptions</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  rpName</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  rpID</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  userName</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> user</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">username</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Don't prompt users for additional information about the authenticator</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// (Recommended for smoother UX)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  attestationType</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'none'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Prevent users from re-registering existing authenticators</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  excludeCredentials</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> userPasskeys</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>map</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">passkey </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> passkey</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Optional</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    transports</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> passkey</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transports</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// See "Guiding use of authenticators via authenticatorSelection" below</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  authenticatorSelection</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Defaults</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    residentKey</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'preferred'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    userVerification</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'preferred'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Optional</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    authenticatorAttachment</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'platform'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Remember these options for the user</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>setCurrentRegistrationOptions</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> options</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> options</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>These options can be passed directly into <a href=browser.html#startregistration><strong>@simplewebauthn/browser</strong>'s <code>startRegistration()</code></a> method.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=guiding-use-of-authenticators-via-authenticatorselection>Guiding use of authenticators via <code>authenticatorSelection</code><a href=#guiding-use-of-authenticators-via-authenticatorselection class=hash-link aria-label="Direct link to guiding-use-of-authenticators-via-authenticatorselection" title="Direct link to guiding-use-of-authenticators-via-authenticatorselection">​</a></h4>
<p><code>generateRegistrationOptions()</code> also accepts an <code>authenticatorSelection</code> option that can be used to fine-tune the registration experience. When unspecified, defaults are provided according to <a href=../advanced/passkeys.html#generateregistrationoptions>passkeys best practices</a>. These values can be overridden based on Relying Party needs, however:</p>
<p><strong><code>authenticatorSelection.residentKey</code></strong>:</p>
<ul>
<li><code>'discouraged'</code>
<ul>
<li>Won't consume discoverable credential slots on security keys, but also won't generate synced passkeys on Android devices.</li>
</ul>
</li>
<li><code>'preferred'</code>
<ul>
<li>Will always generate synced passkeys on Android devices, but will consume discoverable credential slots on security keys.</li>
</ul>
</li>
<li><code>'required'</code>
<ul>
<li>Same as <code>'preferred'</code></li>
</ul>
</li>
</ul>
<p><strong><code>authenticatorSelection.userVerification</code>:</strong></p>
<ul>
<li><code>'discouraged'</code>
<ul>
<li>Won't perform user verification if interacting with an authenticator won't automatically perform it (i.e. security keys won't prompt for PIN, but interacting with Touch ID on a macOS device will always perform user verification.) User verification will usually be <code>false</code>.</li>
</ul>
</li>
<li><code>'preferred'</code>
<ul>
<li>Will perform user verification when possible, but will skip any prompts for PIN or local login password when possible. In these instances user verification can sometimes be <code>false</code>.</li>
</ul>
</li>
<li><code>'required'</code>
<ul>
<li>Will always provides multi-factor authentication, at the expense of always requiring some users to enter their local login password during auth. User verification should never be <code>false</code>.</li>
</ul>
</li>
</ul>
<p><strong><code>authenticatorSelection.authenticatorAttachment</code>:</strong></p>
<ul>
<li><code>'cross-platform'</code>
<ul>
<li>Browsers will guide users towards registering a security key, or mobile device via hybrid registration.</li>
</ul>
</li>
<li><code>'platform'</code>
<ul>
<li>Browser will guide users to registering the locally integrated hardware authenticator.</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=fine-tuning-the-registration-experience-with-preferredauthenticatortype>Fine-tuning the registration experience with <code>preferredAuthenticatorType</code><a href=#fine-tuning-the-registration-experience-with-preferredauthenticatortype class=hash-link aria-label="Direct link to fine-tuning-the-registration-experience-with-preferredauthenticatortype" title="Direct link to fine-tuning-the-registration-experience-with-preferredauthenticatortype">​</a></h4>
<p><a href=https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-hints target=_blank rel="noopener noreferrer">WebAuthn hints</a> allow a Relying Party to further refine the registration experience compared to specifying a value for <code>authenticatorSelection.authenticatorAttachment</code> as detailed above. SimpleWebAuthn enables use of hints via the <code>preferredAuthenticatorType</code> argument that can be passed into <code>generateRegistrationOptions()</code>:</p>
<p><strong><code>preferredAuthenticatorType</code>:</strong></p>
<ul>
<li><code>'securityKey'</code>
<ul>
<li>A security key, like a <a href=https://www.yubico.com/products/yubikey-5-overview/ target=_blank rel="noopener noreferrer">YubiKey 5</a>, <a href=https://www.ftsafe.com/Products/FIDO/NFC target=_blank rel="noopener noreferrer">Feitian K40</a>, and other such FIDO2-compatible USB tokens</li>
</ul>
</li>
<li><code>'localDevice'</code>
<ul>
<li>Typically the platform authenticator available on the device that they are logging in from</li>
</ul>
</li>
<li><code>'remoteDevice'</code>
<ul>
<li>A platform authenticator with access to a valid passkey but that is <strong>not</strong> on the device the user is logging in from (a.k.a. "hybrid auth" a.k.a. "the one that shows a QR code")</li>
</ul>
</li>
</ul>
<p>When this value is specified, browsers that support hints will try to tailor their experience to encourage registration of an authenticator of the specified type. <strong>Hints are a suggestion</strong>, though, and browsers will often allow a user to ultimately choose a different type of authenticator to register. RPs should be prepared for this possibility when using this.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>important</div><div class=admonitionContent_BuS1><p>Setting a value for <code>preferredAuthenticatorType</code> will overwrite any value that may have been specified for <code>authenticatorSelection.authenticatorAttachment</code>! This is to help maintain backwards compatibility with browsers that may not yet know about hints.</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1a-supported-attestation-formats>1a. Supported Attestation Formats<a href=#1a-supported-attestation-formats class=hash-link aria-label="Direct link to 1a. Supported Attestation Formats" title="Direct link to 1a. Supported Attestation Formats">​</a></h3>
<p>If <code>attestationType</code> is set to <code>"direct"</code> when generating registration options, the authenticator will return a more complex response containing an "attestation statement". This statement includes additional verifiable information about the authenticator.</p>
<p>Attestation statements are returned in one of several different formats. SimpleWebAuthn supports <a href=https://w3c.github.io/webauthn/#sctn-defined-attestation-formats target=_blank rel="noopener noreferrer">all current WebAuthn attestation formats</a>, including:</p>
<ul>
<li><strong>Packed</strong></li>
<li><strong>TPM</strong></li>
<li><strong>Android Key</strong></li>
<li><strong>Android SafetyNet</strong></li>
<li><strong>Apple</strong></li>
<li><strong>FIDO U2F</strong></li>
<li><strong>None</strong></li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p>Attestation statements are an advanced aspect of WebAuthn. You can ignore this concept if you're not particular about the kinds of authenticators your users can use for registration and authentication.</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-verify-registration-response>2. Verify registration response<a href=#2-verify-registration-response class=hash-link aria-label="Direct link to 2. Verify registration response" title="Direct link to 2. Verify registration response">​</a></h3>
<p>The second endpoint (<code>POST</code>) should accept the value returned by <a href=browser.html#startregistration><strong>@simplewebauthn/browser</strong>'s <code>startRegistration()</code></a> method and then verify it:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> body </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> req</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Retrieve the logged-in user</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> user</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> UserModel </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUserFromDB</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">loggedInUserId</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Get `options.challenge` that was saved above</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> currentOptions</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> PublicKeyCredentialCreationOptionsJSON </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>getCurrentRegistrationOptions</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> verification</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  verification </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>verifyRegistrationResponse</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    response</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> body</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    expectedChallenge</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> currentOptions</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">challenge</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    expectedOrigin</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> origin</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    expectedRPID</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> rpID</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">error</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token builtin">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>error</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">error</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> res</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>status</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>400</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>send</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> error</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> error</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">message </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> verified </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> verification</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>Support for multiple origins and RP IDs</div><div class=admonitionContent_BuS1><p>SimpleWebAuthn optionally supports verifying registrations from multiple origins and RP IDs! Simply pass in an <strong>array</strong> of possible origins and IDs for <code>expectedOrigin</code> and <code>expectedRPID</code> respectively.</div></div>
<p>When finished, it's a good idea to return the verification status to the browser to display
appropriate UI:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> verified </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-post-registration-responsibilities>3. Post-registration responsibilities<a href=#3-post-registration-responsibilities class=hash-link aria-label="Direct link to 3. Post-registration responsibilities" title="Direct link to 3. Post-registration responsibilities">​</a></h3>
<p>Assuming <code>verification.verified</code> is true then RP's must, at the very least, save the credential data in <code>registrationInfo</code> to the database:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> registrationInfo </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> verification</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  credential</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  credentialDeviceType</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  credentialBackedUp</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> registrationInfo</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> newPasskey</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Passkey </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// `user` here is from Step 2</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  user</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Created by `generateRegistrationOptions()` in Step 1</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  webAuthnUserID</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> currentOptions</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// A unique identifier for the credential</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> credential</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// The public key bytes, used for subsequent authentication signature verification</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  publicKey</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> credential</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">publicKey</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// The number of times the authenticator has been used on this site so far</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  counter</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> credential</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">counter</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// How the browser can talk with this credential's authenticator</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  transports</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> credential</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transports</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Whether the passkey is single-device or multi-device</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  deviceType</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> credentialDeviceType</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Whether the passkey has been backed up in some way</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  backedUp</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> credentialBackedUp</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Save the authenticator info so that we can</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// get it by user ID later</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>saveNewPasskeyInDB</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">newPasskey</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>Regarding <code>counter</code></div><div class=admonitionContent_BuS1><p>Tracking the <a href=https://www.w3.org/TR/webauthn/#signature-counter target=_blank rel="noopener noreferrer">"signature counter"</a> allows Relying Parties to potentially identify misbehaving authenticators, or cloned authenticators. The counter on subsequent authentications should only ever increment; if your stored counter is greater than zero, and a subsequent authentication response's counter is the same or lower, then perhaps the authenticator just used to authenticate is in a compromised state.<p>It's also not unexpected for certain high profile authenticators, like Touch ID on macOS, to always return <code>0</code> (zero) for the signature counter. In this case there is nothing an RP can really do to detect a cloned authenticator, especially in the context of <a href=https://fidoalliance.org/apple-google-and-microsoft-commit-to-expanded-support-for-fido-standard-to-accelerate-availability-of-passwordless-sign-ins/ target=_blank rel="noopener noreferrer">multi-device credentials</a>.<p><strong>@simplewebauthn/server</strong> knows how to properly check the signature counter on subsequent authentications. RP's should only need to remember to store the value after registration, and then feed it back into <code>startAuthentication()</code> when the user attempts a subsequent login. RP's should remember to update the credential's counter value in the database afterwards. See <a href=server.html#3-post-authentication-responsibilities>Post-authentication responsibilities</a> below for how to do so.</div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=authentication>Authentication<a href=#authentication class=hash-link aria-label="Direct link to Authentication" title="Direct link to Authentication">​</a></h2>
<p>"Authentication" is analogous to existing account login. Authentication uses the following exported methods from this package:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  generateAuthenticationOptions</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  verifyAuthenticationResponse</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@simplewebauthn/server'</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>Just like registration, authentication span two steps:</p>
<ol>
<li>Generate authentication options for the browser to pass to a FIDO2 authenticator</li>
<li>Verify the authenticator's response</li>
</ol>
<p>Each of these steps need their own API endpoints:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-generate-authentication-options>1. Generate authentication options<a href=#1-generate-authentication-options class=hash-link aria-label="Direct link to 1. Generate authentication options" title="Direct link to 1. Generate authentication options">​</a></h3>
<p>One endpoint (<code>GET</code>) needs to return the result of a call to <code>generateAuthenticationOptions()</code>:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Retrieve the user record for the account identifier (email, username, etc...) that</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// the unauthenticated user entered</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> user</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> UserModel </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUserFromDBByUsername</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">submittedUsername</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Retrieve any of the user's previously-</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// registered authenticators</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> userPasskeys</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Passkey</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUserPasskeys</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> options</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> PublicKeyCredentialRequestOptionsJSON </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>generateAuthenticationOptions</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  rpID</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Require users to use a previously-registered authenticator</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  allowCredentials</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> userPasskeys</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>map</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">passkey </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> passkey</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    transports</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> passkey</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transports</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Remember this challenge for this user</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>setCurrentAuthenticationOptions</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> options</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> options</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>These options can be passed directly into <a href=browser.html#startauthentication><strong>@simplewebauthn/browser</strong>'s <code>startAuthentication()</code></a> method.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>Support for custom challenges</div><div class=admonitionContent_BuS1><p>Power users can optionally generate and pass in their own unique challenges as <code>challenge</code> when calling <code>generateAuthenticationOptions()</code>. In this scenario <code>options.challenge</code> still needs to be saved to be used in verification as described below.</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-verify-authentication-response>2. Verify authentication response<a href=#2-verify-authentication-response class=hash-link aria-label="Direct link to 2. Verify authentication response" title="Direct link to 2. Verify authentication response">​</a></h3>
<p>The second endpoint (<code>POST</code>) should accept the value returned by <a href=browser.html#startauthentication><strong>@simplewebauthn/browser</strong>'s <code>startAuthentication()</code></a> method and then verify it:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> body </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> req</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Retrieve the user record for the account identifier (email, username, etc...) that</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// the unauthenticated user entered</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> user</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> UserModel </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUserFromDBByUsername</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">submittedUsername</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode) Get `options.challenge` that was saved above</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> currentOptions</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> PublicKeyCredentialRequestOptionsJSON </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>getCurrentAuthenticationOptions</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (Pseudocode} Retrieve a passkey from the DB that</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// should match the `id` in the returned credential</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> passkey</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Passkey </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUserPasskey</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> body</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token plain">passkey</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>throw</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style=color:#393A34>(</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token template-string string" style=color:#e3116c>Could not find passkey </span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string interpolation">body</span><span class="token template-string interpolation punctuation" style=color:#393A34>.</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string string" style=color:#e3116c> for user </span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string interpolation">user</span><span class="token template-string interpolation punctuation" style=color:#393A34>.</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> verification</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  verification </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>verifyAuthenticationResponse</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    response</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> body</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    expectedChallenge</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> currentOptions</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">challenge</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    expectedOrigin</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> origin</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    expectedRPID</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> rpID</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    credential</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> passkey</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      publicKey</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> passkey</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">publicKey</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      counter</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> passkey</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">counter</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      transports</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> passkey</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transports</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">error</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token builtin">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>error</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">error</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> res</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>status</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>400</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>send</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> error</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> error</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">message </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> verified </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> verification</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>When finished, it's a good idea to return the verification status to the browser to display
appropriate UI:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> verified </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>Support for multiple origins and RP IDs</div><div class=admonitionContent_BuS1><p>SimpleWebAuthn optionally supports verifying authentications from multiple origins and RP IDs! Simply pass in an array of possible origins and IDs for <code>expectedOrigin</code> and <code>expectedRPID</code> respectively.</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-post-authentication-responsibilities>3. Post-authentication responsibilities<a href=#3-post-authentication-responsibilities class=hash-link aria-label="Direct link to 3. Post-authentication responsibilities" title="Direct link to 3. Post-authentication responsibilities">​</a></h3>
<p>Assuming <code>verification.verified</code> is true, then update the user's authenticator's <code>counter</code> property in the DB:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> authenticationInfo </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> verification</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> newCounter </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> authenticationInfo</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>saveUpdatedCounter</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">passkey</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> newCounter</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=troubleshooting>Troubleshooting<a href=#troubleshooting class=hash-link aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h2>
<p>Below are errors you may see while using this library, and potential solutions to them:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=domexception-notsupportederror-unrecognized-name>DOMException [NotSupportedError]: Unrecognized name.<a href=#domexception-notsupportederror-unrecognized-name class=hash-link aria-label="Direct link to DOMException [NotSupportedError]: Unrecognized name." title="Direct link to DOMException [NotSupportedError]: Unrecognized name.">​</a></h3>
<p>Authentication responses may unexpectedly error out during verification. This appears as the throwing of an "Unrecognized name" error from a call to <code>verifyAuthenticationResponse()</code> with the following stack trace:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">DOMException [NotSupportedError]: Unrecognized name.</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at new DOMException (node:internal/per_context/domexception:70:5)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at __node_internal_ (node:internal/util:477:10)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at normalizeAlgorithm (node:internal/crypto/util:220:15)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at SubtleCrypto.importKey (node:internal/crypto/webcrypto:503:15)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at importKey (/Users/swan/Developer/simplewebauthn/packages/server/src/helpers/iso/isoCrypto/importKey.ts:9:27)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at verifyOKP (/Users/swan/Developer/simplewebauthn/packages/server/src/helpers/iso/isoCrypto/verifyOKP.ts:57:30)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at Object.verify (/Users/swan/Developer/simplewebauthn/packages/server/src/helpers/iso/isoCrypto/verify.ts:31:21)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at verifySignature (/Users/swan/Developer/simplewebauthn/packages/server/src/helpers/verifySignature.ts:34:20)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at verifyAuthenticationResponse (/Users/swan/Developer/simplewebauthn/packages/server/src/authentication/verifyAuthenticationResponse.ts:206:36)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at async /Users/swan/Developer/simplewebauthn/packages/server/345.ts:26:24</span><br></span></code></pre></div></div>
<p>This appears to be an issue with some environments running <strong>versions of Node prior to v18 LTS</strong>.</p>
<p>To fix this, update your call to <code>generateRegistrationOptions()</code> to exclude <code>-8</code> (Ed25519) from the list of algorithms:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> options </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>generateRegistrationOptions</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  supportedAlgorithmIDs</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>7</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>257</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>You will then need to re-register any authenticators that generated credentials that cause this error.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=error-signature-verification-with-public-key-of-kty-okp-is-not-supported-by-this-method>Error: Signature verification with public key of kty OKP is not supported by this method<a href=#error-signature-verification-with-public-key-of-kty-okp-is-not-supported-by-this-method class=hash-link aria-label="Direct link to Error: Signature verification with public key of kty OKP is not supported by this method" title="Direct link to Error: Signature verification with public key of kty OKP is not supported by this method">​</a></h3>
<p>Authentication responses may unexpectedly error out during verification. This appears as the throwing of a "Signature verification with public key of kty OKP is not supported" error from a call to <code>verifyAuthenticationResponse()</code> with the following stack trace:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">Error: Signature verification with public key of kty OKP is not supported by this method</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at Object.verify (/xxx/node_modules/@simplewebauthn/server/script/helpers/iso/isoCrypto/verify.js:30:11)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at verifySignature (/xxx/node_modules/@simplewebauthn/server/script/helpers/verifySignature.js:25:76)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at verifyAuthenticationResponse (/xxx/node_modules/@simplewebauthn/server/script/authentication/verifyAuthenticationResponse.js:162:66)</span><br></span></code></pre></div></div>
<p>This is caused by <strong>security key responses in Firefox 118 and earlier being incorrectly composed by the browser</strong> when the security key uses <strong>Ed25519</strong> for its credential keypair.</p>
<p>To fix this, update your call to <code>generateRegistrationOptions()</code> to exclude <code>-8</code> (Ed25519) from the list of algorithms:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> options </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>generateRegistrationOptions</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  supportedAlgorithmIDs</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>7</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>257</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>You will then need to re-register any authenticators that generated credentials that cause this error.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=error-extractstrings-is-not-a-function>ERROR extractStrings is not a function<a href=#error-extractstrings-is-not-a-function class=hash-link aria-label="Direct link to ERROR extractStrings is not a function" title="Direct link to ERROR extractStrings is not a function">​</a></h3>
<p>Registration responses may unexpectedly error out during verification. This appears as the throwing of an "extractStrings is not a function" error from a call to <code>verifyRegistrationResponse()</code> with the following stack trace:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">ERROR  extractStrings is not a function</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at readString (/node_modules/.pnpm/<a href="https://simplewebauthn.dev/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8cefeee3fea1f4ccbda2b9a2ba">[email&#160;protected]</a>/node_modules/cbor-x/dist/node.cjs:520:1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at read (/node_modules/.pnpm/<a href="https://simplewebauthn.dev/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="91f2f3fee3bce9d1a0bfa4bfa7">[email&#160;protected]</a>/node_modules/cbor-x/dist/node.cjs:343:1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at read (/node_modules/.pnpm/<a href="https://simplewebauthn.dev/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e586878a97c89da5d4cbd0cbd3">[email&#160;protected]</a>/node_modules/cbor-x/dist/node.cjs:363:1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at checkedRead (/node_modules/.pnpm/<a href="https://simplewebauthn.dev/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fb98999489d683bbcad5ced5cd">[email&#160;protected]</a>/node_modules/cbor-x/dist/node.cjs:202:1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at Encoder.decode (/node_modules/.pnpm/<a href="https://simplewebauthn.dev/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1271707d603f6a52233c273c24">[email&#160;protected]</a>/node_modules/cbor-x/dist/node.cjs:153:1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at Encoder.decodeMultiple (/node_modules/.pnpm/<a href="https://simplewebauthn.dev/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="91f2f3fee3bce9d1a0bfa4bfa7">[email&#160;protected]</a>/node_modules/cbor-x/dist/node.cjs:170:1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at Object.decodeFirst (/node_modules/.pnpm/@<a href="https://simplewebauthn.dev/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="88fbe1e5f8e4edffedeae9fdfce0e6a3fbedfafeedfac8b0a6bba6bd">[email&#160;protected]</a>/node_modules/@simplewebauthn/server/script/helpers/iso/isoCBOR.js:30:1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at decodeAttestationObject (/node_modules/.pnpm/@<a href="https://simplewebauthn.dev/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="087b616578646d7f6d6a697d7c6066237b6d7a7e6d7a4830263b263d">[email&#160;protected]</a>/node_modules/@simplewebauthn/server/script/helpers/decodeAttestationObject.js:12:1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at verifyRegistrationResponse (/node_modules/.pnpm/@<a href="https://simplewebauthn.dev/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d9aab0b4a9b5bcaebcbbb8acadb1b7f2aabcabafbcab99e1f7eaf7ec">[email&#160;protected]</a>/node_modules/@simplewebauthn/server/script/registration/verifyRegistrationResponse.js:100:1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at AuthnService.verifyRegistrationResponse (/home/deploy/mx/modules/authn/authn.service.js:89:1)</span><br></span></code></pre></div></div>
<p>This is caused by the <code>@vercel/ncc</code> dependency not supporting runtime use of <code>require()</code> within other third-party packages used by the project, like <strong>@simplewebauthn/server</strong>'s use of <strong>cbor-x</strong>.</p>
<p>To fix this, add <code>CBOR_NATIVE_ACCELERATION_DISABLED=true</code> in your project's env file to disable the use of <code>require()</code> in <strong>cbor-x</strong>.</p>
<p><strong>Alternatively</strong>, the following can be added to your project to inject this value into your project's runtime environment:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>nodeEnvInjection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token doc-comment comment" style=color:#999988;font-style:italic>/**</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic>   * `@vercel/ncc` does not support the use of `require()` so disable its</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic>   * use in the `@simplewebauthn/server` dependency called `cbor-x`.</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic>   *</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic>   * https://github.com/kriszyp/cbor-x/blob/master/node-index.js#L10</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  process</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">env</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'CBOR_NATIVE_ACCELERATION_DISABLED'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'true'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Call this at the start of the project, before any imports</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>nodeEnvInjection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=error-no-data>Error: No data<a href=#error-no-data class=hash-link aria-label="Direct link to Error: No data" title="Direct link to Error: No data">​</a></h3>
<p>Calls to <code>verifyAuthenticationResponse()</code> may unexpectedly error out with <code>Error: No data</code> in projects that store credential public keys as <code>Binary</code> data types in <a href=https://www.mongodb.com/ target=_blank rel="noopener noreferrer">MongoDB</a>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">Error: No data</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at Module.decodePartialCBOR (file:///path/to/app/node_modules/@levischuck/tiny-cbor/esm/cbor/cbor.js:351:15)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at Module.decodeFirst (file:///path/to/app/node_modules/@simplewebauthn/server/esm/helpers/iso/isoCBOR.js:22:30)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at decodeCredentialPublicKey (file:///path/to/app/node_modules/@simplewebauthn/server/esm/helpers/decodeCredentialPublicKey.js:3:65)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at verifySignature (file:///path/to/app/node_modules/@simplewebauthn/server/esm/helpers/verifySignature.js:17:25)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at verifyAuthenticationResponse (file:///path/to/app/node_modules/@simplewebauthn/server/esm/authentication/verifyAuthenticationResponse.js:154:25)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    at async file:///path/to/app/dist/controller/auth.controller.js:202:28</span><br></span></code></pre></div></div>
<p>To fix this, massage the <code>Binary</code> public key bytes into an instance of <code>Uint8Array</code> that <code>verifyAuthenticationResponse()</code> expects:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> verification </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>verifyAuthenticationResponse</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token literal-property property" style=color:#36acaa>authenticator</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>credentialPublicKey</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Uint8Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">credentialPublicKey</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">buffer</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=error-string-values-for-userid-are-no-longer-supported>Error: String values for `userID` are no longer supported<a href=#error-string-values-for-userid-are-no-longer-supported class=hash-link aria-label="Direct link to Error: String values for `userID` are no longer supported" title="Direct link to Error: String values for `userID` are no longer supported">​</a></h3>
<p>See <a href=../advanced/server/custom-user-ids.html#error-string-values-for-userid-are-no-longer-supported>Advanced Guides > @simplewebauthn/server > Custom User IDs</a> for more information.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=typeerror-cannot-read-properties-of-undefined-reading-counter>TypeError: Cannot read properties of undefined (reading 'counter')<a href=#typeerror-cannot-read-properties-of-undefined-reading-counter class=hash-link aria-label="Direct link to TypeError: Cannot read properties of undefined (reading 'counter')" title="Direct link to TypeError: Cannot read properties of undefined (reading 'counter')">​</a></h3>
<p>As of SimpleWebAuthn v11.0.0 the <code>verifyAuthenticationResponse()</code> method expects a <code>credential</code> argument of type <code>WebAuthnCredential</code> that contains values like the credential ID, public key, and counter needed to verify the response. In prior versions, this argument was called <code>authenticator</code> of the now defunct type <code>AuthenticatorDevice</code>. If you see this error it is likely caused by <code>authenticator</code> not being refactored into the new <code>credential</code> argument.</p>
<p>To fix this issue, update the call to <code>verifyAuthenticationResponse()</code> to replace <code>authenticator</code> with <code>credential</code> of type <code>WebAuthnCredential</code>:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=before>Before<a href=#before class=hash-link aria-label="Direct link to Before" title="Direct link to Before">​</a></h4>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> AuthenticatorDevice </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@simplewebauthn/types'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> authenticator</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> AuthenticatorDevice </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  credentialID</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  credentialPublicKey</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  counter</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  transports</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> verification </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>verifyAuthenticationResponse</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  authenticator</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=after>After<a href=#after class=hash-link aria-label="Direct link to After" title="Direct link to After">​</a></h4>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> WebAuthnCredential </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@simplewebauthn/server'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> credential</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> WebAuthnCredential </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">            </span><span class="token comment" style=color:#999988;font-style:italic>// Same as authenticator.credentialID</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  publicKey</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">     </span><span class="token comment" style=color:#999988;font-style:italic>// Same as authenticator.credentialPublicKey</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  counter</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">         </span><span class="token comment" style=color:#999988;font-style:italic>// Same as authenticator.counter</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  transports</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Same as authenticator.transports</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> verification </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>verifyAuthenticationResponse</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  credential</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/MasterKale/SimpleWebAuthn-homepage/edit/master/docs/packages/server.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=browser.html><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>@simplewebauthn/browser</div></a><a class="pagination-nav__link pagination-nav__link--next" href=types.html><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>@simplewebauthn/types</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#current-version class="table-of-contents__link toc-highlight">Current version</a><li><a href=#installation class="table-of-contents__link toc-highlight">Installation</a><ul><li><a href=#node-lts-20x-and-higher class="table-of-contents__link toc-highlight">Node LTS 20.x and higher</a><li><a href=#deno-v143-and-higher class="table-of-contents__link toc-highlight">Deno v1.43 and higher</a></ul><li><a href=#types class="table-of-contents__link toc-highlight">Types</a><li><a href=#additional-data-structures class="table-of-contents__link toc-highlight">Additional data structures</a><li><a href=#identifying-your-rp class="table-of-contents__link toc-highlight">Identifying your RP</a><li><a href=#registration class="table-of-contents__link toc-highlight">Registration</a><ul><li><a href=#1-generate-registration-options class="table-of-contents__link toc-highlight">1. Generate registration options</a><li><a href=#1a-supported-attestation-formats class="table-of-contents__link toc-highlight">1a. Supported Attestation Formats</a><li><a href=#2-verify-registration-response class="table-of-contents__link toc-highlight">2. Verify registration response</a><li><a href=#3-post-registration-responsibilities class="table-of-contents__link toc-highlight">3. Post-registration responsibilities</a></ul><li><a href=#authentication class="table-of-contents__link toc-highlight">Authentication</a><ul><li><a href=#1-generate-authentication-options class="table-of-contents__link toc-highlight">1. Generate authentication options</a><li><a href=#2-verify-authentication-response class="table-of-contents__link toc-highlight">2. Verify authentication response</a><li><a href=#3-post-authentication-responsibilities class="table-of-contents__link toc-highlight">3. Post-authentication responsibilities</a></ul><li><a href=#troubleshooting class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href=#domexception-notsupportederror-unrecognized-name class="table-of-contents__link toc-highlight">DOMException [NotSupportedError]: Unrecognized name.</a><li><a href=#error-signature-verification-with-public-key-of-kty-okp-is-not-supported-by-this-method class="table-of-contents__link toc-highlight">Error: Signature verification with public key of kty OKP is not supported by this method</a><li><a href=#error-extractstrings-is-not-a-function class="table-of-contents__link toc-highlight">ERROR extractStrings is not a function</a><li><a href=#error-no-data class="table-of-contents__link toc-highlight">Error: No data</a><li><a href=#error-string-values-for-userid-are-no-longer-supported class="table-of-contents__link toc-highlight">Error: String values for `userID` are no longer supported</a><li><a href=#typeerror-cannot-read-properties-of-undefined-reading-counter class="table-of-contents__link toc-highlight">TypeError: Cannot read properties of undefined (reading 'counter')</a></ul></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>
        <strong>Copyright © 2025 Matthew Miller. Built with Docusaurus.</strong>
        <sub>FIDO® is a trademark of FIDO Alliance, Inc.</sub>
        <sub><a href=https://a0.to/signup/simplewebauthn>Sponsored by Auth0 by Okta</a></sub>
      </div></div></div></footer></div><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"5c31f56a44644210823ca8546d62c9d2","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>