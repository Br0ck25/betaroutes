[
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\app.js",
		"messages": [
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startTotalMinutes' is never reassigned. Use 'const' instead.",
				"line": 1544,
				"column": 7,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 1544,
				"endColumn": 24,
				"fix": {
					"range": [50650, 50705],
					"text": "const startTotalMinutes = startHours * 60 + startMinutes;"
				}
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 1652,
				"column": 8,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 1652,
				"endColumn": 16,
				"fix": { "range": [54832, 54860], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 1691,
				"column": 8,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 1691,
				"endColumn": 16,
				"fix": { "range": [56606, 56634], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 1709,
				"column": 9,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 1709,
				"endColumn": 17,
				"fix": { "range": [57260, 57288], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 1855,
				"column": 9,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 1855,
				"endColumn": 17,
				"fix": { "range": [62582, 62610], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 2006,
				"column": 7,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 2006,
				"endColumn": 15,
				"fix": { "range": [68618, 68646], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 2670,
				"column": 7,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 2670,
				"endColumn": 15,
				"fix": { "range": [90999, 91027], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startTotalMinutes' is never reassigned. Use 'const' instead.",
				"line": 3249,
				"column": 7,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3249,
				"endColumn": 24,
				"fix": {
					"range": [108242, 108297],
					"text": "const startTotalMinutes = startHours * 60 + startMinutes;"
				}
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 3297,
				"column": 8,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3297,
				"endColumn": 16,
				"fix": { "range": [109723, 109751], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'start' is never reassigned. Use 'const' instead.",
				"line": 3345,
				"column": 6,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3345,
				"endColumn": 11,
				"fix": {
					"range": [111398, 111441],
					"text": "const start = startHours * 60 + startMinutes;"
				}
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 3388,
				"column": 8,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3388,
				"endColumn": 16,
				"fix": { "range": [112996, 113024], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 3444,
				"column": 6,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3444,
				"endColumn": 14,
				"fix": { "range": [115709, 115737], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 3569,
				"column": 8,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3569,
				"endColumn": 16,
				"fix": { "range": [119691, 119719], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 3626,
				"column": 8,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3626,
				"endColumn": 16,
				"fix": { "range": [121596, 121624], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 3719,
				"column": 8,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3719,
				"endColumn": 16,
				"fix": { "range": [124169, 124197], "text": "const startMin = sh * 60 + sm;" }
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 3772,
				"column": 8,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3772,
				"endColumn": 16,
				"fix": { "range": [125777, 125805], "text": "const startMin = sh * 60 + sm;" }
			}
		],
		"suppressedMessages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'deleteMaintenanceCategoryFromModal' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 290,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 290,
				"endColumn": 44,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML onclick" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'deleteSupplyCategoryFromModal' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 348,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 348,
				"endColumn": 39,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML onclick" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'autocompleteEnd' is assigned a value but never used. Allowed unused vars must match /^_/u.",
				"line": 733,
				"column": 24,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 733,
				"endColumn": 39,
				"suppressions": [
					{
						"kind": "directive",
						"justification": "references kept for Google Maps event listeners"
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'calculateRoute' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 1499,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 1499,
				"endColumn": 30,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'openInGoogleMaps' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 1727,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 1727,
				"endColumn": 26,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'optimizeRoute' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 1762,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 1762,
				"endColumn": 29,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'deleteDestination' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 1956,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 1956,
				"endColumn": 27,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'moveDestinationUp' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 1963,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 1963,
				"endColumn": 27,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'moveDestinationDown' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 1974,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 1974,
				"endColumn": 29,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'prevPage' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2122,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2122,
				"endColumn": 18,
				"suppressions": [{ "kind": "directive", "justification": "used by UI controls" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'nextPage' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2131,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2131,
				"endColumn": 18,
				"suppressions": [{ "kind": "directive", "justification": "used by UI controls" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'goToPage' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2141,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2141,
				"endColumn": 18,
				"suppressions": [{ "kind": "directive", "justification": "used by UI controls" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'deleteLogEntry' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2155,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2155,
				"endColumn": 24,
				"suppressions": [{ "kind": "directive", "justification": "used by UI controls" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'moveEditDestinationUp' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2275,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2275,
				"endColumn": 31,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'moveEditDestinationDown' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2288,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2288,
				"endColumn": 33,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'deleteEditDestination' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2397,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2397,
				"endColumn": 31,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'openEditForm' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2409,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2409,
				"endColumn": 22,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML handlers" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'saveEditedLogEntry' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2604,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2604,
				"endColumn": 34,
				"suppressions": [{ "kind": "directive", "justification": "used by UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'importLog' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2691,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2691,
				"endColumn": 25,
				"suppressions": [{ "kind": "directive", "justification": "used by UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'toggleAuthMode' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2847,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2847,
				"endColumn": 24,
				"suppressions": [{ "kind": "directive", "justification": "used by auth UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'submitAuth' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2857,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2857,
				"endColumn": 26,
				"suppressions": [{ "kind": "directive", "justification": "used by auth UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'logout' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2923,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2923,
				"endColumn": 16,
				"suppressions": [{ "kind": "directive", "justification": "used by auth UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'showPasswordModal' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2960,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2960,
				"endColumn": 27,
				"suppressions": [{ "kind": "directive", "justification": "used by auth UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'submitPasswordChange' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 2969,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 2969,
				"endColumn": 36,
				"suppressions": [{ "kind": "directive", "justification": "used by auth UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'showResetModal' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 3009,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 3009,
				"endColumn": 24,
				"suppressions": [{ "kind": "directive", "justification": "used by auth UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'submitResetPassword' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 3018,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 3018,
				"endColumn": 35,
				"suppressions": [{ "kind": "directive", "justification": "used by auth UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'showDeleteModal' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 3044,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 3044,
				"endColumn": 25,
				"suppressions": [{ "kind": "directive", "justification": "used by auth UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'submitDeleteAccount' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 3053,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 3053,
				"endColumn": 35,
				"suppressions": [{ "kind": "directive", "justification": "used by auth UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'openLogEntryInGoogleMaps' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 3212,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 3212,
				"endColumn": 34,
				"suppressions": [{ "kind": "directive", "justification": "used by UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'formatCurrency' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 3267,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 3267,
				"endColumn": 24,
				"suppressions": [{ "kind": "directive", "justification": "used by UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'toggleLogEntryDetails' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 3363,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 3363,
				"endColumn": 31,
				"suppressions": [{ "kind": "directive", "justification": "used by UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'calculateTotals' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 3497,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 3497,
				"endColumn": 25,
				"suppressions": [{ "kind": "directive", "justification": "used by UI" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'handleGoogleSignIn' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 3870,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 3870,
				"endColumn": 34,
				"suppressions": [{ "kind": "directive", "justification": "used by Google auth callback" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'onGoogleLogin' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 4000,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 4000,
				"endColumn": 29,
				"suppressions": [
					{ "kind": "directive", "justification": "used by Google auth callback in static pages" }
				]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'upgradeToPro' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 4182,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 4182,
				"endColumn": 28,
				"suppressions": [
					{ "kind": "directive", "justification": "referenced by inline HTML in static pages" }
				]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'logResults' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 4263,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 4263,
				"endColumn": 26,
				"suppressions": [{ "kind": "directive", "justification": "used by inline HTML" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'updateSubscriptionInfoInMenu' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 4332,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 4332,
				"endColumn": 44,
				"suppressions": [{ "kind": "directive", "justification": "used by UI" }]
			}
		],
		"errorCount": 16,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 16,
		"fixableWarningCount": 0,
		"source": "/* Legacy bundle: expose globals used by inline HTML. Lint rules will be satisfied by explicit exports at the bottom of this file. */\n\ndocument.addEventListener('DOMContentLoaded', () => {\n\tif (typeof updateAuthUI === 'function') {\n\t\tupdateAuthUI();\n\t}\n});\n\nfunction clearTripForm() {\n\t// Reset date to today\n\tconst today = new Date().toLocaleDateString('en-CA'); // format: YYYY-MM-DD in local time\n\n\tdocument.getElementById('log-date').value = today;\n\n\t//  Clear only optional fields\n\tdocument.getElementById('start-time').value = '';\n\tdocument.getElementById('end-time').value = '';\n\tdocument.getElementById('total-hours').value = '';\n\tdocument.getElementById('log-notes').value = '';\n\n\t// Clear all maintenance and supply items\n\tdocument.getElementById('maintenance-container').innerHTML = '';\n\tdocument.getElementById('supplies-container').innerHTML = '';\n\n\t//  Keep start, end, mpg, and gas-price\n\n\t// Reset destinations\n\tconst container = document.getElementById('destinations-container');\n\tcontainer.innerHTML = '';\n\n\t// Add one fresh destination block\n\tconst div = document.createElement('div');\n\tdiv.classList.add('destination');\n\tdiv.innerHTML = `\n    <label for=\"destination-1\">Destination 1</label>\n    <input type=\"text\" id=\"destination-1\" list=\"recent-destinations\" placeholder=\"Enter destination address\" required>\n    <label for=\"earnings-1\">Earnings for Destination 1</label>\n    <input type=\"number\" id=\"earnings-1\" placeholder=\"Enter earnings for destination\" required>\n    <div class=\"destination-actions\">\n      <button class=\"delete-btn\" onclick=\"deleteDestination(this)\">Delete</button>\n      <button class=\"move-btn\" onclick=\"moveDestinationUp(this)\">Move Up</button>\n      <button class=\"move-btn\" onclick=\"moveDestinationDown(this)\">Move Down</button>\n    </div>\n  `;\n\tcontainer.appendChild(div);\n\tinitAutocompleteDestination(div.querySelector('input[type=\"text\"]'));\n\n\t// Hide results and reset UI\n\tdocument.getElementById('results').classList.add('hidden');\n\tdocument.getElementById('map').classList.add('hidden');\n\tdocument.getElementById('detailed-results').innerHTML = '';\n\tdocument.getElementById('mileage-display').textContent = '';\n\tdocument.getElementById('optimized-mileage-display').textContent = '';\n}\n\n// Maintenance categories management\n// counter removed: maintenanceItemCounter unused\n\nfunction getDefaultMaintenanceCategories() {\n\treturn ['Oil Change', 'Tire Rotation', 'Brake Service', 'Battery'];\n}\n\nfunction getAllMaintenanceCategories() {\n\tconst saved = localStorage.getItem('maintenanceCategories');\n\tif (saved) {\n\t\treturn JSON.parse(saved);\n\t}\n\t// Return defaults if nothing saved yet\n\treturn getDefaultMaintenanceCategories();\n}\n\nfunction saveMaintenanceCategory(typeName) {\n\tif (!typeName || typeName.trim() === '') return;\n\n\tconst allCategories = getAllMaintenanceCategories();\n\tconst trimmed = typeName.trim();\n\n\tif (allCategories.includes(trimmed)) {\n\t\treturn; // Already exists\n\t}\n\n\tallCategories.push(trimmed);\n\tlocalStorage.setItem('maintenanceCategories', JSON.stringify(allCategories));\n\n\tsyncCustomCategoriesToCloud();\n}\n\nfunction deleteMaintenanceCategory(typeName) {\n\tconst allCategories = getAllMaintenanceCategories();\n\tconst filtered = allCategories.filter((t) => t !== typeName);\n\n\t// Always allow deletion - even if it results in empty list\n\tlocalStorage.setItem('maintenanceCategories', JSON.stringify(filtered));\n\n\tsyncCustomCategoriesToCloud();\n}\n\nfunction getCustomMaintenanceTypes() {\n\tconst saved = localStorage.getItem('customMaintenanceTypes');\n\treturn saved ? JSON.parse(saved) : [];\n}\n\nfunction saveCustomMaintenanceType(typeName) {\n\tif (!typeName || typeName.trim() === '') return;\n\n\tconst customTypes = getCustomMaintenanceTypes();\n\tconst trimmed = typeName.trim();\n\n\tconst presetTypes = ['Oil Change', 'Tire Rotation', 'Brake Service', 'Battery'];\n\tif (presetTypes.includes(trimmed) || customTypes.includes(trimmed)) {\n\t\treturn;\n\t}\n\n\tcustomTypes.push(trimmed);\n\tlocalStorage.setItem('customMaintenanceTypes', JSON.stringify(customTypes));\n\n\tsyncCustomCategoriesToCloud();\n}\n\n// removed: deleteCustomMaintenanceType — no references found outside this bundle\n\nfunction getCustomSupplyTypes() {\n\tconst saved = localStorage.getItem('customSupplyTypes');\n\treturn saved ? JSON.parse(saved) : [];\n}\n\nfunction saveCustomSupplyType(typeName) {\n\tif (!typeName || typeName.trim() === '') return;\n\n\tconst customTypes = getCustomSupplyTypes();\n\tconst trimmed = typeName.trim();\n\n\t// Don't save if it's a preset type or already exists\n\tconst presetTypes = ['Poles', 'Concrete', 'Cable'];\n\tif (presetTypes.includes(trimmed) || customTypes.includes(trimmed)) {\n\t\treturn;\n\t}\n\n\tcustomTypes.push(trimmed);\n\tlocalStorage.setItem('customSupplyTypes', JSON.stringify(customTypes));\n\n\t// Sync to cloud if signed in\n\tsyncCustomCategoriesToCloud();\n}\n\n// removed: deleteCustomSupplyType — no references found outside this bundle\n\n// Sync custom categories to/from cloud\nasync function syncCustomCategoriesToCloud() {\n\tconst token = localStorage.getItem('token');\n\tif (!token) return; // Not signed in\n\n\tconst categories = {\n\t\tmaintenance: getCustomMaintenanceTypes(),\n\t\tsupplies: getCustomSupplyTypes()\n\t};\n\n\ttry {\n\t\tawait fetch('https://logs.gorouteyourself.com/categories', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\tAuthorization: token\n\t\t\t},\n\t\t\tbody: JSON.stringify(categories)\n\t\t});\n\t} catch (err) {\n\t\tconsole.error('Failed to sync categories:', err);\n\t}\n}\n\nasync function loadCustomCategoriesFromCloud() {\n\tconst token = localStorage.getItem('token');\n\tif (!token) return; // Not signed in\n\n\ttry {\n\t\tconst response = await fetch('https://logs.gorouteyourself.com/categories', {\n\t\t\theaders: { Authorization: token }\n\t\t});\n\n\t\tif (response.ok) {\n\t\t\tconst categories = await response.json();\n\n\t\t\tif (categories.maintenance) {\n\t\t\t\tlocalStorage.setItem('customMaintenanceTypes', JSON.stringify(categories.maintenance));\n\t\t\t}\n\t\t\tif (categories.supplies) {\n\t\t\t\tlocalStorage.setItem('customSupplyTypes', JSON.stringify(categories.supplies));\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\tconsole.error('Failed to load categories:', err);\n\t}\n}\n\nfunction addMaintenanceItem() {\n\tconst container = document.getElementById('maintenance-container');\n\tconst itemDiv = document.createElement('div');\n\titemDiv.classList.add('maintenance-item');\n\titemDiv.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px; align-items: center;';\n\n\t// Get ALL categories (presets + custom)\n\tconst allCategories = getAllMaintenanceCategories();\n\tconst categoryOptions = allCategories\n\t\t.map((type) => `<option value=\"${type}\">${type}</option>`)\n\t\t.join('');\n\n\titemDiv.innerHTML = `\n    <select class=\"maintenance-type\" style=\"flex: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;\">\n      ${categoryOptions}\n      <option value=\"Custom\">+ Add Custom</option>\n      <option value=\"__MANAGE__\" style=\"color: #007bff; font-weight: bold;\">⚙ Manage Categories</option>\n    </select>\n    <input type=\"text\" class=\"maintenance-custom-name\" placeholder=\"Enter item name\" style=\"flex: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; display: none;\">\n    <input type=\"number\" class=\"maintenance-cost\" placeholder=\"Cost\" style=\"width: 120px; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;\" step=\"0.01\">\n    <button type=\"button\" onclick=\"removeMaintenanceItem(this)\" style=\"background-color: #dc3545; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;\">Delete</button>\n  `;\n\n\tcontainer.appendChild(itemDiv);\n\n\tconst select = itemDiv.querySelector('.maintenance-type');\n\tconst customInput = itemDiv.querySelector('.maintenance-custom-name');\n\n\tselect.addEventListener('change', function () {\n\t\tif (this.value === 'Custom') {\n\t\t\tcustomInput.style.display = 'block';\n\t\t\tcustomInput.required = true;\n\t\t\tcustomInput.focus();\n\t\t} else if (this.value === '__MANAGE__') {\n\t\t\topenManageMaintenanceModal();\n\t\t\tthis.selectedIndex = 0;\n\t\t} else {\n\t\t\tcustomInput.style.display = 'none';\n\t\t\tcustomInput.required = false;\n\t\t\tcustomInput.value = '';\n\t\t}\n\t});\n\n\tcustomInput.addEventListener('blur', function () {\n\t\tif (this.value.trim()) {\n\t\t\tconst newType = this.value.trim();\n\t\t\tsaveMaintenanceCategory(newType);\n\n\t\t\tconst option = document.createElement('option');\n\t\t\toption.value = newType;\n\t\t\toption.textContent = newType;\n\t\t\toption.selected = true;\n\n\t\t\tconst customOption = select.querySelector('option[value=\"Custom\"]');\n\t\t\tselect.insertBefore(option, customOption);\n\n\t\t\tcustomInput.style.display = 'none';\n\t\t\tcustomInput.value = '';\n\t\t}\n\t});\n}\n\nfunction openManageMaintenanceModal() {\n\tconst allCategories = getAllMaintenanceCategories();\n\n\tif (allCategories.length === 0) {\n\t\tshowAlertModal(\n\t\t\t\"You don't have any maintenance categories. Click '+ Add Custom' to create one!\"\n\t\t);\n\t\treturn;\n\t}\n\n\tconst categoryList = allCategories\n\t\t.map(\n\t\t\t(type) =>\n\t\t\t\t`<div style=\"display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;\">\n      <span style=\"flex: 1;\">${type}</span>\n      <button onclick=\"deleteMaintenanceCategoryFromModal('${type.replace(/'/g, \"\\\\'\")}'); event.stopPropagation();\" style=\"background-color: #dc3545; color: white; padding: 5px 15px; border: none; border-radius: 5px; cursor: pointer;\">Delete</button>\n    </div>`\n\t\t)\n\t\t.join('');\n\n\tshowAlertModal(`\n    <h3 style=\"margin-top: 0;\">Manage Maintenance Categories</h3>\n    <div style=\"max-height: 400px; overflow-y: auto; margin: 20px 0;\">\n      ${categoryList}\n    </div>\n    <p style=\"font-size: 14px; color: #666; margin-top: 20px;\">\n      You can delete any category. Changes sync across all your devices if you're signed in.\n    </p>\n  `);\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML onclick */\nfunction deleteMaintenanceCategoryFromModal(typeName) {\n\tdeleteMaintenanceCategory(typeName);\n\tcloseUniversalModal();\n\n\t// Refresh all maintenance dropdowns\n\tdocument.querySelectorAll('.maintenance-type').forEach((select) => {\n\t\tconst currentValue = select.value;\n\t\tconst allCategories = getAllMaintenanceCategories();\n\t\tconst categoryOptions = allCategories\n\t\t\t.map((type) => `<option value=\"${type}\">${type}</option>`)\n\t\t\t.join('');\n\n\t\t// Rebuild options\n\t\tselect.innerHTML = `\n      ${categoryOptions}\n      <option value=\"Custom\">+ Add Custom</option>\n      <option value=\"__MANAGE__\" style=\"color: #007bff; font-weight: bold;\">⚙ Manage Categories</option>\n    `;\n\n\t\t// Restore selection if still valid\n\t\tif (currentValue && currentValue !== typeName && currentValue !== '__MANAGE__') {\n\t\t\tselect.value = currentValue;\n\t\t}\n\t});\n\n\tshowConfirmationMessage(`Deleted \"${typeName}\" from maintenance categories`);\n}\n\nfunction openManageSuppliesModal() {\n\tconst allCategories = getAllSupplyCategories();\n\n\tif (allCategories.length === 0) {\n\t\tshowAlertModal(\"You don't have any supply categories. Click '+ Add Custom' to create one!\");\n\t\treturn;\n\t}\n\n\tconst categoryList = allCategories\n\t\t.map(\n\t\t\t(type) =>\n\t\t\t\t`<div style=\"display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;\">\n      <span style=\"flex: 1;\">${type}</span>\n      <button onclick=\"deleteSupplyCategoryFromModal('${type.replace(/'/g, \"\\\\'\")}'); event.stopPropagation();\" style=\"background-color: #dc3545; color: white; padding: 5px 15px; border: none; border-radius: 5px; cursor: pointer;\">Delete</button>\n    </div>`\n\t\t)\n\t\t.join('');\n\n\tshowAlertModal(`\n    <h3 style=\"margin-top: 0;\">Manage Supply Categories</h3>\n    <div style=\"max-height: 400px; overflow-y: auto; margin: 20px 0;\">\n      ${categoryList}\n    </div>\n    <p style=\"font-size: 14px; color: #666; margin-top: 20px;\">\n      You can delete any category. Changes sync across all your devices if you're signed in.\n    </p>\n  `);\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML onclick */\nfunction deleteSupplyCategoryFromModal(typeName) {\n\tdeleteSupplyCategory(typeName);\n\tcloseUniversalModal();\n\n\t// Refresh all supply dropdowns\n\tdocument.querySelectorAll('.supply-type').forEach((select) => {\n\t\tconst currentValue = select.value;\n\t\tconst allCategories = getAllSupplyCategories();\n\t\tconst categoryOptions = allCategories\n\t\t\t.map((type) => `<option value=\"${type}\">${type}</option>`)\n\t\t\t.join('');\n\n\t\t// Rebuild options\n\t\tselect.innerHTML = `\n      ${categoryOptions}\n      <option value=\"Custom\">+ Add Custom</option>\n      <option value=\"__MANAGE__\" style=\"color: #007bff; font-weight: bold;\">⚙ Manage Categories</option>\n    `;\n\n\t\t// Restore selection if still valid\n\t\tif (currentValue && currentValue !== typeName && currentValue !== '__MANAGE__') {\n\t\t\tselect.value = currentValue;\n\t\t}\n\t});\n\n\tshowConfirmationMessage(`Deleted \"${typeName}\" from supply categories`);\n}\n\nfunction removeMaintenanceItem(button) {\n\tbutton.closest('.maintenance-item').remove();\n}\n\nfunction getMaintenanceData() {\n\tconst maintenance = [];\n\tconst maintenanceItems = document.querySelectorAll('#maintenance-container .maintenance-item');\n\n\tmaintenanceItems.forEach((item) => {\n\t\tconst typeSelect = item.querySelector('.maintenance-type');\n\t\tconst customInput = item.querySelector('.maintenance-custom-name');\n\t\tconst costInput = item.querySelector('.maintenance-cost');\n\n\t\tconst type = typeSelect.value === 'Custom' ? customInput.value : typeSelect.value;\n\t\tconst cost = parseFloat(costInput.value) || 0;\n\n\t\tif (type && cost > 0) {\n\t\t\tmaintenance.push({ type, cost });\n\t\t}\n\t});\n\n\treturn maintenance;\n}\n\nfunction getTotalMaintenanceCost() {\n\tconst maintenance = getMaintenanceData();\n\treturn maintenance.reduce((sum, item) => sum + item.cost, 0);\n}\n\n// Supply items management\n// counter removed: supplyItemCounter unused\n\nfunction getDefaultSupplyCategories() {\n\treturn ['Poles', 'Concrete', 'Cable'];\n}\n\nfunction getAllSupplyCategories() {\n\tconst saved = localStorage.getItem('supplyCategories');\n\tif (saved) {\n\t\treturn JSON.parse(saved);\n\t}\n\treturn getDefaultSupplyCategories();\n}\n\nfunction saveSupplyCategory(typeName) {\n\tif (!typeName || typeName.trim() === '') return;\n\n\tconst allCategories = getAllSupplyCategories();\n\tconst trimmed = typeName.trim();\n\n\tif (allCategories.includes(trimmed)) {\n\t\treturn;\n\t}\n\n\tallCategories.push(trimmed);\n\tlocalStorage.setItem('supplyCategories', JSON.stringify(allCategories));\n\n\tsyncCustomCategoriesToCloud();\n}\n\nfunction deleteSupplyCategory(typeName) {\n\tconst allCategories = getAllSupplyCategories();\n\tconst filtered = allCategories.filter((t) => t !== typeName);\n\n\tlocalStorage.setItem('supplyCategories', JSON.stringify(filtered));\n\n\tsyncCustomCategoriesToCloud();\n}\n\n// duplicate getCustomSupplyTypes/saveCustomSupplyType removed — consolidated earlier in the file\n\nfunction addSupplyItem() {\n\tconst container = document.getElementById('supplies-container');\n\tconst itemDiv = document.createElement('div');\n\titemDiv.classList.add('supply-item');\n\titemDiv.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px; align-items: center;';\n\n\t// Get ALL categories (presets + custom)\n\tconst allCategories = getAllSupplyCategories();\n\tconst categoryOptions = allCategories\n\t\t.map((type) => `<option value=\"${type}\">${type}</option>`)\n\t\t.join('');\n\n\titemDiv.innerHTML = `\n    <select class=\"supply-type\" style=\"flex: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;\">\n      ${categoryOptions}\n      <option value=\"Custom\">+ Add Custom</option>\n      <option value=\"__MANAGE__\" style=\"color: #007bff; font-weight: bold;\">⚙ Manage Categories</option>\n    </select>\n    <input type=\"text\" class=\"supply-custom-name\" placeholder=\"Enter item name\" style=\"flex: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; display: none;\">\n    <input type=\"number\" class=\"supply-cost\" placeholder=\"Cost\" style=\"width: 120px; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;\" step=\"0.01\">\n    <button type=\"button\" onclick=\"removeSupplyItem(this)\" style=\"background-color: #dc3545; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;\">Delete</button>\n  `;\n\n\tcontainer.appendChild(itemDiv);\n\n\tconst select = itemDiv.querySelector('.supply-type');\n\tconst customInput = itemDiv.querySelector('.supply-custom-name');\n\n\tselect.addEventListener('change', function () {\n\t\tif (this.value === 'Custom') {\n\t\t\tcustomInput.style.display = 'block';\n\t\t\tcustomInput.required = true;\n\t\t\tcustomInput.focus();\n\t\t} else if (this.value === '__MANAGE__') {\n\t\t\topenManageSuppliesModal();\n\t\t\tthis.selectedIndex = 0;\n\t\t} else {\n\t\t\tcustomInput.style.display = 'none';\n\t\t\tcustomInput.required = false;\n\t\t\tcustomInput.value = '';\n\t\t}\n\t});\n\n\tcustomInput.addEventListener('blur', function () {\n\t\tif (this.value.trim()) {\n\t\t\tconst newType = this.value.trim();\n\t\t\tsaveSupplyCategory(newType);\n\n\t\t\tconst option = document.createElement('option');\n\t\t\toption.value = newType;\n\t\t\toption.textContent = newType;\n\t\t\toption.selected = true;\n\n\t\t\tconst customOption = select.querySelector('option[value=\"Custom\"]');\n\t\t\tselect.insertBefore(option, customOption);\n\n\t\t\tcustomInput.style.display = 'none';\n\t\t\tcustomInput.value = '';\n\t\t}\n\t});\n}\n\nfunction removeSupplyItem(button) {\n\tbutton.closest('.supply-item').remove();\n}\n\nfunction addEditSupplyItem() {\n\tconst container = document.getElementById('edit-supplies-container');\n\tconst itemDiv = document.createElement('div');\n\titemDiv.classList.add('supply-item');\n\titemDiv.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px; align-items: center;';\n\n\t// Build options with custom types\n\tconst customTypes = getCustomSupplyTypes();\n\tconst customOptions = customTypes\n\t\t.map((type) => `<option value=\"${type}\">${type}</option>`)\n\t\t.join('');\n\n\titemDiv.innerHTML = `\n    <select class=\"supply-type\" style=\"flex: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;\">\n      <option value=\"Poles\">Poles</option>\n      <option value=\"Concrete\">Concrete</option>\n      <option value=\"Cable\">Cable</option>\n      ${customOptions}\n      <option value=\"Custom\">+ Add Custom</option>\n    </select>\n    <input type=\"text\" class=\"supply-custom-name\" placeholder=\"Enter item name\" style=\"flex: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; display: none;\">\n    <input type=\"number\" class=\"supply-cost\" placeholder=\"Cost\" style=\"width: 120px; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;\" step=\"0.01\">\n    <button type=\"button\" onclick=\"removeEditSupplyItem(this)\" style=\"background-color: #dc3545; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;\">Delete</button>\n  `;\n\n\tcontainer.appendChild(itemDiv);\n\n\tconst select = itemDiv.querySelector('.supply-type');\n\tconst customInput = itemDiv.querySelector('.supply-custom-name');\n\n\tselect.addEventListener('change', function () {\n\t\tif (this.value === 'Custom') {\n\t\t\tcustomInput.style.display = 'block';\n\t\t\tcustomInput.required = true;\n\t\t\tcustomInput.focus();\n\t\t} else {\n\t\t\tcustomInput.style.display = 'none';\n\t\t\tcustomInput.required = false;\n\t\t\tcustomInput.value = '';\n\t\t}\n\t});\n\n\t// Save custom type when user enters it\n\tcustomInput.addEventListener('blur', function () {\n\t\tif (this.value.trim()) {\n\t\t\tconst newType = this.value.trim();\n\t\t\tsaveCustomSupplyType(newType);\n\n\t\t\t// Update the dropdown\n\t\t\tconst option = document.createElement('option');\n\t\t\toption.value = newType;\n\t\t\toption.textContent = newType;\n\t\t\toption.selected = true;\n\n\t\t\tconst customOption = select.querySelector('option[value=\"Custom\"]');\n\t\t\tselect.insertBefore(option, customOption);\n\n\t\t\tcustomInput.style.display = 'none';\n\t\t\tcustomInput.value = '';\n\t\t}\n\t});\n}\n\nfunction removeEditSupplyItem(button) {\n\tbutton.closest('.supply-item').remove();\n}\n\nfunction getEditSuppliesData() {\n\tconst supplies = [];\n\tconst supplyItems = document.querySelectorAll('#edit-supplies-container .supply-item');\n\n\tsupplyItems.forEach((item) => {\n\t\tconst typeSelect = item.querySelector('.supply-type');\n\t\tconst customInput = item.querySelector('.supply-custom-name');\n\t\tconst costInput = item.querySelector('.supply-cost');\n\n\t\tconst type = typeSelect.value === 'Custom' ? customInput.value : typeSelect.value;\n\t\tconst cost = parseFloat(costInput.value) || 0;\n\n\t\tif (type && cost > 0) {\n\t\t\tsupplies.push({ type, cost });\n\t\t}\n\t});\n\n\treturn supplies;\n}\n\nfunction getTotalEditSuppliesCost() {\n\tconst supplies = getEditSuppliesData();\n\treturn supplies.reduce((sum, item) => sum + item.cost, 0);\n}\n\n// Edit form maintenance functions\nfunction addEditMaintenanceItem() {\n\tconst container = document.getElementById('edit-maintenance-container');\n\tconst itemDiv = document.createElement('div');\n\titemDiv.classList.add('maintenance-item');\n\titemDiv.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px; align-items: center;';\n\n\tconst customTypes = getCustomMaintenanceTypes();\n\tconst customOptions = customTypes\n\t\t.map((type) => `<option value=\"${type}\">${type}</option>`)\n\t\t.join('');\n\n\titemDiv.innerHTML = `\n    <select class=\"maintenance-type\" style=\"flex: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;\">\n      <option value=\"Oil Change\">Oil Change</option>\n      <option value=\"Tire Rotation\">Tire Rotation</option>\n      <option value=\"Brake Service\">Brake Service</option>\n      <option value=\"Battery\">Battery</option>\n      ${customOptions}\n      <option value=\"Custom\">+ Add Custom</option>\n    </select>\n    <input type=\"text\" class=\"maintenance-custom-name\" placeholder=\"Enter item name\" style=\"flex: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; display: none;\">\n    <input type=\"number\" class=\"maintenance-cost\" placeholder=\"Cost\" style=\"width: 120px; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;\" step=\"0.01\">\n    <button type=\"button\" onclick=\"removeEditMaintenanceItem(this)\" style=\"background-color: #dc3545; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;\">Delete</button>\n  `;\n\n\tcontainer.appendChild(itemDiv);\n\n\tconst select = itemDiv.querySelector('.maintenance-type');\n\tconst customInput = itemDiv.querySelector('.maintenance-custom-name');\n\n\tselect.addEventListener('change', function () {\n\t\tif (this.value === 'Custom') {\n\t\t\tcustomInput.style.display = 'block';\n\t\t\tcustomInput.required = true;\n\t\t\tcustomInput.focus();\n\t\t} else {\n\t\t\tcustomInput.style.display = 'none';\n\t\t\tcustomInput.required = false;\n\t\t\tcustomInput.value = '';\n\t\t}\n\t});\n\n\tcustomInput.addEventListener('blur', function () {\n\t\tif (this.value.trim()) {\n\t\t\tconst newType = this.value.trim();\n\t\t\tsaveCustomMaintenanceType(newType);\n\n\t\t\tconst option = document.createElement('option');\n\t\t\toption.value = newType;\n\t\t\toption.textContent = newType;\n\t\t\toption.selected = true;\n\n\t\t\tconst customOption = select.querySelector('option[value=\"Custom\"]');\n\t\t\tselect.insertBefore(option, customOption);\n\n\t\t\tcustomInput.style.display = 'none';\n\t\t\tcustomInput.value = '';\n\t\t}\n\t});\n}\n\nfunction removeEditMaintenanceItem(button) {\n\tbutton.closest('.maintenance-item').remove();\n}\n\nfunction getEditMaintenanceData() {\n\tconst maintenance = [];\n\tconst maintenanceItems = document.querySelectorAll(\n\t\t'#edit-maintenance-container .maintenance-item'\n\t);\n\n\tmaintenanceItems.forEach((item) => {\n\t\tconst typeSelect = item.querySelector('.maintenance-type');\n\t\tconst customInput = item.querySelector('.maintenance-custom-name');\n\t\tconst costInput = item.querySelector('.maintenance-cost');\n\n\t\tconst type = typeSelect.value === 'Custom' ? customInput.value : typeSelect.value;\n\t\tconst cost = parseFloat(costInput.value) || 0;\n\n\t\tif (type && cost > 0) {\n\t\t\tmaintenance.push({ type, cost });\n\t\t}\n\t});\n\n\treturn maintenance;\n}\n\nfunction getTotalEditMaintenanceCost() {\n\tconst maintenance = getEditMaintenanceData();\n\treturn maintenance.reduce((sum, item) => sum + item.cost, 0);\n}\n\nfunction getSuppliesData() {\n\tconst supplies = [];\n\tconst supplyItems = document.querySelectorAll('#supplies-container .supply-item');\n\n\tsupplyItems.forEach((item) => {\n\t\tconst typeSelect = item.querySelector('.supply-type');\n\t\tconst customInput = item.querySelector('.supply-custom-name');\n\t\tconst costInput = item.querySelector('.supply-cost');\n\n\t\tconst type = typeSelect.value === 'Custom' ? customInput.value : typeSelect.value;\n\t\tconst cost = parseFloat(costInput.value) || 0;\n\n\t\tif (type && cost > 0) {\n\t\t\tsupplies.push({ type, cost });\n\t\t}\n\t});\n\n\treturn supplies;\n}\n\nfunction getTotalSuppliesCost() {\n\tconst supplies = getSuppliesData();\n\treturn supplies.reduce((sum, item) => sum + item.cost, 0);\n}\n\nlet disableAutoSave = false;\n\nfunction scrollToTop() {\n\twindow.scrollTo({ top: 0, behavior: 'smooth' });\n}\n\nlet map;\nlet directionsService;\nlet directionsRenderer;\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- references kept for Google Maps event listeners */\nlet autocompleteStart, autocompleteEnd;\nlet editingIndex = -1;\nlet originalMileage = null;\nlet logEntries = [];\nlet currentFilterFn = null;\nlet currentPage = 1;\n// skipNextSync removed: no longer used (consolidated sync logic)\n\nconst logsPerPage = 10;\n\nfunction getRecentDestinations() {\n\treturn JSON.parse(localStorage.getItem('recentDestinations') || '[]');\n}\n\nfunction saveRecentDestinations(newDestinations) {\n\tconst current = getRecentDestinations();\n\tconst combined = [...new Set([...newDestinations, ...current])].slice(0, 10);\n\tlocalStorage.setItem('recentDestinations', JSON.stringify(combined));\n}\n\nfunction updateDatalistSuggestions() {\n\tconst datalist = document.getElementById('recent-destinations');\n\tif (!datalist) return;\n\tconst recent = getRecentDestinations();\n\tdatalist.innerHTML = recent.map((dest) => `<option value=\"${dest}\">`).join('');\n}\n\nfunction onStartDateChange() {\n\tfilterLogs(); // existing filter logic\n\n\t// Automatically open the end date calendar\n\tconst endDateInput = document.getElementById('filter-end-date');\n\tif (endDateInput) {\n\t\tendDateInput.focus();\n\t\tendDateInput.showPicker?.(); // works in most modern browsers\n\t}\n}\n\nfunction isIos() {\n\treturn /iphone|ipad|ipod/i.test(navigator.userAgent);\n}\n\nfunction isInStandaloneMode() {\n\treturn 'standalone' in window.navigator && window.navigator.standalone;\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n\tconst installBtn = document.getElementById('install-button');\n\n\tif (isIos()) {\n\t\t//  Hide the install button on iOS\n\t\tif (installBtn) installBtn.style.display = 'none';\n\n\t\t//  Only show iOS prompt if not installed\n\t\tif (!isInStandaloneMode()) {\n\t\t\tconst prompt = document.createElement('div');\n\t\t\tprompt.id = 'ios-install-prompt'; //  Needed for auto-hide\n\t\t\tprompt.innerHTML = `\n        <div style=\"\n          background-color: #fffae6;\n          color: #333;\n          padding: 15px;\n          text-align: center;\n          font-size: 16px;\n          border: 1px solid #ffd700;\n          border-radius: 6px;\n          margin: 20px auto 0 auto;\n          max-width: 600px;\n        \">\n           To install this app on your iPhone, tap the\n          <strong>Share</strong> button\n          <br>then choose <strong>Add to Home Screen</strong>.\n        </div>\n      `;\n\n\t\t\t//  Insert below the log container\n\t\t\tconst manageLog = document.getElementById('manage-log-container');\n\t\t\tif (manageLog) {\n\t\t\t\tmanageLog.insertAdjacentElement('afterend', prompt);\n\t\t\t} else {\n\t\t\t\tdocument.body.appendChild(prompt);\n\t\t\t}\n\n\t\t\t//  Auto-hide if user installs manually while the app is open\n\t\t\tconst checkInterval = setInterval(() => {\n\t\t\t\tif (isInStandaloneMode()) {\n\t\t\t\t\tconst iosPrompt = document.getElementById('ios-install-prompt');\n\t\t\t\t\tif (iosPrompt) iosPrompt.remove();\n\t\t\t\t\tclearInterval(checkInterval);\n\t\t\t\t}\n\t\t\t}, 2000); // every 2 seconds\n\t\t}\n\t}\n});\n\nfunction resumeDraftTrip() {\n\tdocument.getElementById('resume-modal').style.display = 'none';\n\n\t//  Restore logs first (only if logged in)\n\tconst cached = localStorage.getItem('cachedLogs');\n\tconst token = localStorage.getItem('token');\n\n\tif (cached && token) {\n\t\ttry {\n\t\t\tlogEntries = JSON.parse(cached);\n\t\t} catch (e) {\n\t\t\tconsole.error(' Failed to parse cachedLogs while resuming draft:', e);\n\t\t}\n\t}\n\n\tconst data = window.__pendingDraftTrip;\n\tif (!data) return;\n\n\t//  Restore form values\n\tdocument.getElementById('log-date').value = data.date || '';\n\tdocument.getElementById('start-address').value = data.start || '';\n\tdocument.getElementById('end-address').value = data.end || '';\n\tdocument.getElementById('mpg').value = data.mpg || '';\n\tdocument.getElementById('gas-price').value = data.gas || '';\n\tdocument.getElementById('start-time').value = data.startTime || '';\n\tdocument.getElementById('end-time').value = data.endTime || '';\n\tdocument.getElementById('total-hours').value = formatHoursAndMinutes(data.hoursWorked || 0);\n\n\t// Restore maintenance items\n\tconst maintenanceContainer = document.getElementById('maintenance-container');\n\tmaintenanceContainer.innerHTML = '';\n\tif (data.maintenance && Array.isArray(data.maintenance)) {\n\t\tdata.maintenance.forEach((item) => {\n\t\t\taddMaintenanceItem();\n\t\t\tconst lastItem = maintenanceContainer.lastElementChild;\n\t\t\tconst typeSelect = lastItem.querySelector('.maintenance-type');\n\t\t\tconst customInput = lastItem.querySelector('.maintenance-custom-name');\n\t\t\tconst costInput = lastItem.querySelector('.maintenance-cost');\n\n\t\t\tconst presetTypes = ['Oil Change', 'Tire Rotation', 'Brake Service', 'Battery'];\n\t\t\tif (presetTypes.includes(item.type)) {\n\t\t\t\ttypeSelect.value = item.type;\n\t\t\t} else {\n\t\t\t\ttypeSelect.value = 'Custom';\n\t\t\t\tcustomInput.style.display = 'block';\n\t\t\t\tcustomInput.value = item.type;\n\t\t\t}\n\t\t\tcostInput.value = item.cost;\n\t\t});\n\t}\n\n\t// Restore supplies items\n\tconst suppliesContainer = document.getElementById('supplies-container');\n\tsuppliesContainer.innerHTML = '';\n\tif (data.supplies && Array.isArray(data.supplies)) {\n\t\tdata.supplies.forEach((item) => {\n\t\t\taddSupplyItem();\n\t\t\tconst lastItem = suppliesContainer.lastElementChild;\n\t\t\tconst typeSelect = lastItem.querySelector('.supply-type');\n\t\t\tconst customInput = lastItem.querySelector('.supply-custom-name');\n\t\t\tconst costInput = lastItem.querySelector('.supply-cost');\n\n\t\t\t// Check if it's a preset type\n\t\t\tconst presetTypes = ['Poles', 'Concrete', 'Cable'];\n\t\t\tif (presetTypes.includes(item.type)) {\n\t\t\t\ttypeSelect.value = item.type;\n\t\t\t} else {\n\t\t\t\ttypeSelect.value = 'Custom';\n\t\t\t\tcustomInput.style.display = 'block';\n\t\t\t\tcustomInput.value = item.type;\n\t\t\t}\n\t\t\tcostInput.value = item.cost;\n\t\t});\n\t}\n\n\tdocument.getElementById('log-notes').value = data.notes || '';\n\n\tconst container = document.getElementById('destinations-container');\n\tcontainer.innerHTML = '';\n\n\tdata.destinations.forEach((d, i) => {\n\t\tconst div = document.createElement('div');\n\t\tdiv.classList.add('destination');\n\t\tdiv.innerHTML = `\n      <label for=\"destination-${i + 1}\">Destination ${i + 1}</label>\n      <input type=\"text\" id=\"destination-${i + 1}\" list=\"recent-destinations\" value=\"${d.address || ''}\">\n      <label for=\"earnings-${i + 1}\">Earnings for Destination ${i + 1}</label>\n      <input type=\"number\" id=\"earnings-${i + 1}\" value=\"${d.earnings || ''}\">\n      <div class=\"destination-actions\">\n        <button class=\"delete-btn\" onclick=\"deleteDestination(this)\">Delete</button>\n        <button class=\"move-btn\" onclick=\"moveDestinationUp(this)\">Move Up</button>\n        <button class=\"move-btn\" onclick=\"moveDestinationDown(this)\">Move Down</button>\n      </div>\n    `;\n\t\tcontainer.appendChild(div);\n\t\tinitAutocompleteDestination(div.querySelector('input[type=\"text\"]'));\n\t});\n\n\t//  Display restored logs at the end\n\tdisplayLog();\n}\n\nfunction discardDraftTrip() {\n\tdocument.getElementById('resume-modal').style.display = 'none';\n\tlocalStorage.removeItem('draftTrip');\n\n\tconst today = new Date().toLocaleDateString('en-CA');\n\tconst dateInput = document.getElementById('log-date');\n\tif (dateInput) dateInput.value = today;\n\n\tconst cached = localStorage.getItem('cachedLogs');\n\tconst token = localStorage.getItem('token');\n\n\t//  Only load cached logs if user is logged in\n\tif (cached && token) {\n\t\ttry {\n\t\t\tlogEntries = JSON.parse(cached);\n\t\t\tdisplayLog();\n\t\t} catch (e) {\n\t\t\tconsole.error(' Failed to parse cachedLogs:', e);\n\t\t}\n\t}\n}\n\nfunction showAlertModal(message, onClose) {\n\tconst modal = document.getElementById('universal-modal');\n\tconst msg = document.getElementById('universal-modal-message');\n\tconst buttons = document.getElementById('universal-modal-buttons');\n\n\tmsg.innerHTML = message;\n\n\t// Save callback if provided, or null\n\twindow._universalCallback = typeof onClose === 'function' ? onClose : null;\n\n\tbuttons.innerHTML = `\n    <button onclick=\"closeUniversalModal(); if (typeof window._universalCallback === 'function') window._universalCallback();\">OK</button>\n  `;\n\n\tmodal.style.display = 'flex';\n}\n\nfunction showConfirmModal(message, onConfirm, onCancel) {\n\tconst modal = document.getElementById('universal-modal');\n\tconst msg = document.getElementById('universal-modal-message');\n\tconst buttons = document.getElementById('universal-modal-buttons');\n\n\tmsg.innerHTML = message;\n\tbuttons.innerHTML = `\n    <button onclick=\"closeUniversalModal(); window._universalConfirmCallback()\">Yes</button>\n    <button onclick=\"closeUniversalModal(); ${onCancel ? 'window._universalCancelCallback();' : ''}\">No</button>\n  `;\n\n\twindow._universalConfirmCallback = onConfirm;\n\tif (onCancel) window._universalCancelCallback = onCancel;\n\n\tmodal.style.display = 'flex';\n}\n\nfunction closeUniversalModal() {\n\tconst modal = document.getElementById('universal-modal');\n\tmodal.style.display = 'none';\n\twindow._universalCallback = null; // clean up\n}\n\nfunction toggleHamburgerManageLogMenu() {\n\tconst menu = document.getElementById('hamburger-manage-log-menu');\n\tconst arrow = document.getElementById('hamburger-manage-arrow');\n\tif (!menu || !arrow) return;\n\n\tconst isOpen = menu.style.maxHeight && menu.style.maxHeight !== '0px';\n\n\tif (isOpen) {\n\t\tmenu.style.maxHeight = '0';\n\t\tarrow.style.transform = 'rotate(0deg)';\n\t} else {\n\t\tmenu.style.maxHeight = menu.scrollHeight + 'px';\n\t\tarrow.style.transform = 'rotate(180deg)';\n\t}\n}\nfunction toggleHamburgerManageAccountMenu() {\n\tconst menu = document.getElementById('hamburger-manage-account-menu');\n\tconst arrow = document.getElementById('hamburger-manage-account-arrow');\n\tif (!menu || !arrow) return;\n\n\tconst isOpen = menu.style.maxHeight && menu.style.maxHeight !== '0px';\n\n\tif (isOpen) {\n\t\tmenu.style.maxHeight = '0';\n\t\tarrow.style.transform = 'rotate(0deg)';\n\t} else {\n\t\tmenu.style.maxHeight = menu.scrollHeight + 'px';\n\t\tarrow.style.transform = 'rotate(180deg)';\n\t}\n}\n\nfunction isDuplicateEntry(entry, existingLog) {\n\treturn existingLog.some(\n\t\t(e) =>\n\t\t\te.date === entry.date &&\n\t\t\te.startClock === entry.startClock &&\n\t\t\te.endClock === entry.endClock &&\n\t\t\te.startTime === entry.startTime &&\n\t\t\te.endTime === entry.endTime &&\n\t\t\tparseFloat(e.totalMileage) === parseFloat(entry.totalMileage)\n\t);\n}\n\nfunction saveUserInputsToLocalStorage({ mpg, gasPrice, startAddress, endAddress }) {\n\tlocalStorage.setItem('mpg', mpg);\n\tlocalStorage.setItem('gasPrice', gasPrice);\n\tlocalStorage.setItem('startAddress', startAddress);\n\tlocalStorage.setItem('endAddress', endAddress);\n}\n\ndocument.addEventListener('click', function (event) {\n\tconst menu = document.getElementById('account-menu');\n\n\t// Check if click is on hamburger button or its children (including the icon)\n\tconst isHamburgerClick =\n\t\thamburgerButton && (event.target === hamburgerButton || hamburgerButton.contains(event.target));\n\n\t// Don't close if clicking inside menu or on hamburger button\n\tif (menu && !menu.contains(event.target) && !isHamburgerClick) {\n\t\tcloseMenu();\n\t}\n});\n\nfunction closeMenu() {\n\tconst menu = document.getElementById('account-menu');\n\tif (menu) {\n\t\tmenu.classList.remove('show');\n\t}\n}\n\nfunction closeAuthModal() {\n\tdocument.getElementById('auth-modal').style.display = 'none';\n}\n\nasync function saveLog() {\n\t//  ALWAYS save to localStorage first (local-first design)\n\tconsole.log(' Saving to localStorage...');\n\tconsole.log(` logEntries has ${logEntries.length} trips before save`);\n\tlocalStorage.setItem('trips', JSON.stringify(logEntries));\n\tconsole.log(' Saved to localStorage');\n\n\t//  If user is authenticated, also sync to cloud\n\tconst token = localStorage.getItem('token');\n\n\tif (!token) {\n\t\tconsole.log(' No token - saved locally only');\n\t\treturn; // Local save successful, no cloud sync needed\n\t}\n\n\t//  If offline, save to pending queue for later sync\n\tif (!navigator.onLine) {\n\t\tconsole.warn(' Offline: Saved locally, will sync when back online.');\n\t\tlocalStorage.setItem('pendingLogs', JSON.stringify(logEntries));\n\t\treturn;\n\t}\n\n\t//  Try to sync to cloud\n\tconsole.log(` Syncing ${logEntries.length} trips to cloud...`);\n\tconsole.log(\n\t\t' Sending to cloud:',\n\t\tlogEntries.map((e) => `${e.date} (${e.destinations?.length || 0} stops)`)\n\t);\n\n\ttry {\n\t\tconst response = await fetch('https://logs.gorouteyourself.com/logs', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\tAuthorization: token\n\t\t\t},\n\t\t\tbody: JSON.stringify(logEntries)\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(await response.text());\n\t\t}\n\n\t\tconsole.log(' Synced to cloud');\n\t\tconsole.log(` logEntries still has ${logEntries.length} trips after cloud sync`);\n\n\t\t//  DON'T reload after every save - causes race condition\n\t\t// await syncAndReloadLogs();\n\t} catch (err) {\n\t\tconsole.error(' Cloud sync failed (but local save succeeded):', err);\n\t\tlocalStorage.setItem('pendingLogs', JSON.stringify(logEntries));\n\t\t// Don't show error - local save succeeded, cloud sync can happen later\n\t}\n}\n\nasync function syncPendingLogs() {\n\tconst pending = localStorage.getItem('pendingLogs');\n\tif (!pending) return;\n\n\tconst token = localStorage.getItem('token');\n\tif (!token) return;\n\n\ttry {\n\t\tconst response = await fetch('https://logs.gorouteyourself.com/logs', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\tAuthorization: token\n\t\t\t},\n\t\t\tbody: pending\n\t\t});\n\n\t\tif (response.ok) {\n\t\t\tconsole.log(' Pending logs synced successfully!');\n\t\t\tlocalStorage.removeItem('pendingLogs');\n\n\t\t\t//  Important: Update cachedLogs after successful sync\n\t\t\tconst freshLogs = await loadLog();\n\t\t\tlocalStorage.setItem('cachedLogs', JSON.stringify(freshLogs));\n\t\t\tdisplayLog();\n\t\t} else {\n\t\t\tconsole.error(' Failed to sync pending logs:', await response.text());\n\t\t}\n\t} catch (err) {\n\t\tconsole.error(' Error syncing pending logs:', err);\n\t}\n}\n\nasync function loadLog() {\n\tconst token = localStorage.getItem('token');\n\n\t//  First, always load local trips\n\tconst localTrips = JSON.parse(localStorage.getItem('trips') || '[]');\n\tconsole.log(` Found ${localTrips.length} local trips`);\n\n\tif (!token) {\n\t\t// No token = return local trips only\n\t\tconsole.log(' No token - returning local trips only');\n\t\treturn localTrips;\n\t}\n\n\t//  User is authenticated - load cloud data first, then merge\n\ttry {\n\t\tconsole.log(' Loading trips from cloud...');\n\t\tconst response = await fetch('https://logs.gorouteyourself.com/logs', {\n\t\t\theaders: { Authorization: token }\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(await response.text());\n\t\t}\n\n\t\tconst cloudLogs = await response.json();\n\t\tconsole.log(` Loaded ${cloudLogs.length} trips from cloud`);\n\n\t\t//  Merge local trips with cloud trips\n\t\tconst merged = [...cloudLogs]; // Start with cloud data\n\n\t\t// Add local trips that aren't already in cloud\n\t\tlet addedCount = 0;\n\t\tlocalTrips.forEach((localTrip) => {\n\t\t\tconst existsInCloud = cloudLogs.some(\n\t\t\t\t(cloudTrip) =>\n\t\t\t\t\tcloudTrip.date === localTrip.date &&\n\t\t\t\t\tcloudTrip.startAddress === localTrip.startAddress &&\n\t\t\t\t\tJSON.stringify(cloudTrip.destinations) === JSON.stringify(localTrip.destinations)\n\t\t\t);\n\n\t\t\tif (!existsInCloud) {\n\t\t\t\tmerged.push(localTrip);\n\t\t\t\taddedCount++;\n\t\t\t}\n\t\t});\n\n\t\tconsole.log(\n\t\t\t` Merge complete: ${cloudLogs.length} from cloud + ${addedCount} new local = ${merged.length} total`\n\t\t);\n\n\t\t//  If we added any local trips, sync the merged data back to cloud\n\t\tif (addedCount > 0) {\n\t\t\tconsole.log(` Syncing ${addedCount} new local trips to cloud...`);\n\t\t\ttry {\n\t\t\t\tawait fetch('https://logs.gorouteyourself.com/logs', {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\tAuthorization: token\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify(merged) // Send ALL trips, not just local\n\t\t\t\t});\n\t\t\t\tconsole.log(' Sync complete');\n\t\t\t} catch (err) {\n\t\t\t\tconsole.warn(' Failed to sync to cloud (but local data preserved):', err);\n\t\t\t}\n\t\t}\n\n\t\t//  Save merged result to both localStorage keys\n\t\tlocalStorage.setItem('trips', JSON.stringify(merged));\n\t\tlocalStorage.setItem('cachedLogs', JSON.stringify(merged));\n\n\t\treturn merged;\n\t} catch (err) {\n\t\tconsole.warn(' Offline or failed to load from cloud. Using local trips.', err);\n\t\t// Failed to load from cloud, return local trips\n\t\tlocalStorage.setItem('cachedLogs', JSON.stringify(localTrips));\n\t\treturn localTrips;\n\t}\n}\n\n// duplicate offline banner / sync helpers removed — consolidated into a single implementation later in the file\n\nfunction saveDraftTrip() {\n\tif (disableAutoSave) return;\n\n\tconst startTime = document.getElementById('start-time')?.value.trim();\n\tconst endTime = document.getElementById('end-time')?.value.trim();\n\tconst hoursWorked = document.getElementById('total-hours')?.value.trim();\n\n\tconst maintenance = getMaintenanceData();\n\tconst supplies = getSuppliesData();\n\tconst notes = document.getElementById('log-notes')?.value.trim(); //  add this\n\n\tconst destinations = Array.from(document.querySelectorAll('#destinations-container .destination'))\n\t\t.map((div) => ({\n\t\t\taddress: div.querySelector('input[id^=\"destination-\"]')?.value.trim() || '',\n\t\t\tearnings: div.querySelector('input[id^=\"earnings-\"]')?.value.trim() || ''\n\t\t}))\n\t\t.filter((d) => d.address || d.earnings);\n\n\tconst hasMeaningfulData =\n\t\tdestinations.length > 0 ||\n\t\tstartTime ||\n\t\tendTime ||\n\t\thoursWorked ||\n\t\tmaintenance.length > 0 ||\n\t\tsupplies.length > 0 ||\n\t\tnotes; //  now considers notes too\n\n\tif (!hasMeaningfulData) {\n\t\tlocalStorage.removeItem('draftTrip');\n\t\treturn;\n\t}\n\n\tconst draft = {\n\t\tdate: document.getElementById('log-date')?.value,\n\t\tstart: document.getElementById('start-address')?.value,\n\t\tend: document.getElementById('end-address')?.value,\n\t\tmpg: document.getElementById('mpg')?.value,\n\t\tgas: document.getElementById('gas-price')?.value,\n\t\tstartTime,\n\t\tendTime,\n\t\thoursWorked,\n\t\tmaintenance,\n\t\tsupplies,\n\t\tnotes, //  save notes to draft\n\t\tdestinations\n\t};\n\n\tlocalStorage.setItem('draftTrip', JSON.stringify(draft));\n}\n\nsetInterval(saveDraftTrip, 5000); // Auto-save every 5 seconds\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n\tconst draft = localStorage.getItem('draftTrip');\n\tupdateAuthUI();\n\n\tif (draft) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(draft);\n\n\t\t\tconst destinations = Array.isArray(data.destinations)\n\t\t\t\t? data.destinations.filter((d) => d.address || d.earnings)\n\t\t\t\t: [];\n\n\t\t\tconst hasMeaningfulData =\n\t\t\t\tdestinations.length > 0 ||\n\t\t\t\t(data.startTime && data.startTime.trim()) ||\n\t\t\t\t(data.endTime && data.endTime.trim()) ||\n\t\t\t\t(data.hoursWorked && parseFloat(data.hoursWorked) > 0) ||\n\t\t\t\t(data.maintenance && parseFloat(data.maintenance) > 0) ||\n\t\t\t\t(data.supplies && parseFloat(data.supplies) > 0);\n\n\t\t\tif (!hasMeaningfulData) {\n\t\t\t\tlocalStorage.removeItem('draftTrip');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst cached = localStorage.getItem('cachedLogs');\n\t\t\tconst token = localStorage.getItem('token');\n\n\t\t\t//  Only load cached logs if user is logged in\n\t\t\t// This prevents showing previous user's data after logout\n\t\t\tif (cached && token) {\n\t\t\t\ttry {\n\t\t\t\t\tlogEntries = JSON.parse(cached);\n\t\t\t\t\tdisplayLog();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(' Failed to parse cachedLogs while showing resume modal:', e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Restoration moved to `resumeDraftTrip` — duplicate unreachable logic removed\n\t\t} catch (err) {\n\t\t\tconsole.error(' Failed to parse draftTrip:', err);\n\t\t\tlocalStorage.removeItem('draftTrip');\n\t\t}\n\t}\n\n\t// Set today's date\n\tconst dateInput = document.getElementById('log-date');\n\tif (dateInput) {\n\t\tconst today = new Date().toLocaleDateString('en-CA'); // format: yyyy-mm-dd\n\t\tdateInput.value = today; //  set only the date\n\t}\n\n\tawait syncPendingLogs();\n\n\tupdateAuthUI();\n\n\tlogEntries = await loadLog();\n\tdisplayLog();\n\tinitOfflineListeners();\n\n\tdocument.getElementById('total-hours').addEventListener('input', () => {\n\t\tconst hoursWorked = parseFloat(document.getElementById('total-hours').value) || 0;\n\n\t\tconst driveTimeInHours = convertTimeToHours(document.getElementById('total-time').textContent);\n\n\t\tconst workedMinutes = Math.round(hoursWorked * 60);\n\t\tconst driveMinutes = Math.round(driveTimeInHours * 60);\n\t\tconst totalWorkedMinutes = workedMinutes + driveMinutes;\n\n\t\tconst totalHoursDecimal = totalWorkedMinutes / 60;\n\n\t\tdocument.getElementById('total-hours').textContent = formatHoursAndMinutes(totalHoursDecimal);\n\t});\n\n\t//  After selecting start time, auto-focus end time after slight delay\n\tdocument.getElementById('start-time').addEventListener('change', () => {\n\t\tsetTimeout(() => document.getElementById('end-time')?.focus(), 200);\n\t});\n\n\tupdateDatalistSuggestions();\n});\n\n//  After selecting start time, auto-focus end time after slight delay\ndocument.getElementById('start-time').addEventListener('change', () => {\n\tsetTimeout(() => document.getElementById('end-time')?.focus(), 200);\n});\n\nfunction updateOfflineBanner() {\n\tconst banner = document.getElementById('offline-banner');\n\n\tif (navigator.onLine) {\n\t\tbanner.style.display = 'none'; //  Online\n\t\tsyncAndReloadLogs(); //  Force refresh logs!\n\t} else {\n\t\tbanner.style.display = 'block'; //  Offline\n\t}\n}\n\nasync function syncAndReloadLogs() {\n\ttry {\n\t\tconsole.log(' Online detected: syncing and reloading logs...');\n\n\t\t// First, sync any pending logs if needed\n\t\tawait syncPendingLogs();\n\n\t\tlogEntries = await loadLog();\n\n\t\t//  Ensure all logs have lastModified timestamp\n\t\tlogEntries = logEntries.map((entry) => ({\n\t\t\t...entry,\n\t\t\tlastModified: entry.lastModified || new Date().toISOString()\n\t\t}));\n\n\t\tdisplayLog();\n\n\t\tconsole.log(' Logs refreshed after reconnecting!');\n\t} catch (error) {\n\t\tconsole.error(' Error refreshing logs:', error);\n\t}\n}\n\n// Call once on page load too\ndocument.addEventListener('DOMContentLoaded', () => {});\n\nfunction showConfirmationMessage(message) {\n\tconst confirmation = document.getElementById('confirmation-message');\n\tif (!confirmation) return;\n\n\tconfirmation.textContent = message;\n\tconfirmation.style.display = 'block';\n\tsetTimeout(() => {\n\t\tconfirmation.style.display = 'none';\n\t}, 3000);\n}\n\nfunction initMap() {\n\twindow.googleMapsReady = true;\n\tmap = new google.maps.Map(document.getElementById('map'), {\n\t\tzoom: 10,\n\t\tcenter: { lat: 37.7749, lng: -122.4194 },\n\t\tmapTypeControl: false,\n\t\tstreetViewControl: false\n\t});\n\n\tdirectionsService = new google.maps.DirectionsService();\n\tdirectionsRenderer = new google.maps.DirectionsRenderer({\n\t\tmap: map,\n\t\tsuppressMarkers: false\n\t});\n\n\tautocompleteStart = new google.maps.places.Autocomplete(\n\t\tdocument.getElementById('start-address'),\n\t\t{ types: ['geocode'] }\n\t);\n\tautocompleteEnd = new google.maps.places.Autocomplete(document.getElementById('end-address'), {\n\t\ttypes: ['geocode']\n\t});\n\tdocument.getElementById('start-address').addEventListener('change', resetOriginalMileageDisplay);\n\tdocument.getElementById('end-address').addEventListener('change', resetOriginalMileageDisplay);\n\tdocument.getElementById('start-time').addEventListener('change', handleTimeChange);\n\tdocument.getElementById('end-time').addEventListener('change', handleTimeChange);\n\n\tautocompleteStart.addListener('place_changed', function () {\n\t\tconst place = autocompleteStart.getPlace();\n\t\tif (place.geometry) {\n\t\t\tdocument.getElementById('end-address').value = document.getElementById('start-address').value;\n\t\t} else {\n\t\t\tdocument.getElementById('start-address').value = '';\n\t\t}\n\t});\n\n\tconst savedMpg = parseFloat(localStorage.getItem('mpg'));\n\tconst savedGasPrice = parseFloat(localStorage.getItem('gasPrice'));\n\tconst savedStartAddress = localStorage.getItem('startAddress');\n\tconst savedEndAddress = localStorage.getItem('endAddress');\n\n\tif (!isNaN(savedMpg)) {\n\t\tdocument.getElementById('mpg').value = savedMpg;\n\t}\n\n\tif (!isNaN(savedGasPrice)) {\n\t\tdocument.getElementById('gas-price').value = savedGasPrice;\n\t}\n\n\tif (savedStartAddress && typeof savedStartAddress === 'string') {\n\t\tdocument.getElementById('start-address').value = savedStartAddress;\n\t}\n\n\tif (savedEndAddress && typeof savedEndAddress === 'string') {\n\t\tdocument.getElementById('end-address').value = savedEndAddress;\n\t}\n\n\t// Initialize autocomplete for the initial destination\n\tdocument\n\t\t.querySelectorAll('#destinations-container .destination input[type=\"text\"]')\n\t\t.forEach(initAutocompleteDestination);\n\n\tdisplayLog();\n}\n\nwindow.initMap = initMap;\n\nfunction initAutocompleteDestination(inputElement) {\n\tvoid new google.maps.places.Autocomplete(inputElement, {\n\t\ttypes: ['geocode']\n\t});\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nasync function calculateRoute() {\n\tconst destinationInputs = document.querySelectorAll('input[id^=\"destination-\"]');\n\tconst filledDestinations = Array.from(destinationInputs).filter(\n\t\t(input) => input.value.trim() !== ''\n\t);\n\tif (filledDestinations.length === 0) {\n\t\tshowAlertModal(' Please enter at least one destination before calculating your route.');\n\t\treturn;\n\t}\n\n\tconst calculationResult = await calculateRouteData();\n\tif (calculationResult) {\n\t\tupdateUI(calculationResult);\n\t\tshowConfirmationMessage(' Route calculated successfully!');\n\n\t\t//  Scroll to map\n\t\tdocument.getElementById('map')?.scrollIntoView({ behavior: 'smooth' });\n\t}\n}\n\nasync function calculateRouteData() {\n\tconst container = document.getElementById('destinations-container');\n\tconst allDestinations = container.querySelectorAll('.destination');\n\n\tallDestinations.forEach((div) => {\n\t\tconst addressInput = div.querySelector('input[id^=\"destination-\"]');\n\t\tif (!addressInput || addressInput.value.trim() === '') {\n\t\t\tdiv.remove();\n\t\t}\n\t});\n\trenumberMainDestinations();\n\n\tconst startAddress = document.getElementById('start-address').value;\n\tconst endAddress = document.getElementById('end-address').value;\n\tconst mpg = parseFloat(document.getElementById('mpg').value);\n\tconst gasPrice = parseFloat(document.getElementById('gas-price').value);\n\tconst startTimeInput = document.getElementById('start-time').value;\n\tconst endTimeInput = document.getElementById('end-time').value;\n\n\tlet hoursWorked = 0;\n\n\tif (startTimeInput && endTimeInput) {\n\t\tconst [startHours, startMinutes] = startTimeInput.split(':').map(Number);\n\t\tconst [endHours, endMinutes] = endTimeInput.split(':').map(Number);\n\n\t\tlet startTotalMinutes = startHours * 60 + startMinutes;\n\t\tlet endTotalMinutes = endHours * 60 + endMinutes;\n\t\tif (endTotalMinutes < startTotalMinutes) endTotalMinutes += 24 * 60;\n\n\t\tconst totalWorkedMinutes = endTotalMinutes - startTotalMinutes;\n\t\thoursWorked = totalWorkedMinutes / 60;\n\n\t\tdocument.getElementById('total-hours').value = formatHoursAndMinutes(hoursWorked);\n\t}\n\n\tconst maintenanceCost = getTotalMaintenanceCost();\n\tconst suppliesCost = getTotalSuppliesCost();\n\n\tsaveUserInputsToLocalStorage({ mpg, gasPrice, startAddress, endAddress });\n\n\tconst destInputs = document.querySelectorAll('input[id^=\"destination-\"]');\n\tconst earningsInputs = document.querySelectorAll('input[id^=\"earnings-\"]');\n\tconst destinations = Array.from(destInputs).map((input) => ({\n\t\tlocation: input.value,\n\t\tstopover: true\n\t}));\n\tsaveRecentDestinations(destinations.map((d) => d.location));\n\tupdateDatalistSuggestions();\n\n\tconst earnings = Array.from(earningsInputs).map((input) => parseFloat(input.value) || 0);\n\tconst totalEarnings = earnings.reduce((sum, val) => sum + val, 0);\n\n\tconst request = {\n\t\torigin: startAddress,\n\t\tdestination: endAddress || destinations[destinations.length - 1]?.location || startAddress,\n\t\twaypoints: destinations,\n\t\ttravelMode: 'DRIVING'\n\t};\n\n\tconst logDateInput = document.getElementById('log-date').value;\n\tconst selectedDate = logDateInput || new Date().toISOString().split('T')[0];\n\n\tif (!navigator.onLine) {\n\t\tshowAlertModal(\" You're offline. Route calculation is unavailable until you're reconnected.\");\n\t\treturn Promise.resolve(null);\n\t}\n\n\treturn new Promise((resolve) => {\n\t\tdirectionsService.route(request, (response, status) => {\n\t\t\tif (status === 'OK') {\n\t\t\t\tdirectionsRenderer.setDirections(response);\n\t\t\t\tdocument.getElementById('map').classList.remove('hidden');\n\n\t\t\t\tlet totalMileage = 0;\n\t\t\t\tlet totalDuration = 0;\n\n\t\t\t\tresponse.routes[0].legs.forEach((leg) => {\n\t\t\t\t\ttotalMileage += leg.distance.value / 1609.34;\n\t\t\t\t\ttotalDuration += leg.duration.value;\n\t\t\t\t});\n\n\t\t\t\tconst fuelCost = mpg && gasPrice ? (totalMileage / mpg) * gasPrice : 0;\n\t\t\t\tconst netProfitBeforeOptional = totalEarnings - fuelCost;\n\t\t\t\tconst netProfit = netProfitBeforeOptional - maintenanceCost - suppliesCost;\n\t\t\t\tconst totalHoursSpent = hoursWorked;\n\t\t\t\tconst profitPerHour = totalHoursSpent > 0 ? netProfit / totalHoursSpent : 0;\n\n\t\t\t\tresolve({\n\t\t\t\t\tdate: selectedDate,\n\t\t\t\t\tstartTime: startAddress,\n\t\t\t\t\tendTime: endAddress,\n\t\t\t\t\tstartClock: startTimeInput,\n\t\t\t\t\tendClock: endTimeInput,\n\t\t\t\t\tdestinations: destinations.map((d) => d.location),\n\t\t\t\t\tearnings: earnings,\n\t\t\t\t\ttotalMileage: totalMileage.toFixed(2),\n\t\t\t\t\ttotalTime: formatDuration(totalDuration),\n\t\t\t\t\ttotalEarnings: totalEarnings.toFixed(2),\n\t\t\t\t\tfuelCost: fuelCost.toFixed(2),\n\t\t\t\t\tmaintenanceCost: maintenanceCost.toFixed(2),\n\t\t\t\t\tsuppliesCost: suppliesCost.toFixed(2),\n\t\t\t\t\tnetProfit: netProfit.toFixed(2),\n\t\t\t\t\tprofitPerHour: profitPerHour.toFixed(2),\n\t\t\t\t\thoursWorked: hoursWorked\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tshowAlertModal(' Directions request failed due to: ' + status);\n\t\t\t\tdocument.getElementById('map').classList.add('hidden');\n\t\t\t\tdocument.getElementById('results').classList.add('hidden');\n\t\t\t\tresolve(null);\n\t\t\t}\n\t\t});\n\t});\n}\n\nfunction updateUI(data) {\n\tif (data) {\n\t\tdocument.getElementById('total-mileage').textContent = data.totalMileage;\n\t\tdocument.getElementById('total-time').textContent = data.totalTime;\n\t\tdocument.getElementById('total-earnings').textContent = data.totalEarnings;\n\t\tdocument.getElementById('fuel-cost').textContent = data.fuelCost;\n\t\tdocument.getElementById('maintenance-cost-result').textContent = data.maintenanceCost;\n\t\tdocument.getElementById('supplies-cost-result').textContent = data.suppliesCost;\n\t\tdocument.getElementById('net-profit').textContent = data.netProfit;\n\t\tdocument.getElementById('profit-per-hour').textContent = data.profitPerHour;\n\t\tdocument.getElementById('results').classList.remove('hidden');\n\t\tconst start = data.startClock;\n\t\tconst end = data.endClock;\n\n\t\tlet totalMinutes = 0;\n\t\tif (start && end && start.includes(':') && end.includes(':')) {\n\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\tlet startMin = sh * 60 + sm;\n\t\t\tlet endMin = eh * 60 + em;\n\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\t\t\ttotalMinutes = endMin - startMin;\n\t\t}\n\n\t\tconst totalH = Math.floor(totalMinutes / 60);\n\t\tconst totalM = totalMinutes % 60;\n\t\tconst hourText = `${totalH} hour${totalH !== 1 ? 's' : ''}`;\n\t\tconst minuteText = totalM > 0 ? ` ${totalM} minute${totalM !== 1 ? 's' : ''}` : '';\n\t\tdocument.getElementById('total-hours').textContent = `${hourText}${minuteText}`;\n\n\t\tif (originalMileage === null) {\n\t\t\toriginalMileage = data.totalMileage;\n\t\t}\n\t\tdocument.getElementById('mileage-display').textContent =\n\t\t\t'Original Route: ' + originalMileage + ' miles';\n\n\t\t//  Add the new detailed display below the map\n\t\tconst detailedResultsHTML = `\n  <h3>Route Details</h3>\n  <p><strong>Date:</strong> ${data.date}</p>\n  <p><strong>Start Address:</strong> ${data.startTime}</p>\n  <p><strong>Destinations:</strong><br>${data.destinations.map((d) => `- ${d}`).join('<br>')}</p>\n  <p><strong>End Address:</strong> ${data.endTime}</p>\n  <p><strong>Earnings per Stop:</strong> ${data.earnings.map((e) => `$${parseFloat(e).toFixed(2)}`).join(', ')}</p>\n  <p><strong>Mileage:</strong> ${data.totalMileage} miles</p>\n  <p><strong>Drive Time:</strong> ${data.totalTime}</p>\n  <p><strong>Total Earnings:</strong> $${data.totalEarnings}</p>\n  <p><strong>Fuel Cost:</strong> $${data.fuelCost}</p>\n  <p><strong>Maintenance:</strong> $${data.maintenanceCost}</p>\n  <p><strong>Supplies:</strong> $${data.suppliesCost}</p>\n  <p><strong>Hours Worked:</strong> ${(() => {\n\t\tconst totalClockMinutes = (() => {\n\t\t\tconst start = data.startClock;\n\t\t\tconst end = data.endClock;\n\t\t\tif (!start || !end) return 0;\n\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\tlet startMin = sh * 60 + sm;\n\t\t\tlet endMin = eh * 60 + em;\n\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\t\t\treturn endMin - startMin;\n\t\t})();\n\n\t\tconst driveMinutes = convertTimeToMinutes(data.totalTime || '');\n\t\tconst workedMinutes = Math.max(totalClockMinutes - driveMinutes, 0);\n\t\treturn formatHoursAndMinutesFromMinutes(workedMinutes);\n\t})()}</p>\n\n<p><strong>Total Hours:</strong> ${(() => {\n\t\t\tconst start = data.startClock;\n\t\t\tconst end = data.endClock;\n\t\t\tlet totalMinutes = 0;\n\t\t\tif (start && end && start.includes(':') && end.includes(':')) {\n\t\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\t\tlet startMin = sh * 60 + sm;\n\t\t\t\tlet endMin = eh * 60 + em;\n\t\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\t\t\t\ttotalMinutes = endMin - startMin;\n\t\t\t}\n\t\t\treturn formatHoursAndMinutesFromMinutes(totalMinutes);\n\t\t})()}</p>\n\n\n  <p><strong>Net Profit:</strong> $${data.netProfit}</p>\n  <p><strong>Profit per Hour:</strong> $${data.profitPerHour}</p>\n`;\n\n\t\tdocument.getElementById('detailed-results').innerHTML = detailedResultsHTML;\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nfunction openInGoogleMaps() {\n\tconst start = encodeURIComponent(document.getElementById('start-address').value.trim());\n\tconst endAddressInput = document.getElementById('end-address').value.trim();\n\n\tconst allDestinations = Array.from(document.querySelectorAll('input[id^=\"destination-\"]'))\n\t\t.map((input) => input.value.trim())\n\t\t.filter((dest) => dest.length > 0);\n\n\tconst end = encodeURIComponent(\n\t\tendAddressInput || allDestinations[allDestinations.length - 1] || start\n\t);\n\n\t//  Don't duplicate end address inside destinations\n\tconst destinations = allDestinations.filter((dest) => dest !== endAddressInput);\n\n\t//  Now build the URL\n\tlet url = `https://www.google.com/maps/dir/?api=1&origin=${start}&destination=${end}`;\n\n\tif (destinations.length > 0) {\n\t\turl += `&waypoints=${destinations.map(encodeURIComponent).join('|')}`;\n\t}\n\n\twindow.open(url, '_blank');\n}\n\nfunction resetOriginalMileageDisplay() {\n\tif (originalMileage === null) return; // Already reset  no need to do anything\n\n\toriginalMileage = null;\n\tdocument.getElementById('mileage-display').textContent = '';\n\tdocument.getElementById('optimized-mileage-display').textContent = '';\n}\n// older logResults removed — updated implementation is kept later in the file\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nasync function optimizeRoute() {\n\tconst destInputs = document.querySelectorAll(\n\t\t'#destinations-container .destination input[type=\"text\"]'\n\t);\n\tconst currentDestinations = Array.from(destInputs)\n\t\t.map((input) => input.value.trim())\n\t\t.filter((value) => value !== '');\n\n\tif (currentDestinations.length < 2) {\n\t\tshowAlertModal(' Please add at least two destinations to optimize the route.');\n\t\treturn;\n\t}\n\n\tif (originalMileage === null) {\n\t\tconst result = await calculateRouteData();\n\t\tif (result && result.totalMileage) {\n\t\t\toriginalMileage = parseFloat(result.totalMileage);\n\t\t\tdocument.getElementById('mileage-display').textContent =\n\t\t\t\t'Original Route: ' + originalMileage.toFixed(2) + ' miles';\n\t\t}\n\t}\n\n\tif (originalMileage === null) {\n\t\tawait calculateRouteData();\n\t}\n\n\tconst startAddress = document.getElementById('start-address').value;\n\tconst endAddress = document.getElementById('end-address').value;\n\n\tconst waypoints = currentDestinations.map((location) => ({\n\t\tlocation,\n\t\tstopover: true\n\t}));\n\n\tconst request = {\n\t\torigin: startAddress,\n\t\tdestination: endAddress,\n\t\twaypoints,\n\t\ttravelMode: 'DRIVING',\n\t\toptimizeWaypoints: true\n\t};\n\n\tdirectionsService.route(request, (response, status) => {\n\t\tif (status === 'OK' && response.routes[0].waypoint_order) {\n\t\t\tconst optimizedOrder = response.routes[0].waypoint_order;\n\t\t\tconst newDestinationsContainer = document.createElement('div');\n\t\t\tnewDestinationsContainer.id = 'destinations-container';\n\n\t\t\toptimizedOrder.forEach((index, i) => {\n\t\t\t\tconst originalDiv = destInputs[index].closest('.destination');\n\t\t\t\tconst clone = originalDiv.cloneNode(true);\n\n\t\t\t\tconst destInput = clone.querySelector('input[id^=\"destination-\"]');\n\t\t\t\tconst earningsInput = clone.querySelector('input[id^=\"earnings-\"]');\n\t\t\t\tconst destLabel = clone.querySelector('label[for^=\"destination-\"]');\n\t\t\t\tconst earningsLabel = clone.querySelector('label[for^=\"earnings-\"]');\n\t\t\t\tconst newIndex = i + 1;\n\n\t\t\t\tif (destLabel) destLabel.setAttribute('for', `destination-${newIndex}`);\n\t\t\t\tif (destInput) destInput.id = `destination-${newIndex}`;\n\t\t\t\tif (earningsLabel) earningsLabel.setAttribute('for', `earnings-${newIndex}`);\n\t\t\t\tif (earningsInput) earningsInput.id = `earnings-${newIndex}`;\n\n\t\t\t\tnewDestinationsContainer.appendChild(clone);\n\t\t\t});\n\n\t\t\tconst oldContainer = document.getElementById('destinations-container');\n\t\t\toldContainer.parentNode.replaceChild(newDestinationsContainer, oldContainer);\n\n\t\t\tdocument\n\t\t\t\t.querySelectorAll('#destinations-container .destination input[type=\"text\"]')\n\t\t\t\t.forEach(initAutocompleteDestination);\n\t\t\tdirectionsRenderer.setDirections(response);\n\n\t\t\tlet optimizedMileage = 0;\n\t\t\tlet totalDuration = 0;\n\t\t\tresponse.routes[0].legs.forEach((leg) => {\n\t\t\t\toptimizedMileage += leg.distance.value / 1609.34;\n\t\t\t\ttotalDuration += leg.duration.value;\n\t\t\t});\n\n\t\t\tdocument.getElementById('optimized-mileage-display').textContent =\n\t\t\t\t'Optimized Route: ' + optimizedMileage.toFixed(2) + ' miles';\n\t\t\tdocument.getElementById('total-time').textContent = formatDuration(totalDuration);\n\n\t\t\t//  CALCULATE hoursWorked from start/end minus drive time\n\t\t\tconst startClock = document.getElementById('start-time').value;\n\t\t\tconst endClock = document.getElementById('end-time').value;\n\t\t\tlet hoursWorked = 0;\n\n\t\t\tif (startClock && endClock && startClock.includes(':') && endClock.includes(':')) {\n\t\t\t\tconst [sh, sm] = startClock.split(':').map(Number);\n\t\t\t\tconst [eh, em] = endClock.split(':').map(Number);\n\t\t\t\tlet startMin = sh * 60 + sm;\n\t\t\t\tlet endMin = eh * 60 + em;\n\t\t\t\tif (endMin < startMin) endMin += 1440;\n\n\t\t\t\tconst totalMinutes = endMin - startMin;\n\t\t\t\tconst driveMinutes = totalDuration / 60;\n\t\t\t\tconst workedMinutes = Math.max(totalMinutes - driveMinutes, 0);\n\t\t\t\thoursWorked = workedMinutes / 60;\n\t\t\t\tdocument.getElementById('total-hours').value = formatHoursAndMinutes(hoursWorked);\n\t\t\t}\n\n\t\t\tconst earnings = Array.from(document.querySelectorAll('input[id^=\"earnings-\"]')).map(\n\t\t\t\t(i) => parseFloat(i.value) || 0\n\t\t\t);\n\t\t\tconst totalEarnings = earnings.reduce((a, b) => a + b, 0);\n\t\t\tconst mpg = parseFloat(document.getElementById('mpg').value || 1);\n\t\t\tconst gasPrice = parseFloat(document.getElementById('gas-price').value || 0);\n\t\t\tconst maintenance = parseFloat(document.getElementById('maintenance-cost').value || 0);\n\t\t\tconst supplies = parseFloat(document.getElementById('supplies-cost').value || 0);\n\n\t\t\tconst fuelCost = (optimizedMileage / mpg) * gasPrice;\n\t\t\tconst netProfit = totalEarnings - fuelCost - maintenance - supplies;\n\t\t\tconst totalHours = hoursWorked;\n\t\t\tconst profitPerHour = totalHours > 0 ? netProfit / totalHours : 0;\n\n\t\t\tconst optimizedData = {\n\t\t\t\tdate: document.getElementById('log-date').value || new Date().toISOString().split('T')[0],\n\t\t\t\tstartTime: startAddress,\n\t\t\t\tendTime: endAddress,\n\t\t\t\tstartClock,\n\t\t\t\tendClock,\n\t\t\t\tdestinations: Array.from(document.querySelectorAll('input[id^=\"destination-\"]')).map(\n\t\t\t\t\t(input) => input.value\n\t\t\t\t),\n\t\t\t\tearnings,\n\t\t\t\ttotalMileage: optimizedMileage.toFixed(2),\n\t\t\t\ttotalTime: formatDuration(totalDuration),\n\t\t\t\ttotalEarnings: totalEarnings.toFixed(2),\n\t\t\t\tfuelCost: fuelCost.toFixed(2),\n\t\t\t\tmaintenanceCost: maintenance.toFixed(2),\n\t\t\t\tsuppliesCost: supplies.toFixed(2),\n\t\t\t\thoursWorked: hoursWorked,\n\t\t\t\tnetProfit: netProfit.toFixed(2),\n\t\t\t\tprofitPerHour: profitPerHour.toFixed(2)\n\t\t\t};\n\n\t\t\tupdateUI(optimizedData);\n\t\t\tshowConfirmationMessage(' Route optimized successfully!');\n\n\t\t\t//  Scroll to map after optimization\n\t\t\tdocument.getElementById('map')?.scrollIntoView({ behavior: 'smooth' });\n\t\t} else if (status === 'OK') {\n\t\t\tdirectionsRenderer.setDirections(response);\n\t\t} else {\n\t\t\tshowAlertModal(' Could not optimize route due to: ' + status);\n\t\t}\n\t});\n}\n\nfunction formatDuration(seconds) {\n\tconst hours = Math.floor(seconds / 3600);\n\tconst minutes = Math.floor((seconds % 3600) / 60);\n\tconst remainingSeconds = seconds % 60;\n\tlet formattedString = '';\n\tif (hours > 0) {\n\t\tformattedString += `${hours} hour${hours > 1 ? 's' : ''} `;\n\t}\n\tif (minutes > 0) {\n\t\tformattedString += `${minutes} minute${minutes > 1 ? 's' : ''} `;\n\t}\n\tif (hours === 0 && minutes === 0) {\n\t\tformattedString += `${remainingSeconds} second${remainingSeconds !== 1 ? 's' : ''}`;\n\t}\n\treturn formattedString.trim();\n}\n\nfunction addDestination() {\n\tconst newDestinationIndex =\n\t\tdocument.querySelectorAll('#destinations-container .destination').length + 1;\n\tconst container = document.getElementById('destinations-container');\n\tconst newDestinationDiv = document.createElement('div');\n\tnewDestinationDiv.classList.add('destination');\n\tnewDestinationDiv.innerHTML = `\n    <label for=\"destination-${newDestinationIndex}\">Destination ${newDestinationIndex}</label>\n   <input type=\"text\" id=\"destination-${newDestinationIndex}\" list=\"recent-destinations\" placeholder=\"Enter destination address\" required>\n\n    <label for=\"earnings-${newDestinationIndex}\">Earnings for Destination ${newDestinationIndex}</label>\n    <input type=\"number\" id=\"earnings-${newDestinationIndex}\" placeholder=\"Enter earnings for destination\" required>\n    <div class=\"destination-actions\">\n        <button class=\"delete-btn\" onclick=\"deleteDestination(this)\">Delete</button>\n        <button class=\"move-btn\" onclick=\"moveDestinationUp(this)\">Move Up</button>\n        <button class=\"move-btn\" onclick=\"moveDestinationDown(this)\">Move Down</button>\n    </div>\n`;\n\tcontainer.appendChild(newDestinationDiv);\n\tinitAutocompleteDestination(newDestinationDiv.querySelector('input[type=\"text\"]'));\n\tresetOriginalMileageDisplay();\n\trenumberMainDestinations();\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nfunction deleteDestination(button) {\n\tbutton.closest('.destination').remove();\n\tresetOriginalMileageDisplay();\n\trenumberMainDestinations();\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nfunction moveDestinationUp(button) {\n\tconst destinationDiv = button.closest('.destination');\n\tconst prevDiv = destinationDiv.previousElementSibling;\n\tif (prevDiv) {\n\t\tdestinationDiv.parentNode.insertBefore(destinationDiv, prevDiv);\n\t\tresetOriginalMileageDisplay();\n\t\trenumberMainDestinations();\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nfunction moveDestinationDown(button) {\n\tconst destinationDiv = button.closest('.destination');\n\tconst nextDiv = destinationDiv.nextElementSibling;\n\tif (nextDiv) {\n\t\tdestinationDiv.parentNode.insertBefore(nextDiv, destinationDiv);\n\t\tresetOriginalMileageDisplay();\n\t\trenumberMainDestinations();\n\t}\n}\n\nfunction logEntry(data) {\n\tdisableAutoSave = true;\n\n\tdata.startClock = document.getElementById('start-time').value || '';\n\tdata.endClock = document.getElementById('end-time').value || '';\n\tdata.hoursWorked = parseFloat(document.getElementById('total-hours').value) || 0;\n\n\tdata.mpg = parseFloat(document.getElementById('mpg').value) || 0;\n\tdata.gasPrice = parseFloat(document.getElementById('gas-price').value) || 0;\n\tdata.lastModified = new Date().toISOString();\n\tdata.notes = document.getElementById('log-notes')?.value || '';\n\tdata.maintenance = getMaintenanceData();\n\tdata.supplies = getSuppliesData();\n\n\t//  Calculate total time from start and end clock times\n\tconst start = document.getElementById('start-time').value;\n\tconst end = document.getElementById('end-time').value;\n\tlet totalHours = 0;\n\n\tif (start && end) {\n\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\tconst [eh, em] = end.split(':').map(Number);\n\t\tlet startMin = sh * 60 + sm;\n\t\tlet endMin = eh * 60 + em;\n\t\tif (endMin < startMin) endMin += 24 * 60; // handle overnight\n\t\ttotalHours = (endMin - startMin) / 60;\n\t}\n\n\t//  Use total session time for profitPerHour\n\tconst netProfitFloat = parseFloat(data.netProfit || 0);\n\tdata.profitPerHour = totalHours > 0 ? (netProfitFloat / totalHours).toFixed(2) : '0.00';\n\n\tdata.netProfit = netProfitFloat.toFixed(2);\n\n\tlocalStorage.removeItem('draftTrip');\n\tlogEntries.unshift(data);\n\tsaveLog();\n\n\tsetTimeout(() => {\n\t\tdisableAutoSave = false;\n\t}, 1000);\n}\n\nfunction displayLog(filterFn = () => true) {\n\tconst logList = document.getElementById('log-list');\n\tconst organizedLog = organizeLogByDay();\n\tlogList.innerHTML = '';\n\n\tconst allEntries = [];\n\tfor (const day in organizedLog) {\n\t\tallEntries.push(...organizedLog[day]);\n\t}\n\n\tconst sortedEntries = allEntries.sort((a, b) => {\n\t\treturn new Date(b.date) - new Date(a.date);\n\t});\n\n\tconst filteredEntries = sortedEntries.filter(\n\t\t(entry) => entry?.date && filterFn(entry.date, entry)\n\t);\n\n\tconst totalPages = Math.ceil(filteredEntries.length / logsPerPage);\n\n\tconst start = (currentPage - 1) * logsPerPage;\n\tconst end = start + logsPerPage;\n\tconst pageEntries = filteredEntries.slice(start, end);\n\n\tif (pageEntries.length === 0) {\n\t\tconst emptyMessage = document.createElement('li');\n\t\temptyMessage.textContent = 'No log entries found for selected filter.';\n\t\tlogList.appendChild(emptyMessage);\n\t} else {\n\t\tpageEntries.forEach((entry) => {\n\t\t\tif (entry) {\n\t\t\t\tconst realIndex = logEntries.findIndex((e) => JSON.stringify(e) === JSON.stringify(entry));\n\t\t\t\tconst listItem = document.createElement('li');\n\n\t\t\t\tlistItem.innerHTML = `\n  <div class=\"log-item-details\" id=\"log-entry-${realIndex}\">\n    <div id=\"summary-${realIndex}\">\n      <strong>Date:</strong> ${entry.date}<br>\n<div><strong>Destinations:</strong><br>\n  <div style=\"margin-left: 20px;\">\n    ${(entry.destinations || []).map((dest) => `- ${dest}`).join('<br>')}\n  </div>\n</div>\n\n\n      <strong>Net Profit:</strong> $${parseFloat(entry.netProfit || 0).toFixed(2)}\n    </div>\n    <div id=\"details-${realIndex}\" class=\"hidden\" style=\"margin-top:10px;\"></div>\n  </div>\n  <div class=\"log-actions\">\n    <button onclick=\"toggleLogEntryDetails(${realIndex})\" id=\"toggle-button-${realIndex}\">More Details</button>\n    <button class=\"edit-btn\" onclick=\"openEditForm(${realIndex})\">Edit</button>\n    <button onclick=\"openLogEntryInGoogleMaps(${realIndex})\">Map</button>\n\n    <button onclick=\"deleteLogEntry(${realIndex})\">Delete</button>\n    \n  </div>\n`;\n\n\t\t\t\tlogList.appendChild(listItem);\n\t\t\t}\n\t\t});\n\t}\n\n\trenderPaginationButtons(totalPages);\n\tupdateLogSummary(filterFn);\n}\n\nfunction renderPaginationButtons(totalPages) {\n\tlet paginationContainer = document.getElementById('pagination-controls');\n\tif (!paginationContainer) {\n\t\tpaginationContainer = document.createElement('div');\n\t\tpaginationContainer.id = 'pagination-controls';\n\t\tpaginationContainer.style.textAlign = 'center';\n\t\tpaginationContainer.style.marginTop = '20px';\n\t\tdocument.getElementById('log-container').appendChild(paginationContainer);\n\t}\n\n\tpaginationContainer.innerHTML = `\n    <div style=\"margin-bottom: 10px; font-size: 18px;\">\n      Page ${currentPage} of ${totalPages}\n    </div>\n    <div style=\"display: flex; justify-content: center; gap: 10px; margin-bottom: 10px;\">\n      <button onclick=\"prevPage()\" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>\n      <button onclick=\"nextPage()\" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>\n    </div>\n    <div style=\"margin-top: 10px;\">\n      Go to Page: \n      <input type=\"number\" id=\"page-input\" min=\"1\" max=\"${totalPages}\" value=\"${currentPage}\" style=\"width: 60px; text-align: center;\">\n      <button onclick=\"goToPage(${totalPages})\">Go</button>\n    </div>\n  `;\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI controls */\nfunction prevPage() {\n\tif (currentPage > 1) {\n\t\tcurrentPage--;\n\t\tdisplayLog();\n\t\tdocument.getElementById('log-container').scrollIntoView({ behavior: 'smooth' });\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI controls */\nfunction nextPage() {\n\tconst totalPages = Math.ceil(logEntries.length / logsPerPage);\n\tif (currentPage < totalPages) {\n\t\tcurrentPage++;\n\t\tdisplayLog();\n\t\tdocument.getElementById('log-container').scrollIntoView({ behavior: 'smooth' });\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI controls */\nfunction goToPage(totalPages) {\n\tconst input = document.getElementById('page-input');\n\tconst page = parseInt(input.value);\n\n\tif (!isNaN(page) && page >= 1 && page <= totalPages) {\n\t\tcurrentPage = page;\n\t\tdisplayLog();\n\t\tdocument.getElementById('log-container').scrollIntoView({ behavior: 'smooth' });\n\t} else {\n\t\tshowAlertModal(' Invalid page number.');\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI controls */\nfunction deleteLogEntry(index) {\n\tshowConfirmModal('Are you sure you want to delete this log entry?', () => {\n\t\tlogEntries.splice(index, 1);\n\t\tsaveLog();\n\t\tfilterLogs();\n\t});\n}\n\nfunction organizeLogByDay() {\n\tconst logByDay = {};\n\n\tlogEntries.forEach((entry) => {\n\t\tif (!entry?.date) return;\n\t\tif (!logByDay[entry.date]) {\n\t\t\tlogByDay[entry.date] = [];\n\t\t}\n\t\tlogByDay[entry.date].push(entry);\n\t});\n\n\treturn logByDay;\n}\n\nfunction closeEditForm() {\n\tconsole.log('closeEditForm function called');\n\tdocument.getElementById('edit-form-container').style.display = 'none';\n\tdocument.getElementById('overlay').style.display = 'none';\n\n\t// Restore regular bottom bar\n\tdocument.getElementById('bottom-bar').style.display = 'flex';\n\tdocument.getElementById('edit-bottom-bar').style.display = 'none';\n\n\teditingIndex = -1;\n}\n\nfunction updateEditTotalEarnings() {\n\tlet total = 0;\n\tconst editEarningsInputs = document.querySelectorAll(\n\t\t'#edit-destinations-container input[id^=\"edit-earnings-\"]'\n\t);\n\teditEarningsInputs.forEach((input) => {\n\t\ttotal += parseFloat(input.value) || 0;\n\t});\n\tdocument.getElementById('edit-total-earnings').value = total.toFixed(2);\n}\n\nfunction updateEditFuelCost() {\n\tconst mileage = parseFloat(document.getElementById('edit-total-mileage').value) || 0;\n\tconst mpg = parseFloat(document.getElementById('edit-mpg').value) || 1; // Prevent division by zero\n\tconst gasPrice = parseFloat(document.getElementById('edit-gas-price').value) || 0;\n\tconst fuelCost = (mileage / mpg) * gasPrice;\n\tdocument.getElementById('edit-fuel-cost').value = fuelCost.toFixed(2);\n}\n\nfunction recalculateEditMileageAndCosts() {\n\tconst start = document.getElementById('edit-start-address').value.trim();\n\tconst end = document.getElementById('edit-end-address').value.trim();\n\tconst destInputs = document.querySelectorAll(\n\t\t'#edit-destinations-container input[id^=\"edit-destination-\"]'\n\t);\n\n\tconst destinations = Array.from(destInputs)\n\t\t.filter((input) => input.value.trim())\n\t\t.map((input) => ({\n\t\t\tlocation: input.value.trim(),\n\t\t\tstopover: true\n\t\t}));\n\n\tif (\n\t\t!start ||\n\t\t!end ||\n\t\tdestinations.length !== destInputs.length ||\n\t\tdestinations.some((d) => !d.location)\n\t) {\n\t\tconsole.warn(\n\t\t\t' Missing or invalid start, end, or destination address  skipping route calculation.'\n\t\t);\n\t\treturn;\n\t}\n\n\tconst request = {\n\t\torigin: start,\n\t\tdestination: end,\n\t\twaypoints: destinations,\n\t\ttravelMode: 'DRIVING'\n\t};\n\n\tdirectionsService.route(request, (response, status) => {\n\t\tif (status === 'OK') {\n\t\t\tlet totalMileage = 0;\n\t\t\tlet totalDuration = 0;\n\t\t\tresponse.routes[0].legs.forEach((leg) => {\n\t\t\t\ttotalMileage += leg.distance.value / 1609.34;\n\t\t\t\ttotalDuration += leg.duration.value;\n\t\t\t});\n\n\t\t\tconst mileageInput = document.getElementById('edit-total-mileage');\n\t\t\tconst timeInput = document.getElementById('edit-total-time');\n\n\t\t\tconsole.log('Updating:', {\n\t\t\t\tmileageInput,\n\t\t\t\ttimeInput,\n\t\t\t\ttotalMileage: totalMileage.toFixed(2),\n\t\t\t\tformattedTime: formatDuration(totalDuration)\n\t\t\t});\n\n\t\t\tif (mileageInput) mileageInput.value = totalMileage.toFixed(2);\n\t\t\tif (timeInput) timeInput.value = formatDuration(totalDuration);\n\n\t\t\tupdateEditFuelCost();\n\t\t} else if (status === 'ZERO_RESULTS') {\n\t\t\tshowAlertModal(\n\t\t\t\t' No route could be found between the entered locations. Please double-check the addresses.'\n\t\t\t);\n\t\t} else {\n\t\t\tconsole.error('Mileage error:', status);\n\t\t}\n\t});\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nfunction moveEditDestinationUp(button) {\n\tconst destinationDiv = button.closest('.destination');\n\tconst prevDiv = destinationDiv.previousElementSibling;\n\tif (prevDiv) {\n\t\tdestinationDiv.parentNode.insertBefore(destinationDiv, prevDiv);\n\t\tresetOriginalMileageDisplay();\n\t\treinitializeEditDestination(destinationDiv);\n\t\trenumberEditDestinations();\n\t\trecalculateEditMileageAndCosts(); //  added\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nfunction moveEditDestinationDown(button) {\n\tconst destinationDiv = button.closest('.destination');\n\tconst nextDiv = destinationDiv.nextElementSibling;\n\tif (nextDiv) {\n\t\tdestinationDiv.parentNode.insertBefore(nextDiv, destinationDiv);\n\t\tresetOriginalMileageDisplay();\n\t\treinitializeEditDestination(destinationDiv);\n\t\trenumberEditDestinations();\n\t\trecalculateEditMileageAndCosts(); //  added\n\t}\n}\n\nfunction reinitializeEditDestination(destinationDiv) {\n\tconst addressInput = destinationDiv.querySelector('input[type=\"text\"]');\n\tif (!addressInput) return;\n\n\t//  Recreate autocomplete\n\tconst autocomplete = new google.maps.places.Autocomplete(addressInput, {\n\t\ttypes: ['geocode']\n\t});\n\n\t//  Trigger on selection from dropdown\n\tautocomplete.addListener('place_changed', recalculateEditMileageAndCosts);\n\n\t//  Trigger when user leaves input field\n\taddressInput.addEventListener('blur', () => {\n\t\t// Slight delay to allow autocomplete to trigger first (if applicable)\n\t\tsetTimeout(recalculateEditMileageAndCosts, 100);\n\t});\n\n\t//  Trigger when Enter is pressed\n\taddressInput.addEventListener('keydown', (e) => {\n\t\tif (e.key === 'Enter') {\n\t\t\te.preventDefault(); // prevent form submission\n\t\t\trecalculateEditMileageAndCosts();\n\n\t\t\tconst allDestInputs = document.querySelectorAll(\n\t\t\t\t'#edit-destinations-container input[type=\"text\"]'\n\t\t\t);\n\t\t\tif (addressInput === allDestInputs[allDestInputs.length - 1]) {\n\t\t\t\taddEditDestination(); // add another one if last\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction renumberEditDestinations() {\n\tconst destinationDivs = document.querySelectorAll('#edit-destinations-container .destination');\n\n\tdestinationDivs.forEach((div, index) => {\n\t\tconst destNum = index + 1;\n\t\tconst label = div.querySelector('label[for^=\"edit-destination-\"]');\n\t\tconst earningsLabel = div.querySelector('label[for^=\"edit-earnings-\"]');\n\t\tconst addressInput = div.querySelector('input[type=\"text\"]');\n\t\tconst earningsInput = div.querySelector('input[type=\"number\"]');\n\n\t\tif (label) {\n\t\t\tlabel.textContent = `Destination ${destNum}`;\n\t\t\tlabel.setAttribute('for', `edit-destination-${destNum}`);\n\t\t}\n\n\t\tif (earningsLabel) {\n\t\t\tearningsLabel.textContent = `Earnings ${destNum}`;\n\t\t\tearningsLabel.setAttribute('for', `edit-earnings-${destNum}`);\n\t\t}\n\n\t\tif (addressInput) {\n\t\t\taddressInput.id = `edit-destination-${destNum}`;\n\t\t}\n\n\t\tif (earningsInput) {\n\t\t\tearningsInput.id = `edit-earnings-${destNum}`;\n\t\t}\n\t});\n}\n\nfunction addEditDestination() {\n\tconst container = document.getElementById('edit-destinations-container');\n\n\tconst destDiv = document.createElement('div');\n\tdestDiv.classList.add('destination');\n\n\tdestDiv.innerHTML = `\n    <label for=\"edit-destination-temp\">Destination</label>\n    <input type=\"text\" id=\"edit-destination-temp\" list=\"recent-destinations\" placeholder=\"Enter destination address\">\n\n    <label for=\"edit-earnings-temp\">Earnings</label>\n    <input type=\"number\" id=\"edit-earnings-temp\" placeholder=\"Enter earnings\">\n\n    <div class=\"destination-actions\">\n      <button type=\"button\" class=\"delete-btn\" onclick=\"deleteEditDestination(this)\">Delete</button>\n      <button type=\"button\" class=\"move-btn\" onclick=\"moveEditDestinationUp(this)\">Move Up</button>\n      <button type=\"button\" class=\"move-btn\" onclick=\"moveEditDestinationDown(this)\">Move Down</button>\n    </div>\n  `;\n\n\tcontainer.appendChild(destDiv);\n\n\trenumberEditDestinations();\n\treinitializeEditDestination(destDiv);\n\n\t//  Add listener to update total earnings\n\tconst earningsInput = destDiv.querySelector('input[type=\"number\"]');\n\tif (earningsInput) {\n\t\tearningsInput.addEventListener('input', updateEditTotalEarnings);\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nfunction deleteEditDestination(button) {\n\tconst destinationDiv = button.closest('.destination');\n\tif (destinationDiv) {\n\t\tdestinationDiv.remove();\n\t\trenumberEditDestinations(); //  Use shared function\n\t\tupdateEditTotalEarnings(); //  Optional if you're tracking per stop\n\t\tresetOriginalMileageDisplay();\n\t\trecalculateEditMileageAndCosts();\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML handlers */\nfunction openEditForm(index) {\n\tconsole.log(' Opening edit for index:', index);\n\teditingIndex = index;\n\tconst entry = logEntries[index];\n\n\tif (!entry) {\n\t\tconsole.error(' No entry found for editing');\n\t\talert('Error: Entry not found');\n\t\treturn;\n\t}\n\n\tconst editFormContainer = document.getElementById('edit-form-container');\n\tconst overlay = document.getElementById('overlay');\n\n\t//  Helper to safely set input values\n\tfunction setInputValue(id, value) {\n\t\tconst input = document.getElementById(id);\n\t\tif (input) input.value = value ?? '';\n\t}\n\n\t//  Populate all form fields safely\n\tsetInputValue('edit-date', entry.date);\n\tsetInputValue('edit-start-address', entry.startTime);\n\tsetInputValue('edit-end-address', entry.endTime);\n\tsetInputValue('edit-start-time', entry.startClock ?? '');\n\tsetInputValue('edit-end-time', entry.endClock ?? '');\n\tsetInputValue('edit-total-earnings', entry.totalEarnings);\n\tsetInputValue('edit-fuel-cost', entry.fuelCost);\n\n\t// Populate maintenance items\n\tconst editMaintenanceContainer = document.getElementById('edit-maintenance-container');\n\teditMaintenanceContainer.innerHTML = '';\n\tif (entry.maintenance && Array.isArray(entry.maintenance)) {\n\t\tentry.maintenance.forEach((item) => {\n\t\t\taddEditMaintenanceItem();\n\t\t\tconst lastItem = editMaintenanceContainer.lastElementChild;\n\t\t\tconst typeSelect = lastItem.querySelector('.maintenance-type');\n\t\t\tconst customInput = lastItem.querySelector('.maintenance-custom-name');\n\t\t\tconst costInput = lastItem.querySelector('.maintenance-cost');\n\n\t\t\tconst presetTypes = ['Oil Change', 'Tire Rotation', 'Brake Service', 'Battery'];\n\t\t\tconst customTypes = getCustomMaintenanceTypes();\n\n\t\t\tif (!presetTypes.includes(item.type) && !customTypes.includes(item.type)) {\n\t\t\t\tsaveCustomMaintenanceType(item.type);\n\t\t\t\tconst option = document.createElement('option');\n\t\t\t\toption.value = item.type;\n\t\t\t\toption.textContent = item.type;\n\t\t\t\tconst customOption = typeSelect.querySelector('option[value=\"Custom\"]');\n\t\t\t\ttypeSelect.insertBefore(option, customOption);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tpresetTypes.includes(item.type) ||\n\t\t\t\tcustomTypes.includes(item.type) ||\n\t\t\t\ttypeSelect.querySelector(`option[value=\"${item.type}\"]`)\n\t\t\t) {\n\t\t\t\ttypeSelect.value = item.type;\n\t\t\t} else {\n\t\t\t\ttypeSelect.value = 'Custom';\n\t\t\t\tcustomInput.style.display = 'block';\n\t\t\t\tcustomInput.value = item.type;\n\t\t\t}\n\t\t\tcostInput.value = item.cost;\n\t\t});\n\t}\n\n\t// Populate supplies items\n\tconst editSuppliesContainer = document.getElementById('edit-supplies-container');\n\teditSuppliesContainer.innerHTML = '';\n\tif (entry.supplies && Array.isArray(entry.supplies)) {\n\t\tentry.supplies.forEach((item) => {\n\t\t\taddEditSupplyItem();\n\t\t\tconst lastItem = editSuppliesContainer.lastElementChild;\n\t\t\tconst typeSelect = lastItem.querySelector('.supply-type');\n\t\t\tconst customInput = lastItem.querySelector('.supply-custom-name');\n\t\t\tconst costInput = lastItem.querySelector('.supply-cost');\n\n\t\t\tconst presetTypes = ['Poles', 'Concrete', 'Cable'];\n\t\t\tconst customTypes = getCustomSupplyTypes();\n\n\t\t\t// If it's not a preset and not in saved custom types, add it\n\t\t\tif (!presetTypes.includes(item.type) && !customTypes.includes(item.type)) {\n\t\t\t\tsaveCustomSupplyType(item.type);\n\t\t\t\t// Add to this dropdown\n\t\t\t\tconst option = document.createElement('option');\n\t\t\t\toption.value = item.type;\n\t\t\t\toption.textContent = item.type;\n\t\t\t\tconst customOption = typeSelect.querySelector('option[value=\"Custom\"]');\n\t\t\t\ttypeSelect.insertBefore(option, customOption);\n\t\t\t}\n\n\t\t\t// Select the type\n\t\t\tif (\n\t\t\t\tpresetTypes.includes(item.type) ||\n\t\t\t\tcustomTypes.includes(item.type) ||\n\t\t\t\ttypeSelect.querySelector(`option[value=\"${item.type}\"]`)\n\t\t\t) {\n\t\t\t\ttypeSelect.value = item.type;\n\t\t\t} else {\n\t\t\t\ttypeSelect.value = 'Custom';\n\t\t\t\tcustomInput.style.display = 'block';\n\t\t\t\tcustomInput.value = item.type;\n\t\t\t}\n\t\t\tcostInput.value = item.cost;\n\t\t});\n\t}\n\n\tsetInputValue('edit-total-mileage', entry.totalMileage);\n\tsetInputValue('edit-total-time', entry.totalTime);\n\tsetInputValue('edit-hours-worked', entry.hoursWorked ?? 0);\n\tsetInputValue('edit-mpg', entry.mpg);\n\tsetInputValue('edit-gas-price', entry.gasPrice);\n\tsetInputValue('edit-notes', entry.notes || '');\n\n\tconst destinationsContainer = document.getElementById('edit-destinations-container');\n\tif (destinationsContainer) {\n\t\tdestinationsContainer.innerHTML = '';\n\n\t\tentry.destinations.forEach((destination, i) => {\n\t\t\tconst destDiv = document.createElement('div');\n\t\t\tdestDiv.className = 'destination';\n\t\t\tdestDiv.innerHTML = `\n        <label for=\"edit-destination-${i + 1}\">Destination ${i + 1}</label>\n        <input type=\"text\" id=\"edit-destination-${i + 1}\" list=\"recent-destinations\" value=\"${destination}\">\n\n        <label for=\"edit-earnings-${i + 1}\">Earnings for Destination ${i + 1}</label>\n        <input type=\"number\" id=\"edit-earnings-${i + 1}\" value=\"${entry.earnings[i] || 0}\">\n        <div class=\"destination-actions\">\n          <button type=\"button\" class=\"delete-btn\" onclick=\"deleteEditDestination(this)\">Delete</button>\n          <button type=\"button\" class=\"move-btn\" onclick=\"moveEditDestinationUp(this)\">Move Up</button>\n          <button type=\"button\" class=\"move-btn\" onclick=\"moveEditDestinationDown(this)\">Move Down</button>\n        </div>\n      `;\n\t\t\tdestinationsContainer.appendChild(destDiv);\n\t\t\treinitializeEditDestination(destDiv);\n\t\t\tsetTimeout(() => {\n\t\t\t\tdocument\n\t\t\t\t\t.querySelectorAll('#edit-destinations-container input[id^=\"edit-earnings-\"]')\n\t\t\t\t\t.forEach((input) => {\n\t\t\t\t\t\tinput.addEventListener('input', updateEditTotalEarnings);\n\t\t\t\t\t});\n\t\t\t}, 0);\n\t\t});\n\t}\n\n\t//  Show Edit form\n\tif (editFormContainer && overlay) {\n\t\teditFormContainer.style.display = 'block';\n\t\toverlay.style.display = 'block';\n\n\t\t// Switch bottom bars\n\t\tdocument.getElementById('bottom-bar').style.display = 'none';\n\t\tdocument.getElementById('edit-bottom-bar').style.display = 'flex';\n\n\t\tconst startTimeInput = document.getElementById('edit-start-time');\n\t\tconst endTimeInput = document.getElementById('edit-end-time');\n\n\t\tif (startTimeInput && endTimeInput) {\n\t\t\tstartTimeInput.addEventListener('input', recalculateEditHoursWorked);\n\t\t\tendTimeInput.addEventListener('input', recalculateEditHoursWorked);\n\t\t}\n\t}\n\n\t//  Setup Autocomplete after a tiny delay\n\tsetTimeout(() => {\n\t\ttry {\n\t\t\tdocument\n\t\t\t\t.querySelectorAll('#edit-destinations-container input[id^=\"edit-destination-\"]')\n\t\t\t\t.forEach((input) => {\n\t\t\t\t\tconst autocomplete = new google.maps.places.Autocomplete(input, { types: ['geocode'] });\n\n\t\t\t\t\tinitAutocompleteDestination(input);\n\n\t\t\t\t\tautocomplete.addListener('place_changed', () => {\n\t\t\t\t\t\tconst place = autocomplete.getPlace();\n\t\t\t\t\t\tif (place && place.geometry) {\n\t\t\t\t\t\t\trecalculateEditMileageAndCosts();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.warn('Invalid place selected for destination.');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t} catch (error) {\n\t\t\tconsole.error('Error setting up autocomplete:', error);\n\t\t}\n\t}, 0);\n}\n\nfunction getNumberValue(id) {\n\tconst el = document.getElementById(id);\n\treturn el ? parseFloat(el.value) || 0 : 0;\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI */\nasync function saveEditedLogEntry() {\n\tif (editingIndex === -1) {\n\t\tconsole.warn('No entry selected for editing.');\n\t\treturn;\n\t}\n\n\tconst entry = logEntries[editingIndex];\n\n\tentry.date = document.getElementById('edit-date').value;\n\tentry.startClock = document.getElementById('edit-start-time')?.value || '';\n\tentry.endClock = document.getElementById('edit-end-time')?.value || '';\n\tentry.startTime = document.getElementById('edit-start-address').value;\n\tentry.endTime = document.getElementById('edit-end-address').value;\n\tentry.totalTime = document.getElementById('edit-total-time')?.value || '';\n\tentry.notes = document.getElementById('edit-notes').value.trim();\n\n\tentry.destinations = [];\n\tentry.earnings = [];\n\n\tconst destInputs = document.querySelectorAll(\n\t\t'#edit-destinations-container input[id^=\"edit-destination-\"]'\n\t);\n\tconst earningsInputs = document.querySelectorAll(\n\t\t'#edit-destinations-container input[id^=\"edit-earnings-\"]'\n\t);\n\n\tdestInputs.forEach((input) => {\n\t\tentry.destinations.push(input.value.trim());\n\t});\n\n\tsaveRecentDestinations(entry.destinations);\n\tupdateDatalistSuggestions();\n\n\tearningsInputs.forEach((input) => {\n\t\tconst value = parseFloat(input.value.trim()) || 0;\n\t\tentry.earnings.push(value);\n\t});\n\n\tentry.totalEarnings = entry.earnings.reduce((sum, val) => sum + val, 0);\n\tentry.fuelCost = getNumberValue('edit-fuel-cost');\n\n\t// Save maintenance data\n\tentry.maintenance = getEditMaintenanceData();\n\tentry.maintenanceCost = getTotalEditMaintenanceCost();\n\n\t// Save supplies data\n\tentry.supplies = getEditSuppliesData();\n\tentry.suppliesCost = getTotalEditSuppliesCost();\n\n\tentry.totalMileage = getNumberValue('edit-total-mileage');\n\tentry.mpg = getNumberValue('edit-mpg');\n\tentry.gasPrice = getNumberValue('edit-gas-price');\n\tentry.hoursWorked = getNumberValue('edit-hours-worked');\n\n\tconst netProfitFloat =\n\t\tentry.totalEarnings - entry.fuelCost - entry.maintenanceCost - entry.suppliesCost;\n\n\t// convertTimeToHours removed — unused here\n\t//  Use full clock span only (start-end time)\n\tlet sessionMinutes = 0;\n\tconst start = entry.startClock;\n\tconst end = entry.endClock;\n\n\tif (start && end && start.includes(':') && end.includes(':')) {\n\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\tconst [eh, em] = end.split(':').map(Number);\n\t\tlet startMin = sh * 60 + sm;\n\t\tlet endMin = eh * 60 + em;\n\t\tif (endMin < startMin) endMin += 1440;\n\t\tsessionMinutes = endMin - startMin;\n\t}\n\n\tconst sessionHours = sessionMinutes / 60;\n\tentry.profitPerHour = sessionHours > 0 ? (netProfitFloat / sessionHours).toFixed(2) : '0.00';\n\n\tentry.netProfit = netProfitFloat.toFixed(2);\n\tentry.lastModified = new Date().toISOString();\n\n\tawait saveLog();\n\tfilterLogs();\n\tcloseEditForm();\n\tshowConfirmationMessage(' Log entry updated!');\n}\n\nlet fileReaderBusy = false; // global or top-level\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI */\nasync function importLog() {\n\tif (fileReaderBusy) {\n\t\tconsole.warn(' FileReader is still busy. Try again in a moment.');\n\t\treturn;\n\t}\n\n\tconst token = localStorage.getItem('token');\n\tif (!token) {\n\t\tshowAlertModal(' You must be signed in to import a CSV file.', showLogin);\n\t\treturn;\n\t}\n\n\tconst fileInput = document.getElementById('import-file');\n\tconst file = fileInput.files[0];\n\n\tif (!file) {\n\t\tshowAlertModal('Please select a CSV file to import.');\n\t\treturn;\n\t}\n\n\tfileReaderBusy = true;\n\n\tconst reader = new FileReader();\n\n\treader.onload = async function (e) {\n\t\ttry {\n\t\t\tconst csvData = e.target.result;\n\t\t\tconst lines = csvData.split('\\n').slice(1); // Skip header\n\t\t\tconst newLogEntries = [];\n\n\t\t\tconst parseFormattedTime = (str) => {\n\t\t\t\tstr = str.replace(/\"/g, '').toLowerCase().trim();\n\t\t\t\tconst hourMatch = str.match(/(\\d+)\\s*hour/);\n\t\t\t\tconst minuteMatch = str.match(/(\\d+)\\s*minute/);\n\n\t\t\t\tconst hours = hourMatch ? parseInt(hourMatch[1]) : 0;\n\t\t\t\tconst minutes = minuteMatch ? parseInt(minuteMatch[1]) : 0;\n\n\t\t\t\treturn (hours * 60 + minutes) / 60;\n\t\t\t};\n\n\t\t\tlet successCount = 0;\n\t\t\tlet duplicateCount = 0;\n\n\t\t\tfor (const line of lines) {\n\t\t\t\tif (!line.trim() || line.startsWith('Totals:')) continue;\n\n\t\t\t\tconst values = line.match(/(\"([^\"]*)\"|[^,]+)/g);\n\t\t\t\tif (!values || values.length < 17) {\n\t\t\t\t\tconsole.warn(' Skipping line  incorrect column count:', line);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst destinations = values[4]\n\t\t\t\t\t\t.replace(/^\"|\"$/g, '')\n\t\t\t\t\t\t.split(';')\n\t\t\t\t\t\t.map((d) => d.trim());\n\n\t\t\t\t\tconst earnings = values[6]\n\t\t\t\t\t\t.replace(/^\"|\"$/g, '')\n\t\t\t\t\t\t.split(';')\n\t\t\t\t\t\t.map((v) => parseFloat(v.trim()) || 0);\n\n\t\t\t\t\tconst notes = values[17] ? values[17].replace(/^\"|\"$/g, '').replace(/\"\"/g, '\"') : '';\n\n\t\t\t\t\tconst entry = {\n\t\t\t\t\t\tdate: values[0],\n\t\t\t\t\t\tstartClock: values[1],\n\t\t\t\t\t\tendClock: values[2],\n\t\t\t\t\t\tstartTime: values[3]?.replace(/^\"|\"$/g, '') || '',\n\t\t\t\t\t\tdestinations,\n\t\t\t\t\t\tendTime: values[5]?.replace(/^\"|\"$/g, '') || '',\n\t\t\t\t\t\tearnings,\n\t\t\t\t\t\ttotalMileage: parseFloat(values[7]) || 0,\n\t\t\t\t\t\ttotalTime: values[8]?.replace(/^\"|\"$/g, ''),\n\t\t\t\t\t\ttotalEarnings: parseFloat(values[9]) || 0,\n\t\t\t\t\t\tfuelCost: parseFloat(values[10]) || 0,\n\t\t\t\t\t\tmaintenanceCost: parseFloat(values[11]) || 0,\n\t\t\t\t\t\tsuppliesCost: parseFloat(values[12]) || 0,\n\t\t\t\t\t\thoursWorked: parseFormattedTime(values[13]),\n\t\t\t\t\t\ttotalHours: parseFormattedTime(values[14]),\n\t\t\t\t\t\tnetProfit: parseFloat(values[15]) || 0,\n\t\t\t\t\t\tprofitPerHour: parseFloat(values[16]) || 0,\n\t\t\t\t\t\tnotes, //  new!\n\t\t\t\t\t\tmpg: 0,\n\t\t\t\t\t\tgasPrice: 0,\n\t\t\t\t\t\tlastModified: new Date().toISOString()\n\t\t\t\t\t};\n\n\t\t\t\t\tif (isDuplicateEntry(entry, logEntries)) {\n\t\t\t\t\t\tduplicateCount++;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tnewLogEntries.push(entry);\n\t\t\t\t\tsuccessCount++;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.warn(' Error parsing CSV row:', err, line);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (successCount === 0) {\n\t\t\t\tif (duplicateCount > 0) {\n\t\t\t\t\tshowAlertModal(' All entries in the file were duplicates and have been skipped.');\n\t\t\t\t} else {\n\t\t\t\t\tshowAlertModal(' The file format appears to be invalid or unsupported.');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogEntries = [...logEntries, ...newLogEntries];\n\t\t\tawait saveLog();\n\t\t\tfilterLogs();\n\t\t\tif (successCount > 0) {\n\t\t\t\tshowAlertModal(\n\t\t\t\t\t` Imported ${successCount} entr${successCount === 1 ? 'y' : 'ies'} successfully.${duplicateCount > 0 ? `\\n Skipped ${duplicateCount} duplicate${duplicateCount === 1 ? '' : 's'}.` : ''}`\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tshowAlertModal(' The file format appears to be invalid or unsupported.');\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error(' Error processing file:', err);\n\t\t\tshowAlertModal(' Failed to process the file.');\n\t\t} finally {\n\t\t\tfileInput.value = ''; // reset for next upload\n\t\t\tfileReaderBusy = false;\n\t\t}\n\t};\n\n\treader.onerror = () => {\n\t\tfileInput.value = ''; // reset in case of error\n\t\tfileReaderBusy = false;\n\t\tshowAlertModal(' Error reading the file.');\n\t};\n\n\treader.readAsText(file);\n}\n\nlet isSignup = false;\n\nfunction showLogin() {\n\tisSignup = false;\n\tdocument.getElementById('auth-title').textContent = 'Sign In';\n\tdocument.getElementById('auth-switch-label').textContent = 'Sign Up';\n\tdocument.getElementById('auth-modal').style.display = 'flex';\n}\n\nfunction showSignup() {\n\tisSignup = true;\n\tdocument.getElementById('auth-title').textContent = 'Create Account';\n\tdocument.getElementById('auth-switch-label').textContent = 'Sign In';\n\tdocument.getElementById('auth-modal').style.display = 'flex';\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by auth UI */\nfunction toggleAuthMode() {\n\tisSignup = !isSignup;\n\tif (isSignup) {\n\t\tshowSignup();\n\t} else {\n\t\tshowLogin();\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by auth UI */\nasync function submitAuth() {\n\tconst username = document.getElementById('auth-username').value.trim();\n\tconst password = document.getElementById('auth-password').value.trim();\n\n\tif (!username || !password) {\n\t\tshowAlertModal(' Username and password required.');\n\t\treturn;\n\t}\n\n\tconst endpoint = isSignup\n\t\t? 'https://logs.gorouteyourself.com/api/signup'\n\t\t: 'https://logs.gorouteyourself.com/api/login';\n\n\tconst res = await fetch(endpoint, {\n\t\tmethod: 'POST',\n\t\theaders: { 'Content-Type': 'application/json' },\n\t\tbody: JSON.stringify({ username, password })\n\t});\n\n\tif (res.ok) {\n\t\tconst data = await res.json();\n\t\tlocalStorage.setItem('username', username);\n\t\tlocalStorage.setItem('token', data.token);\n\t\tdocument.getElementById('auth-modal').style.display = 'none';\n\t\tshowConfirmationMessage(` ${isSignup ? 'Account created' : 'Signed in'} successfully!`);\n\t\tupdateAuthUI();\n\n\t\t// Load custom categories from cloud\n\t\tawait loadCustomCategoriesFromCloud();\n\n\t\tif (isSignup && data.resetKey) {\n\t\t\tshowAlertModal(\n\t\t\t\t` Your reset key is:<br><br><code style=\"font-size: 18px; user-select: all;\">${data.resetKey}</code><br><br>Save this key somewhere safe.`,\n\t\t\t\t() => location.reload()\n\t\t\t);\n\t\t} else {\n\t\t\t//  For login or failed signup-then-login, reload to reflect auth state\n\t\t\tlocation.reload();\n\t\t}\n\t} else {\n\t\tlet msg = ' An error occurred.';\n\t\ttry {\n\t\t\tconst contentType = res.headers.get('Content-Type') || '';\n\t\t\tif (contentType.includes('application/json')) {\n\t\t\t\tconst data = await res.json();\n\t\t\t\tmsg = ' ' + (data.error || msg);\n\t\t\t} else {\n\t\t\t\tmsg = ' ' + (await res.text());\n\t\t\t}\n\n\t\t\tif (res.status === 400 && msg.toLowerCase().includes('username')) {\n\t\t\t\tmsg = ' That username is already taken. Please choose another.';\n\t\t\t}\n\n\t\t\tif (res.status === 404 && msg.toLowerCase().includes('not found')) {\n\t\t\t\tmsg = ' Account not found. Please check your username or sign up.';\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Error parsing error response:', e);\n\t\t}\n\n\t\tshowAlertModal(msg);\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by auth UI */\nfunction logout() {\n\tconsole.log(' Logging out...');\n\n\t//  STEP 1: Clear ALL localStorage (nuclear option)\n\tlocalStorage.clear();\n\n\t//  STEP 2: Clear in-memory data\n\tlogEntries = [];\n\n\t//  STEP 3: Clear UI immediately\n\tconst logList = document.getElementById('log-list');\n\tif (logList) {\n\t\tlogList.innerHTML = '';\n\t}\n\n\t//  STEP 4: Hide username and hamburger immediately\n\tconst usernameDisplay = document.getElementById('username-display');\n\tif (usernameDisplay) usernameDisplay.textContent = '';\n\n\tconst hamburgerButton = document.getElementById('hamburger-button');\n\tif (hamburgerButton) hamburgerButton.style.display = 'none';\n\n\t//  STEP 5: Update auth messages\n\tconst authMessage = document.getElementById('auth-message');\n\tconst logoutMessage = document.getElementById('logout-message');\n\tif (authMessage) authMessage.style.display = 'block';\n\tif (logoutMessage) logoutMessage.style.display = 'none';\n\n\tconsole.log(' Cleared all data');\n\n\t//  STEP 6: Force reload to root (clean URL)\n\tsetTimeout(() => {\n\t\twindow.location.replace(window.location.origin + '/');\n\t}, 100);\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by auth UI */\nfunction showPasswordModal() {\n\tdocument.getElementById('change-password-modal').style.display = 'flex';\n}\n\nfunction closePasswordModal() {\n\tdocument.getElementById('change-password-modal').style.display = 'none';\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by auth UI */\nasync function submitPasswordChange() {\n\tconst current = document.getElementById('current-password').value.trim();\n\tconst next = document.getElementById('new-password').value.trim();\n\tconst confirm = document.getElementById('confirm-password').value.trim();\n\n\tif (!current || !next || !confirm) return showAlertModal(' Please fill out all fields.');\n\n\tif (next !== confirm) return showAlertModal(' New passwords do not match.');\n\n\tconst token = localStorage.getItem('token');\n\tconst username = localStorage.getItem('username');\n\n\tif (!token || !username) {\n\t\tshowAlertModal(' You must be signed in.');\n\t\treturn;\n\t}\n\n\tconst res = await fetch('https://logs.gorouteyourself.com/api/change-password', {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: token\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\tusername,\n\t\t\tcurrentPassword: current,\n\t\t\tnewPassword: next\n\t\t})\n\t});\n\n\tif (res.ok) {\n\t\tshowAlertModal(' Password changed successfully.');\n\t\tclosePasswordModal();\n\t} else {\n\t\tconst msg = await res.text();\n\t\tshowAlertModal(' ' + msg);\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by auth UI */\nfunction showResetModal() {\n\tdocument.getElementById('reset-password-modal').style.display = 'flex';\n}\n\nfunction closeResetModal() {\n\tdocument.getElementById('reset-password-modal').style.display = 'none';\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by auth UI */\nasync function submitResetPassword() {\n\tconst username = document.getElementById('reset-username').value.trim();\n\tconst resetKey = document.getElementById('reset-key').value.trim();\n\tconst newPassword = document.getElementById('reset-new-password').value.trim();\n\n\tif (!username || !resetKey || !newPassword) {\n\t\tshowAlertModal(' Please fill out all fields.');\n\t\treturn;\n\t}\n\n\tconst res = await fetch('https://logs.gorouteyourself.com/api/reset-password', {\n\t\tmethod: 'POST',\n\t\theaders: { 'Content-Type': 'application/json' },\n\t\tbody: JSON.stringify({ username, resetKey, newPassword })\n\t});\n\n\tif (res.ok) {\n\t\tshowAlertModal(' Password reset successfully. You can now sign in.');\n\t\tcloseResetModal();\n\t} else {\n\t\tconst msg = await res.text();\n\t\tshowAlertModal(' ' + msg);\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by auth UI */\nfunction showDeleteModal() {\n\tdocument.getElementById('delete-account-modal').style.display = 'flex';\n}\n\nfunction closeDeleteModal() {\n\tdocument.getElementById('delete-account-modal').style.display = 'none';\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by auth UI */\nasync function submitDeleteAccount() {\n\tconst password = document.getElementById('delete-password').value.trim();\n\tconst username = localStorage.getItem('username');\n\tconst token = localStorage.getItem('token');\n\n\tif (!username || !token || !password) {\n\t\tshowAlertModal(' Missing credentials.');\n\t\treturn;\n\t}\n\n\tconst res = await fetch('https://logs.gorouteyourself.com/api/delete-account', {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: token\n\t\t},\n\t\tbody: JSON.stringify({ username, password })\n\t});\n\n\tif (res.ok) {\n\t\t// 1. Clear all auth and cached data\n\t\tlocalStorage.removeItem('username');\n\t\tlocalStorage.removeItem('token');\n\t\tlocalStorage.removeItem('cachedLogs');\n\t\tlocalStorage.removeItem('pendingLogs');\n\n\t\t// 2. Close the modal and reset password input\n\t\tcloseDeleteModal();\n\t\tdocument.getElementById('delete-password').value = '';\n\n\t\t// 3. Clear in-memory logs\n\t\tlogEntries = [];\n\n\t\t// 4. Clear UI elements\n\t\tdocument.getElementById('log-list').innerHTML = '';\n\t\tdocument.getElementById('log-summary').innerHTML = '';\n\t\tdocument.getElementById('log-container').style.display = 'none';\n\n\t\tconst manageLog = document.getElementById('manage-log-container');\n\t\tif (manageLog) manageLog.style.display = 'none';\n\n\t\t// 5. Update auth UI and disable key buttons\n\t\tupdateAuthUI();\n\t\tdocument.querySelectorAll('button').forEach((btn) => {\n\t\t\tif (\n\t\t\t\tbtn.textContent.includes('Log Route') ||\n\t\t\t\tbtn.textContent.includes('Optimize') ||\n\t\t\t\tbtn.textContent.includes('Calculate')\n\t\t\t) {\n\t\t\t\tbtn.disabled = true;\n\t\t\t}\n\t\t});\n\n\t\t// 6. Alert and reload\n\t\tshowAlertModal(' Your account has been deleted.', () => {\n\t\t\tlocation.reload();\n\t\t});\n\t} else {\n\t\tconst msg = await res.text();\n\t\tshowAlertModal(' ' + msg);\n\t}\n}\n\nwindow.toggleMenu = function () {\n\tconsole.log(' toggleMenu() called');\n\n\tconst menu = document.getElementById('account-menu');\n\tconsole.log(' Menu element:', menu);\n\n\tif (!menu) {\n\t\tconsole.error(' Menu element not found!');\n\t\treturn;\n\t}\n\n\tconst isShowing = menu.classList.contains('show');\n\tconsole.log(' Current state - isShowing:', isShowing);\n\n\tif (isShowing) {\n\t\tconsole.log(' Closing menu...');\n\t\tmenu.classList.remove('show');\n\t} else {\n\t\tconsole.log(' Opening menu...');\n\t\tmenu.classList.add('show');\n\t}\n\n\t// Log final state\n\tsetTimeout(() => {\n\t\tconsole.log(' Final menu classes:', menu.className);\n\t\tconsole.log(' Final menu style.left:', window.getComputedStyle(menu).left);\n\t}, 100);\n};\n\nwindow.closeMenu = function () {\n\tconsole.log(' closeMenu() called');\n\tconst menu = document.getElementById('account-menu');\n\tif (menu) {\n\t\tmenu.classList.remove('show');\n\t\tconsole.log(' Menu closed');\n\t} else {\n\t\tconsole.error(' Menu element not found!');\n\t}\n};\n\nfunction filterLogs() {\n\tconst startDate = document.getElementById('filter-start-date').value;\n\tconst endDate = document.getElementById('filter-end-date').value;\n\tconst searchQuery = document.getElementById('filter-search').value.trim().toLowerCase();\n\n\t//  Define the shared filter logic\n\tcurrentFilterFn = (entryDate, entry) => {\n\t\tlet matchesDate = true;\n\t\tif (startDate && entryDate < startDate) matchesDate = false;\n\t\tif (endDate && entryDate > endDate) matchesDate = false;\n\n\t\tconst fieldsToSearch = [\n\t\t\tentry.startTime,\n\t\t\tentry.endTime,\n\t\t\t...(entry.destinations || []),\n\t\t\t(entry.totalEarnings || '').toString(),\n\t\t\t(entry.fuelCost || '').toString(),\n\t\t\t(entry.maintenanceCost || '').toString(),\n\t\t\t(entry.suppliesCost || '').toString(),\n\t\t\t(entry.netProfit || '').toString(),\n\t\t\t(entry.totalMileage || '').toString(),\n\t\t\t(entry.totalTime || '').toString(),\n\t\t\t(entry.profitPerHour || '').toString(),\n\t\t\t(entry.hoursWorked || '').toString()\n\t\t]\n\t\t\t.join(' ')\n\t\t\t.toLowerCase();\n\n\t\tconst matchesSearch = !searchQuery || fieldsToSearch.includes(searchQuery);\n\n\t\treturn matchesDate && matchesSearch;\n\t};\n\n\t//  Use that filter directly in display\n\tdisplayLog(currentFilterFn);\n}\n\n// Hide Manage Log menu when clicking outside\ndocument.addEventListener('click', function (event) {\n\tconst manageButton = document.querySelector('#manage-log-container button');\n\tconst manageMenu = document.getElementById('manage-log-menu');\n\n\t// If click outside both the menu AND the button\n\tif (manageMenu && !manageMenu.contains(event.target) && !manageButton.contains(event.target)) {\n\t\tmanageMenu.style.display = 'none';\n\t}\n});\n\nfunction triggerImportFile() {\n\tconst fileInput = document.getElementById('import-file');\n\tif (fileInput) {\n\t\tfileInput.click(); // Simulate a click to open file picker\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI */\nfunction openLogEntryInGoogleMaps(index) {\n\tconst entry = logEntries[index];\n\tif (!entry) {\n\t\tconsole.error('Invalid log entry index');\n\t\treturn;\n\t}\n\n\tconst start = encodeURIComponent(entry.startTime.trim());\n\tconst end = encodeURIComponent(entry.endTime.trim());\n\n\tconst destinations = Array.isArray(entry.destinations)\n\t\t? entry.destinations.map((dest) => encodeURIComponent(dest.trim()))\n\t\t: [];\n\n\tlet url = `https://www.google.com/maps/dir/?api=1&origin=${start}&destination=${end}`;\n\n\tif (destinations.length > 0) {\n\t\turl += `&waypoints=${destinations.join('|')}`;\n\t}\n\n\twindow.open(url, '_blank');\n}\n\nfunction handleTimeChange() {\n\tconst startTimeInput = document.getElementById('start-time').value;\n\tconst endTimeInput = document.getElementById('end-time').value;\n\tconst totalHoursInput = document.getElementById('total-hours');\n\n\t//  Auto-open End Time picker after selecting Start Time\n\tif (startTimeInput && !endTimeInput) {\n\t\tdocument.getElementById('end-time')?.showPicker?.();\n\t}\n\n\tif (startTimeInput && endTimeInput) {\n\t\tconst [startHours, startMinutes] = startTimeInput.split(':').map(Number);\n\t\tconst [endHours, endMinutes] = endTimeInput.split(':').map(Number);\n\n\t\tlet startTotalMinutes = startHours * 60 + startMinutes;\n\t\tlet endTotalMinutes = endHours * 60 + endMinutes;\n\n\t\tif (endTotalMinutes < startTotalMinutes) {\n\t\t\tendTotalMinutes += 24 * 60; // Handle overnight shifts\n\t\t}\n\n\t\tconst totalWorkedMinutes = endTotalMinutes - startTotalMinutes;\n\t\tconst hoursWorked = totalWorkedMinutes / 60;\n\n\t\t//  Display in input as formatted string like \"2 hours 15 minutes\"\n\t\ttotalHoursInput.value = formatHoursAndMinutes(hoursWorked);\n\t} else {\n\t\ttotalHoursInput.value = '';\n\t}\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI */\nfunction formatCurrency(value) {\n\tif (isNaN(value)) return '$0.00';\n\treturn `$${parseFloat(value).toLocaleString(undefined, {\n\t\tminimumFractionDigits: 2,\n\t\tmaximumFractionDigits: 2\n\t})}`;\n}\n\nfunction updateLogSummary(filterFn) {\n\tconst summaryDiv = document.getElementById('log-summary');\n\n\tconst filteredEntries = logEntries.filter((entry) => entry?.date && filterFn(entry.date, entry));\n\n\tif (filteredEntries.length === 0) {\n\t\tsummaryDiv.innerHTML = 'No data available for selected filter.';\n\t\treturn;\n\t}\n\n\tlet totalNetProfit = 0;\n\tlet totalMinutes = 0;\n\n\tfilteredEntries.forEach((entry) => {\n\t\ttotalNetProfit += parseFloat(entry.netProfit) || 0;\n\n\t\tconst start = entry.startClock || '';\n\t\tconst end = entry.endClock || '';\n\n\t\tif (start && end && start.includes(':') && end.includes(':')) {\n\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\tlet startMin = sh * 60 + sm;\n\t\t\tlet endMin = eh * 60 + em;\n\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\n\t\t\ttotalMinutes += endMin - startMin;\n\t\t}\n\t});\n\n\tconst totalHoursDecimal = totalMinutes / 60; // unrounded for profit calculations\n\tconst profitPerHour = totalHoursDecimal > 0 ? totalNetProfit / totalHoursDecimal : 0;\n\n\tconst fullHours = Math.floor(totalHoursDecimal);\n\tconst fullMinutes = Math.round((totalHoursDecimal % 1) * 60);\n\tconst formattedTime = `${fullHours} hour${fullHours !== 1 ? 's' : ''}${fullMinutes > 0 ? ` ${fullMinutes} minute${fullMinutes !== 1 ? 's' : ''}` : ''}`;\n\n\tsummaryDiv.innerHTML = `\n    <div style=\"display: flex; flex-direction: column; align-items: center;\">\n      <div style=\"margin-bottom: 8px;\">\n        Net Profit: <span style=\"color: green;\">$${totalNetProfit.toFixed(2)}</span>\n      </div>\n      <div style=\"margin-bottom: 8px;\">\n        Profit Per Hour: <span style=\"color: blue;\">$${profitPerHour.toFixed(2)}</span>\n      </div>\n      <div>\n        Total Hours: <span style=\"color: black;\">${formattedTime}</span>\n      </div>\n    </div>\n  `;\n}\n\nfunction recalculateEditHoursWorked() {\n\tconst startTime = document.getElementById('edit-start-time')?.value;\n\tconst endTime = document.getElementById('edit-end-time')?.value;\n\tconst hoursWorkedInput = document.getElementById('edit-hours-worked');\n\n\tif (!hoursWorkedInput) return;\n\n\thoursWorkedInput.readOnly = true;\n\thoursWorkedInput.style.backgroundColor = '#f0f0f0';\n\n\tif (!startTime || !endTime) {\n\t\thoursWorkedInput.value = '';\n\t\treturn;\n\t}\n\n\tconst [startHours, startMinutes] = startTime.split(':').map(Number);\n\tconst [endHours, endMinutes] = endTime.split(':').map(Number);\n\n\tlet start = startHours * 60 + startMinutes;\n\tlet end = endHours * 60 + endMinutes;\n\n\tif (end < start) end += 24 * 60; // handle overnight\n\n\tconst totalWorkedMinutes = end - start;\n\thoursWorkedInput.value = formatHoursAndMinutesFromMinutes(totalWorkedMinutes);\n}\n\nfunction formatTimeToAmPm(timeStr) {\n\tif (!timeStr) return 'N/A';\n\tconst [hours, minutes] = timeStr.split(':').map(Number);\n\tconst ampm = hours >= 12 ? 'PM' : 'AM';\n\tconst displayHours = hours % 12 || 12; // 0 becomes 12\n\treturn `${displayHours}:${minutes.toString().padStart(2, '0')} ${ampm}`;\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI */\nfunction toggleLogEntryDetails(index) {\n\tconst entry = logEntries[index];\n\tconst detailsDiv = document.getElementById(`details-${index}`);\n\tconst toggleButton = document.getElementById(`toggle-button-${index}`);\n\tconst summaryDiv = document.getElementById(`summary-${index}`);\n\n\tif (!detailsDiv || !entry || !toggleButton || !summaryDiv) return;\n\n\tif (detailsDiv.classList.contains('hidden')) {\n\t\t// Expand\n\t\tconst destinations = entry.destinations?.length\n\t\t\t? entry.destinations.map((d) => `- ${d}`).join('<br>')\n\t\t\t: 'None';\n\n\t\tconst earnings = Array.isArray(entry.earnings)\n\t\t\t? entry.earnings.map((e) => `$${parseFloat(e).toFixed(2)}`).join(', ')\n\t\t\t: '$0.00';\n\n\t\tconst formattedHoursWorked = (() => {\n\t\t\tconst start = entry.startClock;\n\t\t\tconst end = entry.endClock;\n\t\t\tif (!start || !end || !start.includes(':') || !end.includes(':')) return 'N/A';\n\n\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\tlet startMin = sh * 60 + sm;\n\t\t\tlet endMin = eh * 60 + em;\n\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\n\t\t\tconst totalMinutes = endMin - startMin;\n\t\t\tconst driveMinutes = convertTimeToMinutes(entry.totalTime || '');\n\t\t\tconst workedMinutes = Math.max(totalMinutes - driveMinutes, 0);\n\t\t\treturn formatHoursAndMinutesFromMinutes(workedMinutes);\n\t\t})();\n\n\t\tdetailsDiv.innerHTML = `\n  <div><strong>Date:</strong> ${entry.date}</div>\n  <div><strong>Start Time:</strong> ${formatTimeToAmPm(entry.startClock)}</div>\n  <div><strong>End Time:</strong> ${formatTimeToAmPm(entry.endClock)}</div>\n  <div><strong>Start Address:</strong> ${entry.startTime}</div>\n  \n  <div><strong>Destinations:</strong></div> <!-- first separate div -->\n  <div style=\"margin-left: 15px;\">${destinations}</div> <!-- second div for addresses -->\n\n  <div><strong>End Address:</strong> ${entry.endTime}</div>\n  <div><strong>Earnings per Stop:</strong> ${earnings}</div>\n  <div><strong>Mileage:</strong> ${entry.totalMileage} miles</div>\n  <div><strong>Drive Time:</strong> ${entry.totalTime}</div>\n  <div><strong>Total Earnings:</strong> $${entry.totalEarnings}</div>\n  <div><strong>Fuel Cost:</strong> $${entry.fuelCost}</div>\n  <div><strong>Maintenance:</strong> $${entry.maintenanceCost || 0}${entry.maintenance && entry.maintenance.length > 0 ? `<div style=\"margin-left: 15px; font-size: 14px;\">${entry.maintenance.map((m) => `${m.type}: $${m.cost.toFixed(2)}`).join('<br>')}</div>` : ''}</div>\n  <div><strong>Supplies:</strong> $${entry.suppliesCost || 0}${entry.supplies && entry.supplies.length > 0 ? `<div style=\"margin-left: 15px; font-size: 14px;\">${entry.supplies.map((s) => `${s.type}: $${s.cost.toFixed(2)}`).join('<br>')}</div>` : ''}</div>\n  <div><strong>Hours Worked:</strong> ${formattedHoursWorked}</div>\n  <div><strong>Total Hours:</strong> ${calculateTotalHours(entry)}</div>\n  <div><strong>Net Profit:</strong> $${entry.netProfit}</div>\n  <div><strong>Profit per Hour:</strong> $${entry.profitPerHour}</div>\n`;\n\t\tif (entry.notes) {\n\t\t\tdetailsDiv.innerHTML += `<div><strong>Notes:</strong> ${entry.notes}</div>`;\n\t\t}\n\n\t\tdetailsDiv.classList.remove('hidden');\n\t\tsummaryDiv.classList.add('hidden'); //  Hide only the summary\n\t\ttoggleButton.textContent = 'Less Details';\n\t} else {\n\t\t// Collapse\n\t\tdetailsDiv.classList.add('hidden');\n\t\tsummaryDiv.classList.remove('hidden'); //  Show the summary\n\t\ttoggleButton.textContent = 'More Details';\n\t}\n}\n\nfunction calculateTotalHours(entry) {\n\tconst start = entry.startClock;\n\tconst end = entry.endClock;\n\tif (!start || !end || !start.includes(':') || !end.includes(':')) {\n\t\treturn 'N/A';\n\t}\n\n\tconst [sh, sm] = start.split(':').map(Number);\n\tconst [eh, em] = end.split(':').map(Number);\n\tlet startMin = sh * 60 + sm;\n\tlet endMin = eh * 60 + em;\n\tif (endMin < startMin) endMin += 24 * 60;\n\n\tconst totalMinutes = endMin - startMin;\n\n\treturn formatHoursAndMinutesFromMinutes(totalMinutes);\n}\n\nfunction clearFilters() {\n\tdocument.getElementById('filter-start-date').value = '';\n\tdocument.getElementById('filter-end-date').value = '';\n\tdocument.getElementById('filter-search').value = '';\n\tfilterLogs(); //  Refresh the display\n}\n\nfunction initOfflineListeners() {\n\tupdateOfflineBanner(); // Set initial state\n\twindow.addEventListener('online', updateOfflineBanner);\n\twindow.addEventListener('offline', updateOfflineBanner);\n}\n\nfunction renumberMainDestinations() {\n\tconst destinationDivs = document.querySelectorAll('#destinations-container .destination');\n\n\tdestinationDivs.forEach((div, index) => {\n\t\tconst destNum = index + 1;\n\t\tconst label = div.querySelector('label[for^=\"destination-\"]');\n\t\tconst earningsLabel = div.querySelector('label[for^=\"earnings-\"]');\n\t\tconst addressInput = div.querySelector('input[type=\"text\"]');\n\t\tconst earningsInput = div.querySelector('input[type=\"number\"]');\n\n\t\tif (label) {\n\t\t\tlabel.textContent = `Destination ${destNum}`;\n\t\t\tlabel.setAttribute('for', `destination-${destNum}`);\n\t\t}\n\n\t\tif (earningsLabel) {\n\t\t\tearningsLabel.textContent = `Earnings for Destination ${destNum}`;\n\t\t\tearningsLabel.setAttribute('for', `earnings-${destNum}`);\n\t\t}\n\n\t\tif (addressInput) {\n\t\t\taddressInput.id = `destination-${destNum}`;\n\t\t}\n\n\t\tif (earningsInput) {\n\t\t\tearningsInput.id = `earnings-${destNum}`;\n\t\t}\n\t});\n}\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI */\nfunction calculateTotals(logs) {\n\treturn logs.reduce(\n\t\t(totals, entry) => {\n\t\t\ttotals.totalEarnings += parseFloat(entry.totalEarnings || 0);\n\t\t\ttotals.fuelCost += parseFloat(entry.fuelCost || 0);\n\t\t\ttotals.maintenance += parseFloat(entry.maintenanceCost || 0);\n\t\t\ttotals.supplies += parseFloat(entry.suppliesCost || 0);\n\t\t\ttotals.netProfit += parseFloat(entry.netProfit || 0);\n\t\t\ttotals.mileage += parseFloat(entry.totalMileage || 0);\n\t\t\ttotals.hoursWorked += parseFloat(entry.hoursWorked || 0);\n\t\t\ttotals.driveMinutes += convertTimeToMinutes(entry.totalTime);\n\t\t\tconst pph = parseFloat(entry.profitPerHour || 0);\n\t\t\tif (!isNaN(pph)) {\n\t\t\t\ttotals.profitPerHourSum += pph;\n\t\t\t\ttotals.count++;\n\t\t\t}\n\t\t\treturn totals;\n\t\t},\n\t\t{\n\t\t\ttotalEarnings: 0,\n\t\t\tfuelCost: 0,\n\t\t\tmaintenance: 0,\n\t\t\tsupplies: 0,\n\t\t\tnetProfit: 0,\n\t\t\tmileage: 0,\n\t\t\thoursWorked: 0,\n\t\t\tdriveMinutes: 0,\n\t\t\tprofitPerHourSum: 0,\n\t\t\tcount: 0\n\t\t}\n\t);\n}\n\nfunction convertTimeToMinutes(timeStr) {\n\tif (!timeStr) return 0;\n\n\t// Match \"X hour(s)\" and \"Y minute(s)\", ignore seconds entirely\n\tconst hourMatch = timeStr.match(/(\\d+)\\s*hour/);\n\tconst minMatch = timeStr.match(/(\\d+)\\s*minute/);\n\n\tconst hours = hourMatch ? parseInt(hourMatch[1]) : 0;\n\tconst minutes = minMatch ? parseInt(minMatch[1]) : 0;\n\n\treturn hours * 60 + minutes;\n}\n\nfunction exportToCSVWithTotals() {\n\tconst filtered =\n\t\ttypeof currentFilterFn === 'function'\n\t\t\t? logEntries.filter((entry) => entry?.date && currentFilterFn(entry.date, entry))\n\t\t\t: logEntries;\n\n\tif (filtered.length === 0) {\n\t\talert(' No entries to export.');\n\t\treturn;\n\t}\n\n\tconst header =\n\t\t'Date,Start Time,End Time,Start Address,Destinations,End Address,Earnings per Stop,Mileage,Drive Time,Total Earnings,Fuel Cost,Maintenance Total,Maintenance Breakdown,Supplies Total,Supplies Breakdown,Hours Worked,Total Hours,Net Profit,Profit Per Hour,Notes\\n';\n\n\tconst csvRows = filtered.map((entry) => {\n\t\tconst destinationsString = `\"${(entry.destinations || []).join(';')}\"`;\n\t\tconst earningsString = `\"${(entry.earnings || []).map((e) => `$${parseFloat(e).toFixed(2)}`).join(';')}\"`;\n\n\t\tconst start = entry.startClock;\n\t\tconst end = entry.endClock;\n\t\tlet workedMinutes = 0;\n\t\tlet sessionMinutes = 0;\n\n\t\tif (start && end && start.includes(':') && end.includes(':')) {\n\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\tlet startMin = sh * 60 + sm;\n\t\t\tlet endMin = eh * 60 + em;\n\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\n\t\t\tsessionMinutes = endMin - startMin;\n\t\t\tconst driveMinutes = convertTimeToMinutes(entry.totalTime || '');\n\t\t\tworkedMinutes = Math.max(sessionMinutes - driveMinutes, 0);\n\t\t}\n\n\t\treturn [\n\t\t\tentry.date,\n\t\t\tstart || '',\n\t\t\tend || '',\n\t\t\t`\"${(entry.startTime || '').replace(/\"/g, '\"\"')}\"`,\n\t\t\tdestinationsString,\n\t\t\t`\"${(entry.endTime || '').replace(/\"/g, '\"\"')}\"`,\n\t\t\tearningsString,\n\t\t\tentry.totalMileage,\n\t\t\tentry.totalTime,\n\t\t\tentry.totalEarnings,\n\t\t\tentry.fuelCost,\n\t\t\tentry.maintenanceCost || 0,\n\t\t\t`\"${(entry.maintenance || []).map((m) => `${m.type}: $${m.cost.toFixed(2)}`).join('; ')}\"`,\n\t\t\tentry.suppliesCost || 0,\n\t\t\t`\"${(entry.supplies || []).map((s) => `${s.type}: $${s.cost.toFixed(2)}`).join('; ')}\"`,\n\t\t\t`\"${formatHoursAndMinutesFromMinutes(workedMinutes)}\"`,\n\t\t\t`\"${formatHoursAndMinutesFromMinutes(sessionMinutes)}\"`,\n\t\t\tentry.netProfit,\n\t\t\tentry.profitPerHour || '',\n\t\t\t`\"${(entry.notes || '').replace(/\"/g, '\"\"')}\"`\n\t\t].join(',');\n\t});\n\n\tlet totalNetProfit = 0;\n\tlet totalDriveMinutes = 0;\n\tlet totalSessionMinutes = 0;\n\tlet totalEarnings = 0;\n\tlet fuelCost = 0;\n\tlet maintenance = 0;\n\tlet supplies = 0;\n\tlet mileage = 0;\n\n\tfiltered.forEach((entry) => {\n\t\ttotalNetProfit += parseFloat(entry.netProfit) || 0;\n\t\ttotalEarnings += parseFloat(entry.totalEarnings) || 0;\n\t\tfuelCost += parseFloat(entry.fuelCost) || 0;\n\t\tmaintenance += parseFloat(entry.maintenanceCost) || 0;\n\t\tsupplies += parseFloat(entry.suppliesCost) || 0;\n\t\tmileage += parseFloat(entry.totalMileage) || 0;\n\n\t\ttotalDriveMinutes += convertTimeToMinutes(entry.totalTime || '');\n\n\t\tconst start = entry.startClock || '';\n\t\tconst end = entry.endClock || '';\n\t\tif (start && end && start.includes(':') && end.includes(':')) {\n\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\tlet startMin = sh * 60 + sm;\n\t\t\tlet endMin = eh * 60 + em;\n\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\t\t\ttotalSessionMinutes += endMin - startMin;\n\t\t}\n\t});\n\n\tconst totalWorkedMinutes = Math.max(totalSessionMinutes - totalDriveMinutes, 0);\n\tconst formattedWorkedTime = formatHoursAndMinutesFromMinutes(totalWorkedMinutes);\n\tconst formattedTotalTime = formatHoursAndMinutesFromMinutes(totalSessionMinutes);\n\tconst profitPerHour = totalSessionMinutes > 0 ? totalNetProfit / (totalSessionMinutes / 60) : 0;\n\tconst formattedDriveTime = `${Math.floor(totalDriveMinutes / 60)} hour${Math.floor(totalDriveMinutes / 60) !== 1 ? 's' : ''} ${totalDriveMinutes % 60} minutes`;\n\n\tconst totalRow = [\n\t\t'Totals:',\n\t\t'',\n\t\t'',\n\t\t'',\n\t\t'',\n\t\t'',\n\t\t'',\n\t\tmileage.toFixed(2),\n\t\tformattedDriveTime,\n\t\ttotalEarnings.toFixed(2),\n\t\tfuelCost.toFixed(2),\n\t\tmaintenance.toFixed(2),\n\t\tsupplies.toFixed(2),\n\t\tformattedWorkedTime,\n\t\tformattedTotalTime,\n\t\ttotalNetProfit.toFixed(2),\n\t\tprofitPerHour.toFixed(2),\n\t\t'' // Notes\n\t].join(',');\n\n\tconst csvString = header + csvRows.join('\\n') + '\\n' + totalRow;\n\tconst blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });\n\tconst link = document.createElement('a');\n\tconst url = URL.createObjectURL(blob);\n\tlink.setAttribute('href', url);\n\tlink.setAttribute('download', 'profit_log_full_export.csv');\n\tlink.style.visibility = 'hidden';\n\tdocument.body.appendChild(link);\n\tlink.click();\n\tdocument.body.removeChild(link);\n}\n\nfunction exportToPDFWithTotals() {\n\tconst filtered =\n\t\ttypeof currentFilterFn === 'function'\n\t\t\t? logEntries.filter((entry) => entry?.date && currentFilterFn(entry.date, entry))\n\t\t\t: logEntries;\n\n\tif (filtered.length === 0) {\n\t\talert(' No entries to export.');\n\t\treturn;\n\t}\n\n\tconst { jsPDF } = window.jspdf;\n\tconst pdf = new jsPDF({ orientation: 'landscape' });\n\n\tconst columns = [\n\t\t'Date',\n\t\t'Start',\n\t\t'Destinations',\n\t\t'End',\n\t\t'Earnings',\n\t\t'Fuel',\n\t\t'Maintenance',\n\t\t'Supplies',\n\t\t'Net Profit',\n\t\t'Mileage',\n\t\t'Drive Time',\n\t\t'Earnings per Stop',\n\t\t'Hours Worked',\n\t\t'Total Hours',\n\t\t'Profit per Hour',\n\t\t'Notes'\n\t];\n\n\tconst data = filtered.map((entry) => {\n\t\tconst destinations = (entry.destinations || []).join('\\n');\n\t\tconst earningsPerStop = (entry.earnings || [])\n\t\t\t.map((e) => `$${parseFloat(e).toFixed(2)}`)\n\t\t\t.join(', ');\n\n\t\tconst start = entry.startClock;\n\t\tconst end = entry.endClock;\n\t\tlet workedMinutes = 0;\n\t\tlet sessionMinutes = 0;\n\n\t\tif (start && end && start.includes(':') && end.includes(':')) {\n\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\tlet startMin = sh * 60 + sm;\n\t\t\tlet endMin = eh * 60 + em;\n\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\n\t\t\tsessionMinutes = endMin - startMin;\n\t\t\tconst driveMinutes = convertTimeToMinutes(entry.totalTime || '');\n\t\t\tworkedMinutes = Math.max(sessionMinutes - driveMinutes, 0);\n\t\t}\n\n\t\treturn [\n\t\t\tentry.date,\n\t\t\tentry.startTime,\n\t\t\tdestinations,\n\t\t\tentry.endTime,\n\t\t\t`$${entry.totalEarnings}`,\n\t\t\t`$${entry.fuelCost}`,\n\t\t\t`$${entry.maintenanceCost}`,\n\t\t\t`$${entry.suppliesCost}`,\n\t\t\t`$${entry.netProfit}`,\n\t\t\t`${entry.totalMileage} mi`,\n\t\t\tentry.totalTime,\n\t\t\tearningsPerStop,\n\t\t\tformatHoursAndMinutesFromMinutes(workedMinutes),\n\t\t\tformatHoursAndMinutesFromMinutes(sessionMinutes),\n\t\t\t`$${entry.profitPerHour || '0.00'}`,\n\t\t\tentry.notes || ''\n\t\t];\n\t});\n\n\t// Totals\n\tlet totalNetProfit = 0;\n\tlet totalDriveMinutes = 0;\n\tlet totalSessionMinutes = 0;\n\tlet totalEarnings = 0;\n\tlet fuelCost = 0;\n\tlet maintenance = 0;\n\tlet supplies = 0;\n\tlet mileage = 0;\n\n\tfiltered.forEach((entry) => {\n\t\ttotalNetProfit += parseFloat(entry.netProfit) || 0;\n\t\ttotalEarnings += parseFloat(entry.totalEarnings) || 0;\n\t\tfuelCost += parseFloat(entry.fuelCost) || 0;\n\t\tmaintenance += parseFloat(entry.maintenanceCost) || 0;\n\t\tsupplies += parseFloat(entry.suppliesCost) || 0;\n\t\tmileage += parseFloat(entry.totalMileage) || 0;\n\t\ttotalDriveMinutes += convertTimeToMinutes(entry.totalTime || '');\n\n\t\tconst start = entry.startClock || '';\n\t\tconst end = entry.endClock || '';\n\t\tif (start && end && start.includes(':') && end.includes(':')) {\n\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\tlet startMin = sh * 60 + sm;\n\t\t\tlet endMin = eh * 60 + em;\n\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\t\t\ttotalSessionMinutes += endMin - startMin;\n\t\t}\n\t});\n\n\tconst totalWorkedMinutes = Math.max(totalSessionMinutes - totalDriveMinutes, 0);\n\tconst formattedWorkedTime = formatHoursAndMinutesFromMinutes(totalWorkedMinutes);\n\tconst formattedTotalTime = formatHoursAndMinutesFromMinutes(totalSessionMinutes);\n\tconst profitPerHour = totalSessionMinutes > 0 ? totalNetProfit / (totalSessionMinutes / 60) : 0;\n\tconst formattedDriveTime = `${Math.floor(totalDriveMinutes / 60)} hr ${totalDriveMinutes % 60} min`;\n\n\tdata.push([\n\t\t'Totals:',\n\t\t'',\n\t\t'',\n\t\t'',\n\t\t`$${totalEarnings.toFixed(2)}`,\n\t\t`$${fuelCost.toFixed(2)}`,\n\t\t`$${maintenance.toFixed(2)}`,\n\t\t`$${supplies.toFixed(2)}`,\n\t\t`$${totalNetProfit.toFixed(2)}`,\n\t\t`${mileage.toFixed(2)} mi`,\n\t\tformattedDriveTime,\n\t\t'',\n\t\tformattedWorkedTime,\n\t\tformattedTotalTime,\n\t\t`$${profitPerHour.toFixed(2)}`,\n\t\t'' // Notes\n\t]);\n\n\tpdf.autoTable({\n\t\thead: [columns],\n\t\tbody: data,\n\t\tstyles: {\n\t\t\tfontSize: 7.5,\n\t\t\tcellPadding: 1.5,\n\t\t\toverflow: 'linebreak'\n\t\t},\n\t\theadStyles: {\n\t\t\tfillColor: [44, 62, 80],\n\t\t\ttextColor: 255,\n\t\t\tfontSize: 8\n\t\t},\n\t\ttheme: 'striped',\n\t\tstartY: 20,\n\t\ttableWidth: 'auto',\n\t\tdidDrawPage: function (data) {\n\t\t\tpdf.setFontSize(9);\n\t\t\tpdf.setTextColor(40);\n\t\t\tpdf.text(\n\t\t\t\t`Profit Log - Page ${data.pageNumber}`,\n\t\t\t\tdata.settings.margin.left,\n\t\t\t\tpdf.internal.pageSize.height - 10\n\t\t\t);\n\t\t}\n\t});\n\n\tpdf.save('profit_log_with_totals.pdf');\n}\n\nfunction formatHoursAndMinutesFromMinutes(totalMinutes) {\n\tconst h = Math.floor(totalMinutes / 60);\n\tconst m = totalMinutes % 60;\n\tconst hourText = h > 0 ? `${h} hour${h !== 1 ? 's' : ''}` : '';\n\tconst minuteText = m > 0 ? `${m} minute${m !== 1 ? 's' : ''}` : '';\n\treturn [hourText, minuteText].filter(Boolean).join(' ');\n}\n\ndocument.addEventListener('click', function (event) {\n\tconst logMenu = document.getElementById('hamburger-manage-log-menu');\n\tconst logToggle = document.getElementById('hamburger-manage-toggle');\n\n\tconst accountMenu = document.getElementById('hamburger-manage-account-menu');\n\tconst accountToggle = document.getElementById('hamburger-manage-account-toggle');\n\n\t// Ignore clicks on either toggle buttons\n\tif (logToggle?.contains(event.target) || accountToggle?.contains(event.target)) return;\n\n\t// Ignore clicks inside the menus\n\tif (logMenu?.contains(event.target) || accountMenu?.contains(event.target)) return;\n\n\t// Close both dropdowns\n\tif (logMenu) {\n\t\tlogMenu.style.maxHeight = '0';\n\t\tconst arrow = document.getElementById('hamburger-manage-arrow');\n\t\tif (arrow) arrow.style.transform = 'rotate(0deg)';\n\t}\n\n\tif (accountMenu) {\n\t\taccountMenu.style.maxHeight = '0';\n\t\tconst arrow = document.getElementById('hamburger-manage-account-arrow');\n\t\tif (arrow) arrow.style.transform = 'rotate(0deg)';\n\t}\n});\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by Google auth callback */\nasync function handleGoogleSignIn(response) {\n\tconst credential = response.credential;\n\n\ttry {\n\t\tconst res = await fetch('https://logs.gorouteyourself.com/api/google-login', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\tbody: JSON.stringify({ credential })\n\t\t});\n\n\t\tconst data = await res.json();\n\n\t\tif (data.token) {\n\t\t\tlocalStorage.setItem('token', data.token);\n\t\t\tupdateAuthUI?.(); // Optional: refresh UI\n\t\t\tshowConfirmationMessage(' Signed in with Google!');\n\t\t} else {\n\t\t\talert('Google sign-in failed.');\n\t\t}\n\t} catch (err) {\n\t\tconsole.error('Google login error:', err);\n\t\talert('Login failed');\n\t}\n}\n\nfunction updateAuthUI() {\n\tconst token = localStorage.getItem('token');\n\tconst username = localStorage.getItem('username');\n\tconst hamburgerButton = document.getElementById('hamburger-button');\n\n\tif (token && username) {\n\t\tdocument.getElementById('auth-message').style.display = 'none';\n\t\tdocument.getElementById('logout-message').style.display = 'block';\n\t\tdocument.getElementById('username-display').textContent = username;\n\t\tif (hamburgerButton) hamburgerButton.style.display = 'inline-block';\n\t} else {\n\t\tdocument.getElementById('auth-message').style.display = 'block';\n\t\tdocument.getElementById('logout-message').style.display = 'none';\n\t\tdocument.getElementById('username-display').textContent = '';\n\t\tif (hamburgerButton) hamburgerButton.style.display = 'none';\n\t}\n}\n\n//  Time Helpers\nfunction convertTimeToHours(durationStr = '') {\n\tconst hours = +(durationStr.match(/(\\d+)\\s*hour/)?.[1] || 0);\n\tconst minutes = +(durationStr.match(/(\\d+)\\s*minute/)?.[1] || 0);\n\treturn hours + minutes / 60;\n}\n\nfunction formatHoursAndMinutes(decimal = 0) {\n\tif (isNaN(decimal) || decimal <= 0) return '0 minutes';\n\n\tconst totalMinutes = Math.round(decimal * 60); //  more accurate\n\tconst hours = Math.floor(totalMinutes / 60);\n\tconst minutes = totalMinutes % 60;\n\n\tconst parts = [];\n\tif (hours > 0) parts.push(`${hours} hour${hours !== 1 ? 's' : ''}`);\n\tif (minutes > 0) parts.push(`${minutes} minute${minutes !== 1 ? 's' : ''}`);\n\n\treturn parts.join(' ');\n}\n\n// removed: parseHoursAndMinutes — not referenced by this bundle\n\n//  Register the service worker\nif ('serviceWorker' in navigator) {\n\twindow.addEventListener('load', function () {\n\t\tnavigator.serviceWorker.register('/service-worker.js').then(\n\t\t\tfunction (registration) {\n\t\t\t\tconsole.log(' Service Worker registered with scope:', registration.scope);\n\t\t\t},\n\t\t\tfunction (err) {\n\t\t\t\tconsole.error(' Service Worker registration failed:', err);\n\t\t\t}\n\t\t);\n\t});\n}\n\n//  Show install button if eligible and not already installed\nwindow.addEventListener('beforeinstallprompt', (e) => {\n\te.preventDefault();\n\tdeferredPrompt = e;\n\n\t// Only show if not already installed\n\tif (!window.matchMedia('(display-mode: standalone)').matches) {\n\t\tconst btn = document.getElementById('install-button');\n\t\tif (btn) btn.style.display = 'inline-block';\n\t}\n});\n\n//  Handle click on install button\ndocument.getElementById('install-button')?.addEventListener('click', () => {\n\tif (deferredPrompt) {\n\t\tdeferredPrompt.prompt();\n\t\tdeferredPrompt.userChoice.then((choiceResult) => {\n\t\t\tif (choiceResult.outcome === 'accepted') {\n\t\t\t\tconsole.log(' User accepted the install prompt');\n\t\t\t} else {\n\t\t\t\tconsole.log(' User dismissed the install prompt');\n\t\t\t}\n\t\t\tdeferredPrompt = null;\n\t\t\tdocument.getElementById('install-button').style.display = 'none';\n\t\t});\n\t}\n});\n\n//  Hide the install button if already installed (user is using PWA)\nwindow.addEventListener('DOMContentLoaded', () => {\n\tconst isStandalone =\n\t\twindow.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;\n\n\tif (isStandalone) {\n\t\tconst btn = document.getElementById('install-button');\n\t\tif (btn) btn.style.display = 'none';\n\t}\n});\n\nlet scrollTimeout;\nwindow.addEventListener('scroll', () => {\n\tclearTimeout(scrollTimeout);\n\tscrollTimeout = setTimeout(() => {\n\t\tconst topBar = document.getElementById('top-bar');\n\t\tif (!topBar) return;\n\t\ttopBar.style.boxShadow = window.scrollY > 10 ? '0 2px 6px rgba(0,0,0,0.1)' : 'none';\n\t}, 50);\n});\n\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by Google auth callback in static pages */\nasync function onGoogleLogin(response) {\n\ttry {\n\t\tconst res = await fetch('/api/google-login', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\tbody: JSON.stringify({ id_token: response.credential })\n\t\t});\n\n\t\tif (!res.ok) {\n\t\t\tthrow new Error(await res.text());\n\t\t}\n\n\t\tconst data = await res.json();\n\t\tlocalStorage.setItem('token', data.token);\n\n\t\t// Refresh UI, show welcome, or reload logs\n\t\tupdateAuthUI?.();\n\t\tawait syncAndReloadLogs?.();\n\t} catch (err) {\n\t\talert(' Google login failed: ' + err.message);\n\t}\n}\n\nwindow.handleGoogleSignIn = async function (response) {\n\ttry {\n\t\tif (!response || !response.credential) {\n\t\t\tthrow new Error('Missing credential');\n\t\t}\n\n\t\tconst res = await fetch('https://logs.gorouteyourself.com/api/google-login', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\tbody: JSON.stringify({ id_token: response.credential })\n\t\t});\n\n\t\tif (!res.ok) {\n\t\t\tconst errorText = await res.text();\n\t\t\tthrow new Error(errorText);\n\t\t}\n\n\t\tconst data = await res.json();\n\t\tlocalStorage.setItem('token', data.token);\n\t\tupdateAuthUI?.();\n\t\tawait syncAndReloadLogs?.();\n\t} catch (err) {\n\t\tconsole.error('Google login error:', err);\n\t\talert(' Google login failed: ' + err.message);\n\t}\n};\n\nlet deferredPrompt = null;\n\nwindow.addEventListener('beforeinstallprompt', (e) => {\n\te.preventDefault();\n\tdeferredPrompt = e;\n});\n\nfunction installApp() {\n\tif (deferredPrompt) {\n\t\tdeferredPrompt.prompt();\n\t\tdeferredPrompt.userChoice.then((choiceResult) => {\n\t\t\tif (choiceResult.outcome === 'accepted') {\n\t\t\t\tconsole.log(' User accepted the install prompt');\n\t\t\t} else {\n\t\t\t\tconsole.log(' User dismissed the install prompt');\n\t\t\t}\n\t\t\tdeferredPrompt = null;\n\t\t});\n\t} else {\n\t\talert(' Installation is not supported or already installed.');\n\t}\n}\n\nfunction toggleHamburgerSettingsMenu() {\n\tconst menu = document.getElementById('hamburger-settings-menu');\n\tconst arrow = document.getElementById('hamburger-settings-arrow');\n\tif (!menu || !arrow) return;\n\n\tconst isOpen = menu.style.maxHeight && menu.style.maxHeight !== '0px';\n\n\tif (isOpen) {\n\t\tmenu.style.maxHeight = '0';\n\t\tarrow.style.transform = 'rotate(0deg)';\n\t} else {\n\t\tmenu.style.maxHeight = menu.scrollHeight + 'px';\n\t\tarrow.style.transform = 'rotate(180deg)';\n\t}\n}\n\nfunction blurButtonOnInteraction(e) {\n\tconst btn = e.target.closest('button');\n\tif (btn) btn.blur();\n}\n\ndocument.addEventListener('click', blurButtonOnInteraction);\ndocument.addEventListener('touchend', blurButtonOnInteraction);\n\n// ==============================================\n// SUBSCRIPTION & USAGE TRACKING FUNCTIONS\n// Add these to app.js\n// ==============================================\n\n// Get current subscription info\nasync function getSubscriptionInfo() {\n\tconst token = localStorage.getItem('token');\n\tif (!token) return null;\n\n\ttry {\n\t\tconst response = await fetch('https://logs.gorouteyourself.com/api/subscription', {\n\t\t\theaders: { Authorization: token }\n\t\t});\n\n\t\tif (response.ok) {\n\t\t\treturn await response.json();\n\t\t}\n\t} catch (err) {\n\t\tconsole.error('Failed to get subscription info:', err);\n\t}\n\n\treturn null;\n}\n\n// Check if user can log more trips\nasync function canLogTrip() {\n\tconst subscription = await getSubscriptionInfo();\n\tif (!subscription) return true; // Local-only users can always log\n\n\tif (subscription.plan === 'free') {\n\t\treturn subscription.tripsThisMonth < subscription.maxTrips;\n\t}\n\n\treturn true; // Pro/Business have unlimited\n}\n\n// Show upgrade modal when limit reached\nfunction showUpgradeModal() {\n\tconst html = `\n    <div style=\"text-align: center;\">\n      <h3>📊 You've reached your limit!</h3>\n      <p style=\"margin: 20px 0;\">You've used all 10 trips this month on the Free plan.</p>\n      <p style=\"margin-bottom: 30px;\">Upgrade to <strong>Pro</strong> for unlimited trips, cloud sync, and more!</p>\n      \n      <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); \n                  color: white; \n                  padding: 20px; \n                  border-radius: 12px; \n                  margin: 20px 0;\">\n        <div style=\"font-size: 14px; opacity: 0.9;\">Pro Plan</div>\n        <div style=\"font-size: 36px; font-weight: bold; margin: 10px 0;\">$9.99</div>\n        <div style=\"font-size: 14px; opacity: 0.9;\">per month</div>\n        <ul style=\"text-align: left; margin: 20px 0; padding-left: 20px;\">\n          <li>✅ Unlimited trips</li>\n          <li>✅ Cloud sync & backup</li>\n          <li>✅ Route optimization</li>\n          <li>✅ CSV/PDF export</li>\n          <li>✅ Analytics dashboard</li>\n        </ul>\n      </div>\n      \n      <button onclick=\"upgradeToPro()\" style=\"\n        background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);\n        color: white;\n        padding: 15px 40px;\n        font-size: 18px;\n        font-weight: 600;\n        border: none;\n        border-radius: 30px;\n        cursor: pointer;\n        margin-top: 10px;\n      \">Upgrade to Pro</button>\n      \n      <p style=\"margin-top: 20px; font-size: 14px; color: #666;\">\n        Or <a href=\"#\" onclick=\"closeUniversalModal()\" style=\"color: #4caf50;\">continue with Free plan next month</a>\n      </p>\n    </div>\n  `;\n\n\tshowAlertModal(html);\n}\n\n// Upgrade to Pro (mock implementation - replace with Stripe)\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- referenced by inline HTML in static pages */\nasync function upgradeToPro() {\n\t// TODO: Integrate Stripe checkout\n\t// For now, direct API upgrade\n\tconst token = localStorage.getItem('token');\n\tif (!token) {\n\t\tshowAlertModal('⚠️ Please sign in to upgrade.');\n\t\treturn;\n\t}\n\n\ttry {\n\t\tconst response = await fetch('https://logs.gorouteyourself.com/api/subscription/upgrade', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\tAuthorization: token\n\t\t\t},\n\t\t\tbody: JSON.stringify({ plan: 'pro' })\n\t\t});\n\n\t\tif (response.ok) {\n\t\t\t// upgrade successful\n\t\t\tcloseUniversalModal();\n\t\t\tshowAlertModal('🎉 Successfully upgraded to Pro! You now have unlimited trips.', () => {\n\t\t\t\tlocation.reload();\n\t\t\t});\n\t\t} else {\n\t\t\tconst error = await response.text();\n\t\t\tshowAlertModal('❌ Upgrade failed: ' + error);\n\t\t}\n\t} catch (err) {\n\t\tconsole.error('Upgrade error:', err);\n\t\tshowAlertModal('❌ Failed to upgrade. Please try again.');\n\t}\n}\n\n// Show usage stats in UI\nasync function displayUsageStats() {\n\tconst subscription = await getSubscriptionInfo();\n\tif (!subscription) return;\n\n\tconst usernameDisplay = document.getElementById('username-display');\n\tif (!usernameDisplay) return;\n\n\t// Add plan badge\n\tconst planBadge = document.createElement('span');\n\tplanBadge.style.cssText = `\n    display: inline-block;\n    margin-left: 8px;\n    padding: 2px 8px;\n    background: ${subscription.plan === 'pro' ? '#7b1fa2' : subscription.plan === 'business' ? '#388e3c' : '#1976d2'};\n    color: white;\n    font-size: 11px;\n    font-weight: 600;\n    border-radius: 4px;\n    text-transform: uppercase;\n  `;\n\tplanBadge.textContent = subscription.plan;\n\n\t// Only show for signed-in users\n\tif (usernameDisplay.textContent) {\n\t\tusernameDisplay.appendChild(planBadge);\n\t}\n\n\t// Show trip count for Free users\n\tif (subscription.plan === 'free') {\n\t\tconst tripCount = document.createElement('div');\n\t\ttripCount.style.cssText = `\n      position: absolute;\n      top: 45px;\n      right: 22px;\n      font-size: 12px;\n      color: ${subscription.tripsThisMonth >= subscription.maxTrips ? '#f44336' : '#666'};\n      font-weight: 500;\n    `;\n\t\ttripCount.textContent = `${subscription.tripsThisMonth}/${subscription.maxTrips} trips`;\n\t\tusernameDisplay.parentElement.appendChild(tripCount);\n\t}\n}\n\n// Update logResults to check limits\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by inline HTML */\nasync function logResults() {\n\tconst destinationInputs = document.querySelectorAll('input[id^=\"destination-\"]');\n\tconst filledDestinations = Array.from(destinationInputs).filter(\n\t\t(input) => input.value.trim() !== ''\n\t);\n\tif (filledDestinations.length === 0) {\n\t\tshowAlertModal('⚠️ Please enter at least one destination before logging your route.');\n\t\treturn;\n\t}\n\n\t// Check if user can log trip\n\tconst canLog = await canLogTrip();\n\tif (!canLog) {\n\t\tshowUpgradeModal();\n\t\treturn;\n\t}\n\n\tconst calculationResult = await calculateRouteData();\n\tif (calculationResult) {\n\t\tcurrentPage = 1;\n\t\tlogEntry(calculationResult);\n\t\tdisplayLog();\n\t\tupdateUI(calculationResult);\n\t\tclearTripForm();\n\t\tshowConfirmationMessage('✓ Route logged successfully!');\n\t}\n}\n\n// Initialize usage tracking on page load\ndocument.addEventListener('DOMContentLoaded', async () => {\n\t// ... existing code ...\n\n\t// Display usage stats if signed in\n\tawait displayUsageStats();\n});\n\n// ==============================================\n// USAGE IN HAMBURGER MENU\n// Add this section to the hamburger menu\n// ==============================================\n\n/*\nAdd this HTML to the hamburger menu in index.html:\n\n<div id=\"subscription-info\" style=\"\n  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);\n  padding: 15px;\n  margin: 10px;\n  border-radius: 8px;\n  text-align: center;\n\">\n  <div id=\"plan-name\" style=\"font-weight: 600; color: #333; font-size: 16px;\">Free Plan</div>\n  <div id=\"plan-details\" style=\"font-size: 13px; color: #666; margin: 8px 0;\"></div>\n  <button onclick=\"showUpgradePage()\" style=\"\n    background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);\n    color: white;\n    padding: 8px 16px;\n    border: none;\n    border-radius: 20px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    margin-top: 8px;\n  \">Upgrade Plan</button>\n</div>\n*/\n\n// Update subscription info in menu\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars -- used by UI */\nasync function updateSubscriptionInfoInMenu() {\n\tconst subscription = await getSubscriptionInfo();\n\tif (!subscription) return;\n\n\tconst planNameEl = document.getElementById('plan-name');\n\tconst planDetailsEl = document.getElementById('plan-details');\n\n\tif (planNameEl) {\n\t\tplanNameEl.textContent =\n\t\t\tsubscription.plan.charAt(0).toUpperCase() + subscription.plan.slice(1) + ' Plan';\n\t}\n\n\tif (planDetailsEl) {\n\t\tif (subscription.plan === 'free') {\n\t\t\tplanDetailsEl.innerHTML = `\n        ${subscription.tripsThisMonth}/${subscription.maxTrips} trips used<br>\n        Resets ${new Date(subscription.resetDate).toLocaleDateString()}\n      `;\n\t\t} else {\n\t\t\tplanDetailsEl.textContent = '✓ Unlimited trips';\n\t\t}\n\t}\n}\n\n// Show upgrade page\nfunction showUpgradePage() {\n\tcloseMenu();\n\tshowUpgradeModal();\n}\n\n// Expose legacy globals used by inline HTML handlers in static pages\n(function exposeLegacyGlobals() {\n\ttry {\n\t\tif (typeof toggleMenu === 'function') globalThis.toggleMenu = toggleMenu;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof scrollToTop === 'function') globalThis.scrollToTop = scrollToTop;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof showSignup === 'function') globalThis.showSignup = showSignup;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof showLogin === 'function') globalThis.showLogin = showLogin;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof closeMenu === 'function') globalThis.closeMenu = closeMenu;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof showUpgradePage === 'function') globalThis.showUpgradePage = showUpgradePage;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof triggerImportFile === 'function') globalThis.triggerImportFile = triggerImportFile;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof exportToCSVWithTotals === 'function')\n\t\t\tglobalThis.exportToCSVWithTotals = exportToCSVWithTotals;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof exportToPDFWithTotals === 'function')\n\t\t\tglobalThis.exportToPDFWithTotals = exportToPDFWithTotals;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof toggleHamburgerSettingsMenu === 'function')\n\t\t\tglobalThis.toggleHamburgerSettingsMenu = toggleHamburgerSettingsMenu;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof installApp === 'function') globalThis.installApp = installApp;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof addDestination === 'function') globalThis.addDestination = addDestination;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof addMaintenanceItem === 'function')\n\t\t\tglobalThis.addMaintenanceItem = addMaintenanceItem;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof addSupplyItem === 'function') globalThis.addSupplyItem = addSupplyItem;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof clearFilters === 'function') globalThis.clearFilters = clearFilters;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof addEditDestination === 'function')\n\t\t\tglobalThis.addEditDestination = addEditDestination;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof addEditMaintenanceItem === 'function')\n\t\t\tglobalThis.addEditMaintenanceItem = addEditMaintenanceItem;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof resumeDraftTrip === 'function') globalThis.resumeDraftTrip = resumeDraftTrip;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof discardDraftTrip === 'function') globalThis.discardDraftTrip = discardDraftTrip;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof toggleHamburgerManageLogMenu === 'function')\n\t\t\tglobalThis.toggleHamburgerManageLogMenu = toggleHamburgerManageLogMenu;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof toggleHamburgerManageAccountMenu === 'function')\n\t\t\tglobalThis.toggleHamburgerManageAccountMenu = toggleHamburgerManageAccountMenu;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof closeAuthModal === 'function') globalThis.closeAuthModal = closeAuthModal;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof deleteCustomMaintenanceType === 'function')\n\t\t\tglobalThis.deleteCustomMaintenanceType = deleteCustomMaintenanceType;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof deleteCustomSupplyType === 'function')\n\t\t\tglobalThis.deleteCustomSupplyType = deleteCustomSupplyType;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof removeMaintenanceItem === 'function')\n\t\t\tglobalThis.removeMaintenanceItem = removeMaintenanceItem;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof removeSupplyItem === 'function') globalThis.removeSupplyItem = removeSupplyItem;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof removeEditSupplyItem === 'function')\n\t\t\tglobalThis.removeEditSupplyItem = removeEditSupplyItem;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof removeEditMaintenanceItem === 'function')\n\t\t\tglobalThis.removeEditMaintenanceItem = removeEditMaintenanceItem;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof onStartDateChange === 'function') globalThis.onStartDateChange = onStartDateChange;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n\ttry {\n\t\tif (typeof initAutocompleteDestination === 'function')\n\t\t\tglobalThis.initAutocompleteDestination = initAutocompleteDestination;\n\t} catch (e) {\n\t\tvoid e;\n\t}\n})();\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\dashboard-enhanced.js",
		"messages": [
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'startMin' is never reassigned. Use 'const' instead.",
				"line": 96,
				"column": 8,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 96,
				"endColumn": 16,
				"fix": { "range": [3163, 3191], "text": "const startMin = sh * 60 + sm;" }
			}
		],
		"suppressedMessages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'expandRoute' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 267,
				"column": 10,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 267,
				"endColumn": 21,
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'preview' is assigned a value but never used. Allowed unused vars must match /^_/u.",
				"line": 268,
				"column": 8,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 268,
				"endColumn": 15,
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 1,
		"fixableWarningCount": 0,
		"source": "/* eslint-disable @typescript-eslint/no-unused-vars */\n// ============================================\n// DASHBOARD-ENHANCED.JS - Advanced Analytics\n// ============================================\n\n// Initialize enhanced features on page load\ndocument.addEventListener('DOMContentLoaded', () => {\n\tconsole.log('📈 Enhanced analytics initializing...');\n\n\t// Wait for main dashboard to load first\n\tsetTimeout(() => {\n\t\tif (allTrips && allTrips.length > 0) {\n\t\t\trenderEfficiencyMetrics();\n\t\t\trenderTopRoutes();\n\t\t\trenderComparison();\n\t\t}\n\t}, 500);\n});\n\n// Render efficiency metrics\nfunction renderEfficiencyMetrics() {\n\tconst trips = getFilteredTrips(currentPeriod);\n\n\tif (trips.length === 0) {\n\t\treturn;\n\t}\n\n\tconst stats = calculateStats(trips);\n\n\t// Profit per Mile\n\tconst profitPerMile = stats.totalMileage > 0 ? stats.totalProfit / stats.totalMileage : 0;\n\tdocument.getElementById('profit-per-mile').textContent = `$${profitPerMile.toFixed(2)}`;\n\n\t// Cost per Mile\n\tconst totalCosts = stats.totalFuelCost + stats.totalMaintenanceCost + stats.totalSuppliesCost;\n\tconst costPerMile = stats.totalMileage > 0 ? totalCosts / stats.totalMileage : 0;\n\tdocument.getElementById('cost-per-mile').textContent = `$${costPerMile.toFixed(2)}`;\n\n\t// Average Miles per Trip\n\tconst avgMiles = stats.totalTrips > 0 ? stats.totalMileage / stats.totalTrips : 0;\n\tdocument.getElementById('avg-miles-trip').textContent = `${avgMiles.toFixed(1)} mi`;\n\n\t// Average Hours per Trip\n\tconst avgHours = stats.totalTrips > 0 ? stats.totalHours / stats.totalTrips : 0;\n\tdocument.getElementById('avg-hours-trip').textContent = `${avgHours.toFixed(1)} hrs`;\n}\n\n// Render top routes by profitability\nfunction renderTopRoutes() {\n\tconst trips = getFilteredTrips(currentPeriod);\n\tconst tbody = document.getElementById('top-routes-table-body');\n\n\tif (!tbody) return;\n\n\tif (trips.length === 0) {\n\t\ttbody.innerHTML = `\n      <tr>\n        <td colspan=\"6\" style=\"text-align: center; padding: 40px; color: #999;\">\n          No routes in selected period.\n        </td>\n      </tr>\n    `;\n\t\treturn;\n\t}\n\n\t// Group trips by route signature (start → destinations → end)\n\tconst routeGroups = {};\n\n\ttrips.forEach((trip) => {\n\t\tconst destinations = trip.destinations || [];\n\t\tconst routeKey = `${trip.startTime}|${destinations.join('|')}|${trip.endTime}`;\n\n\t\tif (!routeGroups[routeKey]) {\n\t\t\trouteGroups[routeKey] = {\n\t\t\t\troute: {\n\t\t\t\t\tfull: `${trip.startTime} 2192 ${destinations.join(' 2192 ')} 2192 ${trip.endTime}`,\n\t\t\t\t\tpreview: `${trip.startTime} 2192 ${destinations.slice(0, 2).join(' 2192 ')}${destinations.length > 2 ? '...' : ''} 2192 ${trip.endTime}`\n\t\t\t\t},\n\t\t\t\ttrips: [],\n\t\t\t\ttotalProfit: 0,\n\t\t\t\ttotalMileage: 0,\n\t\t\t\ttotalHours: 0\n\t\t\t};\n\t\t}\n\n\t\trouteGroups[routeKey].trips.push(trip);\n\t\trouteGroups[routeKey].totalProfit += parseFloat(trip.netProfit || 0);\n\t\trouteGroups[routeKey].totalMileage += parseFloat(trip.totalMileage || 0);\n\n\t\t// Calculate hours from clock times\n\t\tconst start = trip.startClock;\n\t\tconst end = trip.endClock;\n\t\tif (start && end && start.includes(':') && end.includes(':')) {\n\t\t\tconst [sh, sm] = start.split(':').map(Number);\n\t\t\tconst [eh, em] = end.split(':').map(Number);\n\t\t\tlet startMin = sh * 60 + sm;\n\t\t\tlet endMin = eh * 60 + em;\n\t\t\tif (endMin < startMin) endMin += 24 * 60;\n\t\t\trouteGroups[routeKey].totalHours += (endMin - startMin) / 60;\n\t\t}\n\t});\n\n\t// Convert to array and calculate metrics\n\tconst routes = Object.values(routeGroups).map((group) => ({\n\t\t...group,\n\t\tprofitPerMile: group.totalMileage > 0 ? group.totalProfit / group.totalMileage : 0,\n\t\tprofitPerHour: group.totalHours > 0 ? group.totalProfit / group.totalHours : 0,\n\t\ttripCount: group.trips.length\n\t}));\n\n\t// Sort by total profit (descending) and take top 10\n\tconst topRoutes = routes.sort((a, b) => b.totalProfit - a.totalProfit).slice(0, 10);\n\n\tif (topRoutes.length === 0) {\n\t\ttbody.innerHTML = `\n      <tr>\n        <td colspan=\"6\" style=\"text-align: center; padding: 40px; color: #999;\">\n          No routes found.\n        </td>\n      </tr>\n    `;\n\t\treturn;\n\t}\n\n\ttbody.innerHTML = topRoutes\n\t\t.map((route, index) => {\n\t\t\tconst profitClass = route.totalProfit >= 0 ? 'profit-positive' : 'profit-negative';\n\n\t\t\treturn `\n      <tr>\n        <td>${index + 1}</td>\n        <td class=\"route-preview\" style=\"cursor: pointer; color: #007bff;\" onclick=\"expandRoute(this)\" title=\"Click to see full route\">${route.route.preview}<span style=\"display:none;\" class=\"full-route\">${route.route.full}</span></td>\n        <td>${route.tripCount}</td>\n        <td class=\"${profitClass}\">$${route.totalProfit.toFixed(2)}</td>\n        <td>$${route.profitPerMile.toFixed(2)}</td>\n        <td>$${route.profitPerHour.toFixed(2)}</td>\n      </tr>\n    `;\n\t\t})\n\t\t.join('');\n}\n\n// Render period comparison\nfunction renderComparison() {\n\tconst currentTrips = getFilteredTrips(currentPeriod);\n\n\t// Get previous period trips\n\tconst previousTrips = getFilteredTrips(currentPeriod * 2).filter((trip) => {\n\t\tconst tripDate = new Date(trip.date);\n\t\tconst cutoffDate = new Date();\n\t\tcutoffDate.setDate(cutoffDate.getDate() - currentPeriod);\n\t\treturn tripDate < cutoffDate;\n\t});\n\n\tconst tbody = document.getElementById('comparison-table-body');\n\tif (!tbody) return;\n\n\tconst currentStats = calculateStats(currentTrips);\n\tconst previousStats = calculateStats(previousTrips);\n\n\t// Calculate changes\n\tconst comparisons = [\n\t\t{\n\t\t\tmetric: 'Total Trips',\n\t\t\tprevious: previousStats.totalTrips,\n\t\t\tcurrent: currentStats.totalTrips,\n\t\t\tformat: 'number'\n\t\t},\n\t\t{\n\t\t\tmetric: 'Total Profit',\n\t\t\tprevious: previousStats.totalProfit,\n\t\t\tcurrent: currentStats.totalProfit,\n\t\t\tformat: 'currency'\n\t\t},\n\t\t{\n\t\t\tmetric: 'Avg Profit/Hour',\n\t\t\tprevious: previousStats.avgProfitPerHour,\n\t\t\tcurrent: currentStats.avgProfitPerHour,\n\t\t\tformat: 'currency'\n\t\t},\n\t\t{\n\t\t\tmetric: 'Total Mileage',\n\t\t\tprevious: previousStats.totalMileage,\n\t\t\tcurrent: currentStats.totalMileage,\n\t\t\tformat: 'miles'\n\t\t},\n\t\t{\n\t\t\tmetric: 'Fuel Costs',\n\t\t\tprevious: previousStats.totalFuelCost,\n\t\t\tcurrent: currentStats.totalFuelCost,\n\t\t\tformat: 'currency'\n\t\t},\n\t\t{\n\t\t\tmetric: 'Total Hours',\n\t\t\tprevious: previousStats.totalHours,\n\t\t\tcurrent: currentStats.totalHours,\n\t\t\tformat: 'hours'\n\t\t}\n\t];\n\n\ttbody.innerHTML = comparisons\n\t\t.map((item) => {\n\t\t\tconst change =\n\t\t\t\titem.previous > 0\n\t\t\t\t\t? ((item.current - item.previous) / item.previous) * 100\n\t\t\t\t\t: item.current > 0\n\t\t\t\t\t\t? 100\n\t\t\t\t\t\t: 0;\n\n\t\t\tconst changeClass = change >= 0 ? 'profit-positive' : 'profit-negative';\n\t\t\tconst changeSymbol = change >= 0 ? '↑' : '↓';\n\n\t\t\t// Format values based on type\n\t\t\tlet previousDisplay, currentDisplay;\n\n\t\t\tswitch (item.format) {\n\t\t\t\tcase 'currency':\n\t\t\t\t\tpreviousDisplay = `$${item.previous.toFixed(2)}`;\n\t\t\t\t\tcurrentDisplay = `$${item.current.toFixed(2)}`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'miles':\n\t\t\t\t\tpreviousDisplay = `${item.previous.toFixed(1)} mi`;\n\t\t\t\t\tcurrentDisplay = `${item.current.toFixed(1)} mi`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hours':\n\t\t\t\t\tpreviousDisplay = `${item.previous.toFixed(1)} hrs`;\n\t\t\t\t\tcurrentDisplay = `${item.current.toFixed(1)} hrs`;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tpreviousDisplay = item.previous;\n\t\t\t\t\tcurrentDisplay = item.current;\n\t\t\t}\n\n\t\t\treturn `\n      <tr>\n        <td><strong>${item.metric}</strong></td>\n        <td>${previousDisplay}</td>\n        <td>${currentDisplay}</td>\n        <td class=\"${changeClass}\">\n          ${changeSymbol} ${Math.abs(change).toFixed(1)}%\n        </td>\n      </tr>\n    `;\n\t\t})\n\t\t.join('');\n}\n\n// Update enhanced features when period changes\n// Hook into the existing changePeriod function\nconst originalChangePeriod = window.changePeriod;\nif (typeof originalChangePeriod === 'function') {\n\twindow.changePeriod = function (days) {\n\t\t// Call original function\n\t\toriginalChangePeriod.call(this, days);\n\n\t\t// Update enhanced features\n\t\tsetTimeout(() => {\n\t\t\trenderEfficiencyMetrics();\n\t\t\trenderTopRoutes();\n\t\t\trenderComparison();\n\t\t}, 100);\n\t};\n}\n\n// Export enhanced analytics data\n// Expand route to show all destinations\nfunction expandRoute(cell) {\n\tconst preview = cell.childNodes[0];\n\tconst fullRouteSpan = cell.querySelector('.full-route');\n\tif (!fullRouteSpan) return;\n\n\tconst isExpanded = fullRouteSpan.style.display === 'inline';\n\n\tif (isExpanded) {\n\t\t// Collapse\n\t\tfullRouteSpan.style.display = 'none';\n\t\tcell.childNodes[0].textContent = cell.getAttribute('data-preview');\n\t} else {\n\t\t// Expand\n\t\tcell.setAttribute('data-preview', cell.childNodes[0].textContent);\n\t\tcell.childNodes[0].textContent = '';\n\t\tfullRouteSpan.style.display = 'inline';\n\t}\n}\n\nfunction exportEnhancedAnalytics() {\n\tconst trips = getFilteredTrips(currentPeriod);\n\n\tif (trips.length === 0) {\n\t\tshowAlertModal('⚠️ No data to export in selected period.');\n\t\treturn;\n\t}\n\n\tconst stats = calculateStats(trips);\n\n\t// Efficiency metrics\n\tconst profitPerMile = stats.totalMileage > 0 ? stats.totalProfit / stats.totalMileage : 0;\n\tconst costPerMile =\n\t\tstats.totalMileage > 0\n\t\t\t? (stats.totalFuelCost + stats.totalMaintenanceCost + stats.totalSuppliesCost) /\n\t\t\t\tstats.totalMileage\n\t\t\t: 0;\n\tconst avgMiles = stats.totalTrips > 0 ? stats.totalMileage / stats.totalTrips : 0;\n\tconst avgHours = stats.totalTrips > 0 ? stats.totalHours / stats.totalTrips : 0;\n\n\t// Create comprehensive report\n\tconst report = {\n\t\tperiod: `${currentPeriod} days`,\n\t\tgenerated: new Date().toLocaleString(),\n\t\tsummary: {\n\t\t\ttotalTrips: stats.totalTrips,\n\t\t\ttotalProfit: stats.totalProfit,\n\t\t\ttotalEarnings: stats.totalEarnings,\n\t\t\ttotalCosts: stats.totalFuelCost + stats.totalMaintenanceCost + stats.totalSuppliesCost,\n\t\t\tavgProfitPerHour: stats.avgProfitPerHour\n\t\t},\n\t\tefficiency: {\n\t\t\tprofitPerMile: profitPerMile,\n\t\t\tcostPerMile: costPerMile,\n\t\t\tavgMilesPerTrip: avgMiles,\n\t\t\tavgHoursPerTrip: avgHours\n\t\t},\n\t\ttrips: trips.map((trip) => ({\n\t\t\tdate: trip.date,\n\t\t\troute: `${trip.startTime} → ${(trip.destinations || []).join(' → ')} → ${trip.endTime}`,\n\t\t\tprofit: parseFloat(trip.netProfit || 0),\n\t\t\tmileage: parseFloat(trip.totalMileage || 0),\n\t\t\tearnings: parseFloat(trip.totalEarnings || 0)\n\t\t}))\n\t};\n\n\t// Download as JSON\n\tconst blob = new Blob([JSON.stringify(report, null, 2)], {\n\t\ttype: 'application/json'\n\t});\n\tconst link = document.createElement('a');\n\tlink.href = URL.createObjectURL(blob);\n\tlink.download = `analytics-report-${currentPeriod}days.json`;\n\tlink.click();\n\n\tshowConfirmationMessage(`✅ Exported analytics report`);\n}\n\n// Add export button for enhanced analytics\nfunction addEnhancedExportButton() {\n\tconst exportButtons = document.querySelector('.export-buttons');\n\tif (!exportButtons) return;\n\n\tconst enhancedBtn = document.createElement('button');\n\tenhancedBtn.className = 'export-btn';\n\tenhancedBtn.innerHTML = `\n    <span class=\"material-icons\">analytics</span>\n    Export Analytics Report\n  `;\n\tenhancedBtn.onclick = exportEnhancedAnalytics;\n\n\texportButtons.appendChild(enhancedBtn);\n}\n\n// Initialize export button after page load\nsetTimeout(addEnhancedExportButton, 1000);\n\nconsole.log('✅ Dashboard-enhanced.js loaded');\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\dashboard.js",
		"messages": [
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'charts' is never reassigned. Use 'const' instead.",
				"line": 7,
				"column": 5,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 7,
				"endColumn": 11,
				"fix": { "range": [212, 228], "text": "const charts = {};" }
			}
		],
		"suppressedMessages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'button' is assigned a value but never used. Allowed unused vars must match /^_/u.",
				"line": 11,
				"column": 8,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 11,
				"endColumn": 14,
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 1,
		"fixableWarningCount": 0,
		"source": "/* eslint-disable @typescript-eslint/no-unused-vars */\n// dashboard.js - FIXED VERSION\n// Handles rendering and interactions for the dashboard page\n\nlet allTrips = [];\nlet currentPeriod = 7; // default to 7 days\nlet charts = {}; // store chart instances\n\n// Initialize on page load\nwindow.toggleViewAll = function () {\n\tconst button = document.getElementById('view-all-trips-button');\n\t// Redirect to index.html log section\n\twindow.location.href = '/index.html#log';\n};\n\n// Change time period\nwindow.changePeriod = function (days) {\n\tcurrentPeriod = days;\n\n\t// Update button states\n\tconst buttons = document.querySelectorAll('.period-btn');\n\tbuttons.forEach((btn) => {\n\t\tbtn.classList.remove('active');\n\t\tif (btn.textContent.includes(days.toString())) {\n\t\t\tbtn.classList.add('active');\n\t\t}\n\t});\n\n\trenderDashboard();\n};\n\n// Helper: Format date for display\nfunction formatLocalDate(dateString) {\n\tconst date = new Date(dateString + 'T00:00:00');\n\treturn date.toLocaleDateString('en-US', {\n\t\tyear: 'numeric',\n\t\tmonth: 'short',\n\t\tday: 'numeric'\n\t});\n}\n\n// Helper: Format hours and minutes\nfunction formatHoursAndMinutes(decimal = 0) {\n\tif (isNaN(decimal) || decimal <= 0) return '0 minutes';\n\n\tconst totalMinutes = Math.round(decimal * 60);\n\tconst hours = Math.floor(totalMinutes / 60);\n\tconst minutes = totalMinutes % 60;\n\n\tconst parts = [];\n\tif (hours > 0) parts.push(`${hours} hour${hours !== 1 ? 's' : ''}`);\n\tif (minutes > 0) parts.push(`${minutes} minute${minutes !== 1 ? 's' : ''}`);\n\n\treturn parts.join(' ') || '0 minutes';\n}\n\n// Load trips data\nasync function loadTripsData() {\n\tconst token = localStorage.getItem('token');\n\n\tif (!token) {\n\t\tconsole.warn('⚠ No token found - redirecting to index');\n\t\twindow.location.href = '/index.html';\n\t\treturn;\n\t}\n\n\ttry {\n\t\t// Try to load from cloud first\n\t\tconst response = await fetch('https://logs.gorouteyourself.com/logs', {\n\t\t\theaders: { Authorization: token }\n\t\t});\n\n\t\tif (response.ok) {\n\t\t\tallTrips = await response.json();\n\t\t\tconsole.log(`📦 Loaded ${allTrips.length} trips from cloud`);\n\t\t} else {\n\t\t\t// Fall back to local storage\n\t\t\tallTrips = JSON.parse(localStorage.getItem('trips') || '[]');\n\t\t\tconsole.log(`📦 Loaded ${allTrips.length} trips from local storage`);\n\t\t}\n\n\t\trenderDashboard();\n\t} catch (error) {\n\t\tconsole.error('Error loading trips:', error);\n\t\t// Fall back to local storage\n\t\tallTrips = JSON.parse(localStorage.getItem('trips') || '[]');\n\t\trenderDashboard();\n\t}\n}\n\n// Main render function\nfunction renderDashboard() {\n\tconst trips = getFilteredTrips(currentPeriod);\n\n\tif (trips.length === 0) {\n\t\tshowEmptyState();\n\t\treturn;\n\t}\n\n\thideEmptyState();\n\trenderStats(trips);\n\trenderCharts(trips);\n\trenderRecentTrips(trips);\n}\n\n// Get trips for selected period\nfunction getFilteredTrips(days) {\n\tconst now = new Date();\n\tconst cutoffDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\n\n\treturn allTrips\n\t\t.filter((trip) => {\n\t\t\tconst tripDate = new Date(trip.date + 'T00:00:00');\n\t\t\treturn tripDate >= cutoffDate && tripDate <= now;\n\t\t})\n\t\t.sort((a, b) => new Date(b.date) - new Date(a.date));\n}\n\n// Render stat cards\nfunction renderStats(trips) {\n\t// Calculate totals\n\tconst totalProfit = trips.reduce((sum, t) => sum + parseFloat(t.netProfit || 0), 0);\n\tconst totalFuel = trips.reduce((sum, t) => sum + parseFloat(t.fuelCost || 0), 0);\n\n\t// Calculate hours worked\n\tlet totalHoursWorked = 0;\n\ttrips.forEach((trip) => {\n\t\tif (trip.hoursWorked) {\n\t\t\ttotalHoursWorked += parseFloat(trip.hoursWorked);\n\t\t}\n\t});\n\n\tconst avgProfitPerHour = totalHoursWorked > 0 ? totalProfit / totalHoursWorked : 0;\n\n\t// Update DOM\n\tdocument.getElementById('total-profit').textContent = `$${totalProfit.toFixed(2)}`;\n\tdocument.getElementById('total-trips').textContent = trips.length;\n\tdocument.getElementById('avg-profit-hour').textContent = `$${avgProfitPerHour.toFixed(2)}`;\n\tdocument.getElementById('fuel-costs').textContent = `$${totalFuel.toFixed(2)}`;\n\n\t// Calculate changes (compare to previous period)\n\tconst prevTrips = getPreviousPeriodTrips(currentPeriod);\n\tconst prevProfit = prevTrips.reduce((sum, t) => sum + parseFloat(t.netProfit || 0), 0);\n\tconst prevFuel = prevTrips.reduce((sum, t) => sum + parseFloat(t.fuelCost || 0), 0);\n\n\tupdateChange('profit-change', totalProfit, prevProfit);\n\tupdateChange('trips-change', trips.length, prevTrips.length);\n\tupdateChange('fuel-change', totalFuel, prevFuel, true); // true = lower is better\n}\n\n// Get previous period trips for comparison\nfunction getPreviousPeriodTrips(days) {\n\tconst now = new Date();\n\tconst cutoffDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\n\tconst prevCutoffDate = new Date(cutoffDate.getTime() - days * 24 * 60 * 60 * 1000);\n\n\treturn allTrips.filter((trip) => {\n\t\tconst tripDate = new Date(trip.date + 'T00:00:00');\n\t\treturn tripDate >= prevCutoffDate && tripDate < cutoffDate;\n\t});\n}\n\n// Update change indicator\nfunction updateChange(elementId, current, previous, lowerIsBetter = false) {\n\tconst element = document.getElementById(elementId);\n\tif (!element) return;\n\n\tif (previous === 0) {\n\t\telement.textContent = '';\n\t\treturn;\n\t}\n\n\tconst change = ((current - previous) / previous) * 100;\n\tconst isPositive = lowerIsBetter ? change < 0 : change > 0;\n\n\telement.textContent = `${change > 0 ? '+' : ''}${change.toFixed(1)}%`;\n\telement.className = `stat-change ${isPositive ? 'positive' : 'negative'}`;\n}\n\n// Render charts\nfunction renderCharts(trips) {\n\trenderProfitChart(trips);\n\trenderCostChart(trips);\n}\n\n// Profit trend chart\nfunction renderProfitChart(trips) {\n\tconst ctx = document.getElementById('profit-chart');\n\tif (!ctx) return;\n\n\t// Destroy existing chart\n\tif (charts.profit) {\n\t\tcharts.profit.destroy();\n\t}\n\n\t// Prepare data (reverse to show oldest to newest)\n\tconst reversedTrips = [...trips].reverse();\n\tconst labels = reversedTrips.map((t) => formatLocalDate(t.date));\n\tconst data = reversedTrips.map((t) => parseFloat(t.netProfit || 0));\n\n\tcharts.profit = new Chart(ctx, {\n\t\ttype: 'line',\n\t\tdata: {\n\t\t\tlabels: labels,\n\t\t\tdatasets: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Net Profit',\n\t\t\t\t\tdata: data,\n\t\t\t\t\tborderColor: '#4caf50',\n\t\t\t\t\tbackgroundColor: 'rgba(76, 175, 80, 0.1)',\n\t\t\t\t\ttension: 0.4,\n\t\t\t\t\tfill: true\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\toptions: {\n\t\t\tresponsive: true,\n\t\t\tmaintainAspectRatio: true,\n\t\t\tplugins: {\n\t\t\t\tlegend: {\n\t\t\t\t\tdisplay: false\n\t\t\t\t}\n\t\t\t},\n\t\t\tscales: {\n\t\t\t\ty: {\n\t\t\t\t\tbeginAtZero: true,\n\t\t\t\t\tticks: {\n\t\t\t\t\t\tcallback: function (value) {\n\t\t\t\t\t\t\treturn '$' + value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n}\n\n// Cost breakdown chart\nfunction renderCostChart(trips) {\n\tconst ctx = document.getElementById('cost-chart');\n\tif (!ctx) return;\n\n\t// Destroy existing chart\n\tif (charts.cost) {\n\t\tcharts.cost.destroy();\n\t}\n\n\t// Calculate totals\n\tconst fuelCost = trips.reduce((sum, t) => sum + parseFloat(t.fuelCost || 0), 0);\n\tconst maintenanceCost = trips.reduce((sum, t) => sum + parseFloat(t.maintenanceCost || 0), 0);\n\tconst suppliesCost = trips.reduce((sum, t) => sum + parseFloat(t.suppliesCost || 0), 0);\n\n\tcharts.cost = new Chart(ctx, {\n\t\ttype: 'doughnut',\n\t\tdata: {\n\t\t\tlabels: ['Fuel', 'Maintenance', 'Supplies'],\n\t\t\tdatasets: [\n\t\t\t\t{\n\t\t\t\t\tdata: [fuelCost, maintenanceCost, suppliesCost],\n\t\t\t\t\tbackgroundColor: ['#f44336', '#2196f3', '#ff9800']\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\toptions: {\n\t\t\tresponsive: true,\n\t\t\tmaintainAspectRatio: true,\n\t\t\tplugins: {\n\t\t\t\tlegend: {\n\t\t\t\t\tposition: 'bottom'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n}\n\n// Render recent trips table\nfunction renderRecentTrips(trips) {\n\tconst tbody = document.getElementById('recent-trips-table');\n\tif (!tbody) return;\n\n\tconst recentTrips = trips.slice(0, 5); // Show last 5\n\n\ttbody.innerHTML = recentTrips\n\t\t.map((trip) => {\n\t\t\tconst route = `${trip.startTime} → ${trip.endTime}`;\n\t\t\tconst stops = (trip.destinations || []).length;\n\n\t\t\treturn `\n      <tr>\n        <td>${formatLocalDate(trip.date)}</td>\n        <td style=\"max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\" title=\"${route}\">${route}</td>\n        <td>${stops}</td>\n        <td>${parseFloat(trip.totalMileage || 0).toFixed(1)}</td>\n        <td style=\"font-weight: 600; color: ${parseFloat(trip.netProfit) >= 0 ? '#4caf50' : '#f44336'};\">$${parseFloat(trip.netProfit || 0).toFixed(2)}</td>\n        <td>\n          <button class=\"btn-view\" onclick=\"viewTripDetails('${trip.date}')\">View</button>\n          <button class=\"btn-edit\" onclick=\"editTripOnIndex(${allTrips.indexOf(trip)})\">Edit</button>\n        </td>\n      </tr>\n    `;\n\t\t})\n\t\t.join('');\n}\n\n// Show empty state\nfunction showEmptyState() {\n\tconst container = document.querySelector('.dashboard-container');\n\tconst emptyState = document.getElementById('empty-state');\n\n\tif (container) container.style.display = 'none';\n\tif (emptyState) emptyState.style.display = 'block';\n}\n\n// Hide empty state\nfunction hideEmptyState() {\n\tconst container = document.querySelector('.dashboard-container');\n\tconst emptyState = document.getElementById('empty-state');\n\n\tif (container) container.style.display = 'block';\n\tif (emptyState) emptyState.style.display = 'none';\n}\n\n// View trip details in modal\nwindow.viewTripDetails = function (date) {\n\tconst trip = allTrips.find((t) => t.date === date);\n\tif (!trip) return;\n\n\tconst destinations = trip.destinations || [];\n\tconst destList = destinations\n\t\t.map((d, i) => `${i + 1}. ${d} - $${parseFloat(trip.earnings[i] || 0).toFixed(2)}`)\n\t\t.join('<br>');\n\n\tshowAlertModal(`\n    <h3 style=\"margin-top: 0;\">Trip Details - ${formatLocalDate(date)}</h3>\n    <div style=\"text-align: left; margin: 20px 0; font-size: 14px;\">\n      <p><strong>Start:</strong> ${trip.startTime}</p>\n      <p><strong>Destinations:</strong><br>${destList}</p>\n      <p><strong>End:</strong> ${trip.endTime}</p>\n      <p><strong>Mileage:</strong> ${trip.totalMileage} miles</p>\n      <p><strong>Drive Time:</strong> ${trip.totalTime}</p>\n      <p><strong>Hours Worked:</strong> ${formatHoursAndMinutes(trip.hoursWorked || 0)}</p>\n      <hr>\n      <p><strong>Earnings:</strong> $${trip.totalEarnings}</p>\n      <p><strong>Fuel Cost:</strong> $${trip.fuelCost}</p>\n      <p><strong>Maintenance:</strong> $${trip.maintenanceCost || 0}</p>\n      <p><strong>Supplies:</strong> $${trip.suppliesCost || 0}</p>\n      <p style=\"font-size: 16px; margin-top: 10px;\"><strong>Net Profit:</strong> $${trip.netProfit}</p>\n      <p><strong>Profit/Hour:</strong> $${trip.profitPerHour}</p>\n      ${trip.notes ? `<hr><p><strong>Notes:</strong> ${trip.notes}</p>` : ''}\n    </div>\n  `);\n};\n\n// Edit trip on index.html - FIXED VERSION\nwindow.editTripOnIndex = function (tripIndex) {\n\tif (tripIndex === -1) return;\n\n\t// Store the index for the index.html page to read\n\tlocalStorage.setItem('editTripIndex', tripIndex.toString());\n\n\t// Redirect to index.html log section\n\twindow.location.href = '/index.html#edit-' + tripIndex;\n};\n\n// Initialize when DOM is ready\ndocument.addEventListener('DOMContentLoaded', async () => {\n\tconsole.log('📊 Dashboard initializing...');\n\n\t// Check authentication\n\tconst token = localStorage.getItem('token');\n\tif (!token) {\n\t\tconsole.warn('⚠ Not authenticated - redirecting to index');\n\t\twindow.location.href = '/index.html';\n\t\treturn;\n\t}\n\n\tawait loadTripsData();\n});\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\e2e\\demo.test.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\e2e\\passkey-demo.spec.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\e2e\\trip-flow.test.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\eslint.config.js",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\eslint.svelte5-guard.js",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\playwright.config.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\postcss.config.js",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\app.d.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\demo.spec.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\do-worker.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\env.d.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\global.d.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\hooks.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\index.js",
		"messages": [],
		"suppressedMessages": [
			{
				"ruleId": "@typescript-eslint/ban-ts-comment",
				"severity": 2,
				"message": "Do not use \"@ts-nocheck\" because it alters compilation errors.",
				"line": 2,
				"column": 1,
				"nodeType": "Line",
				"messageId": "tsDirectiveComment",
				"endLine": 2,
				"endColumn": 15,
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\actions\\swipe.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\AsyncErrorBoundary.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ErrorBoundary.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\Loading.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\PWAInstall.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\SyncIndicator.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\TripSkeleton.svelte",
		"messages": [
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 2,
				"column": 2,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 21,
				"endColumn": 9
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<div class=\"animate-pulse space-y-4\">\n\t{#each Array(3) as _}\n\t\t<div\n\t\t\tclass=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700\"\n\t\t>\n\t\t\t<div class=\"flex justify-between items-start mb-3\">\n\t\t\t\t<div class=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3\"></div>\n\t\t\t\t<div class=\"h-5 bg-gray-300 dark:bg-gray-600 rounded w-1/4\"></div>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex items-center gap-3 mb-2\">\n\t\t\t\t<div class=\"w-2 h-2 rounded-full bg-green-400\"></div>\n\t\t\t\t<div class=\"h-3 bg-gray-200 dark:bg-gray-700 rounded w-3/4\"></div>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex items-center gap-3\">\n\t\t\t\t<div class=\"w-2 h-2 rounded-full bg-red-400\"></div>\n\t\t\t\t<div class=\"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2\"></div>\n\t\t\t</div>\n\t\t</div>\n\t{/each}\n\n\t<div class=\"text-center pt-4\">\n\t\t<p class=\"text-xs text-gray-400 animate-pulse\">Optimizing your trip history...</p>\n\t</div>\n</div>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\data\\ExportView.svelte",
		"messages": [
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 12,
				"column": 22,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 12,
				"endColumn": 39
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 13,
				"column": 25,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 13,
				"endColumn": 42
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 424,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 424,
				"endColumn": 30
			}
		],
		"suppressedMessages": [],
		"errorCount": 2,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { trips } from '$lib/stores/trips';\n\timport { expenses } from '$lib/stores/expenses';\n\timport { currentUser } from '$lib/stores/currentUser';\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport Button from '$lib/components/ui/Button.svelte';\n\n\tlet exportFormat = 'csv';\n\tlet exportDataType = 'trips'; // 'trips' | 'expenses' | 'tax_bundle'\n\tlet dateFrom = '';\n\tlet dateTo = '';\n\tlet selectedTrips = new Set<string>();\n\tlet selectedExpenses = new Set<string>();\n\tlet selectAll = false;\n\tlet isUpgradeModalOpen = false;\n\n\t// Reactive filter logic for Trips\n\t$: filteredTrips = $trips.filter((trip) => {\n\t\tif (!trip.date) return false;\n\t\tconst tripDate = new Date(trip.date);\n\t\tif (dateFrom && tripDate < new Date(dateFrom)) return false;\n\t\tif (dateTo && tripDate > new Date(dateTo)) return false;\n\t\treturn true;\n\t});\n\n\t// Reactive filter logic for Expenses\n\t$: filteredExpenses = $expenses.filter((expense) => {\n\t\tconst dStr = expense.date || expense.createdAt;\n\t\tif (!dStr) return false;\n\t\tconst expenseDate = new Date(dStr);\n\t\tif (dateFrom && expenseDate < new Date(dateFrom)) return false;\n\t\tif (dateTo && expenseDate > new Date(dateTo)) return false;\n\t\treturn true;\n\t});\n\n\t// Reactive selection logic\n\t$: if (selectAll) {\n\t\tif (exportDataType === 'trips') {\n\t\t\tselectedTrips = new Set(filteredTrips.map((t) => t.id));\n\t\t} else if (exportDataType === 'expenses') {\n\t\t\tselectedExpenses = new Set(filteredExpenses.map((e) => e.id));\n\t\t}\n\t} else {\n\t\t// Auto-check selectAll status based on individual selections\n\t\tif (exportDataType === 'trips') {\n\t\t\tif (selectedTrips.size === filteredTrips.length && filteredTrips.length > 0) selectAll = true;\n\t\t} else if (exportDataType === 'expenses') {\n\t\t\tif (selectedExpenses.size === filteredExpenses.length && filteredExpenses.length > 0)\n\t\t\t\tselectAll = true;\n\t\t}\n\t}\n\n\t// Auto-select everything for Tax Bundle\n\t$: if (exportDataType === 'tax_bundle') {\n\t\tselectAll = true;\n\t\tselectedTrips = new Set(filteredTrips.map((t) => t.id));\n\t\tselectedExpenses = new Set(filteredExpenses.map((e) => e.id));\n\t}\n\n\t// Check Pro Status\n\t$: isPro = ['pro', 'business', 'premium', 'enterprise'].includes(\n\t\t($currentUser?.plan ?? '') as string\n\t);\n\n\tfunction toggleSelectAll() {\n\t\tif (selectAll) {\n\t\t\tselectedTrips = new Set();\n\t\t\tselectedExpenses = new Set();\n\t\t} else {\n\t\t\tselectedTrips = new Set(filteredTrips.map((t) => t.id));\n\t\t\tselectedExpenses = new Set(filteredExpenses.map((e) => e.id));\n\t\t}\n\t\tselectAll = !selectAll;\n\t}\n\n\tfunction toggleTrip(id: string) {\n\t\tif (selectedTrips.has(id)) selectedTrips.delete(id);\n\t\telse selectedTrips.add(id);\n\t\tselectedTrips = selectedTrips;\n\t\tselectAll = selectedTrips.size === filteredTrips.length;\n\t}\n\n\tfunction toggleExpense(id: string) {\n\t\tif (selectedExpenses.has(id)) selectedExpenses.delete(id);\n\t\telse selectedExpenses.add(id);\n\t\tselectedExpenses = selectedExpenses;\n\t\tselectAll = selectedExpenses.size === filteredExpenses.length;\n\t}\n\n\tfunction formatDate(dateString: string): string {\n\t\treturn new Date(dateString).toLocaleDateString();\n\t}\n\n\t// --- EXPORT LOGIC ---\n\n\tfunction handleExport() {\n\t\t// 1. Export is available to all users; quotas are enforced on creation of data\n\n\t\tif (exportFormat === 'pdf') {\n\t\t\talert(\"PDF export requires a library like 'jspdf'. Please install it to enable PDF support.\");\n\t\t\treturn;\n\t\t}\n\n\t\t// 2. Handle different export types\n\t\tif (exportDataType === 'trips') {\n\t\t\tconst tripsToExport = filteredTrips.filter((t) => selectedTrips.has(t.id));\n\t\t\tif (tripsToExport.length === 0) return alert('No trips selected.');\n\t\t\tgenerateTripCSV(tripsToExport);\n\t\t} else if (exportDataType === 'expenses') {\n\t\t\tconst expensesToExport = filteredExpenses.filter((e) => selectedExpenses.has(e.id));\n\t\t\tif (expensesToExport.length === 0) return alert('No expenses selected.');\n\t\t\tgenerateExpenseCSV(expensesToExport);\n\t\t} else if (exportDataType === 'tax_bundle') {\n\t\t\tif (filteredTrips.length === 0 && filteredExpenses.length === 0)\n\t\t\t\treturn alert('No data found in this range.');\n\n\t\t\t// Trigger multiple downloads\n\t\t\tif (filteredTrips.length > 0) generateTripCSV(filteredTrips, 'Tax_Mileage_Log');\n\n\t\t\t// Small delay to ensure browser handles multiple downloads\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (filteredExpenses.length > 0) generateExpenseCSV(filteredExpenses, 'Tax_Expense_Log');\n\t\t\t}, 500);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tgenerateTaxSummary(filteredTrips, filteredExpenses);\n\t\t\t}, 1000);\n\t\t}\n\t}\n\n\tfunction generateTripCSV(data: any[], filenamePrefix = 'trips_export') {\n\t\tconst headers = [\n\t\t\t'Date',\n\t\t\t'Miles',\n\t\t\t'Start Address',\n\t\t\t'End Address',\n\t\t\t'Purpose',\n\t\t\t'Vehicle',\n\t\t\t'Notes'\n\t\t];\n\t\tconst rows = data.map((trip) => {\n\t\t\tconst date = trip.date ? new Date(trip.date).toLocaleDateString() : '';\n\t\t\tconst miles = trip.totalMiles || 0;\n\t\t\tconst start = `\"${(trip.startAddress || '').replace(/\"/g, '\"\"')}\"`;\n\t\t\tconst last = trip.stops?.[trip.stops.length - 1];\n\t\t\tconst end = `\"${(last?.address || trip.endAddress || 'End').replace(/\"/g, '\"\"')}\"`;\n\n\t\t\tconst purpose = `\"${(trip.purpose || 'Business').replace(/\"/g, '\"\"')}\"`;\n\t\t\tconst vehicle = `\"${(trip.vehicleId || '').replace(/\"/g, '\"\"')}\"`;\n\t\t\tconst notes = `\"${(trip.notes || '').replace(/\"/g, '\"\"')}\"`;\n\n\t\t\treturn [date, miles, start, end, purpose, vehicle, notes].join(',');\n\t\t});\n\n\t\tdownloadFile(\n\t\t\t[headers.join(','), ...rows].join('\\n'),\n\t\t\t`${filenamePrefix}_${new Date().toISOString().slice(0, 10)}.csv`,\n\t\t\t'text/csv'\n\t\t);\n\t}\n\n\tfunction generateExpenseCSV(data: any[], filenamePrefix = 'expenses_export') {\n\t\tconst headers = ['Date', 'Category', 'Amount', 'Description'];\n\t\tconst rows = data.map((e) => {\n\t\t\tconst date = e.date ? new Date(e.date).toLocaleDateString() : '';\n\t\t\tconst category = `\"${(e.category || 'General').replace(/\"/g, '\"\"')}\"`;\n\t\t\tconst amount = e.amount || 0;\n\t\t\tconst desc = `\"${(e.description || '').replace(/\"/g, '\"\"')}\"`;\n\t\t\treturn [date, category, amount, desc].join(',');\n\t\t});\n\t\tdownloadFile(\n\t\t\t[headers.join(','), ...rows].join('\\n'),\n\t\t\t`${filenamePrefix}_${new Date().toISOString().slice(0, 10)}.csv`,\n\t\t\t'text/csv'\n\t\t);\n\t}\n\n\tfunction generateTaxSummary(tripsData: any[], expensesData: any[]) {\n\t\tconst totalMiles = tripsData.reduce((sum, t) => sum + (t.totalMiles || 0), 0);\n\t\tconst totalExpenses = expensesData.reduce((sum, e) => sum + (e.amount || 0), 0);\n\n\t\t// Group expenses by category\n\t\tconst byCategory: Record<string, number> = {};\n\t\texpensesData.forEach((e) => {\n\t\t\tconst cat = e.category || 'Other';\n\t\t\tbyCategory[cat] = (byCategory[cat] || 0) + (e.amount || 0);\n\t\t});\n\n\t\tlet summary = `TAX SUMMARY REPORT\\n`;\n\t\tsummary += `Generated: ${new Date().toLocaleDateString()}\\n`;\n\t\tsummary += `Period: ${dateFrom || 'Start'} to ${dateTo || 'Present'}\\n\\n`;\n\n\t\tsummary += `----------------------------------------\\n`;\n\t\tsummary += `MILEAGE\\n`;\n\t\tsummary += `----------------------------------------\\n`;\n\t\tsummary += `Total Business Miles: ${totalMiles.toFixed(1)}\\n`;\n\t\tsummary += `Total Trips: ${tripsData.length}\\n\\n`;\n\n\t\tsummary += `----------------------------------------\\n`;\n\t\tsummary += `EXPENSES\\n`;\n\t\tsummary += `----------------------------------------\\n`;\n\t\tsummary += `Total Expenses: $${totalExpenses.toFixed(2)}\\n`;\n\t\tObject.entries(byCategory).forEach(([cat, amt]) => {\n\t\t\tsummary += `  - ${cat}: $${amt.toFixed(2)}\\n`;\n\t\t});\n\n\t\tdownloadFile(summary, `Tax_Summary_${new Date().getFullYear()}.txt`, 'text/plain');\n\t}\n\n\tfunction downloadFile(content: string, fileName: string, mimeType: string) {\n\t\tconst blob = new Blob([content], { type: `${mimeType};charset=utf-8;` });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst link = document.createElement('a');\n\t\tlink.setAttribute('href', url);\n\t\tlink.setAttribute('download', fileName);\n\t\tlink.style.visibility = 'hidden';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t}\n</script>\n\n<div class=\"export-grid\">\n\t<div class=\"options-card\">\n\t\t<h2 class=\"card-title\">1. Export Settings</h2>\n\n\t\t<div class=\"option-group\">\n\t\t\t<h3 class=\"option-label\">Data Type</h3>\n\t\t\t<div class=\"format-buttons\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"format-btn\"\n\t\t\t\t\tclass:active={exportDataType === 'trips'}\n\t\t\t\t\ton:click={() => (exportDataType = 'trips')}>Trips</button\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"format-btn\"\n\t\t\t\t\tclass:active={exportDataType === 'expenses'}\n\t\t\t\t\ton:click={() => (exportDataType = 'expenses')}>Expenses</button\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"format-btn full-width\"\n\t\t\t\t\tclass:active={exportDataType === 'tax_bundle'}\n\t\t\t\t\ton:click={() => (exportDataType = 'tax_bundle')}>Tax Bundle (All)</button\n\t\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if exportDataType !== 'tax_bundle'}\n\t\t\t<div class=\"option-group\">\n\t\t\t\t<h3 class=\"option-label\">Format</h3>\n\t\t\t\t<div class=\"format-buttons\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"format-btn\"\n\t\t\t\t\t\tclass:active={exportFormat === 'csv'}\n\t\t\t\t\t\ton:click={() => (exportFormat = 'csv')}>CSV (Excel)</button\n\t\t\t\t\t>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"format-btn\"\n\t\t\t\t\t\tclass:active={exportFormat === 'pdf'}\n\t\t\t\t\t\ton:click={() => (exportFormat = 'pdf')}>PDF (Print)</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"option-group\">\n\t\t\t<h3 class=\"option-label\">Date Range</h3>\n\t\t\t<div class=\"date-inputs\">\n\t\t\t\t<div class=\"date-field\">\n\t\t\t\t\t<label for=\"from\">From</label>\n\t\t\t\t\t<input id=\"from\" type=\"date\" bind:value={dateFrom} />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"date-field\">\n\t\t\t\t\t<label for=\"to\">To</label>\n\t\t\t\t\t<input id=\"to\" type=\"date\" bind:value={dateTo} />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<button\n\t\t\tclass=\"btn-action\"\n\t\t\ton:click={handleExport}\n\t\t\tdisabled={exportDataType !== 'tax_bundle' &&\n\t\t\t\t(exportDataType === 'trips' ? selectedTrips.size === 0 : selectedExpenses.size === 0)}\n\t\t\ttitle={!isPro ? 'Upgrade to Export' : 'Export Data'}\n\t\t>\n\t\t\t{#if !isPro}🔒{/if}\n\t\t\t{#if exportDataType === 'tax_bundle'}\n\t\t\t\tDownload Tax Package\n\t\t\t{:else}\n\t\t\t\tExport {exportDataType === 'trips' ? selectedTrips.size : selectedExpenses.size} Item{selectedTrips.size !==\n\t\t\t\t\t1 && selectedExpenses.size !== 1\n\t\t\t\t\t? 's'\n\t\t\t\t\t: ''}\n\t\t\t{/if}\n\t\t</button>\n\t</div>\n\n\t<div class=\"selection-card\">\n\t\t<div class=\"selection-header\">\n\t\t\t<h2 class=\"card-title\">\n\t\t\t\t{#if exportDataType === 'tax_bundle'}\n\t\t\t\t\t2. Review Summary\n\t\t\t\t{:else}\n\t\t\t\t\t2. Select {exportDataType === 'trips' ? 'Trips' : 'Expenses'}\n\t\t\t\t{/if}\n\t\t\t</h2>\n\t\t\t{#if exportDataType !== 'tax_bundle'}\n\t\t\t\t<button class=\"btn-text\" on:click={toggleSelectAll}\n\t\t\t\t\t>{selectAll ? 'Deselect All' : 'Select All'}</button\n\t\t\t\t>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"trips-list\">\n\t\t\t{#if exportDataType === 'tax_bundle'}\n\t\t\t\t<div class=\"summary-preview\">\n\t\t\t\t\t<div class=\"summary-stat\">\n\t\t\t\t\t\t<span class=\"label\">Total Miles</span>\n\t\t\t\t\t\t<span class=\"value\"\n\t\t\t\t\t\t\t>{filteredTrips.reduce((s, t) => s + (t.totalMiles || 0), 0).toFixed(1)}</span\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"summary-stat\">\n\t\t\t\t\t\t<span class=\"label\">Total Expenses</span>\n\t\t\t\t\t\t<span class=\"value\"\n\t\t\t\t\t\t\t>${filteredExpenses.reduce((s, e) => s + (e.amount || 0), 0).toFixed(2)}</span\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"summary-note\">\n\t\t\t\t\t\tIncludes {filteredTrips.length} trips and {filteredExpenses.length} expense records.\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{:else if exportDataType === 'trips'}\n\t\t\t\t{#if filteredTrips.length > 0}\n\t\t\t\t\t{#each filteredTrips as trip (trip.id)}\n\t\t\t\t\t\t<label class=\"trip-item\" class:selected={selectedTrips.has(trip.id)}>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tchecked={selectedTrips.has(trip.id)}\n\t\t\t\t\t\t\t\ton:change={() => toggleTrip(trip.id)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div class=\"trip-content\">\n\t\t\t\t\t\t\t\t<div class=\"trip-top\">\n\t\t\t\t\t\t\t\t\t<span class=\"trip-date\">{formatDate(trip.date || '')}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"trip-miles\">{trip.totalMiles?.toFixed(1) || '0'} mi</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"trip-route\">\n\t\t\t\t\t\t\t\t\t{typeof trip.startAddress === 'string'\n\t\t\t\t\t\t\t\t\t\t? trip.startAddress.split(',')[0]\n\t\t\t\t\t\t\t\t\t\t: 'Unknown'} →\n\t\t\t\t\t\t\t\t\t{String(trip.stops?.at(-1)?.address ?? trip.endAddress ?? 'End').split(',')[0]}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t{/each}\n\t\t\t\t{:else}\n\t\t\t\t\t<div class=\"empty-state\">No trips found</div>\n\t\t\t\t{/if}\n\t\t\t{:else if exportDataType === 'expenses'}\n\t\t\t\t{#if filteredExpenses.length > 0}\n\t\t\t\t\t{#each filteredExpenses as expense (expense.id)}\n\t\t\t\t\t\t<label class=\"trip-item\" class:selected={selectedExpenses.has(expense.id)}>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tchecked={selectedExpenses.has(expense.id)}\n\t\t\t\t\t\t\t\ton:change={() => toggleExpense(expense.id)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div class=\"trip-content\">\n\t\t\t\t\t\t\t\t<div class=\"trip-top\">\n\t\t\t\t\t\t\t\t\t<span class=\"trip-date\">{formatDate(expense.date || expense.createdAt)}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"trip-miles\">${expense.amount?.toFixed(2)}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"trip-route\">\n\t\t\t\t\t\t\t\t\t{expense.category || 'General'}\n\t\t\t\t\t\t\t\t\t{#if expense.description}\n\t\t\t\t\t\t\t\t\t\t- {expense.description}{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t{/each}\n\t\t\t\t{:else}\n\t\t\t\t\t<div class=\"empty-state\">No expenses found</div>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n\n<Modal bind:open={isUpgradeModalOpen} title=\"Upgrade to Pro\">\n\t<div class=\"space-y-6 text-center py-4\">\n\t\t<div class=\"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4\">\n\t\t\t<span class=\"text-3xl\">🚀</span>\n\t\t</div>\n\n\t\t<h3 class=\"text-xl font-bold text-gray-900\">Unlock Pro Features</h3>\n\n\t\t<p class=\"text-gray-600 text-base leading-relaxed\">\n\t\t\tData Export is a Pro feature. Upgrade now to download your trip history for taxes!\n\t\t</p>\n\n\t\t<div class=\"bg-gray-50 p-4 rounded-lg text-left text-sm space-y-2 border border-gray-100\">\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Unlimited Stops per Trip</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">One-Click Route Optimization</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Unlimited Monthly Trips</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Data Export</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex gap-3 justify-center pt-2\">\n\t\t\t<Button variant=\"outline\" on:click={() => (isUpgradeModalOpen = false)}>Maybe Later</Button>\n\t\t\t<a\n\t\t\t\thref=\"/dashboard/settings\"\n\t\t\t\tclass=\"inline-flex items-center justify-center rounded-lg bg-orange-600 px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600 transition-all\"\n\t\t\t>\n\t\t\t\tUpgrade Now\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</Modal>\n\n<style>\n\t.export-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr;\n\t\tgap: 24px;\n\t}\n\t.options-card,\n\t.selection-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 20px;\n\t}\n\t.card-title {\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tmargin-bottom: 16px;\n\t\tcolor: #111827;\n\t}\n\t.option-group {\n\t\tmargin-bottom: 24px;\n\t}\n\t.option-label {\n\t\tfont-size: 13px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 8px;\n\t}\n\t.format-buttons {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 12px;\n\t}\n\t.format-btn {\n\t\tpadding: 12px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tbackground: white;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t}\n\t.format-btn.active {\n\t\tborder-color: #ff7f50;\n\t\tcolor: #ff7f50;\n\t\tbackground: #fff5f2;\n\t}\n\t.format-btn.full-width {\n\t\tgrid-column: span 2;\n\t}\n\t.date-inputs {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t}\n\t.date-field {\n\t\tflex: 1;\n\t}\n\t.date-field input {\n\t\twidth: 100%;\n\t\tpadding: 10px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t}\n\t.btn-action {\n\t\twidth: 100%;\n\t\tpadding: 14px;\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 700;\n\t\tcursor: pointer;\n\t}\n\t.btn-action:disabled {\n\t\topacity: 0.5;\n\t}\n\t.selection-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 16px;\n\t}\n\t.btn-text {\n\t\tcolor: #ff7f50;\n\t\tbackground: none;\n\t\tborder: none;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t}\n\t.trips-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t\tmax-height: 400px;\n\t\toverflow-y: auto;\n\t}\n\t.trip-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tbackground: #f9fafb;\n\t\tcursor: pointer;\n\t}\n\t.trip-item.selected {\n\t\tborder-color: #ff7f50;\n\t\tbackground: #fff5f2;\n\t}\n\t.trip-content {\n\t\tflex: 1;\n\t}\n\t.trip-top {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tfont-size: 12px;\n\t\tfont-weight: 600;\n\t}\n\t.empty-state {\n\t\ttext-align: center;\n\t\tcolor: #9ca3af;\n\t\tpadding: 20px;\n\t}\n\n\t.summary-preview {\n\t\tpadding: 16px;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.summary-stat {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 8px;\n\t\tfont-weight: 600;\n\t\tcolor: #111827;\n\t}\n\t.summary-note {\n\t\tmargin-top: 16px;\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t\ttext-align: center;\n\t}\n\n\t@media (min-width: 1024px) {\n\t\t.export-grid {\n\t\t\tgrid-template-columns: 350px 1fr;\n\t\t\talign-items: start;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\data\\ImportView.svelte",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 142,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 142,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 202,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 212,
				"endColumn": 12
			}
		],
		"suppressedMessages": [],
		"errorCount": 2,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { trips } from '$lib/stores/trips';\n\timport { user } from '$lib/stores/auth';\n\timport { localDateISO } from '$lib/utils/dates';\n\tlet importFormat = 'csv';\n\tlet isProcessing = false;\n\tlet previewTrips: any[] = [];\n\n\t// [SECURITY] Validate file content matches expected format (not just extension)\n\tconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\n\n\tfunction validateCSVContent(text: string): boolean {\n\t\t// CSV should have at least a header row and be mostly printable ASCII\n\t\tif (!text || text.length < 5) return false;\n\n\t\t// Check for binary/null bytes that shouldn't be in CSV\n\t\t// Check first 1000 chars for null byte (char code 0)\n\t\tconst sample = text.slice(0, 1000);\n\t\tif (sample.includes('\\0')) return false;\n\n\t\t// Should have at least one line break\n\t\tif (!/\\r?\\n/.test(text)) return false;\n\n\t\t// First line should look like comma-separated values (not binary)\n\t\tconst firstLine = text.split(/\\r?\\n/)[0] || '';\n\t\tif (firstLine.length < 3) return false;\n\n\t\treturn true;\n\t}\n\n\tfunction validatePDFMagicBytes(buffer: ArrayBuffer): boolean {\n\t\t// PDF files start with \"%PDF-\" (magic bytes)\n\t\tconst header = new Uint8Array(buffer.slice(0, 5));\n\t\tconst magic = String.fromCharCode(...header);\n\t\treturn magic === '%PDF-';\n\t}\n\n\tasync function handleFileUpload(e: Event) {\n\t\tconst input = e.target as HTMLInputElement;\n\t\tconst files = input.files;\n\t\tif (!files || files.length === 0) return;\n\n\t\tconst file = files.item(0);\n\t\tif (!file) return;\n\n\t\t// [SECURITY] Validate file size\n\t\tif (file.size > MAX_FILE_SIZE) {\n\t\t\talert('File is too large. Please use a file smaller than 5MB.');\n\t\t\treturn;\n\t\t}\n\n\t\tisProcessing = true;\n\n\t\ttry {\n\t\t\tif (importFormat === 'csv') {\n\t\t\t\tconst text = await file.text();\n\n\t\t\t\t// [SECURITY] Validate CSV content structure\n\t\t\t\tif (!validateCSVContent(text)) {\n\t\t\t\t\talert(\n\t\t\t\t\t\t'The file does not appear to be a valid CSV file. Please ensure you are uploading a CSV file.'\n\t\t\t\t\t);\n\t\t\t\t\tpreviewTrips = [];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tparseCSV(text);\n\t\t\t} else {\n\t\t\t\t// [SECURITY] Validate PDF magic bytes\n\t\t\t\tconst buffer = await file.arrayBuffer();\n\t\t\t\tif (!validatePDFMagicBytes(buffer)) {\n\t\t\t\t\talert(\n\t\t\t\t\t\t'The file does not appear to be a valid PDF file. Please ensure you are uploading a PDF file.'\n\t\t\t\t\t);\n\t\t\t\t\tpreviewTrips = [];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\talert('PDF import is not fully supported yet. Please use CSV for best results.');\n\t\t\t\tpreviewTrips = [];\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error('Parse error:', err);\n\t\t\talert('Failed to parse file.');\n\t\t} finally {\n\t\t\tisProcessing = false;\n\t\t}\n\t}\n\n\tfunction parseCSV(content: string) {\n\t\tconst lines: string[] = content.split(/\\r?\\n/);\n\t\tif (lines.length < 2) return;\n\n\t\tconst parsed: any[] = [];\n\n\t\tconst dataLines = lines.slice(1);\n\t\tfor (const line of dataLines) {\n\t\t\tconst trimmed = (line || '').trim();\n\t\t\tif (!trimmed) continue;\n\n\t\t\tconst row = trimmed\n\t\t\t\t.split(',')\n\t\t\t\t.map((c) => (c ?? '').toString().trim().replace(/\"/g, '')) as string[];\n\n\t\t\tconst dateStr = row[0] ?? '';\n\t\t\tconst milesStr = row[1] ?? '0';\n\t\t\tconst trip: any = {\n\t\t\t\tdate: dateStr ? localDateISO(String(dateStr)) : localDateISO(),\n\t\t\t\ttotalMiles: parseFloat(String(milesStr)) || 0,\n\t\t\t\tstartAddress: row[2] ?? 'Unknown Start',\n\t\t\t\tendAddress: row[3] ?? 'Unknown End',\n\t\t\t\tnotes: 'Imported CSV',\n\t\t\t\tstartTime: '09:00',\n\t\t\t\tendTime: '17:00',\n\t\t\t\tmpg: 25,\n\t\t\t\tgasPrice: 3.5,\n\t\t\t\tstops: []\n\t\t\t};\n\n\t\t\tparsed.push(trip);\n\t\t}\n\t\tpreviewTrips = parsed;\n\t}\n\n\tasync function saveTrips() {\n\t\tif (previewTrips.length === 0) return;\n\n\t\t// [!code fix] Strictly use ID. Prevents usage of legacy username.\n\t\tconst userId = $user?.id || localStorage.getItem('offline_user_id');\n\n\t\tif (!userId) {\n\t\t\talert('You must be logged in to import trips.');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tfor (const trip of previewTrips) {\n\t\t\t\tawait trips.create(trip, userId);\n\t\t\t}\n\t\t\talert(`Successfully imported ${previewTrips.length} trips!`);\n\t\t\tpreviewTrips = [];\n\t\t} catch (e) {\n\t\t\talert('Error saving trips.');\n\t\t}\n\t}\n</script>\n\n<div class=\"import-grid\">\n\t<div class=\"options-card\">\n\t\t<h2 class=\"card-title\">1. Import Settings</h2>\n\n\t\t<div class=\"option-group spacing-large\">\n\t\t\t<h3 class=\"option-label\">Format</h3>\n\t\t\t<div class=\"format-buttons\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"format-btn\"\n\t\t\t\t\tclass:active={importFormat === 'csv'}\n\t\t\t\t\ton:click={() => (importFormat = 'csv')}\n\t\t\t\t>\n\t\t\t\t\tCSV (Excel)\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"format-btn\"\n\t\t\t\t\tclass:active={importFormat === 'pdf'}\n\t\t\t\t\ton:click={() => (importFormat = 'pdf')}\n\t\t\t\t>\n\t\t\t\t\tPDF (Document)\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"option-group\">\n\t\t\t<h3 class=\"option-label\">Select File</h3>\n\t\t\t<div class=\"file-drop-area\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\taccept={importFormat === 'csv' ? '.csv' : '.pdf'}\n\t\t\t\t\ton:change={handleFileUpload}\n\t\t\t\t\tdisabled={isProcessing}\n\t\t\t\t/>\n\t\t\t\t<div class=\"file-placeholder\">\n\t\t\t\t\t{#if isProcessing}\n\t\t\t\t\t\t<span>Processing...</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<span>Click to upload <b>.{importFormat.toUpperCase()}</b> file</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"selection-card\">\n\t\t<div class=\"selection-header\">\n\t\t\t<h2 class=\"card-title\">2. Preview</h2>\n\t\t\t{#if previewTrips.length > 0}\n\t\t\t\t<button class=\"btn-text\" on:click={saveTrips}>Save All</button>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t{#if previewTrips.length > 0}\n\t\t\t<div class=\"trips-list\">\n\t\t\t\t{#each previewTrips as trip}\n\t\t\t\t\t<div class=\"trip-item\">\n\t\t\t\t\t\t<div class=\"trip-content\">\n\t\t\t\t\t\t\t<div class=\"trip-top\">\n\t\t\t\t\t\t\t\t<span>{trip.date}</span>\n\t\t\t\t\t\t\t\t<span>{trip.totalMiles} mi</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"trip-route\">{trip.startAddress} → {trip.endAddress}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t<button class=\"btn-import-action\" on:click={saveTrips}>\n\t\t\t\tImport {previewTrips.length} Trips\n\t\t\t</button>\n\t\t{:else}\n\t\t\t<div class=\"empty-state\">Upload a file to preview trips</div>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t.import-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr;\n\t\tgap: 24px;\n\t}\n\t.options-card,\n\t.selection-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 20px;\n\t}\n\t.card-title {\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tmargin-bottom: 16px;\n\t\tcolor: #111827;\n\t}\n\n\t.option-group {\n\t\tmargin-bottom: 24px;\n\t}\n\t.spacing-large {\n\t\tmargin-bottom: 48px;\n\t}\n\n\t.option-label {\n\t\tfont-size: 13px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.format-buttons {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 12px;\n\t}\n\t.format-btn {\n\t\tpadding: 12px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tbackground: white;\n\t\tfont-weight: 600;\n\t\tfont-size: 13px;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\t.format-btn.active {\n\t\tborder-color: #29abe2;\n\t\tcolor: #29abe2;\n\t\tbackground: #f0f9ff;\n\t}\n\n\t.file-drop-area {\n\t\tposition: relative;\n\t\tborder: 2px dashed #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tpadding: 32px;\n\t\ttext-align: center;\n\t\tbackground: #f9fafb;\n\t\ttransition: all 0.2s;\n\t}\n\t.file-drop-area:hover {\n\t\tborder-color: #29abe2;\n\t\tbackground: #f0f9ff;\n\t}\n\t.file-drop-area input {\n\t\tposition: absolute;\n\t\tinset: 0;\n\t\topacity: 0;\n\t\tcursor: pointer;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t.file-placeholder {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tfont-weight: 500;\n\t}\n\t.file-placeholder b {\n\t\tcolor: #29abe2;\n\t}\n\n\t.selection-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 16px;\n\t}\n\t.btn-text {\n\t\tcolor: #29abe2;\n\t\tbackground: none;\n\t\tborder: none;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t}\n\n\t.trips-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t\tmax-height: 400px;\n\t\toverflow-y: auto;\n\t\tmargin-bottom: 16px;\n\t}\n\t.trip-item {\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tbackground: #f9fafb;\n\t}\n\t.trip-top {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tfont-weight: 600;\n\t\tmargin-bottom: 4px;\n\t\tfont-size: 13px;\n\t\tcolor: #111827;\n\t}\n\t.trip-route {\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t/* MATCHED STYLE: Updated to Orange Gradient */\n\t.btn-import-action {\n\t\twidth: 100%;\n\t\tpadding: 14px;\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 700;\n\t\tcursor: pointer;\n\t\tfont-size: 15px;\n\t\tbox-shadow: 0 4px 12px rgba(255, 127, 80, 0.3);\n\t}\n\n\t.btn-import-action:hover {\n\t\ttransform: translateY(-2px);\n\t\tbox-shadow: 0 6px 16px rgba(255, 127, 80, 0.4);\n\t}\n\n\t.empty-state {\n\t\ttext-align: center;\n\t\tcolor: #9ca3af;\n\t\tpadding: 20px;\n\t\tfont-size: 14px;\n\t}\n\n\t@media (min-width: 1024px) {\n\t\t.import-grid {\n\t\t\tgrid-template-columns: 350px 1fr;\n\t\t\talign-items: start;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\hughesnet\\ArchivedRestore.svelte",
		"messages": [
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 128,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 147,
				"endColumn": 12
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { createEventDispatcher } from 'svelte';\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport Button from '$lib/components/ui/Button.svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\tlet loading = false;\n\tlet orders: Array<any> = [];\n\tlet selected: string[] = [];\n\tlet error: string | null = null;\n\tlet successMsg: string | null = null;\n\n\tasync function load() {\n\t\tloading = true;\n\t\terror = null;\n\t\ttry {\n\t\t\tconst res = await fetch('/api/hughesnet/archived');\n\t\t\tconst body: any = await res.json();\n\t\t\tif (body.success) orders = body.orders;\n\t\t\telse error = body.error || 'Failed to load archived orders';\n\t\t} catch (e: any) {\n\t\t\terror = e.message || 'Network error';\n\t\t}\n\t\tloading = false;\n\t}\n\n\tonMount(load);\n\n\tfunction toggle(id: string) {\n\t\tconsole.log('[ArchivedRestore] toggle', id);\n\t\tconst idx = selected.indexOf(id);\n\t\tif (idx >= 0) {\n\t\t\tselected = [...selected.slice(0, idx), ...selected.slice(idx + 1)];\n\t\t} else {\n\t\t\tselected = [...selected, id];\n\t\t}\n\t}\n\n\tfunction selectAll() {\n\t\tconsole.log('[ArchivedRestore] selectAll before:', selected.length, 'orders:', orders.length);\n\t\tif (selected.length === orders.length) selected = [];\n\t\telse selected = orders.map((o) => o.id);\n\t\tconsole.log('[ArchivedRestore] selectAll after:', selected.length);\n\t}\n\n\t// Modal control\n\tlet showConfirm = false;\n\tlet confirmAction: 'restore' | 'restore_sync' = 'restore';\n\n\tfunction openConfirm() {\n\t\tshowConfirm = true;\n\t\tconfirmAction = 'restore';\n\t}\n\n\tfunction closeConfirm() {\n\t\tshowConfirm = false;\n\t}\n\n\tasync function confirmRestore() {\n\t\tif (selected.length === 0) {\n\t\t\tcloseConfirm();\n\t\t\treturn;\n\t\t}\n\t\tloading = true;\n\t\tsuccessMsg = null;\n\t\terror = null;\n\t\ttry {\n\t\t\tconst res = await fetch('/api/hughesnet/archived/import', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ ids: Array.from(selected) })\n\t\t\t});\n\t\t\tconst body: any = await res.json();\n\t\t\tif (body.success) {\n\t\t\t\tsuccessMsg = `Imported ${body.imported.length} orders. ${body.skipped.length} skipped.`;\n\t\t\t\t// Notify parent about imported ids and dates\n\t\t\t\tdispatch('restored', { imported: body.imported, importedDates: body.importedDates || [] });\n\t\t\t\tif (\n\t\t\t\t\tconfirmAction === 'restore_sync' &&\n\t\t\t\t\tbody.importedDates &&\n\t\t\t\t\tbody.importedDates.length > 0\n\t\t\t\t) {\n\t\t\t\t\tdispatch('restoreAndSync', { dates: body.importedDates });\n\t\t\t\t}\n\t\t\t\tawait load();\n\t\t\t\tselected = [];\n\t\t\t\tcloseConfirm();\n\t\t\t} else {\n\t\t\t\terror = body.error || 'Import failed';\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\terror = e.message || 'Network error';\n\t\t}\n\t\tloading = false;\n\t}\n</script>\n\n<div class=\"archive-card\">\n\t<h3 class=\"title\">Archived Orders</h3>\n\t{#if loading}\n\t\t<p>Loading...</p>\n\t{:else}\n\t\t{#if error}\n\t\t\t<div class=\"error\">{error}</div>\n\t\t{/if}\n\t\t{#if successMsg}\n\t\t\t<div class=\"success\">{successMsg}</div>\n\t\t{/if}\n\n\t\t{#if orders.length === 0}\n\t\t\t<p>No archived orders found.</p>\n\t\t{:else}\n\t\t\t<div class=\"controls\">\n\t\t\t\t<button type=\"button\" class=\"btn-small\" on:click={selectAll}\n\t\t\t\t\t>{selected.length === orders.length ? 'Unselect All' : 'Select All'}</button\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"btn-primary\"\n\t\t\t\t\tdisabled={selected.length === 0}\n\t\t\t\t\ton:click={openConfirm}>Restore Selected</button\n\t\t\t\t>\n\t\t\t</div>\n\n\t\t\t<ul class=\"list\">\n\t\t\t\t{#each orders as o}\n\t\t\t\t\t<li class=\"item\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\tchecked={selected.includes(o.id)}\n\t\t\t\t\t\t\ton:change={() => toggle(o.id)}\n\t\t\t\t\t\t\taria-label={`Select order ${o.id}`}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"meta\">\n\t\t\t\t\t\t\t<div class=\"addr\">{o.order.address || 'No address'}</div>\n\t\t\t\t\t\t\t<div class=\"info\">\n\t\t\t\t\t\t\t\tID: {o.id}\n\t\t\t\t\t\t\t\t{#if o.order.confirmScheduleDate}\n\t\t\t\t\t\t\t\t\t· Order Date: {o.order.confirmScheduleDate}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t· Stored: {new Date(o.storedAt).toLocaleString()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t{/each}\n\t\t\t</ul>\n\n\t\t\t{#if showConfirm}\n\t\t\t\t<Modal bind:open={showConfirm} title={`Restore ${selected.length} archived order(s)?`}>\n\t\t\t\t\t<div class=\"space-y-3\">\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tWould you like to just restore them, or restore and run a HughesNet sync now to create\n\t\t\t\t\t\t\ttrips for those dates?\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<div class=\"modal-actions\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tconfirmAction = 'restore';\n\t\t\t\t\t\t\t\t\tconfirmRestore();\n\t\t\t\t\t\t\t\t}}>Restore Only</Button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tconfirmAction = 'restore_sync';\n\t\t\t\t\t\t\t\t\tconfirmRestore();\n\t\t\t\t\t\t\t\t}}>Restore & Sync Now</Button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Button variant=\"secondary\" on:click={closeConfirm}>Cancel</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#if confirmAction === 'restore_sync'}\n\t\t\t\t\t\t\t<p class=\"help\">\n\t\t\t\t\t\t\t\t⚠️ Restoring and syncing will create trips for the imported dates and may overwrite\n\t\t\t\t\t\t\t\texisting trips for those dates.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</Modal>\n\t\t\t{/if}\n\t\t{/if}\n\t{/if}\n</div>\n\n<style>\n\t.archive-card {\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tbackground: white;\n\t}\n\t.title {\n\t\tfont-weight: 700;\n\t\tmargin-bottom: 8px;\n\t}\n\t.controls {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\tmargin-bottom: 8px;\n\t}\n\t.controls button {\n\t\tpointer-events: auto;\n\t}\n\t.btn-primary {\n\t\tpadding: 6px 10px;\n\t\tbackground: #f97316;\n\t\tcolor: white;\n\t\tborder-radius: 8px;\n\t}\n\t.btn-small {\n\t\tpadding: 6px 10px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t}\n\t.list {\n\t\tlist-style: none;\n\t\tpadding: 0;\n\t\tmargin: 0;\n\t\tmax-height: 240px;\n\t\toverflow: auto;\n\t}\n\t.item {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n\t\tpadding: 8px 0;\n\t\tborder-bottom: 1px solid #f3f4f6;\n\t}\n\t.meta {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t.addr {\n\t\tfont-weight: 600;\n\t}\n\t.info {\n\t\tcolor: #6b7280;\n\t\tfont-size: 12px;\n\t}\n\t.success {\n\t\tbackground: #ecfdf5;\n\t\tborder: 1px solid #bbf7d0;\n\t\tpadding: 8px;\n\t\tborder-radius: 8px;\n\t\tmargin-bottom: 8px;\n\t}\n\t.error {\n\t\tbackground: #fef2f2;\n\t\tborder: 1px solid #fecaca;\n\t\tpadding: 8px;\n\t\tborder-radius: 8px;\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.help {\n\t\tmargin-top: 8px;\n\t\tcolor: #92400e;\n\t\tfont-size: 13px;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\hughesnet\\ConfigForm.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\hughesnet\\ConnectionStatus.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\hughesnet\\DebugConsole.svelte",
		"messages": [
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 24,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 31,
				"endColumn": 11
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { slide } from 'svelte/transition';\n\texport let logs: string[] = [];\n\texport let showConsole = false;\n</script>\n\n<div class=\"settings-card full-width bg-dark\">\n\t<div\n\t\tclass=\"console-header\"\n\t\ton:click={() => (showConsole = !showConsole)}\n\t\ton:keydown={() => {}}\n\t\trole=\"button\"\n\t\ttabindex=\"0\"\n\t>\n\t\t<div class=\"flex items-center gap-2\">\n\t\t\t<span>Debug Console</span>\n\t\t\t<span class=\"console-count\">({logs.length})</span>\n\t\t</div>\n\t\t<span class=\"toggle-icon\" class:rotated={showConsole}>▶</span>\n\t</div>\n\n\t{#if showConsole}\n\t\t<div class=\"console-body\" transition:slide>\n\t\t\t{#each logs as log}\n\t\t\t\t<div class=\"log-line\">\n\t\t\t\t\t<span class=\"log-time\"\n\t\t\t\t\t\t>{log.includes('[') ? '' : '[' + new Date().toLocaleTimeString() + ']'}</span\n\t\t\t\t\t>\n\t\t\t\t\t<span class=\"log-msg\" class:server={log.includes('[Server]')}>{log}</span>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t\t{#if logs.length === 0}\n\t\t\t\t<div class=\"log-line muted\">System ready...</div>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t.settings-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 24px;\n\t}\n\t.settings-card.full-width {\n\t\tgrid-column: span 2;\n\t}\n\t.bg-dark {\n\t\tbackground: #111827;\n\t\tborder-color: #374151;\n\t\tpadding: 0;\n\t\toverflow: hidden;\n\t}\n\n\t.console-header {\n\t\tbackground: #1f2937;\n\t\tpadding: 12px 24px;\n\t\tcolor: #9ca3af;\n\t\tfont-size: 12px;\n\t\tfont-weight: 700;\n\t\ttext-transform: uppercase;\n\t\tborder-bottom: 1px solid #374151;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tcursor: pointer;\n\t\tuser-select: none;\n\t}\n\t.console-header:hover {\n\t\tcolor: #e5e7eb;\n\t\tbackground: #374151;\n\t}\n\t.console-count {\n\t\tcolor: #6b7280;\n\t\tfont-weight: 400;\n\t\tfont-size: 11px;\n\t\tmargin-left: 4px;\n\t}\n\t.toggle-icon {\n\t\ttransition: transform 0.2s;\n\t\tfont-size: 10px;\n\t}\n\t.toggle-icon.rotated {\n\t\ttransform: rotate(90deg);\n\t}\n\n\t.console-body {\n\t\tpadding: 16px 24px;\n\t\theight: 200px;\n\t\toverflow-y: auto;\n\t\tfont-family: monospace;\n\t\tfont-size: 12px;\n\t\tdisplay: flex;\n\t\tflex-direction: column-reverse;\n\t\tborder-top: 1px solid #374151;\n\t}\n\t.log-line {\n\t\tmargin-bottom: 6px;\n\t}\n\t.log-time {\n\t\tcolor: #6b7280;\n\t\tmargin-right: 8px;\n\t}\n\t.log-msg {\n\t\tcolor: #34d399;\n\t}\n\t.log-msg.server {\n\t\tcolor: #60a5fa;\n\t}\n\t.log-line.muted {\n\t\tcolor: #4b5563;\n\t\tfont-style: italic;\n\t}\n\n\t@media (max-width: 768px) {\n\t\t.settings-card.full-width {\n\t\t\tgrid-column: span 1;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\hughesnet\\OrderList.svelte",
		"messages": [
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 29,
				"column": 3,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 55,
				"endColumn": 10
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\texport let orders: any[] = [];\n</script>\n\n<div class=\"settings-card full-width\">\n\t<div class=\"card-header\">\n\t\t<div class=\"card-icon navy\">\n\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t<path\n\t\t\t\t\td=\"M17 2H3C2.46957 2 1.96086 2.21071 1.58579 2.58579C1.21071 2.96086 1 3.46957 1 4V16C1 16.5304 1.21071 17.0391 1.58579 17.4142C1.96086 17.7893 2.46957 18 3 18H17C17.5304 18 18.0391 17.7893 18.4142 17.4142C18.7893 17.0391 19 16.5304 19 16V4C19 3.46957 18.7893 2.96086 18.4142 2.58579C18.0391 2.21071 17.5304 2 17 2Z\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td=\"M1 8H19M6 1V3M14 1V3\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div>\n\t\t\t<h2 class=\"card-title\">Cached Orders</h2>\n\t\t\t<p class=\"card-subtitle\">Orders currently stored in your session</p>\n\t\t</div>\n\t</div>\n\n\t<div class=\"orders-list\">\n\t\t{#each orders as order}\n\t\t\t<div class=\"order-item\">\n\t\t\t\t<div class=\"order-main\">\n\t\t\t\t\t<span class=\"order-id\">#{order.id}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"order-badge {order.type === 'Install'\n\t\t\t\t\t\t\t? 'blue'\n\t\t\t\t\t\t\t: order.type === 'Upgrade'\n\t\t\t\t\t\t\t\t? 'green'\n\t\t\t\t\t\t\t\t: 'purple'}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{order.type || 'Unknown'}\n\t\t\t\t\t</span>\n\t\t\t\t\t{#if order.hasPoleMount}\n\t\t\t\t\t\t<span class=\"order-badge pole\">Pole</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"order-details\">\n\t\t\t\t\t<div class=\"order-addr\">{order.address}</div>\n\t\t\t\t\t<div class=\"order-meta\">{order.city}, {order.state}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"order-time\">\n\t\t\t\t\t<div class=\"date\">{order.confirmScheduleDate}</div>\n\t\t\t\t\t<div class=\"time\">{order.beginTime}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/each}\n\t</div>\n</div>\n\n<style>\n\t.settings-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 24px;\n\t}\n\t.settings-card.full-width {\n\t\tgrid-column: span 2;\n\t}\n\t.card-header {\n\t\tdisplay: flex;\n\t\tgap: 16px;\n\t\tmargin-bottom: 24px;\n\t\tpadding-bottom: 20px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t}\n\t.card-icon {\n\t\twidth: 48px;\n\t\theight: 48px;\n\t\tborder-radius: 12px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcolor: white;\n\t\tflex-shrink: 0;\n\t}\n\t.card-icon.navy {\n\t\tbackground: linear-gradient(135deg, #111827 0%, #1a3a5c 100%);\n\t}\n\t.card-title {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t}\n\t.card-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.orders-list {\n\t\tdisplay: grid;\n\t\tgap: 12px;\n\t\tmax-height: 400px;\n\t\toverflow-y: auto;\n\t}\n\t.order-item {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 12px 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tbackground: #f9fafb;\n\t}\n\t.order-main {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 10px;\n\t}\n\t.order-id {\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t}\n\t.order-badge {\n\t\tpadding: 2px 8px;\n\t\tborder-radius: 12px;\n\t\tfont-size: 11px;\n\t\tfont-weight: 700;\n\t\ttext-transform: uppercase;\n\t}\n\t.order-badge.blue {\n\t\tbackground: #dbeafe;\n\t\tcolor: #1e40af;\n\t}\n\t.order-badge.purple {\n\t\tbackground: #f3e8ff;\n\t\tcolor: #6b21a8;\n\t}\n\t.order-badge.green {\n\t\tbackground: #dcfce7;\n\t\tcolor: #15803d;\n\t}\n\t.order-badge.pole {\n\t\tbackground: #fee2e2;\n\t\tcolor: #991b1b;\n\t\tborder: 1px solid #fca5a5;\n\t}\n\t.order-details {\n\t\tflex: 1;\n\t\tmargin: 0 16px;\n\t}\n\t.order-addr {\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tfont-weight: 500;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t.order-meta {\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t}\n\t.order-time {\n\t\ttext-align: right;\n\t}\n\t.date {\n\t\tfont-weight: 700;\n\t\tcolor: #059669;\n\t\tfont-size: 13px;\n\t}\n\t.time {\n\t\tcolor: #6b7280;\n\t\tfont-size: 12px;\n\t}\n\n\t@media (max-width: 768px) {\n\t\t.settings-card.full-width {\n\t\t\tgrid-column: span 1;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\layout\\Footer.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 18,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 18,
				"endColumn": 33
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 19,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 19,
				"endColumn": 31
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 20,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 20,
				"endColumn": 33
			}
		],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 3,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { base } from '$app/paths';\n\tconst resolve = (href: string) => `${base}${href}`;\n\n\tconst { class: className = '' } = $props();\n</script>\n\n<footer\n\tclass=\"w-full border-t border-neutral-border bg-neutral-bg-secondary mt-10 {className}\"\n\tstyle=\"padding-bottom: calc(env(safe-area-inset-bottom, 20px) + 12px);\"\n>\n\t<div\n\t\tclass=\"max-w-7xl mx-auto px-4 py-6 text-neutral-secondary text-sm flex flex-col tablet:flex-row justify-between items-center gap-4\"\n\t>\n\t\t<p>© {new Date().getFullYear()} Go Route Yourself</p>\n\n\t\t<nav class=\"flex gap-6\">\n\t\t\t<a href={resolve('/privacy')} class=\"hover:text-primary-green\">Privacy</a>\n\t\t\t<a href={resolve('/terms')} class=\"hover:text-primary-green\">Terms</a>\n\t\t\t<a href={resolve('/support')} class=\"hover:text-primary-green\">Support</a>\n\t\t</nav>\n\t</div>\n</footer>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\layout\\Header.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 21,
				"column": 8,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 21,
				"endColumn": 20
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 43,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 43,
				"endColumn": 26
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 61,
				"column": 6,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 63,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 62,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 62,
				"endColumn": 35
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 70,
				"column": 6,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 72,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 71,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 71,
				"endColumn": 35
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 74,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 74,
				"endColumn": 33
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 75,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 75,
				"endColumn": 36
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 81,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 81,
				"endColumn": 33
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 109,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 111,
				"endColumn": 12
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 110,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 110,
				"endColumn": 34
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 121,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 123,
				"endColumn": 12
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 122,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 122,
				"endColumn": 34
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 125,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 125,
				"endColumn": 35
			}
		],
		"suppressedMessages": [],
		"errorCount": 4,
		"fatalErrorCount": 0,
		"warningCount": 10,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { goto } from '$app/navigation';\n\timport { base } from '$app/paths';\n\timport { getUserState } from '$lib/stores/user.svelte';\n\timport SyncIndicator from '$lib/components/SyncIndicator.svelte';\n\n\tconst resolve = (href: string) => `${base}${href}`;\n\n\t// Get reactive state\n\tconst userState = getUserState();\n\n\tlet isMobileMenuOpen = $state(false);\n\n\tfunction toggleMenu() {\n\t\tisMobileMenuOpen = !isMobileMenuOpen;\n\t}\n\n\tasync function logout() {\n\t\tawait fetch('/api/logout', { method: 'POST' });\n\t\tuserState.logout();\n\t\tgoto(resolve('/'));\n\t}\n\n\t// Links for the public site (Logged Out)\n\tconst publicLinks = [\n\t\t{ name: 'Features', href: '/#features' },\n\t\t{ name: 'Pricing', href: '/#pricing' },\n\t\t{ name: 'How It Works', href: '/#how-it-works' },\n\t\t{ name: 'Docs', href: '/docs' }\n\t];\n\n\t// Links for the app (Logged In)\n\tconst appLinks = [\n\t\t{ name: 'Dashboard', href: '/dashboard' },\n\t\t{ name: 'Trips', href: '/dashboard/trips' },\n\t\t{ name: 'Settings', href: '/dashboard/settings' }\n\t];\n</script>\n\n<header class=\"header\">\n\t<div class=\"container\">\n\t\t<div class=\"header-content\">\n\t\t\t<a href={resolve('/')} class=\"logo-link\">\n\t\t\t\t<picture>\n\t\t\t\t\t<source type=\"image/avif\" srcset=\"/180x75.avif 180w\" sizes=\"64px\" />\n\t\t\t\t\t<source type=\"image/webp\" srcset=\"/180x75.avif 180w\" sizes=\"64px\" />\n\t\t\t\t\t<img\n\t\t\t\t\t\tsrc=\"/180x75.avif\"\n\t\t\t\t\t\talt=\"Go Route Yourself\"\n\t\t\t\t\t\tclass=\"logo\"\n\t\t\t\t\t\twidth=\"180\"\n\t\t\t\t\t\theight=\"75\"\n\t\t\t\t\t\tsrcset=\"/180x75.avif 1x, /180x75.avif 2x\"\n\t\t\t\t\t\tdecoding=\"async\"\n\t\t\t\t\t/>\n\t\t\t\t</picture>\n\t\t\t</a>\n\n\t\t\t<nav class=\"nav desktop-nav\">\n\t\t\t\t{#if userState.value}\n\t\t\t\t\t{#each appLinks as link}\n\t\t\t\t\t\t<a href={resolve(link.href)} class=\"nav-link\">{link.name}</a>\n\t\t\t\t\t{/each}\n\n\t\t\t\t\t<div class=\"separator\"></div>\n\n\t\t\t\t\t<SyncIndicator />\n\t\t\t\t\t<button onclick={logout} class=\"btn-login\">Logout</button>\n\t\t\t\t{:else}\n\t\t\t\t\t{#each publicLinks as link}\n\t\t\t\t\t\t<a href={resolve(link.href)} class=\"nav-link\">{link.name}</a>\n\t\t\t\t\t{/each}\n\n\t\t\t\t\t<a href={resolve('/login')} class=\"btn-login\">Sign In</a>\n\t\t\t\t\t<a href={resolve('/register')} class=\"btn-primary\">Get Started Free</a>\n\t\t\t\t{/if}\n\t\t\t</nav>\n\n\t\t\t<div class=\"mobile-nav-controls\">\n\t\t\t\t{#if !userState.value}\n\t\t\t\t\t<a href={resolve('/login')} class=\"mobile-signin\">Sign In</a>\n\t\t\t\t{/if}\n\n\t\t\t\t<button class=\"hamburger-btn\" onclick={toggleMenu} aria-label=\"Toggle menu\">\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"24\"\n\t\t\t\t\t\theight=\"24\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if isMobileMenuOpen}\n\t\t\t\t\t\t\t<path d=\"M18 6L6 18M6 6L18 18\"></path>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<path d=\"M3 12h18M3 6h18M3 18h18\"></path>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t{#if isMobileMenuOpen}\n\t\t<div class=\"mobile-menu\">\n\t\t\t{#if userState.value}\n\t\t\t\t{#each appLinks as link}\n\t\t\t\t\t<a href={resolve(link.href)} class=\"mobile-link\" onclick={toggleMenu}>{link.name}</a>\n\t\t\t\t{/each}\n\t\t\t\t<div class=\"divider\"></div>\n\t\t\t\t<button\n\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\tlogout();\n\t\t\t\t\t\ttoggleMenu();\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"mobile-link text-red\">Logout</button\n\t\t\t\t>\n\t\t\t{:else}\n\t\t\t\t{#each publicLinks as link}\n\t\t\t\t\t<a href={resolve(link.href)} class=\"mobile-link\" onclick={toggleMenu}>{link.name}</a>\n\t\t\t\t{/each}\n\t\t\t\t<div class=\"divider\"></div>\n\t\t\t\t<a href={resolve('/register')} class=\"btn-primary mobile-btn\" onclick={toggleMenu}\n\t\t\t\t\t>Get Started Free</a\n\t\t\t\t>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n</header>\n\n<style>\n\t/* Match variables from the main page */\n\t:root {\n\t\t--orange: #ff7f50;\n\t\t--navy: #2c4a6e;\n\t\t--gray-100: #f3f4f6;\n\t\t--gray-600: #4b5563;\n\t\t--gray-900: #111827;\n\t}\n\n\t.header {\n\t\tposition: sticky;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbackground: white;\n\t\tborder-bottom: 1px solid var(--gray-100);\n\t\tz-index: 1000;\n\t\tpadding: 16px 0;\n\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n\t}\n\n\t.container {\n\t\tmax-width: 1200px;\n\t\tmargin: 0 auto;\n\t\tpadding: 0 20px;\n\t}\n\n\t.header-content {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t}\n\n\t.logo {\n\t\theight: 100%;\n\t\twidth: 100%;\n\t\tobject-fit: contain;\n\t}\n\n\t.logo-link {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n\n\t/* Desktop Nav */\n\t.desktop-nav {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 24px;\n\t}\n\n\t.nav-link {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcolor: var(--gray-600);\n\t\tfont-size: 16px;\n\t\tcursor: pointer;\n\t\ttext-decoration: none;\n\t\ttransition: color 0.2s;\n\t\tfont-weight: 500;\n\t}\n\n\t.nav-link:hover {\n\t\tcolor: var(--orange);\n\t}\n\n\t.btn-login {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcolor: var(--gray-600);\n\t\ttext-decoration: none;\n\t\tfont-weight: 500;\n\t\tfont-size: 16px;\n\t\tcursor: pointer;\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\theight: 44px;\n\t\tpadding: 0 8px;\n\t}\n\n\t.btn-login:hover {\n\t\tcolor: var(--navy);\n\t}\n\n\t.btn-primary {\n\t\tbackground: var(--orange);\n\t\tcolor: white;\n\t\tpadding: 10px 24px;\n\t\tborder-radius: 8px;\n\t\ttext-decoration: none;\n\t\tfont-weight: 600;\n\t\ttransition: transform 0.2s;\n\t}\n\n\t.btn-primary:hover {\n\t\ttransform: translateY(-2px);\n\t}\n\n\t.separator {\n\t\twidth: 1px;\n\t\theight: 24px;\n\t\tbackground-color: var(--gray-100);\n\t}\n\n\t/* Mobile Controls */\n\t.mobile-nav-controls {\n\t\tdisplay: none;\n\t\talign-items: center;\n\t\tgap: 16px;\n\t}\n\n\t.mobile-signin {\n\t\ttext-decoration: none;\n\t\tcolor: var(--navy);\n\t\tfont-weight: 600;\n\t\tfont-size: 15px;\n\t}\n\n\t.hamburger-btn {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t\tcolor: var(--gray-600);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 4px;\n\t}\n\n\t/* Mobile Menu */\n\t.mobile-menu {\n\t\tposition: absolute;\n\t\ttop: 100%;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\tbackground: white;\n\t\tborder-bottom: 1px solid var(--gray-100);\n\t\tpadding: 16px;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t\tbox-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n\t}\n\n\t.mobile-link {\n\t\tbackground: none;\n\t\tborder: none;\n\t\ttext-align: left;\n\t\tfont-size: 16px;\n\t\tcolor: var(--gray-600);\n\t\tpadding: 8px 0;\n\t\tcursor: pointer;\n\t\ttext-decoration: none;\n\t}\n\n\t.mobile-link.text-red {\n\t\tcolor: #dc2626;\n\t}\n\n\t.divider {\n\t\theight: 1px;\n\t\tbackground: var(--gray-100);\n\t\tmargin: 4px 0;\n\t}\n\n\t.mobile-btn {\n\t\ttext-align: center;\n\t\tdisplay: block;\n\t}\n\n\t@media (max-width: 768px) {\n\t\t.desktop-nav {\n\t\t\tdisplay: none;\n\t\t}\n\t\t.mobile-nav-controls {\n\t\t\tdisplay: flex;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\trip\\DestinationList.svelte",
		"messages": [
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 84,
				"column": 2,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 126,
				"endColumn": 9
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport type { Destination, GeocodeResult } from '$lib/types';\n\timport { autocomplete } from '$lib/utils/autocomplete';\n\timport { createEventDispatcher } from 'svelte';\n\n\texport let destinations: Destination[] = [{ address: '', earnings: 0 }];\n\texport let apiKey: string = '';\n\n\tconst dispatch = createEventDispatcher();\n\tfunction handlePlaceSelect(index: number, e: CustomEvent) {\n\t\tconst place = e.detail as GeocodeResult;\n\t\tif (!destinations || !destinations[index]) return;\n\t\tconst dest = destinations[index]!;\n\t\tdest.address = place.formatted_address || place.name || '';\n\t\t// Extract Lat/Lng\n\t\tif (place.geometry && place.geometry.location) {\n\t\t\tconst latRaw = (place.geometry.location as any).lat;\n\t\t\tconst lngRaw = (place.geometry.location as any).lng;\n\t\t\tconst lat =\n\t\t\t\ttypeof latRaw === 'function' ? (latRaw as unknown as () => number)() : (latRaw as number);\n\t\t\tconst lng =\n\t\t\t\ttypeof lngRaw === 'function' ? (lngRaw as unknown as () => number)() : (lngRaw as number);\n\t\t\tdest.location = { lat, lng };\n\t\t}\n\n\t\t// Trigger reactivity in parent\n\t\tdispatch('update', destinations);\n\t}\n\n\tfunction addDestination() {\n\t\tdestinations = [...(destinations || []), { address: '', earnings: 0 }];\n\t\tdispatch('update', destinations);\n\t}\n\n\tfunction removeDestination(index: number) {\n\t\tif (destinations.length > 1) {\n\t\t\tdestinations = destinations.filter((_, i) => i !== index);\n\t\t\tdispatch('update', destinations);\n\t\t}\n\t}\n\n\tfunction moveUp(index: number) {\n\t\tif (index > 0 && destinations && destinations[index] && destinations[index - 1]) {\n\t\t\tconst current = destinations[index] as Destination;\n\t\t\tconst prev = destinations[index - 1] as Destination;\n\t\t\tdestinations[index] = prev;\n\t\t\tdestinations[index - 1] = current;\n\t\t\tdestinations = [...destinations]; // Trigger reactivity\n\t\t\tdispatch('update', destinations);\n\t\t}\n\t}\n\n\tfunction moveDown(index: number) {\n\t\tif (\n\t\t\tdestinations &&\n\t\t\tindex < destinations.length - 1 &&\n\t\t\tdestinations[index] &&\n\t\t\tdestinations[index + 1]\n\t\t) {\n\t\t\tconst current = destinations[index] as Destination;\n\t\t\tconst next = destinations[index + 1] as Destination;\n\t\t\tdestinations[index] = next;\n\t\t\tdestinations[index + 1] = current;\n\t\t\tdestinations = [...destinations];\n\t\t\tdispatch('update', destinations);\n\t\t}\n\t}\n\n\t// Action to listen for 'place-selected' events (used instead of mixing deprecated/new event syntaxes)\n\tfunction placeSelector(node: HTMLElement, cb: (e: CustomEvent) => void) {\n\t\tconst handler = (ev: Event) => cb(ev as CustomEvent);\n\t\tnode.addEventListener('place-selected', handler);\n\t\treturn {\n\t\t\tdestroy() {\n\t\t\t\tnode.removeEventListener('place-selected', handler);\n\t\t\t}\n\t\t};\n\t}\n</script>\n\n<div class=\"destinations-container\">\n\t<h3 class=\"block font-semibold mb-4 text-sm text-gray-700\">Destinations</h3>\n\n\t{#each destinations as dest, i}\n\t\t<div class=\"dest-row flex gap-2 mb-3\">\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tbind:value={dest.address}\n\t\t\t\tplaceholder=\"Destination address\"\n\t\t\t\tclass=\"flex-2 w-full p-3 text-base border border-gray-300 rounded-lg\"\n\t\t\t\tautocomplete=\"off\"\n\t\t\t\tuse:autocomplete={{ apiKey }}\n\t\t\t\tuse:placeSelector={(e: CustomEvent) => handlePlaceSelect(i, e)}\n\t\t\t/>\n\t\t\t<input\n\t\t\t\ttype=\"number\"\n\t\t\t\tbind:value={dest.earnings}\n\t\t\t\tplaceholder=\"$\"\n\t\t\t\tstep=\"0.01\"\n\t\t\t\tclass=\"flex-1 w-24 p-3 text-base border border-gray-300 rounded-lg\"\n\t\t\t/>\n\t\t\t<div class=\"flex gap-1\">\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tonclick={() => moveUp(i)}\n\t\t\t\t\tdisabled={i === 0}\n\t\t\t\t\tclass=\"p-3 bg-gray-100 rounded-lg disabled:opacity-50 active:bg-gray-200 transition-colors\"\n\t\t\t\t\t>↑</button\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tonclick={() => moveDown(i)}\n\t\t\t\t\tdisabled={i === destinations.length - 1}\n\t\t\t\t\tclass=\"p-3 bg-gray-100 rounded-lg disabled:opacity-50 active:bg-gray-200 transition-colors\"\n\t\t\t\t\t>↓</button\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tonclick={() => removeDestination(i)}\n\t\t\t\t\tdisabled={destinations.length === 1}\n\t\t\t\t\tclass=\"p-3 bg-red-50 text-red-600 rounded-lg disabled:opacity-50 active:bg-red-100 transition-colors\"\n\t\t\t\t\t>✕</button\n\t\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t{/each}\n\n\t<button\n\t\ttype=\"button\"\n\t\tonclick={addDestination}\n\t\tclass=\"mt-2 text-blue-600 font-semibold text-sm hover:underline py-2\">+ Add Destination</button\n\t>\n</div>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\trip\\TripDebug.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\trip\\TripForm.svelte",
		"messages": [
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 570,
				"column": 7,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 591,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 608,
				"column": 7,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 629,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 765,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 765,
				"endColumn": 30
			}
		],
		"suppressedMessages": [],
		"errorCount": 2,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { get } from 'svelte/store';\n\timport { onMount } from 'svelte';\n\timport { slide } from 'svelte/transition';\n\timport type { Destination, Trip, LatLng } from '$lib/types';\n\timport { calculateTripTotals } from '$lib/utils/calculations';\n\timport { storage } from '$lib/utils/storage';\n\timport { draftTrip } from '$lib/stores/trips';\n\timport { autocomplete } from '$lib/utils/autocomplete';\n\timport { calculateRoute as getRouteData, optimizeRoute } from '$lib/services/maps';\n\timport DestinationList from './DestinationList.svelte';\n\timport TripSummary from './TripSummary.svelte';\n\timport TripDebug from './TripDebug.svelte';\n\timport { toasts } from '$lib/stores/toast';\n\timport Skeleton from '$lib/components/ui/Skeleton.svelte';\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport Button from '$lib/components/ui/Button.svelte';\n\timport { getUserState } from '$lib/stores/user.svelte';\n\timport { PLAN_LIMITS } from '$lib/constants';\n\n\t// Svelte 5 Props using Runes\n\tconst { googleApiKey = '', loading = false, trip = null } = $props();\n\n\tconst settings = get(userSettings);\n\tconst API_KEY = $derived(() => googleApiKey || 'dummy_key');\n\n\tconst userState = getUserState();\n\n\t// --- Form State (Runes) ---\n\tlet date = $state(new Date().toISOString().split('T')[0]);\n\tlet startTime = $state('');\n\tlet endTime = $state('');\n\n\tlet startAddress = $state<string>(\n\t\tString(settings.startLocation || storage.getSetting('defaultStartAddress') || '')\n\t);\n\tlet endAddress = $state<string>(\n\t\tString(settings.endLocation || storage.getSetting('defaultEndAddress') || '')\n\t);\n\n\t// Coordinates State\n\tlet startLocation = $state<LatLng | undefined>(undefined);\n\tlet endLocation = $state<LatLng | undefined>(undefined);\n\n\tlet mpg = $state(settings.defaultMPG ?? storage.getSetting('defaultMPG') ?? 25);\n\tlet gasPrice = $state(settings.defaultGasPrice ?? storage.getSetting('defaultGasPrice') ?? 3.5);\n\n\tconst distanceUnit = $state(settings.distanceUnit || 'mi');\n\n\t// Destinations State\n\tlet destinations = $state<Destination[]>([{ address: '', earnings: 0 }]);\n\tlet notes = $state('');\n\n\t// Financials State (Runes)\n\tlet supplies = $state<{ id: string; type: string; cost: number }[]>([]);\n\tlet maintenance = $state<{ id: string; type: string; cost: number }[]>([]);\n\tlet showFinancials = $state(true);\n\n\t// --- Calculation State (Runes) ---\n\tlet calculating = $state(false);\n\tlet calculated = $state(false);\n\tlet calculationError = $state('');\n\n\tlet totalMileage = $state(0);\n\tlet totalTime = $state('');\n\tlet fuelCost = $state(0);\n\n\t// Computed Costs\n\tconst suppliesCost = $derived(supplies.reduce((sum, item) => sum + (Number(item.cost) || 0), 0));\n\tconst maintenanceCost = $derived(\n\t\tmaintenance.reduce((sum, item) => sum + (Number(item.cost) || 0), 0)\n\t);\n\n\tlet netProfit = $state(0);\n\n\t// Upgrade Modal State with specific reason tracking\n\tlet showUpgradeModal = $state(false);\n\tlet upgradeReason = $state<'stops' | 'optimize' | 'trips' | 'general'>('general');\n\n\t// Computed upgrade message based on reason\n\tconst upgradeMessage = $derived(() => {\n\t\tswitch (upgradeReason) {\n\t\t\tcase 'stops':\n\t\t\t\treturn `You've hit the ${PLAN_LIMITS.FREE.MAX_STOPS || 5}-stop limit for Free plans. Upgrade to Pro for unlimited stops per trip!`;\n\t\t\tcase 'optimize':\n\t\t\t\treturn 'Route Optimization is available to all users; free tier limits still apply to trip size.';\n\t\t\tcase 'trips':\n\t\t\t\treturn `You've reached your limit (${PLAN_LIMITS.FREE.MAX_TRIPS_PER_MONTH || PLAN_LIMITS.FREE.MAX_TRIPS_IN_WINDOW || 10} trips per ${PLAN_LIMITS.FREE.WINDOW_DAYS || 30} days).`;\n\t\t\tdefault:\n\t\t\t\treturn 'Upgrade to Pro to unlock additional conveniences and higher quotas.';\n\t\t}\n\t});\n\n\t// --- Auto-Calculation Effect ---\n\t$effect(() => {\n\t\tconst _deps = { startAddress, endAddress, destinations, mpg, gasPrice };\n\t\tvoid _deps; // referenced intentionally to capture dependencies\n\t\tconst hasStart = !!(startAddress && startAddress.length > 3);\n\t\tconst hasDest =\n\t\t\t(destinations?.length ?? 0) > 0 && (destinations?.[0]?.address?.length ?? 0) > 3;\n\n\t\tif (hasStart && hasDest) {\n\t\t\tconst timer = setTimeout(() => {\n\t\t\t\thandleCalculate(true); // true = silent mode\n\t\t\t}, 1500);\n\n\t\t\treturn () => clearTimeout(timer);\n\t\t}\n\n\t\treturn; // ensure consistent return type for the effect\n\t});\n\n\t// --- Handlers ---\n\tfunction handleAddressSelect(field: 'start' | 'end', e: CustomEvent) {\n\t\tconst place = e.detail;\n\t\tconst val = place.formatted_address || place.name || '';\n\n\t\tlet location: LatLng | undefined;\n\t\tif (place.geometry && place.geometry.location) {\n\t\t\tconst lat =\n\t\t\t\ttypeof place.geometry.location.lat === 'function'\n\t\t\t\t\t? place.geometry.location.lat()\n\t\t\t\t\t: place.geometry.location.lat;\n\t\t\tconst lng =\n\t\t\t\ttypeof place.geometry.location.lng === 'function'\n\t\t\t\t\t? place.geometry.location.lng()\n\t\t\t\t\t: place.geometry.location.lng;\n\t\t\tlocation = { lat, lng };\n\t\t}\n\n\t\tif (field === 'start') {\n\t\t\tstartAddress = val;\n\t\t\tstartLocation = location;\n\t\t} else {\n\t\t\tendAddress = val;\n\t\t\tendLocation = location;\n\t\t}\n\t}\n\n\t// Action to listen for 'place-selected' events dispatched by the autocomplete action\n\tfunction placeSelector(node: HTMLElement, cb: (e: CustomEvent) => void) {\n\t\tconst handler = (ev: Event) => cb(ev as CustomEvent);\n\t\tnode.addEventListener('place-selected', handler);\n\t\treturn {\n\t\t\tdestroy() {\n\t\t\t\tnode.removeEventListener('place-selected', handler);\n\t\t\t}\n\t\t};\n\t}\n\n\t// Financial Handlers\n\tfunction addSupply() {\n\t\tsupplies = [...supplies, { id: crypto.randomUUID(), type: '', cost: 0 }];\n\t}\n\tfunction removeSupply(index: number) {\n\t\tsupplies = supplies.filter((_, i) => i !== index);\n\t}\n\tfunction addMaintenance() {\n\t\tmaintenance = [...maintenance, { id: crypto.randomUUID(), type: '', cost: 0 }];\n\t}\n\tfunction removeMaintenance(index: number) {\n\t\tmaintenance = maintenance.filter((_, i) => i !== index);\n\t}\n\n\tasync function handleCalculate(silent = false): Promise<any | null> {\n\t\tif (!startAddress) {\n\t\t\tif (!silent) toasts.error('Please enter a start address.');\n\t\t\treturn null;\n\t\t}\n\n\t\t// Stop Limit Check\n\t\tif (!silent) {\n\t\t\tconst validStopCount = destinations.filter(\n\t\t\t\t(d) => d.address && d.address.trim().length > 0\n\t\t\t).length;\n\t\t\tif (userState.value?.plan === 'free' && validStopCount > (PLAN_LIMITS.FREE.MAX_STOPS || 5)) {\n\t\t\t\ttoasts.error(\n\t\t\t\t\t`You've hit the ${PLAN_LIMITS.FREE.MAX_STOPS || 5}-stop limit for Free plans.`\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tcalculating = true;\n\t\tcalculationError = '';\n\t\ttry {\n\t\t\tconst effectiveEndAddress = endAddress ? endAddress : startAddress;\n\t\t\tconst destsCopy = $state.snapshot(destinations) as Destination[];\n\n\t\t\tconst routeData = await getRouteData(\n\t\t\t\tstartAddress,\n\t\t\t\teffectiveEndAddress,\n\t\t\t\tdestsCopy,\n\t\t\t\tdistanceUnit as 'mi' | 'km'\n\t\t\t);\n\n\t\t\t// [!code fix] Capture 'miles' first, then 'totalMiles'\n\t\t\tconst rawDist = (routeData as any).miles ?? routeData.totalMiles ?? 0;\n\t\t\ttotalMileage = Number(rawDist);\n\n\t\t\tconst duration = routeData.totalMinutes ?? (routeData as any).minutes ?? 0;\n\n\t\t\tconst totals = calculateTripTotals(\n\t\t\t\ttotalMileage,\n\t\t\t\tduration,\n\t\t\t\tdestsCopy,\n\t\t\t\tmpg,\n\t\t\t\tgasPrice,\n\t\t\t\t[],\n\t\t\t\t[],\n\t\t\t\tstartTime,\n\t\t\t\tendTime\n\t\t\t);\n\n\t\t\ttotalTime = totals.totalTime || '';\n\n\t\t\tif (trip && trip.fuelCost && !startLocation) {\n\t\t\t\tfuelCost = trip.fuelCost;\n\t\t\t} else {\n\t\t\t\tfuelCost = totals.fuelCost || 0;\n\t\t\t}\n\n\t\t\tconst grossEarnings = destsCopy.reduce(\n\t\t\t\t(acc: number, d: Destination) => acc + (Number(d.earnings) || 0),\n\t\t\t\t0\n\t\t\t);\n\t\t\tnetProfit = grossEarnings - (fuelCost + suppliesCost + maintenanceCost);\n\n\t\t\tcalculated = true;\n\t\t\tconsole.log('[TripForm] handleCalculate success', {\n\t\t\t\tmiles: totalMileage,\n\t\t\t\tminutes: duration\n\t\t\t});\n\n\t\t\tif (!silent) toasts.success('Route calculated successfully!');\n\n\t\t\treturn routeData;\n\t\t} catch (err: any) {\n\t\t\tconsole.error('Calculation Error:', err);\n\t\t\tconst msg = (err.message || '').toLowerCase();\n\n\t\t\t// Plan limit detection\n\t\t\tif (msg.includes('plan limit') || msg.includes('pro feature') || msg.includes('trip limit')) {\n\t\t\t\tupgradeReason = 'general';\n\t\t\t\tshowUpgradeModal = true;\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (!silent || !msg.includes('zero_results')) {\n\t\t\t\tcalculationError = err.message;\n\t\t\t\tif (!silent) toasts.error(err.message);\n\t\t\t}\n\t\t\treturn null;\n\t\t} finally {\n\t\t\tcalculating = false;\n\t\t}\n\t}\n\n\tasync function handleOptimize() {\n\t\tif (!startAddress) {\n\t\t\ttoasts.error('Please enter a start address first.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst validDests = destinations.filter((d) => d.address && d.address.trim() !== '');\n\t\tif (validDests.length < 2) {\n\t\t\ttoasts.error('Need at least 2 stops to optimize.');\n\t\t\treturn;\n\t\t}\n\n\t\tcalculating = true;\n\n\t\ttry {\n\t\t\tconst result: any = await optimizeRoute(startAddress, endAddress || '', validDests);\n\n\t\t\tif (result && (result as any).optimizedOrder && (result as any).optimizedOrder.length > 0) {\n\t\t\t\tconst currentDestinations = $state.snapshot(destinations) as Destination[];\n\t\t\t\tconst validDestinations = currentDestinations.filter(\n\t\t\t\t\t(d) => d.address && d.address.trim() !== ''\n\t\t\t\t);\n\t\t\t\tconst emptyDestinations = currentDestinations.filter(\n\t\t\t\t\t(d) => !d.address || d.address.trim() === ''\n\t\t\t\t);\n\n\t\t\t\tlet waypointsToReorder: Destination[] = [];\n\t\t\t\tlet fixedEnd: Destination | null = null;\n\n\t\t\t\tif (!endAddress) {\n\t\t\t\t\tfixedEnd = validDestinations[validDestinations.length - 1] ?? null;\n\t\t\t\t\twaypointsToReorder = validDestinations.slice(0, -1);\n\t\t\t\t} else {\n\t\t\t\t\twaypointsToReorder = validDestinations;\n\t\t\t\t}\n\n\t\t\t\tconst reorderedWaypoints = (result as any).optimizedOrder\n\t\t\t\t\t.map((index: number) => waypointsToReorder[index])\n\t\t\t\t\t.filter(Boolean) as Destination[];\n\n\t\t\t\tlet newDestinations = [...reorderedWaypoints];\n\n\t\t\t\tif (fixedEnd) {\n\t\t\t\t\tnewDestinations.push(fixedEnd);\n\t\t\t\t}\n\n\t\t\t\tnewDestinations = [...newDestinations, ...emptyDestinations];\n\t\t\t\tdestinations = newDestinations;\n\n\t\t\t\ttoasts.success('Stops optimized for fastest route!');\n\t\t\t\thandleCalculate(true);\n\t\t\t} else {\n\t\t\t\ttoasts.info('Route is already optimized or could not be improved.');\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\tconst msg = (e.message || '').toLowerCase();\n\n\t\t\t// Catch ALL potential plan limit indicators\n\t\t\tconst isPlanLimit =\n\t\t\t\te.code === 'PLAN_LIMIT' ||\n\t\t\t\tmsg.includes('plan limit') ||\n\t\t\t\tmsg.includes('pro feature') ||\n\t\t\t\tmsg.includes('upgrade');\n\n\t\t\tif (isPlanLimit) {\n\t\t\t\tupgradeReason = 'optimize';\n\t\t\t\tshowUpgradeModal = true;\n\t\t\t} else {\n\t\t\t\tconsole.error('Optimization failed:', e);\n\t\t\t\ttoasts.error(`Optimization failed: ${e.message}`);\n\t\t\t}\n\t\t} finally {\n\t\t\tcalculating = false;\n\t\t}\n\t}\n\n\t// --- Draft Logic ---\n\tfunction loadDraft(draft: Partial<Trip>) {\n\t\tif (!draft || typeof draft !== 'object') return;\n\t\tif (draft.date) date = draft.date;\n\t\tif (draft.startTime) startTime = draft.startTime;\n\t\tif (draft.endTime) endTime = draft.endTime;\n\t\tif (draft.startAddress) startAddress = draft.startAddress;\n\t\tif (draft.endAddress) endAddress = draft.endAddress;\n\t\tif (draft.startLocation) startLocation = draft.startLocation;\n\t\tif (draft.endLocation) endLocation = draft.endLocation;\n\t\tif (draft.mpg) mpg = draft.mpg;\n\t\tif (draft.gasPrice) gasPrice = draft.gasPrice;\n\t\tif (draft.destinations && Array.isArray(draft.destinations)) destinations = draft.destinations;\n\t\tif (draft.notes) notes = draft.notes;\n\t\t// Load Supplies from Draft/Trip, normalize and ensure ids\n\t\tif (draft.suppliesItems && Array.isArray(draft.suppliesItems)) {\n\t\t\tsupplies = (draft.suppliesItems as any[]).map((s) => ({\n\t\t\t\tid: s.id ?? crypto.randomUUID(),\n\t\t\t\ttype: s.type ?? s.name ?? '',\n\t\t\t\tcost: Number(s.cost) || 0\n\t\t\t}));\n\t\t} else if ((draft as any).supplyItems && Array.isArray((draft as any).supplyItems)) {\n\t\t\tsupplies = ((draft as any).supplyItems as any[]).map((s) => ({\n\t\t\t\tid: s.id ?? crypto.randomUUID(),\n\t\t\t\ttype: s.type ?? s.name ?? '',\n\t\t\t\tcost: Number(s.cost) || 0\n\t\t\t}));\n\t\t}\n\n\t\tif (draft.maintenanceItems && Array.isArray(draft.maintenanceItems)) {\n\t\t\tmaintenance = (draft.maintenanceItems as any[]).map((m) => ({\n\t\t\t\tid: m.id ?? crypto.randomUUID(),\n\t\t\t\ttype: m.item ?? m.type ?? '',\n\t\t\t\tcost: Number(m.cost) || 0\n\t\t\t}));\n\t\t}\n\t}\n\n\tfunction saveDraft() {\n\t\tconst draftData: Partial<Trip> = {\n\t\t\tdate,\n\t\t\tstartTime,\n\t\t\tendTime,\n\t\t\tstartAddress,\n\t\t\tendAddress,\n\t\t\tstartLocation,\n\t\t\tendLocation,\n\t\t\tdestinations,\n\t\t\tmpg,\n\t\t\tgasPrice,\n\t\t\tnotes,\n\t\t\tsuppliesItems: supplies,\n\t\t\tmaintenanceItems: maintenance\n\t\t};\n\t\tdraftTrip.save(draftData);\n\t}\n\n\tonMount(() => {\n\t\t// Support loading trip via prop (Edit Mode)\n\t\tif (trip) {\n\t\t\tloadDraft(trip);\n\t\t\tif (trip.totalMiles) totalMileage = trip.totalMiles;\n\t\t\tif (trip.fuelCost) fuelCost = trip.fuelCost;\n\t\t} else {\n\t\t\tconst rawDraft = draftTrip.load();\n\t\t\tif (rawDraft && confirm('Resume your last unsaved trip?')) {\n\t\t\t\tloadDraft(rawDraft as Partial<Trip>);\n\t\t\t}\n\t\t}\n\n\t\tconst interval = setInterval(saveDraft, 5000);\n\t\treturn () => clearInterval(interval);\n\t});\n</script>\n\n<div class=\"max-w-4xl mx-auto p-4 md:p-6\">\n\t<h2 class=\"text-2xl font-bold mb-6\">{trip ? 'Edit Trip' : 'Plan Your Trip'}</h2>\n\n\t<TripDebug />\n\n\t<div class=\"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 mb-6 space-y-6\">\n\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t\t<div>\n\t\t\t\t<label for=\"trip-date\" class=\"block font-semibold mb-2 text-sm text-gray-700\">Date</label>\n\t\t\t\t{#if loading}\n\t\t\t\t\t<Skeleton height=\"48px\" className=\"rounded-lg\" />\n\t\t\t\t{:else}\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"trip-date\"\n\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\tbind:value={date}\n\t\t\t\t\t\tclass=\"w-full p-3 text-base border-gray-300 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div>\n\t\t\t<label for=\"start-address\" class=\"block font-semibold mb-2 text-sm text-gray-700\"\n\t\t\t\t>Start Address</label\n\t\t\t>\n\t\t\t{#if loading}\n\t\t\t\t<Skeleton height=\"48px\" className=\"rounded-lg\" />\n\t\t\t{:else}\n\t\t\t\t<input\n\t\t\t\t\tid=\"start-address\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={startAddress}\n\t\t\t\t\tplaceholder=\"Enter start location\"\n\t\t\t\t\tclass=\"w-full p-3 text-base border-gray-300 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY() }}\n\t\t\t\t\tuse:placeSelector={(e: CustomEvent) => handleAddressSelect('start', e)}\n\t\t\t\t/>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t{#if loading}\n\t\t\t<div class=\"space-y-3\">\n\t\t\t\t<div class=\"block font-semibold text-sm text-gray-700\">Destinations</div>\n\t\t\t\t<Skeleton height=\"50px\" className=\"rounded-lg\" />\n\t\t\t\t<Skeleton height=\"50px\" className=\"rounded-lg\" />\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<DestinationList bind:destinations apiKey={API_KEY()} />\n\t\t{/if}\n\n\t\t<div>\n\t\t\t<label for=\"end-address\" class=\"block font-semibold mb-2 text-sm text-gray-700\"\n\t\t\t\t>End Address (Optional)</label\n\t\t\t>\n\t\t\t{#if loading}\n\t\t\t\t<Skeleton height=\"48px\" className=\"rounded-lg\" />\n\t\t\t{:else}\n\t\t\t\t<input\n\t\t\t\t\tid=\"end-address\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={endAddress}\n\t\t\t\t\tplaceholder=\"Leave empty to return to Start\"\n\t\t\t\t\tclass=\"w-full p-3 text-base border-gray-300 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY() }}\n\t\t\t\t\tuse:placeSelector={(e: CustomEvent) => handleAddressSelect('end', e)}\n\t\t\t\t/>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"grid grid-cols-2 gap-4\">\n\t\t\t<div>\n\t\t\t\t<label for=\"mpg\" class=\"block font-semibold mb-2 text-sm text-gray-700\">MPG</label>\n\t\t\t\t{#if loading}\n\t\t\t\t\t<Skeleton height=\"48px\" className=\"rounded-lg\" />\n\t\t\t\t{:else}\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"mpg\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tbind:value={mpg}\n\t\t\t\t\t\tstep=\"0.1\"\n\t\t\t\t\t\tclass=\"w-full p-3 text-base border-gray-300 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<label for=\"gas-price\" class=\"block font-semibold mb-2 text-sm text-gray-700\"\n\t\t\t\t\t>Gas Price ($)</label\n\t\t\t\t>\n\t\t\t\t{#if loading}\n\t\t\t\t\t<Skeleton height=\"48px\" className=\"rounded-lg\" />\n\t\t\t\t{:else}\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"gas-price\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tbind:value={gasPrice}\n\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\tclass=\"w-full p-3 text-base border-gray-300 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<label for=\"start-time\" class=\"block font-semibold mb-2 text-sm text-gray-700\"\n\t\t\t\t\t>Start Time</label\n\t\t\t\t>\n\t\t\t\t{#if loading}\n\t\t\t\t\t<Skeleton height=\"48px\" className=\"rounded-lg\" />\n\t\t\t\t{:else}\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"start-time\"\n\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\tbind:value={startTime}\n\t\t\t\t\t\tclass=\"w-full p-3 text-base border-gray-300 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<label for=\"end-time\" class=\"block font-semibold mb-2 text-sm text-gray-700\">End Time</label\n\t\t\t\t>\n\t\t\t\t{#if loading}\n\t\t\t\t\t<Skeleton height=\"48px\" className=\"rounded-lg\" />\n\t\t\t\t{:else}\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"end-time\"\n\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\tbind:value={endTime}\n\t\t\t\t\t\tclass=\"w-full p-3 text-base border-gray-300 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"border-t border-gray-100 pt-4\">\n\t\t\t<div class=\"flex justify-between items-center mb-4\">\n\t\t\t\t<div class=\"block font-semibold text-sm text-gray-700\">Expenses & Supplies</div>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"text-sm text-blue-600\"\n\t\t\t\t\tonclick={() => (showFinancials = !showFinancials)}\n\t\t\t\t>\n\t\t\t\t\t{showFinancials ? 'Hide' : 'Show'}\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t{#if showFinancials}\n\t\t\t\t<div transition:slide class=\"space-y-4 bg-gray-50 p-4 rounded-lg\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"flex justify-between items-center mb-2\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-semibold text-gray-500 uppercase\"\n\t\t\t\t\t\t\t\t>Supplies (Pole, Concrete)</span\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tonclick={addSupply}\n\t\t\t\t\t\t\t\tclass=\"text-xs bg-white border px-2 py-1 rounded hover:bg-gray-100\">+ Add</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#each supplies as item, i}\n\t\t\t\t\t\t\t<div class=\"flex gap-2 mb-2 items-center\">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Item Type\"\n\t\t\t\t\t\t\t\t\tbind:value={item.type}\n\t\t\t\t\t\t\t\t\tclass=\"w-full p-2 text-sm border rounded\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"$\"\n\t\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\t\tbind:value={item.cost}\n\t\t\t\t\t\t\t\t\tclass=\"w-24 p-2 text-sm border rounded\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonclick={() => removeSupply(i)}\n\t\t\t\t\t\t\t\t\tclass=\"text-red-400 hover:text-red-600\">✕</button\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t{#if supplies.length > 0}\n\t\t\t\t\t\t\t<div class=\"text-right text-xs text-gray-600 font-medium\">\n\t\t\t\t\t\t\t\tSubtotal: ${suppliesCost.toFixed(2)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"flex justify-between items-center mb-2\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-semibold text-gray-500 uppercase\">Vehicle / Other</span>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tonclick={addMaintenance}\n\t\t\t\t\t\t\t\tclass=\"text-xs bg-white border px-2 py-1 rounded hover:bg-gray-100\">+ Add</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#each maintenance as item, i}\n\t\t\t\t\t\t\t<div class=\"flex gap-2 mb-2 items-center\">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Description\"\n\t\t\t\t\t\t\t\t\tbind:value={item.type}\n\t\t\t\t\t\t\t\t\tclass=\"w-full p-2 text-sm border rounded\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"$\"\n\t\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\t\tbind:value={item.cost}\n\t\t\t\t\t\t\t\t\tclass=\"w-24 p-2 text-sm border rounded\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonclick={() => removeMaintenance(i)}\n\t\t\t\t\t\t\t\t\tclass=\"text-red-400 hover:text-red-600\">✕</button\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div>\n\t\t\t<label for=\"notes\" class=\"block font-semibold mb-2 text-sm text-gray-700\">Notes</label>\n\t\t\t{#if loading}\n\t\t\t\t<Skeleton height=\"100px\" className=\"rounded-lg\" />\n\t\t\t{:else}\n\t\t\t\t<textarea\n\t\t\t\t\tid=\"notes\"\n\t\t\t\t\tbind:value={notes}\n\t\t\t\t\trows=\"3\"\n\t\t\t\t\tclass=\"w-full p-3 text-base border-gray-300 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n\t\t\t\t></textarea>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n\n\t{#if calculationError}\n\t\t<div class=\"bg-red-50 text-red-700 p-4 rounded-lg mb-6 border border-red-200\">\n\t\t\t{calculationError}\n\t\t</div>\n\t{/if}\n\n\t{#if calculated}\n\t\t<TripSummary {totalMileage} {distanceUnit} {totalTime} {fuelCost} {netProfit} />\n\t{:else if calculating}\n\t\t<div\n\t\t\tclass=\"p-6 text-center text-gray-500 bg-gray-50 rounded-xl border border-dashed border-gray-300\"\n\t\t>\n\t\t\t<div class=\"inline-block animate-spin mr-2\">⟳</div>\n\t\t\tCalculating route...\n\t\t</div>\n\t{/if}\n\n\t<div class=\"flex flex-col sm:flex-row gap-3 mt-6\">\n\t\t{#if loading}\n\t\t\t<Skeleton height=\"48px\" width=\"160px\" className=\"rounded-lg\" />\n\t\t{:else}\n\t\t\t<button\n\t\t\t\tclass=\"w-full sm:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm\"\n\t\t\t\tonclick={() => handleCalculate(false)}\n\t\t\t\tdisabled={calculating}\n\t\t\t>\n\t\t\t\t{calculating ? 'Calculating...' : 'Recalculate Route'}\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tclass=\"w-full sm:w-auto px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm\"\n\t\t\t\tonclick={handleOptimize}\n\t\t\t\tdisabled={calculating}\n\t\t\t\ttitle={userState.value?.plan === 'free'\n\t\t\t\t\t? 'Pro Feature - Upgrade to Unlock'\n\t\t\t\t\t: 'Reorder stops for fastest route'}\n\t\t\t>\n\t\t\t\t{#if userState.value?.plan === 'free'}\n\t\t\t\t\t🔒 Optimize Stops (Pro)\n\t\t\t\t{:else}\n\t\t\t\t\tOptimize Stops\n\t\t\t\t{/if}\n\t\t\t</button>\n\t\t{/if}\n\t</div>\n</div>\n\n<Modal bind:open={showUpgradeModal} title=\"Upgrade to Pro\">\n\t<div class=\"space-y-6 text-center py-4\">\n\t\t<div class=\"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4\">\n\t\t\t{#if upgradeReason === 'stops'}\n\t\t\t\t<span class=\"text-3xl\">📍</span>\n\t\t\t{:else if upgradeReason === 'optimize'}\n\t\t\t\t<span class=\"text-3xl\">🚀</span>\n\t\t\t{:else if upgradeReason === 'trips'}\n\t\t\t\t<span class=\"text-3xl\">📊</span>\n\t\t\t{:else}\n\t\t\t\t<span class=\"text-3xl\">⭐</span>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<h3 class=\"text-xl font-bold text-gray-900\">\n\t\t\t{#if upgradeReason === 'stops'}\n\t\t\t\tToo Many Stops\n\t\t\t{:else if upgradeReason === 'optimize'}\n\t\t\t\tPro Feature Required\n\t\t\t{:else if upgradeReason === 'trips'}\n\t\t\t\tMonthly Limit Reached\n\t\t\t{:else}\n\t\t\t\tUnlock Pro Features\n\t\t\t{/if}\n\t\t</h3>\n\n\t\t<p class=\"text-gray-600 text-base leading-relaxed\">\n\t\t\t{upgradeMessage()}\n\t\t</p>\n\n\t\t{#if upgradeReason === 'trips' && userState.value}\n\t\t\t<div class=\"bg-orange-50 border border-orange-200 rounded-lg p-3 text-sm\">\n\t\t\t\t<div class=\"font-semibold text-orange-900\">Your Free Plan Status:</div>\n\t\t\t\t<div class=\"text-orange-700 mt-1\">\n\t\t\t\t\t{userState.value.tripsThisMonth} / {userState.value.maxTrips} trips used this month\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"bg-gray-50 p-4 rounded-lg text-left text-sm space-y-2 border border-gray-100\">\n\t\t\t<div class=\"font-semibold text-gray-900 mb-3\">Pro Plan Includes:</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\"><strong>Unlimited</strong> Stops per Trip</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\"><strong>One-Click</strong> Route Optimization</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\"><strong>Unlimited</strong> Monthly Trips</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\"><strong>Priority</strong> Support</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg p-4\">\n\t\t\t<div class=\"text-sm opacity-90\">Only</div>\n\t\t\t<div class=\"text-3xl font-bold\">$9.99<span class=\"text-lg font-normal\">/mo</span></div>\n\t\t\t<div class=\"text-sm opacity-90\">Cancel anytime</div>\n\t\t</div>\n\n\t\t<div class=\"flex gap-3 justify-center pt-2\">\n\t\t\t<Button variant=\"outline\" on:click={() => (showUpgradeModal = false)}>Maybe Later</Button>\n\t\t\t<a\n\t\t\t\thref=\"/dashboard/settings\"\n\t\t\t\tclass=\"inline-flex items-center justify-center rounded-lg bg-orange-600 px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600 transition-all\"\n\t\t\t>\n\t\t\t\tUpgrade to Pro →\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</Modal>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\trip\\TripSummary.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ui\\Button.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ui\\Button.svelte.d.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ui\\Card.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ui\\CollapsibleCard.svelte",
		"messages": [
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'title' is never reassigned. Use 'const' instead.",
				"line": 5,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 5,
				"endColumn": 8
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'subtitle' is never reassigned. Use 'const' instead.",
				"line": 6,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 6,
				"endColumn": 11
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'storageKey' is never reassigned. Use 'const' instead.",
				"line": 8,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 8,
				"endColumn": 13
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'icon' is never reassigned. Use 'const' instead.",
				"line": 9,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 9,
				"endColumn": 7
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'children' is never reassigned. Use 'const' instead.",
				"line": 10,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 10,
				"endColumn": 11
			}
		],
		"suppressedMessages": [],
		"errorCount": 5,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport type { Snippet } from 'svelte';\n\tlet {\n\t\ttitle = '',\n\t\tsubtitle = '',\n\t\topen = $bindable(true),\n\t\tstorageKey = null,\n\t\ticon,\n\t\tchildren\n\t}: {\n\t\ttitle?: string;\n\t\tsubtitle?: string;\n\t\topen?: boolean;\n\t\tstorageKey?: string | null;\n\t\ticon?: Snippet;\n\t\tchildren?: Snippet;\n\t} = $props();\n\n\tconst contentId = `collapsible-${Math.random().toString(36).slice(2, 9)}`;\n\n\tonMount(() => {\n\t\tif (storageKey && typeof localStorage !== 'undefined') {\n\t\t\tconst raw = localStorage.getItem(storageKey);\n\t\t\tif (raw !== null) open = raw === '1';\n\t\t}\n\t});\n\n\tfunction toggle() {\n\t\topen = !open;\n\t\tif (storageKey && typeof localStorage !== 'undefined') {\n\t\t\tlocalStorage.setItem(storageKey, open ? '1' : '0');\n\t\t}\n\t}\n</script>\n\n<section class=\"settings-card collapsible\" aria-labelledby={contentId + '-title'}>\n\t<div\n\t\tclass=\"card-header clickable\"\n\t\trole=\"button\"\n\t\tonclick={toggle}\n\t\tonkeydown={(e) => {\n\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\te.preventDefault();\n\t\t\t\ttoggle();\n\t\t\t}\n\t\t}}\n\t\ttabindex=\"0\"\n\t>\n\t\t<div class=\"card-icon-wrapper\">\n\t\t\t{@render icon?.()}\n\t\t</div>\n\t\t<div class=\"card-header-text\">\n\t\t\t<h2 id={contentId + '-title'} class=\"card-title\">{title}</h2>\n\t\t\t{#if subtitle}\n\t\t\t\t<p class=\"card-subtitle\">{subtitle}</p>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<button\n\t\t\tclass=\"toggle-btn\"\n\t\t\ttype=\"button\"\n\t\t\taria-expanded={open}\n\t\t\taria-controls={contentId}\n\t\t\tonclick={(e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\ttoggle();\n\t\t\t}}\n\t\t\taria-label={open ? 'Collapse' : 'Expand'}\n\t\t>\n\t\t\t{#if open}\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\twidth=\"18\"\n\t\t\t\t\theight=\"18\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"><polyline points=\"18 15 12 9 6 15\"></polyline></svg\n\t\t\t\t>\n\t\t\t{:else}\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\twidth=\"18\"\n\t\t\t\t\theight=\"18\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg\n\t\t\t\t>\n\t\t\t{/if}\n\t\t</button>\n\t</div>\n\n\t<div id={contentId} class:closed={!open} class:open class=\"collapsible-body\" hidden={!open}>\n\t\t{@render children?.()}\n\t</div>\n</section>\n\n<style>\n\t.settings-card.collapsible {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 20px;\n\t}\n\n\t.card-header.clickable {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tcursor: pointer;\n\t}\n\n\t.card-icon-wrapper {\n\t\twidth: 48px;\n\t\theight: 48px;\n\t\tborder-radius: 12px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tflex-shrink: 0;\n\t\tfont-size: 20px;\n\t}\n\n\t.card-title {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\n\t.card-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tmargin: 0;\n\t}\n\n\t.toggle-btn {\n\t\tmargin-left: auto;\n\t\tbackground: transparent;\n\t\tborder: none;\n\t\tpadding: 6px;\n\t\tborder-radius: 8px;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t}\n\n\t.toggle-btn:hover {\n\t\tbackground: rgba(0, 0, 0, 0.03);\n\t\tcolor: #374151;\n\t}\n\n\t.collapsible-body {\n\t\ttransition:\n\t\t\tmax-height 0.25s ease,\n\t\t\topacity 0.2s ease,\n\t\t\ttransform 0.2s ease;\n\t\toverflow: hidden;\n\t\topacity: 1;\n\t\ttransform-origin: top;\n\t}\n\t.collapsible-body.closed {\n\t\tmax-height: 0;\n\t\topacity: 0;\n\t\ttransform: scaleY(0.98);\n\t}\n\t.collapsible-body.open {\n\t\tmax-height: 2000px;\n\t\topacity: 1;\n\t\ttransform: scaleY(1);\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ui\\Input.svelte",
		"messages": [
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'label' is never reassigned. Use 'const' instead.",
				"line": 3,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3,
				"endColumn": 8
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'type' is never reassigned. Use 'const' instead.",
				"line": 4,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 4,
				"endColumn": 7
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'placeholder' is never reassigned. Use 'const' instead.",
				"line": 6,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 6,
				"endColumn": 14
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'id' is never reassigned. Use 'const' instead.",
				"line": 7,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 7,
				"endColumn": 5
			}
		],
		"suppressedMessages": [],
		"errorCount": 4,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\tlet {\n\t\tlabel = '',\n\t\ttype = 'text',\n\t\tvalue = $bindable(''),\n\t\tplaceholder = '',\n\t\tid = ''\n\t}: {\n\t\tlabel?: string;\n\t\ttype?: string;\n\t\tvalue?: string;\n\t\tplaceholder?: string;\n\t\tid?: string;\n\t} = $props();\n</script>\n\n<label class=\"block w-full\">\n\t<span class=\"block text-neutral-primary text-sm mb-1\">{label}</span>\n\t<input\n\t\t{id}\n\t\t{type}\n\t\tbind:value\n\t\t{placeholder}\n\t\tclass=\"w-full p-3 text-base border border-neutral-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-green\"\n\t/>\n</label>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ui\\Modal.svelte",
		"messages": [
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'title' is never reassigned. Use 'const' instead.",
				"line": 3,
				"column": 33,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3,
				"endColumn": 38
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'children' is never reassigned. Use 'const' instead.",
				"line": 3,
				"column": 40,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 3,
				"endColumn": 48
			}
		],
		"suppressedMessages": [],
		"errorCount": 2,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\t// Use $bindable for two-way binding on 'open'\n\tlet { open = $bindable(false), title, children } = $props();\n\tlet dialog: HTMLDialogElement;\n\n\t// Sync Svelte state with the Native DOM API\n\t$effect(() => {\n\t\tif (dialog) {\n\t\t\tif (open && !dialog.open) {\n\t\t\t\tdialog.showModal();\n\t\t\t} else if (!open && dialog.open) {\n\t\t\t\tdialog.close();\n\t\t\t}\n\t\t}\n\t});\n\n\t// Handle native close events (e.g. Escape key) — implementation below to allow suppression during autocomplete selection.\n\n\t// Close when clicking the backdrop\n\tfunction handleBackdropClick(e: MouseEvent) {\n\t\t// Debug: log composedPath in browsers where issues appear\n\t\ttry {\n\t\t\tconst path: any[] = (e as any).composedPath ? (e as any).composedPath() : [e.target];\n\t\t\tconst hasPac = path.some(\n\t\t\t\t(el) =>\n\t\t\t\t\tel && el.classList && el.classList.contains && el.classList.contains('pac-container')\n\t\t\t);\n\t\t\tif (console && console.debug)\n\t\t\t\tconsole.debug('[modal] backdrop click', { target: e.target, hasPac, path });\n\n\t\t\t// If the click originated inside the autocomplete dropdown, ignore it so\n\t\t\t// selecting suggestions doesn't close the dialog.\n\t\t\tif (hasPac) return;\n\t\t} catch (_err: unknown) {\n\t\t\tvoid _err;\n\t\t}\n\n\t\t// In a native dialog, the backdrop is considered part of the dialog element\n\t\t// but the content is inside. If the target is the dialog itself, it's a backdrop click.\n\t\tif (e.target === dialog) {\n\t\t\tdialog.close();\n\t\t}\n\t}\n\n\tfunction onDialogClose() {\n\t\t// If we have a temporary suppression flag set (by the autocomplete selection),\n\t\t// reopen and clear it rather than letting the modal stay closed.\n\t\ttry {\n\t\t\tif ((dialog as any).__suppressClose) {\n\t\t\t\t(dialog as any).__suppressClose = false;\n\t\t\t\tif (console && console.debug) console.debug('[modal] suppressed close - reopening');\n\t\t\t\ttry {\n\t\t\t\t\tdialog.showModal();\n\t\t\t\t} catch (_e: unknown) {\n\t\t\t\t\tvoid _e;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t} catch (_e: unknown) {\n\t\t\tvoid _e;\n\t\t}\n\n\t\topen = false;\n\t}\n</script>\n\n<dialog\n\tbind:this={dialog}\n\tonclose={() => onDialogClose()}\n\tonclick={handleBackdropClick}\n\tclass=\"\n    m-auto p-0 rounded-xl bg-white text-left shadow-xl w-full max-w-lg\n    backdrop:bg-black/50 backdrop:backdrop-blur-sm\n    open:animate-in open:fade-in-0 open:zoom-in-95\n    closed:animate-out closed:fade-out-0 closed:zoom-out-95\n    border border-neutral-200\n  \"\n\tstyle=\"max-height: calc(85vh - env(safe-area-inset-bottom, 20px));\"\n>\n\t<div class=\"relative flex flex-col h-full overflow-hidden\">\n\t\t<div class=\"flex items-center justify-between px-6 py-4 border-b border-neutral-100 shrink-0\">\n\t\t\t<h3 class=\"modal-title\">\n\t\t\t\t{title || 'Dialog'}\n\t\t\t</h3>\n\t\t\t<button\n\t\t\t\tonclick={() => dialog.close()}\n\t\t\t\tclass=\"rounded-md p-2 hover:bg-neutral-100 transition-colors text-neutral-500 hover:text-neutral-900 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n\t\t\t\taria-label=\"Close\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\twidth=\"24\"\n\t\t\t\t\theight=\"24\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t>\n\t\t\t\t\t<path d=\"M18 6 6 18\" /><path d=\"m6 6 12 12\" />\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"p-6 overflow-y-auto modal-body\">\n\t\t\t{#if children}\n\t\t\t\t{@render children()}\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</dialog>\n\n<style>\n\t/* Reset default browser dialog styles */\n\tdialog {\n\t\tmargin: auto; /* Centers the dialog */\n\t\tinset: 0;\n\t}\n\n\tdialog::backdrop {\n\t\t/* Tailwind 'backdrop:' utility covers this, but explicit inheritance ensures safety */\n\t\tbackground-color: rgb(0 0 0 / 0.5);\n\t}\n\n\t/* Standardized modal content styles so consumers get consistent spacing, inputs and actions */\n\t.modal-title {\n\t\tfont-size: 1.125rem; /* 18px */\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\n\t.modal-body {\n\t\tpadding-top: 12px;\n\t\tpadding-bottom: 12px;\n\t\tline-height: 1.4;\n\t\tcolor: #374151;\n\t}\n\n\t/* Buttons inside modals should be larger and consistent */\n\t:global(.modal-actions) {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tmargin-top: 20px;\n\t}\n\n\t:global(.modal-actions) :global(button),\n\t:global(.modal-actions) button {\n\t\tflex: 1;\n\t\tpadding: 12px 16px;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 600;\n\t}\n\n\t/* Make form controls consistent inside modal content */\n\t.modal-body :global(input),\n\t.modal-body :global(select),\n\t.modal-body :global(textarea) {\n\t\tpadding: 10px 12px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-size: 14px;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ui\\SelectMobile.svelte",
		"messages": [
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'id' is never reassigned. Use 'const' instead.",
				"line": 5,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 5,
				"endColumn": 5
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'options' is never reassigned. Use 'const' instead.",
				"line": 6,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 6,
				"endColumn": 10
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'placeholder' is never reassigned. Use 'const' instead.",
				"line": 8,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 8,
				"endColumn": 14
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'className' is never reassigned. Use 'const' instead.",
				"line": 9,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 9,
				"endColumn": 12
			},
			{
				"ruleId": "prefer-const",
				"severity": 2,
				"message": "'onchange' is never reassigned. Use 'const' instead.",
				"line": 10,
				"column": 3,
				"nodeType": "Identifier",
				"messageId": "useConst",
				"endLine": 10,
				"endColumn": 11
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 128,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 147,
				"endColumn": 11
			}
		],
		"suppressedMessages": [],
		"errorCount": 6,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { onDestroy } from 'svelte';\n\n\tlet {\n\t\tid = undefined,\n\t\toptions = [],\n\t\tvalue = $bindable(null),\n\t\tplaceholder = '',\n\t\tclassName = '',\n\t\tonchange\n\t}: {\n\t\tid?: string | undefined;\n\t\toptions?: { value: string; label: string }[];\n\t\tvalue?: string | null;\n\t\tplaceholder?: string;\n\t\tclassName?: string;\n\t\tonchange?: (detail: { value: string }) => void;\n\t} = $props();\n\n\tlet open = $state(false);\n\tlet focusedIndex = $state(-1);\n\tlet buttonEl: HTMLElement | null = $state(null);\n\tlet listEl: HTMLElement | null = $state(null);\n\n\tfunction toggle() {\n\t\topen = !open;\n\t\tif (open) focusedIndex = options.findIndex((o) => o.value === value);\n\t}\n\n\tfunction close() {\n\t\topen = false;\n\t\tfocusedIndex = -1;\n\t}\n\n\tfunction selectOption(opt?: { value: string; label: string }) {\n\t\tif (!opt) return;\n\t\tvalue = opt.value;\n\t\t// Call the onchange callback if provided\n\t\tonchange?.({ value: opt.value });\n\t\tclose();\n\t\tsetTimeout(() => (buttonEl as any)?.focus(), 0);\n\t}\n\n\tfunction onKeydown(e: KeyboardEvent) {\n\t\tif (!open && (e.key === 'Enter' || e.key === ' ')) {\n\t\t\te.preventDefault();\n\t\t\ttoggle();\n\t\t\treturn;\n\t\t}\n\t\tif (!open) return;\n\t\tif (e.key === 'ArrowDown') {\n\t\t\te.preventDefault();\n\t\t\tfocusedIndex = Math.min(focusedIndex + 1, options.length - 1);\n\t\t\ta11yScroll();\n\t\t} else if (e.key === 'ArrowUp') {\n\t\t\te.preventDefault();\n\t\t\tfocusedIndex = Math.max(focusedIndex - 1, 0);\n\t\t\ta11yScroll();\n\t\t} else if (e.key === 'Enter') {\n\t\t\te.preventDefault();\n\t\t\tconst opt = options[focusedIndex];\n\t\t\tif (opt) selectOption(opt);\n\t\t} else if (e.key === 'Escape') {\n\t\t\tclose();\n\t\t}\n\t}\n\n\tfunction a11yScroll() {\n\t\tif (!listEl) return;\n\t\tconst child = listEl.querySelectorAll('[role=\"option\"]')[focusedIndex] as\n\t\t\t| HTMLElement\n\t\t\t| undefined;\n\t\tchild?.scrollIntoView({ block: 'nearest' });\n\t}\n\n\t// Click outside to close\n\tfunction docClick(e: MouseEvent) {\n\t\tif (!open) return;\n\t\tif (!buttonEl) return;\n\t\tconst path = (e.composedPath && e.composedPath()) || (e as any).path || [];\n\t\tif (path.includes(buttonEl) || (listEl && path.includes(listEl))) return;\n\t\tclose();\n\t}\n\n\tif (typeof document !== 'undefined') {\n\t\tdocument.addEventListener('click', docClick);\n\t}\n\n\tonDestroy(() => {\n\t\tif (typeof document !== 'undefined') document.removeEventListener('click', docClick);\n\t});\n</script>\n\n<div class={`select-mobile ${className}`}>\n\t<button\n\t\t{id}\n\t\tbind:this={buttonEl}\n\t\ttype=\"button\"\n\t\trole=\"combobox\"\n\t\taria-haspopup=\"listbox\"\n\t\taria-expanded={open}\n\t\taria-controls={id ? `list-${id}` : undefined}\n\t\tclass=\"select-btn\"\n\t\tonclick={toggle}\n\t\tonkeydown={onKeydown}\n\t>\n\t\t<span class=\"label\">{options.find((o) => o.value === value)?.label ?? placeholder}</span>\n\t\t<svg class=\"caret\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t<path\n\t\t\t\td=\"M6 9l6 6 6-6\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tstroke-width=\"2\"\n\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t/>\n\t\t</svg>\n\t</button>\n\n\t{#if open}\n\t\t<ul\n\t\t\tid={id ? `list-${id}` : undefined}\n\t\t\tclass=\"options\"\n\t\t\trole=\"listbox\"\n\t\t\tbind:this={listEl}\n\t\t\ttabindex=\"0\"\n\t\t\taria-activedescendant={focusedIndex >= 0 ? `option-${focusedIndex}` : undefined}\n\t\t>\n\t\t\t{#each options as opt, i}\n\t\t\t\t<li\n\t\t\t\t\tid={`option-${i}`}\n\t\t\t\t\trole=\"option\"\n\t\t\t\t\tclass:selected={opt.value === value}\n\t\t\t\t\taria-selected={opt.value === value}\n\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\tonclick={() => selectOption(opt)}\n\t\t\t\t\tonkeydown={(e) => {\n\t\t\t\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tselectOption(opt);\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tonmouseenter={() => (focusedIndex = i)}\n\t\t\t\t\ttitle={opt.label}\n\t\t\t\t>\n\t\t\t\t\t{opt.label}\n\t\t\t\t</li>\n\t\t\t{/each}\n\t\t</ul>\n\t{/if}\n</div>\n\n<style>\n\t.select-mobile {\n\t\tdisplay: block; /* visible when component is rendered by Svelte (mobile) */\n\t\tposition: relative;\n\t}\n\n\t.select-btn {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\twidth: 100%;\n\t\tpadding: 12px 14px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tbackground: white;\n\t\tfont-size: 16px;\n\t\ttext-align: left;\n\t\tcursor: pointer;\n\t}\n\n\t.select-btn:focus {\n\t\toutline: none;\n\t\tbox-shadow: 0 0 0 3px rgba(255, 127, 80, 0.12);\n\t}\n\n\t.select-btn .label {\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tdisplay: inline-block;\n\t\tmax-width: calc(100% - 28px);\n\t}\n\n\t.options {\n\t\tposition: absolute;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tmargin-top: 6px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tmax-height: 220px;\n\t\toverflow: auto;\n\t\tz-index: 1000;\n\t\tpadding: 6px 6px;\n\t\tbox-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);\n\t}\n\n\t.options li {\n\t\tpadding: 10px 12px;\n\t\tborder-radius: 8px;\n\t\tcursor: pointer;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t.options li:hover,\n\t.options li.selected {\n\t\tbackground: #f9fafb;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ui\\Skeleton.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\components\\ui\\ToastContainer.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-at-html-tags",
				"severity": 2,
				"message": "`{@html}` can lead to XSS attack.",
				"line": 46,
				"column": 5,
				"nodeType": "SvelteMustacheTag",
				"messageId": "unexpected",
				"endLine": 46,
				"endColumn": 30
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { toasts } from '$lib/stores/toast';\n\timport { flip } from 'svelte/animate';\n\timport { fade, fly } from 'svelte/transition';\n\timport { sanitizeStaticSvg } from '$lib/utils/sanitize';\n\n\t// [!code fix] SECURITY (Issue #7, #43): Sanitize static SVG icons as defense-in-depth\n\tconst icons = {\n\t\tsuccess: sanitizeStaticSvg(\n\t\t\t'<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path></svg>'\n\t\t),\n\t\terror: sanitizeStaticSvg(\n\t\t\t'<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg>'\n\t\t),\n\t\twarning: sanitizeStaticSvg(\n\t\t\t'<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path></svg>'\n\t\t),\n\t\tinfo: sanitizeStaticSvg(\n\t\t\t'<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>'\n\t\t)\n\t};\n\n\tconst colors = {\n\t\tsuccess: 'bg-green-50 text-green-800 border-green-200',\n\t\terror: 'bg-red-50 text-red-800 border-red-200',\n\t\twarning: 'bg-yellow-50 text-yellow-800 border-yellow-200',\n\t\tinfo: 'bg-blue-50 text-blue-800 border-blue-200'\n\t};\n</script>\n\n<div\n\tclass=\"fixed right-4 z-50 flex flex-col gap-2 pointer-events-none\"\n\tstyle=\"bottom: calc(1rem + env(safe-area-inset-bottom, 0px));\"\n>\n\t{#each $toasts as toast (toast.id)}\n\t\t<div\n\t\t\tanimate:flip\n\t\t\tin:fly={{ y: 20, duration: 300 }}\n\t\t\tout:fade={{ duration: 200 }}\n\t\t\tclass=\"pointer-events-auto flex items-center w-full max-w-sm p-4 mb-2 border rounded-lg shadow-lg {colors[\n\t\t\t\ttoast.type\n\t\t\t]}\"\n\t\t\trole=\"alert\"\n\t\t>\n\t\t\t<div class=\"inline-flex items-center justify-center flex-shrink-0 w-8 h-8 rounded-full\">\n\t\t\t\t{@html icons[toast.type]}\n\t\t\t</div>\n\t\t\t<div class=\"ml-3 text-sm font-normal\">{toast.message}</div>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"ml-auto -mx-1.5 -my-1.5 rounded-lg focus:ring-2 p-1.5 inline-flex h-8 w-8 hover:bg-black/5\"\n\t\t\t\tonclick={() => toasts.dismiss(toast.id)}\n\t\t\t\taria-label=\"Close\"\n\t\t\t>\n\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\n\t\t\t\t\t><path\n\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\td=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\"\n\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t></path></svg\n\t\t\t\t>\n\t\t\t</button>\n\t\t</div>\n\t{/each}\n</div>\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\constants.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\db\\indexedDB.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 204,
				"column": 33,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 204,
				"endColumn": 36,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6820, 6823], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6820, 6823], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 216,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 216,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7159, 7162], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7159, 7162], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 350,
				"column": 32,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 350,
				"endColumn": 35,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [10552, 10555], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [10552, 10555], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 3,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/db/indexedDB.ts\nimport { openDB, type IDBPDatabase } from 'idb';\nimport { DB_NAME, DB_VERSION } from './types';\nimport type { TripRecord, TrashRecord, SyncQueueItem, ExpenseRecord, MileageRecord } from './types';\n\n/**\n * Database interface with typed stores\n */\nexport interface AppDB {\n\ttrips: {\n\t\tkey: string;\n\t\tvalue: TripRecord;\n\t\tindexes: {\n\t\t\tuserId: string;\n\t\t\tsyncStatus: string;\n\t\t\tupdatedAt: string;\n\t\t};\n\t};\n\texpenses: {\n\t\t// [!code ++] New Store\n\t\tkey: string;\n\t\tvalue: ExpenseRecord;\n\t\tindexes: {\n\t\t\tuserId: string;\n\t\t\tsyncStatus: string;\n\t\t\tdate: string;\n\t\t};\n\t};\n\ttrash: {\n\t\tkey: string;\n\t\tvalue: TrashRecord;\n\t\tindexes: {\n\t\t\tuserId: string;\n\t\t\tsyncStatus: string;\n\t\t\tdeletedAt: string;\n\t\t\texpiresAt: string;\n\t\t};\n\t};\n\tmileage: {\n\t\tkey: string;\n\t\tvalue: MileageRecord;\n\t\tindexes: {\n\t\t\tuserId: string;\n\t\t\tsyncStatus: string;\n\t\t\tdate: string;\n\t\t};\n\t};\n\tsyncQueue: {\n\t\tkey: number;\n\t\tvalue: SyncQueueItem;\n\t\tindexes: {\n\t\t\ttimestamp: number;\n\t\t\taction: string;\n\t\t\ttripId: string;\n\t\t};\n\t};\n}\n\nlet dbPromise: Promise<IDBPDatabase<AppDB>> | null = null;\n\n/**\n * Open or create the IndexedDB database\n * * This creates 4 object stores:\n * - trips: Active trips\n * - expenses: Active expenses\n * - trash: Deleted items (30-day retention)\n * - syncQueue: Pending changes to sync to cloud\n */\nexport async function getDB(): Promise<IDBPDatabase<AppDB>> {\n\tif (dbPromise) {\n\t\treturn dbPromise;\n\t}\n\n\t// Try opening the DB with the desired version. If the browser already has a newer\n\t// version (e.g. user has a DB from a different build), openDB will throw a\n\t// VersionError. In that case, fall back to opening the existing database\n\t// without requesting an upgrade to avoid the exception and continue using\n\t// the current schema.\n\ttry {\n\t\tdbPromise = openDB<AppDB>(DB_NAME, DB_VERSION, {\n\t\t\tupgrade(db, oldVersion, newVersion) {\n\t\t\t\tconsole.log(`📦 Upgrading database from v${oldVersion} to v${newVersion}`);\n\n\t\t\t\t// Create trips store\n\t\t\t\tif (!db.objectStoreNames.contains('trips')) {\n\t\t\t\t\tconsole.log('Creating \"trips\" object store...');\n\t\t\t\t\tconst tripStore = db.createObjectStore('trips', { keyPath: 'id' });\n\n\t\t\t\t\t// Indexes for efficient queries\n\t\t\t\t\ttripStore.createIndex('userId', 'userId', { unique: false });\n\t\t\t\t\ttripStore.createIndex('syncStatus', 'syncStatus', { unique: false });\n\t\t\t\t\ttripStore.createIndex('updatedAt', 'updatedAt', { unique: false });\n\n\t\t\t\t\tconsole.log('✅ Created \"trips\" store with indexes');\n\t\t\t\t}\n\n\t\t\t\t// [!code ++] Create expenses store\n\t\t\t\tif (!db.objectStoreNames.contains('expenses')) {\n\t\t\t\t\tconsole.log('Creating \"expenses\" object store...');\n\t\t\t\t\tconst expenseStore = db.createObjectStore('expenses', { keyPath: 'id' });\n\n\t\t\t\t\t// Indexes for efficient queries\n\t\t\t\t\texpenseStore.createIndex('userId', 'userId', { unique: false });\n\t\t\t\t\texpenseStore.createIndex('syncStatus', 'syncStatus', { unique: false });\n\t\t\t\t\texpenseStore.createIndex('date', 'date', { unique: false });\n\n\t\t\t\t\tconsole.log('✅ Created \"expenses\" store with indexes');\n\t\t\t\t}\n\n\t\t\t\t// Create trash store\n\t\t\t\tif (!db.objectStoreNames.contains('trash')) {\n\t\t\t\t\tconsole.log('Creating \"trash\" object store...');\n\t\t\t\t\tconst trashStore = db.createObjectStore('trash', { keyPath: 'id' });\n\n\t\t\t\t\t// Indexes for efficient queries\n\t\t\t\t\ttrashStore.createIndex('userId', 'userId', { unique: false });\n\t\t\t\t\ttrashStore.createIndex('syncStatus', 'syncStatus', { unique: false });\n\t\t\t\t\ttrashStore.createIndex('deletedAt', 'deletedAt', { unique: false });\n\t\t\t\t\ttrashStore.createIndex('expiresAt', 'expiresAt', { unique: false });\n\n\t\t\t\t\tconsole.log('✅ Created \"trash\" store with indexes');\n\t\t\t\t}\n\n\t\t\t\t// [!code ++] Create mileage store\n\t\t\t\tif (!db.objectStoreNames.contains('mileage')) {\n\t\t\t\t\tconsole.log('Creating \"mileage\" object store...');\n\t\t\t\t\tconst mileageStore = db.createObjectStore('mileage', { keyPath: 'id' });\n\n\t\t\t\t\t// Indexes for efficient queries\n\t\t\t\t\tmileageStore.createIndex('userId', 'userId', { unique: false });\n\t\t\t\t\tmileageStore.createIndex('syncStatus', 'syncStatus', { unique: false });\n\t\t\t\t\tmileageStore.createIndex('date', 'date', { unique: false });\n\n\t\t\t\t\tconsole.log('✅ Created \"mileage\" store with indexes');\n\t\t\t\t}\n\n\t\t\t\t// Create syncQueue store\n\t\t\t\tif (!db.objectStoreNames.contains('syncQueue')) {\n\t\t\t\t\tconsole.log('Creating \"syncQueue\" object store...');\n\t\t\t\t\tconst queueStore = db.createObjectStore('syncQueue', {\n\t\t\t\t\t\tkeyPath: 'id',\n\t\t\t\t\t\tautoIncrement: true\n\t\t\t\t\t});\n\n\t\t\t\t\t// Indexes\n\t\t\t\t\tqueueStore.createIndex('timestamp', 'timestamp', { unique: false });\n\t\t\t\t\tqueueStore.createIndex('action', 'action', { unique: false });\n\t\t\t\t\tqueueStore.createIndex('tripId', 'tripId', { unique: false });\n\n\t\t\t\t\tconsole.log('✅ Created \"syncQueue\" store with indexes');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tblocked() {\n\t\t\t\tconsole.warn('⚠️ Database upgrade blocked - close other tabs');\n\t\t\t},\n\n\t\t\tblocking() {\n\t\t\t\tconsole.warn('⚠️ This tab is blocking database upgrade in another tab');\n\t\t\t}\n\t\t});\n\n\t\t// Force resolution now so VersionError is thrown inside the try block\n\t\tawait dbPromise;\n\n\t\t// Migration: If an older DB used the legacy 'millage' store name, migrate its\n\t\t// data to the canonical 'mileage' store and drop the legacy store. We do this\n\t\t// after opening so we can read the old data, then perform a version upgrade\n\t\t// to create the new store and remove the old one.\n\t\ttry {\n\t\t\tconst db = await dbPromise;\n\t\t\tif (db.objectStoreNames.contains('millage') && !db.objectStoreNames.contains('mileage')) {\n\t\t\t\tconsole.log('🔁 Migrating legacy \"millage\" store to \"mileage\"...');\n\t\t\t\t// Read all entries from legacy store\n\t\t\t\tconst readTx = db.transaction('millage', 'readonly');\n\t\t\t\tconst oldItems = await readTx.objectStore('millage').getAll();\n\t\t\t\tawait readTx.done;\n\n\t\t\t\t// Close current connection and bump DB version to perform structural upgrades\n\t\t\t\tdb.close();\n\t\t\t\tconst newVersion = (db.version || DB_VERSION) + 1;\n\n\t\t\t\tconst migratedDB = await openDB<AppDB>(DB_NAME, newVersion, {\n\t\t\t\t\tupgrade(upDb) {\n\t\t\t\t\t\tif (!upDb.objectStoreNames.contains('mileage')) {\n\t\t\t\t\t\t\tconsole.log('Creating \"mileage\" store during migration...');\n\t\t\t\t\t\t\tconst mileageStore = upDb.createObjectStore('mileage', { keyPath: 'id' });\n\t\t\t\t\t\t\tmileageStore.createIndex('userId', 'userId', { unique: false });\n\t\t\t\t\t\t\tmileageStore.createIndex('syncStatus', 'syncStatus', { unique: false });\n\t\t\t\t\t\t\tmileageStore.createIndex('date', 'date', { unique: false });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (upDb.objectStoreNames.contains('millage')) {\n\t\t\t\t\t\t\tupDb.deleteObjectStore('millage');\n\t\t\t\t\t\t\tconsole.log('Deleted legacy \"millage\" store');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Populate migrated store with old entries\n\t\t\t\tif (oldItems && oldItems.length > 0) {\n\t\t\t\t\tconst writeTx = migratedDB.transaction('mileage', 'readwrite');\n\t\t\t\t\tconst outStore = writeTx.objectStore('mileage');\n\t\t\t\t\tfor (const itm of oldItems) {\n\t\t\t\t\t\tawait outStore.put(itm as any);\n\t\t\t\t\t}\n\t\t\t\t\tawait writeTx.done;\n\t\t\t\t\tconsole.log(`✅ Migrated ${oldItems.length} mileage records`);\n\t\t\t\t}\n\n\t\t\t\t// Replace the cached dbPromise with the migrated instance\n\t\t\t\tdbPromise = Promise.resolve(migratedDB);\n\t\t\t}\n\t\t} catch (migErr) {\n\t\t\tconsole.warn('⚠️ Mileage migration failed or not necessary:', migErr);\n\t\t}\n\t} catch (err: any) {\n\t\tif (\n\t\t\terr?.name === 'VersionError' ||\n\t\t\t(typeof DOMException !== 'undefined' &&\n\t\t\t\terr instanceof DOMException &&\n\t\t\t\terr.name === 'VersionError')\n\t\t) {\n\t\t\tconsole.warn(\n\t\t\t\t'⚠️ Database has a newer version than this code expects. Opening existing DB without upgrade.'\n\t\t\t);\n\t\t\t// Fallback: open at the existing database version without attempting to upgrade\n\t\t\tdbPromise = openDB<AppDB>(DB_NAME);\n\t\t} else {\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\treturn dbPromise;\n}\n\nexport function getMileageStoreName(db: IDBPDatabase<AppDB>): 'mileage' | 'millage' {\n\tif (db.objectStoreNames.contains('mileage')) return 'mileage';\n\tif (db.objectStoreNames.contains('millage')) return 'millage';\n\treturn 'mileage';\n}\n\n/**\n * Clear all data from the database (useful for testing/debugging)\n */\nexport async function clearDatabase(): Promise<void> {\n\tconst db = await getDB();\n\n\t// [!code ++] Added expenses to transaction\n\tconst tx = db.transaction(['trips', 'expenses', 'mileage', 'trash', 'syncQueue'], 'readwrite');\n\n\tawait Promise.all([\n\t\ttx.objectStore('trips').clear(),\n\t\ttx.objectStore('expenses').clear(),\n\t\ttx.objectStore('mileage').clear(),\n\t\ttx.objectStore('trash').clear(),\n\t\ttx.objectStore('syncQueue').clear()\n\t]);\n\n\tawait tx.done;\n\n\tconsole.log('🗑️ Database cleared');\n}\n\n/**\n * Get database statistics\n */\nexport async function getDBStats() {\n\tconst db = await getDB();\n\n\t// [!code ++] Added expenses\n\tconst tx = db.transaction(['trips', 'expenses', 'mileage', 'trash', 'syncQueue'], 'readonly');\n\n\tconst [tripCount, expenseCount, mileageCount, trashCount, queueCount] = await Promise.all([\n\t\ttx.objectStore('trips').count(),\n\t\ttx.objectStore('expenses').count(),\n\t\ttx.objectStore('mileage').count(),\n\t\ttx.objectStore('trash').count(),\n\t\ttx.objectStore('syncQueue').count()\n\t]);\n\n\treturn {\n\t\ttrips: tripCount,\n\t\texpenses: expenseCount,\n\t\tmileage: mileageCount,\n\t\ttrash: trashCount,\n\t\tpendingSync: queueCount\n\t};\n}\n\n/**\n * Export all data (for backup/debugging)\n */\nexport async function exportData() {\n\tconst db = await getDB();\n\n\t// [!code ++] Added expenses\n\tconst tx = db.transaction(['trips', 'expenses', 'mileage', 'trash', 'syncQueue'], 'readonly');\n\n\tconst [trips, expenses, mileage, trash, syncQueue] = await Promise.all([\n\t\ttx.objectStore('trips').getAll(),\n\t\ttx.objectStore('expenses').getAll(),\n\t\ttx.objectStore('mileage').getAll(),\n\t\ttx.objectStore('trash').getAll(),\n\t\ttx.objectStore('syncQueue').getAll()\n\t]);\n\n\treturn {\n\t\ttrips,\n\t\texpenses,\n\t\tmileage,\n\t\ttrash,\n\t\tsyncQueue,\n\t\texportedAt: new Date().toISOString()\n\t};\n}\n\n/**\n * Import data (for restore/debugging)\n */\nexport async function importData(data: {\n\ttrips?: TripRecord[];\n\texpenses?: ExpenseRecord[]; // [!code ++]\n\tmileage?: MileageRecord[];\n\ttrash?: TrashRecord[];\n\tsyncQueue?: SyncQueueItem[];\n}) {\n\tconst db = await getDB();\n\n\tconst tx = db.transaction(['trips', 'expenses', 'mileage', 'trash', 'syncQueue'], 'readwrite');\n\n\t// Import trips\n\tif (data.trips) {\n\t\tconst tripStore = tx.objectStore('trips');\n\t\tfor (const trip of data.trips) {\n\t\t\tawait tripStore.put(trip);\n\t\t}\n\t}\n\n\t// [!code ++] Import expenses and mileage\n\tif (data.expenses) {\n\t\tconst expenseStore = tx.objectStore('expenses');\n\t\tfor (const expense of data.expenses) {\n\t\t\tawait expenseStore.put(expense);\n\t\t}\n\t}\n\n\tif (data.mileage) {\n\t\tconst mileageStore = tx.objectStore('mileage');\n\t\tfor (const m of data.mileage) {\n\t\t\tawait mileageStore.put(m as any);\n\t\t}\n\t}\n\n\t// Import trash\n\tif (data.trash) {\n\t\tconst trashStore = tx.objectStore('trash');\n\t\tfor (const item of data.trash) {\n\t\t\tawait trashStore.put(item);\n\t\t}\n\t}\n\n\t// Import sync queue\n\tif (data.syncQueue) {\n\t\tconst queueStore = tx.objectStore('syncQueue');\n\t\tfor (const item of data.syncQueue) {\n\t\t\tawait queueStore.put(item);\n\t\t}\n\t}\n\n\tawait tx.done;\n\n\tconsole.log('✅ Data imported successfully');\n}\n\n/**\n * Delete the entire database (nuclear option)\n */\nexport async function deleteDatabase(): Promise<void> {\n\tif (dbPromise) {\n\t\tconst db = await dbPromise;\n\t\tdb.close();\n\t\tdbPromise = null;\n\t}\n\n\tawait new Promise<void>((resolve, reject) => {\n\t\tconst request = indexedDB.deleteDatabase(DB_NAME);\n\t\trequest.onsuccess = () => {\n\t\t\tconsole.log('🗑️ Database deleted');\n\t\t\tresolve();\n\t\t};\n\t\trequest.onerror = () => reject(request.error);\n\t\trequest.onblocked = () => {\n\t\t\tconsole.warn('⚠️ Database deletion blocked - close other tabs');\n\t\t};\n\t});\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\db\\test.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\db\\types.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\index.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\PlacesIndexDO.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\TripIndexDO.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\auditLog.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\auth.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\authenticatorService.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\csrf.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\debug.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\dev-mock-db.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\directionsCache.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\email.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\env.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\expenseService.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\geocode.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet-parser.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet\\auth.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet\\constants.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet\\fetcher.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet\\parser.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet\\router.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet\\service.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet\\tripBuilder.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet\\types.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\hughesnet\\utils.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\log.ts",
		"messages": [],
		"suppressedMessages": [
			{
				"ruleId": "no-console",
				"severity": 2,
				"message": "Unexpected console statement.",
				"line": 57,
				"column": 4,
				"nodeType": "MemberExpression",
				"messageId": "unexpected",
				"endLine": 57,
				"endColumn": 18,
				"suggestions": [
					{
						"fix": { "range": [1361, 1401], "text": "" },
						"messageId": "removeMethodCall",
						"desc": "Remove the console method call."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "no-console",
				"severity": 2,
				"message": "Unexpected console statement.",
				"line": 60,
				"column": 4,
				"nodeType": "MemberExpression",
				"messageId": "unexpected",
				"endLine": 60,
				"endColumn": 18,
				"suggestions": [
					{
						"fix": { "range": [1463, 1527], "text": "" },
						"messageId": "removeMethodCall",
						"desc": "Remove the console method call."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "no-console",
				"severity": 2,
				"message": "Unexpected console statement.",
				"line": 64,
				"column": 3,
				"nodeType": "MemberExpression",
				"messageId": "unexpected",
				"endLine": 64,
				"endColumn": 17,
				"suggestions": [
					{
						"fix": { "range": [1585, 1609], "text": "" },
						"messageId": "removeMethodCall",
						"desc": "Remove the console method call."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\migration\\storage-key-migration.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\mileageService.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\mockKv.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\passwordValidation.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\rateLimit.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\requestValidation.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\sanitize.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\session.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\sessionService.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\stripe.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\stripe\\webhook.spec.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 81,
				"column": 56,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 81,
				"endColumn": 59,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2711, 2714], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2711, 2714], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 82,
				"column": 38,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 82,
				"endColumn": 41,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2754, 2757], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2754, 2757], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 103,
				"column": 56,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 103,
				"endColumn": 59,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3468, 3471], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3468, 3471], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 104,
				"column": 38,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 104,
				"endColumn": 41,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3511, 3514], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3511, 3514], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 4,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { describe, it, expect, beforeEach, vi } from 'vitest';\nimport { setupMockKV } from '$lib/server/dev-mock-db';\n\nimport type Stripe from 'stripe';\n\n// Mock hook for stripe.getStripe\nlet constructEventStub: (body: string, sig: string, secret: string) => Stripe.Event = () =>\n\t({ type: '', data: { object: {} } }) as unknown as Stripe.Event;\nvi.mock('$lib/server/stripe', () => ({\n\tgetStripe: () => ({\n\t\twebhooks: {\n\t\t\tconstructEvent: (body: string, sig: string, secret: string) =>\n\t\t\t\tconstructEventStub(body, sig, secret)\n\t\t}\n\t})\n}));\n\nimport { POST } from '../../../routes/api/stripe/webhook/+server';\nimport * as userService from '$lib/server/userService';\nimport { safeKV } from '$lib/server/env';\n\nfunction makeReq(body: string, sig = 'sig') {\n\tconst req = {\n\t\theaders: { get: (_k: string) => sig },\n\t\ttext: async () => body\n\t};\n\treturn req as unknown as Request;\n}\n\ndescribe('Stripe webhook handler', () => {\n\tlet platform: { env: Record<string, unknown> };\n\n\tbeforeEach(async () => {\n\t\tconst event = { platform: { env: {} as Record<string, unknown> } };\n\t\tawait setupMockKV(event);\n\t\tplatform = event.platform;\n\t\t// Set webhook secret\n\t\t(platform.env as Record<string, unknown>)['STRIPE_WEBHOOK_SECRET'] = 'whsec_test';\n\t});\n\n\tit('handles checkout.session.completed and persists mapping + upgrades user', async () => {\n\t\tconst usersKV = safeKV(platform.env, 'BETA_USERS_KV')!;\n\n\t\t// Spy on updateUserPlan\n\t\tconst spy = vi.spyOn(userService, 'updateUserPlan').mockResolvedValue(undefined);\n\n\t\tconstructEventStub = () =>\n\t\t\t({\n\t\t\t\ttype: 'checkout.session.completed',\n\t\t\t\tdata: { object: { metadata: { userId: 'u1' }, customer: 'cus_123' } }\n\t\t\t}) as unknown as Stripe.Event;\n\n\t\tconst req = makeReq(JSON.stringify({}));\n\t\tconst res = await POST({ request: req, platform } as unknown as Parameters<typeof POST>[0]);\n\t\tconst body = (await res.json()) as Record<string, unknown>;\n\t\texpect(body['received']).toBe(true);\n\n\t\texpect(spy).toHaveBeenCalledWith(usersKV, 'u1', 'pro', 'cus_123');\n\n\t\t// persisted mapping\n\t\tconst mapped = await usersKV.get('stripe:customer:cus_123');\n\t\texpect(mapped).toBe('u1');\n\n\t\tspy.mockRestore();\n\t});\n\n\tit('handles customer.subscription.deleted and downgrades user via mapping', async () => {\n\t\tconst usersKV = safeKV(platform.env, 'BETA_USERS_KV')!;\n\t\t// Create mapping\n\t\tawait usersKV.put('stripe:customer:cus_del', 'user_del');\n\n\t\tconst spy = vi.spyOn(userService, 'updateUserPlan').mockResolvedValue(undefined);\n\n\t\tconstructEventStub = () =>\n\t\t\t({\n\t\t\t\ttype: 'customer.subscription.deleted',\n\t\t\t\tdata: { object: { customer: 'cus_del' } }\n\t\t\t}) as unknown as Stripe.Event;\n\n\t\tconst req = makeReq(JSON.stringify({}));\n\t\tconst res = await POST({ request: req, platform } as any);\n\t\tconst body = (await res.json()) as any;\n\t\texpect(body.received).toBe(true);\n\n\t\texpect(spy).toHaveBeenCalledWith(usersKV, 'user_del', 'free');\n\n\t\tspy.mockRestore();\n\t});\n\n\tit('handles customer.subscription.updated and downgrades when status is canceled', async () => {\n\t\tconst usersKV = safeKV(platform.env, 'BETA_USERS_KV')!;\n\t\tawait usersKV.put('stripe:customer:cus_upd', 'user_upd');\n\n\t\tconst spy = vi.spyOn(userService, 'updateUserPlan').mockResolvedValue(undefined);\n\n\t\tconstructEventStub = () =>\n\t\t\t({\n\t\t\t\ttype: 'customer.subscription.updated',\n\t\t\t\tdata: { object: { customer: 'cus_upd', status: 'canceled' } }\n\t\t\t}) as unknown as Stripe.Event;\n\n\t\tconst req = makeReq(JSON.stringify({}));\n\t\tconst res = await POST({ request: req, platform } as any);\n\t\tconst body = (await res.json()) as any;\n\t\texpect(body.received).toBe(true);\n\n\t\texpect(spy).toHaveBeenCalledWith(usersKV, 'user_upd', 'free');\n\n\t\tspy.mockRestore();\n\t});\n});\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\tripService.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\user.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\userService.ts",
		"messages": [],
		"suppressedMessages": [
			{
				"ruleId": "no-restricted-syntax",
				"severity": 2,
				"message": "SECURITY: Do not use user.name/email/token for ownership checks. Use 'user.id' only. (See SECURITY.md)",
				"line": 346,
				"column": 26,
				"nodeType": "MemberExpression",
				"messageId": "restrictedSyntax",
				"endLine": 346,
				"endColumn": 36,
				"suppressions": [{ "kind": "directive", "justification": "Legacy index cleanup (safe)" }]
			}
		],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\webauthn-utils.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\server\\webauthn.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\services\\googleMaps.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\services\\maps.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\auth.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 274,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 274,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7861, 7864], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7861, 7864], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 342,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 342,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [9924, 9927], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [9924, 9927], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 384,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 384,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [11081, 11084], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [11081, 11084], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 400,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 400,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [11622, 11625], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [11622, 11625], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 425,
				"column": 18,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 425,
				"endColumn": 21,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [12302, 12305], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [12302, 12305], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 445,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 445,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [12826, 12829], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [12826, 12829], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 6,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/stores/auth.ts\nimport { writable, derived } from 'svelte/store';\nimport type { User, AuthResponse } from '$lib/types';\nimport { storage } from '$lib/utils/storage';\nimport { api } from '$lib/utils/api';\nimport { trips } from './trips';\nimport { csrfFetch } from '$lib/utils/csrf';\n\ninterface AuthState {\n\tuser: User | null;\n\tisAuthenticated: boolean;\n\tisLoading: boolean;\n\terror: string | null;\n}\n\nconst getOfflineId = () => {\n\tif (typeof window === 'undefined') return null;\n\treturn localStorage.getItem('offline_user_id');\n};\n\n// [SECURITY FIX #54] Cache user data in sessionStorage instead of localStorage\n// sessionStorage clears on tab close, reducing XSS exposure window\n\nconst normalizePlan = (p: unknown): User['plan'] => {\n\tif (p === 'free' || p === 'pro' || p === 'business' || p === 'premium') return p;\n\treturn 'free';\n};\n\nconst saveUserCache = (user: User) => {\n\tif (typeof window !== 'undefined') {\n\t\t// Only cache non-sensitive display data\n\t\tconst safeCache = {\n\t\t\tid: user.id, // [!code fix] Cache the UUID\n\t\t\tplan: user.plan,\n\t\t\ttripsThisMonth: user.tripsThisMonth,\n\t\t\tmaxTrips: user.maxTrips,\n\t\t\tresetDate: user.resetDate,\n\t\t\tname: user.name || ''\n\t\t\t// Note: email and token are NOT cached\n\t\t};\n\t\tsessionStorage.setItem('user_cache', JSON.stringify(safeCache));\n\t}\n};\n\n// Helper: Retrieve cached user data\nconst getUserCache = (): User | null => {\n\tif (typeof window === 'undefined') return null;\n\tconst cached = sessionStorage.getItem('user_cache');\n\tif (!cached) return null;\n\ttry {\n\t\tconst parsed = JSON.parse(cached);\n\n\t\t// [!code fix] CRITICAL: Invalidate cache if ID is missing.\n\t\t// This forces a fresh fetch from the server to get the correct UUID.\n\t\tif (!parsed.id) {\n\t\t\tsessionStorage.removeItem('user_cache');\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: parsed.id, // [!code fix] Restore the UUID\n\t\t\ttoken: '', // Never cached\n\t\t\tplan: parsed.plan || 'free',\n\t\t\ttripsThisMonth: parsed.tripsThisMonth ?? 0,\n\t\t\tmaxTrips: parsed.maxTrips ?? 10,\n\t\t\tresetDate: parsed.resetDate || '',\n\t\t\tname: parsed.name || ''\n\t\t};\n\t} catch {\n\t\treturn null;\n\t}\n};\n\nfunction createAuthStore() {\n\tconst { subscribe, set, update } = writable<AuthState>({\n\t\tuser: null,\n\t\tisAuthenticated: false,\n\t\tisLoading: false,\n\t\terror: null\n\t});\n\n\treturn {\n\t\tsubscribe,\n\n\t\thydrate: (userData: User) => {\n\t\t\tlet localName = '';\n\t\t\tlet localEmail = '';\n\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\tlocalName = storage.getUsername() || '';\n\t\t\t\t// [SECURITY FIX #54] Email now in sessionStorage, not localStorage\n\t\t\t\tlocalEmail = sessionStorage.getItem('user_email') || '';\n\t\t\t\t// [SECURITY FIX #52] Session tokens are now in httpOnly cookies\n\t\t\t\t// No need to store token in localStorage\n\t\t\t}\n\n\t\t\tconst mergedUser = {\n\t\t\t\t...userData,\n\t\t\t\tname: userData.name || localName,\n\t\t\t\temail: userData.email || localEmail\n\t\t\t};\n\n\t\t\t// Update cache on hydration\n\t\t\tsaveUserCache(mergedUser);\n\n\t\t\tset({\n\t\t\t\tuser: mergedUser,\n\t\t\t\tisAuthenticated: true,\n\t\t\t\tisLoading: false,\n\t\t\t\terror: null\n\t\t\t});\n\t\t},\n\n\t\tinit: async () => {\n\t\t\t// [SECURITY FIX #52] Session tokens are now in httpOnly cookies\n\t\t\t// Check authentication status via server call instead of localStorage\n\t\t\tconst username = storage.getUsername();\n\t\t\t// [SECURITY FIX #54] Email now in sessionStorage, not localStorage\n\t\t\tconst email = typeof window !== 'undefined' ? sessionStorage.getItem('user_email') : null;\n\n\t\t\t// Try to verify session with server (cookies sent automatically)\n\t\t\tupdate((state) => ({ ...state, isLoading: true }));\n\t\t\ttry {\n\t\t\t\tconst response = await fetch('/api/auth/session', {\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\tcredentials: 'include'\n\t\t\t\t});\n\n\t\t\t\tif (response.ok) {\n\t\t\t\t\tconst responseData = (await response.json()) as { user?: Partial<User> };\n\t\t\t\t\tconst data = responseData.user || {};\n\t\t\t\t\tconst user: User = {\n\t\t\t\t\t\tid: data.id, // [!code fix] Critical: Capture UUID from server session\n\t\t\t\t\t\ttoken: '', // No longer stored client-side\n\t\t\t\t\t\tplan: data.plan || 'free',\n\t\t\t\t\t\ttripsThisMonth: data.tripsThisMonth ?? 0,\n\t\t\t\t\t\tmaxTrips: data.maxTrips ?? 10,\n\t\t\t\t\t\tresetDate: data.resetDate || '',\n\t\t\t\t\t\tname: data.name || username || '',\n\t\t\t\t\t\temail: data.email || email || ''\n\t\t\t\t\t};\n\n\t\t\t\t\t// Success: Update offline cache\n\t\t\t\t\tsaveUserCache(user);\n\n\t\t\t\t\tset({\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\tisAuthenticated: true,\n\t\t\t\t\t\tisLoading: false,\n\t\t\t\t\t\terror: null\n\t\t\t\t\t});\n\n\t\t\t\t\t// Prefer ID for sync; do not fallback to name\n\t\t\t\t\tif (user.id) await trips.syncFromCloud(user.id);\n\t\t\t\t} else {\n\t\t\t\t\t// Not authenticated - check offline cache\n\t\t\t\t\tconst cachedUser = getUserCache();\n\t\t\t\t\tif (cachedUser && username) {\n\t\t\t\t\t\tconsole.log('✅ Restored user session from offline cache');\n\t\t\t\t\t\tset({\n\t\t\t\t\t\t\tuser: cachedUser,\n\t\t\t\t\t\t\tisAuthenticated: true,\n\t\t\t\t\t\t\tisLoading: false,\n\t\t\t\t\t\t\terror: null\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait trips.load(cachedUser.id || cachedUser.name || 'user');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tset({\n\t\t\t\t\t\t\tuser: null,\n\t\t\t\t\t\t\tisAuthenticated: false,\n\t\t\t\t\t\t\tisLoading: false,\n\t\t\t\t\t\t\terror: null\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.warn('Failed to verify session, checking offline cache...', error);\n\n\t\t\t\t// Fallback to offline cache if server unreachable\n\t\t\t\tconst cachedUser = getUserCache();\n\t\t\t\tif (cachedUser && username) {\n\t\t\t\t\tconsole.log('✅ Restored user session from offline cache');\n\t\t\t\t\tset({\n\t\t\t\t\t\tuser: cachedUser,\n\t\t\t\t\t\tisAuthenticated: true,\n\t\t\t\t\t\tisLoading: false,\n\t\t\t\t\t\terror: null\n\t\t\t\t\t});\n\t\t\t\t\tif (cachedUser.id) await trips.load(cachedUser.id);\n\t\t\t\t} else {\n\t\t\t\t\tset({\n\t\t\t\t\t\tuser: null,\n\t\t\t\t\t\tisAuthenticated: false,\n\t\t\t\t\t\tisLoading: false,\n\t\t\t\t\t\terror: null\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tupdateProfile: (data: { name?: string; email?: string }) => {\n\t\t\tupdate((state) => {\n\t\t\t\tif (!state.user) return state;\n\n\t\t\t\tconst updatedUser = { ...state.user, ...data };\n\n\t\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\t\tif (data.name) storage.setUsername(data.name);\n\t\t\t\t\t// [SECURITY FIX #54] Email now in sessionStorage, not localStorage\n\t\t\t\t\tif (data.email) sessionStorage.setItem('user_email', data.email);\n\t\t\t\t\tsaveUserCache(updatedUser); // Keep cache in sync\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...state,\n\t\t\t\t\tuser: updatedUser\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\n\t\tsignup: async (username: string, password: string) => {\n\t\t\tupdate((state) => ({ ...state, isLoading: true, error: null }));\n\t\t\ttry {\n\t\t\t\tconst response = (await api.signup(username, password)) as AuthResponse;\n\t\t\t\tconst offlineId = getOfflineId();\n\n\t\t\t\t// [SECURITY FIX #52] Only store username, not token\n\t\t\t\tstorage.setUsername(username);\n\n\t\t\t\t// Create server-side session so cloud endpoints (/api/trips) are authorized\n\t\t\t\ttry {\n\t\t\t\t\tawait fetch('/login', {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\t\tbody: JSON.stringify({ email: username, password })\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Failed to create server session after signup:', e);\n\t\t\t\t}\n\n\t\t\t\tlet subscription = { plan: 'free', tripsThisMonth: 0, maxTrips: 10, resetDate: '' };\n\t\t\t\ttry {\n\t\t\t\t\tsubscription = await api.getSubscription();\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// If subscription fetch fails (legacy endpoints), default to free\n\t\t\t\t\tconsole.warn('Subscription lookup failed during signup', e);\n\t\t\t\t}\n\t\t\t\tconst user: User = {\n\t\t\t\t\tid: response.id, // [!code fix] Capture UUID from signup response\n\t\t\t\t\ttoken: '',\n\t\t\t\t\tplan: normalizePlan(subscription.plan),\n\t\t\t\t\ttripsThisMonth: subscription.tripsThisMonth,\n\t\t\t\t\tmaxTrips: subscription.maxTrips,\n\t\t\t\t\tresetDate: subscription.resetDate,\n\t\t\t\t\tname: username,\n\t\t\t\t\temail: ''\n\t\t\t\t};\n\t\t\t\tset({\n\t\t\t\t\tuser,\n\t\t\t\t\tisAuthenticated: true,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\terror: null\n\t\t\t\t});\n\n\t\t\t\tif (offlineId) {\n\t\t\t\t\tawait trips.migrateOfflineTrips(offlineId, user.id || username);\n\t\t\t\t\tlocalStorage.removeItem('offline_user_id');\n\t\t\t\t}\n\n\t\t\t\tawait trips.syncFromCloud(user.id || username);\n\n\t\t\t\treturn { success: true, resetKey: response.resetKey };\n\t\t\t} catch (error: any) {\n\t\t\t\tupdate((state) => ({\n\t\t\t\t\t...state,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\terror: error.message || 'Signup failed'\n\t\t\t\t}));\n\t\t\t\treturn { success: false, error: error.message };\n\t\t\t}\n\t\t},\n\n\t\tlogin: async (username: string, password: string) => {\n\t\t\tupdate((state) => ({ ...state, isLoading: true, error: null }));\n\t\t\ttry {\n\t\t\t\tconst response = (await api.login(username, password)) as AuthResponse;\n\t\t\t\tconst offlineId = getOfflineId();\n\n\t\t\t\t// [SECURITY FIX #52] Only store username, not token\n\t\t\t\tstorage.setUsername(username);\n\n\t\t\t\t// Create server-side session cookie so /api/trips and other server endpoints recognize the user\n\t\t\t\ttry {\n\t\t\t\t\tawait fetch('/login', {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\t\tbody: JSON.stringify({ email: username, password })\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Failed to create server session on login:', e);\n\t\t\t\t}\n\n\t\t\t\t// [SECURITY FIX #54] Email now in sessionStorage, not localStorage\n\t\t\t\tconst savedEmail =\n\t\t\t\t\ttypeof window !== 'undefined' ? sessionStorage.getItem('user_email') || '' : '';\n\t\t\t\tlet subscription = { plan: 'free', tripsThisMonth: 0, maxTrips: 10, resetDate: '' };\n\t\t\t\ttry {\n\t\t\t\t\tsubscription = await api.getSubscription();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Subscription lookup failed during login', e);\n\t\t\t\t}\n\n\t\t\t\tconst user: User = {\n\t\t\t\t\tid: response.id, // [!code fix] Capture UUID from login response\n\t\t\t\t\ttoken: '',\n\t\t\t\t\tplan: normalizePlan(subscription.plan),\n\t\t\t\t\ttripsThisMonth: subscription.tripsThisMonth,\n\t\t\t\t\tmaxTrips: subscription.maxTrips,\n\t\t\t\t\tresetDate: subscription.resetDate,\n\t\t\t\t\tname: username,\n\t\t\t\t\temail: savedEmail\n\t\t\t\t};\n\t\t\t\tsaveUserCache(user);\n\n\t\t\t\tset({\n\t\t\t\t\tuser,\n\t\t\t\t\tisAuthenticated: true,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\terror: null\n\t\t\t\t});\n\n\t\t\t\tif (offlineId) {\n\t\t\t\t\tawait trips.migrateOfflineTrips(offlineId, user.id || username);\n\t\t\t\t\tlocalStorage.removeItem('offline_user_id');\n\t\t\t\t}\n\n\t\t\t\tawait trips.syncFromCloud(user.id || username);\n\n\t\t\t\treturn { success: true };\n\t\t\t} catch (error: any) {\n\t\t\t\tupdate((state) => ({\n\t\t\t\t\t...state,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\terror: error.message || 'Login failed'\n\t\t\t\t}));\n\t\t\t\treturn { success: false, error: error.message };\n\t\t\t}\n\t\t},\n\n\t\tlogout: async () => {\n\t\t\t// [SECURITY FIX #52] Clear server session (cookie cleared server-side)\n\t\t\ttry {\n\t\t\t\tawait fetch('/logout', {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'include'\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Failed to clear server session:', e);\n\t\t\t}\n\n\t\t\tstorage.clearUsername();\n\t\t\t// [SECURITY FIX #54] Clear from sessionStorage, not localStorage\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\tsessionStorage.removeItem('user_email');\n\t\t\t\tsessionStorage.removeItem('user_cache');\n\t\t\t}\n\n\t\t\tset({\n\t\t\t\tuser: null,\n\t\t\t\tisAuthenticated: false,\n\t\t\t\tisLoading: false,\n\t\t\t\terror: null\n\t\t\t});\n\t\t},\n\n\t\tchangePassword: async (username: string, currentPassword: string, newPassword: string) => {\n\t\t\tupdate((state) => ({ ...state, isLoading: true, error: null }));\n\t\t\ttry {\n\t\t\t\tawait api.changePassword(username, currentPassword, newPassword);\n\t\t\t\tupdate((state) => ({ ...state, isLoading: false, error: null }));\n\t\t\t\treturn { success: true };\n\t\t\t} catch (error: any) {\n\t\t\t\tupdate((state) => ({\n\t\t\t\t\t...state,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\terror: error.message || 'Password change failed'\n\t\t\t\t}));\n\t\t\t\treturn { success: false, error: error.message };\n\t\t\t}\n\t\t},\n\n\t\tresetPassword: async (username: string, resetKey: string, newPassword: string) => {\n\t\t\tupdate((state) => ({ ...state, isLoading: true, error: null }));\n\t\t\ttry {\n\t\t\t\tawait api.resetPassword(username, resetKey, newPassword);\n\t\t\t\tupdate((state) => ({ ...state, isLoading: false, error: null }));\n\t\t\t\treturn { success: true };\n\t\t\t} catch (error: any) {\n\t\t\t\tupdate((state) => ({\n\t\t\t\t\t...state,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\terror: error.message || 'Password reset failed'\n\t\t\t\t}));\n\t\t\t\treturn { success: false, error: error.message };\n\t\t\t}\n\t\t},\n\n\t\tdeleteAccount: async (username: string, password: string) => {\n\t\t\tupdate((state) => ({ ...state, isLoading: true, error: null }));\n\n\t\t\ttry {\n\t\t\t\t// [SECURITY FIX #52] Use credentials:include for cookie-based auth\n\t\t\t\tconst response = await csrfFetch('/api/user', {\n\t\t\t\t\tmethod: 'DELETE',\n\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify({ username, password })\n\t\t\t\t});\n\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tconst data: any = await response.json().catch(() => ({}));\n\t\t\t\t\tthrow new Error(data.error || 'Account deletion failed');\n\t\t\t\t}\n\n\t\t\t\tstorage.clearAll();\n\t\t\t\t// [SECURITY FIX #54] Clear from sessionStorage, not localStorage\n\t\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\t\tsessionStorage.removeItem('user_email');\n\t\t\t\t\tsessionStorage.removeItem('user_cache');\n\t\t\t\t}\n\t\t\t\ttrips.clear();\n\n\t\t\t\tset({\n\t\t\t\t\tuser: null,\n\t\t\t\t\tisAuthenticated: false,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\terror: null\n\t\t\t\t});\n\n\t\t\t\treturn { success: true };\n\t\t\t} catch (error: any) {\n\t\t\t\tupdate((state) => ({\n\t\t\t\t\t...state,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\terror: error.message || 'Account deletion failed'\n\t\t\t\t}));\n\t\t\t\treturn { success: false, error: error.message };\n\t\t\t}\n\t\t},\n\n\t\trefreshSubscription: async () => {\n\t\t\t// [SECURITY FIX #52] Use server session via credentials:include\n\t\t\ttry {\n\t\t\t\tconst response = await fetch('/api/auth/session', {\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\tcredentials: 'include'\n\t\t\t\t});\n\n\t\t\t\tif (!response.ok) return;\n\n\t\t\t\tconst data = (await response.json()) as { user?: Partial<User> };\n\t\t\t\tif (!data.user) return;\n\n\t\t\t\tupdate((state) => {\n\t\t\t\t\tif (!state.user) return state;\n\t\t\t\t\tconst updated: User = {\n\t\t\t\t\t\t...state.user,\n\t\t\t\t\t\tid: data.user?.id || state.user.id, // [!code fix] Ensure ID is preserved/updated\n\t\t\t\t\t\tplan: data.user?.plan || state.user.plan,\n\t\t\t\t\t\ttripsThisMonth: data.user?.tripsThisMonth ?? state.user.tripsThisMonth,\n\t\t\t\t\t\tmaxTrips: data.user?.maxTrips ?? state.user.maxTrips,\n\t\t\t\t\t\tresetDate: data.user?.resetDate || state.user.resetDate\n\t\t\t\t\t};\n\t\t\t\t\tsaveUserCache(updated); // Update cache\n\t\t\t\t\treturn { ...state, user: updated };\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Failed to refresh subscription:', error);\n\t\t\t}\n\t\t},\n\n\t\tclearError: () => {\n\t\t\tupdate((state) => ({ ...state, error: null }));\n\t\t}\n\t};\n}\n\nexport const auth = createAuthStore();\n\nexport const user = derived(auth, ($auth) => $auth.user);\nexport const isAuthenticated = derived(auth, ($auth) => $auth.isAuthenticated);\nexport const isLoading = derived(auth, ($auth) => $auth.isLoading);\nexport const authError = derived(auth, ($auth) => $auth.error);\n\nexport const canCreateTrip = derived(user, ($user) => {\n\tif (!$user) return true;\n\tif ($user.plan === 'pro' || $user.plan === 'business') return true;\n\treturn ($user.tripsThisMonth ?? 0) < ($user.maxTrips ?? Infinity);\n});\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\currentUser.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\expenses.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 16,
				"column": 27,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 16,
				"endColumn": 30,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [575, 578], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [575, 578], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 32,
				"column": 49,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 32,
				"endColumn": 52,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1140, 1143], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1140, 1143], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 113,
				"column": 49,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 113,
				"endColumn": 52,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3658, 3661], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3658, 3661], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 344,
				"column": 26,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 344,
				"endColumn": 29,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [9969, 9972], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [9969, 9972], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 444,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 444,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [12878, 12881], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [12878, 12881], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 5,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/stores/expenses.ts\nimport { writable, get } from 'svelte/store';\nimport { getDB } from '$lib/db/indexedDB';\nimport { syncManager } from '$lib/sync/syncManager';\nimport type { ExpenseRecord } from '$lib/db/types';\nimport type { User } from '$lib/types';\n\nimport { auth } from '$lib/stores/auth';\nimport { PLAN_LIMITS } from '$lib/constants';\n\nexport const isLoading = writable(false);\n\nfunction createExpensesStore() {\n\tconst { subscribe, set, update } = writable<ExpenseRecord[]>([]);\n\tlet _hydrationPromise: Promise<void> | null = null;\n\tconst _resolveHydration: any = null;\n\n\treturn {\n\t\tsubscribe,\n\t\tset,\n\n\t\t// [!code fix] Smart Hydrate: Removes stale items (deleted on other devices)\n\t\tasync hydrate(data: ExpenseRecord[], _userId?: string) {\n\t\t\t// parameter intentionally unused in this implementation — keep for API parity\n\t\t\tvoid _userId;\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\n\t\t\t\t// 1. Check Trash to prevent resurrection of locally deleted items\n\t\t\t\tconst trashTx = db.transaction('trash', 'readonly');\n\t\t\t\tconst trashItems = await trashTx.objectStore('trash').getAll();\n\t\t\t\tconst trashIds = new Set(trashItems.map((t: any) => t.id));\n\t\t\t\tawait trashTx.done;\n\n\t\t\t\t// 2. Prepare Valid Data (Server data minus local trash)\n\t\t\t\tconst validServerData = data.filter((item) => !trashIds.has(item.id));\n\t\t\t\tconst serverIdSet = new Set(validServerData.map((i) => i.id));\n\n\t\t\t\t// 3. Update Screen Immediately\n\t\t\t\tset(validServerData);\n\n\t\t\t\t// 4. Update DB (ReadWrite)\n\t\t\t\tconst tx = db.transaction(['expenses', 'trash'], 'readwrite');\n\t\t\t\tconst store = tx.objectStore('expenses');\n\n\t\t\t\t// Get all local items to check for zombies (stale items)\n\t\t\t\tconst localItems = await store.getAll();\n\n\t\t\t\tfor (const local of localItems) {\n\t\t\t\t\t// DELETE if:\n\t\t\t\t\t// a) It is in the local Trash\n\t\t\t\t\t// b) OR It is marked as 'synced' locally, but missing from server list (Deleted remotely)\n\t\t\t\t\t// (We skip 'pending' items because those are new local creations waiting to upload)\n\t\t\t\t\tconst isTrash = trashIds.has(local.id);\n\t\t\t\t\tconst isStale = local.syncStatus === 'synced' && !serverIdSet.has(local.id);\n\n\t\t\t\t\tif (isTrash || isStale) {\n\t\t\t\t\t\tawait store.delete(local.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// UPDATE/INSERT fresh server data\n\t\t\t\tfor (const item of validServerData) {\n\t\t\t\t\tawait store.put({ ...item, syncStatus: 'synced' });\n\t\t\t\t}\n\n\t\t\t\tawait tx.done;\n\t\t\t\tif (_resolveHydration) _resolveHydration();\n\t\t\t\t_hydrationPromise = null;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Failed to hydrate expenses:', err);\n\t\t\t\t// Fallback: just trust the server data\n\t\t\t\tset(data);\n\t\t\t\tif (_resolveHydration) _resolveHydration();\n\t\t\t\t_hydrationPromise = null;\n\t\t\t}\n\t\t},\n\n\t\tupdateLocal(expense: ExpenseRecord) {\n\t\t\tupdate((items) => {\n\t\t\t\tconst index = items.findIndex((e) => e.id === expense.id);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tconst newItems = [...items];\n\t\t\t\t\tnewItems[index] = { ...newItems[index], ...expense };\n\t\t\t\t\treturn newItems;\n\t\t\t\t} else {\n\t\t\t\t\treturn [expense, ...items].sort(\n\t\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t\tnew Date(b.date || b.createdAt).getTime() - new Date(a.date || a.createdAt).getTime()\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tasync load(userId?: string) {\n\t\t\tisLoading.set(true);\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction(['expenses', 'trash'], 'readonly');\n\t\t\t\tconst store = tx.objectStore('expenses');\n\t\t\t\tconst trashStore = tx.objectStore('trash');\n\n\t\t\t\tlet expenses: ExpenseRecord[];\n\n\t\t\t\tif (userId) {\n\t\t\t\t\tconst index = store.index('userId');\n\t\t\t\t\texpenses = await index.getAll(userId);\n\t\t\t\t} else {\n\t\t\t\t\texpenses = await store.getAll();\n\t\t\t\t}\n\n\t\t\t\tconst trashItems = await trashStore.getAll();\n\t\t\t\tconst trashIds = new Set(trashItems.map((t: any) => t.id));\n\n\t\t\t\tconst activeItems = expenses.filter((e) => !trashIds.has(e.id));\n\n\t\t\t\tactiveItems.sort((a, b) => {\n\t\t\t\t\tconst dateA = new Date(a.date || a.createdAt).getTime();\n\t\t\t\t\tconst dateB = new Date(b.date || b.createdAt).getTime();\n\t\t\t\t\treturn dateB - dateA;\n\t\t\t\t});\n\n\t\t\t\tset(activeItems);\n\t\t\t\treturn activeItems;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to load expenses:', err);\n\t\t\t\tset([]);\n\t\t\t\treturn [];\n\t\t\t} finally {\n\t\t\t\tisLoading.set(false);\n\t\t\t}\n\t\t},\n\n\t\tasync create(expenseData: Partial<ExpenseRecord>, userId: string) {\n\t\t\ttry {\n\t\t\t\tconst currentUser = (get(auth) as { user?: User | null }).user;\n\t\t\t\tconst isFreeTier = !currentUser?.plan || currentUser.plan === 'free';\n\t\t\t\tif (isFreeTier) {\n\t\t\t\t\tconst db = await getDB();\n\t\t\t\t\tconst tx = db.transaction('expenses', 'readonly');\n\t\t\t\t\tconst index = tx.objectStore('expenses').index('userId');\n\t\t\t\t\tconst allExpenses = await index.getAll(userId);\n\n\t\t\t\t\tconst windowDays = PLAN_LIMITS.FREE.WINDOW_DAYS || 30;\n\t\t\t\t\tconst windowMs = windowDays * 24 * 60 * 60 * 1000;\n\t\t\t\t\tconst cutoff = new Date(Date.now() - windowMs);\n\n\t\t\t\t\tconst recentCount = allExpenses.filter(\n\t\t\t\t\t\t(e) => new Date(e.date || e.createdAt) >= cutoff\n\t\t\t\t\t).length;\n\t\t\t\t\tconst allowed =\n\t\t\t\t\t\tPLAN_LIMITS.FREE.MAX_EXPENSES_PER_MONTH ||\n\t\t\t\t\t\tPLAN_LIMITS.FREE.MAX_EXPENSES_IN_WINDOW ||\n\t\t\t\t\t\t20;\n\t\t\t\t\tif (recentCount >= allowed) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Free tier limit reached (${allowed} expenses per ${windowDays} days).`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst expense: ExpenseRecord = {\n\t\t\t\t\t...expenseData,\n\t\t\t\t\tid: expenseData.id || crypto.randomUUID(),\n\t\t\t\t\tuserId,\n\t\t\t\t\tcreatedAt: expenseData.createdAt || new Date().toISOString(),\n\t\t\t\t\tupdatedAt: expenseData.updatedAt || new Date().toISOString(),\n\t\t\t\t\tsyncStatus: 'pending'\n\t\t\t\t} as ExpenseRecord;\n\n\t\t\t\tupdate((items) => [expense, ...items]);\n\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('expenses', 'readwrite');\n\t\t\t\tawait tx.objectStore('expenses').put(expense);\n\t\t\t\tawait tx.done;\n\n\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\taction: 'create',\n\t\t\t\t\ttripId: expense.id,\n\t\t\t\t\tdata: { ...expense, store: 'expenses' }\n\t\t\t\t});\n\n\t\t\t\treturn expense;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to create expense:', err);\n\t\t\t\t// Revert on error\n\t\t\t\tthis.load(userId);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\n\t\tasync updateExpense(id: string, changes: Partial<ExpenseRecord>, userId: string) {\n\t\t\tupdate((items) =>\n\t\t\t\titems.map((e) =>\n\t\t\t\t\te.id === id ? { ...e, ...changes, updatedAt: new Date().toISOString() } : e\n\t\t\t\t)\n\t\t\t);\n\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('expenses', 'readwrite');\n\t\t\t\tconst store = tx.objectStore('expenses');\n\n\t\t\t\tconst existing = await store.get(id);\n\t\t\t\tif (!existing) throw new Error('Expense not found');\n\t\t\t\tif (existing.userId !== userId) throw new Error('Unauthorized');\n\n\t\t\t\tconst updated = {\n\t\t\t\t\t...existing,\n\t\t\t\t\t...changes,\n\t\t\t\t\tid,\n\t\t\t\t\tuserId,\n\t\t\t\t\tupdatedAt: new Date().toISOString(),\n\t\t\t\t\tsyncStatus: 'pending'\n\t\t\t\t};\n\n\t\t\t\tawait store.put(updated);\n\t\t\t\tawait tx.done;\n\n\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\taction: 'update',\n\t\t\t\t\ttripId: id,\n\t\t\t\t\tdata: { ...updated, store: 'expenses' }\n\t\t\t\t});\n\n\t\t\t\treturn updated;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to update expense:', err);\n\t\t\t\tthis.load(userId);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\n\t\tasync deleteExpense(id: string, userId: string) {\n\t\t\tlet previousExpenses: ExpenseRecord[] = [];\n\t\t\tupdate((current) => {\n\t\t\t\tpreviousExpenses = current;\n\t\t\t\treturn current.filter((e) => e.id !== id);\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tconsole.log('🗑️ Moving expense to trash:', id);\n\t\t\t\tconst db = await getDB();\n\n\t\t\t\t// Single transaction for both stores to prevent locks\n\t\t\t\tconst tx = db.transaction(['expenses', 'trash'], 'readwrite');\n\t\t\t\tconst store = tx.objectStore('expenses');\n\t\t\t\tconst trashStore = tx.objectStore('trash');\n\n\t\t\t\tconst rec = await store.get(id);\n\t\t\t\tif (!rec) {\n\t\t\t\t\t// Already gone locally? Just ensure sync sends delete\n\t\t\t\t\tawait tx.done;\n\t\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\t\taction: 'delete',\n\t\t\t\t\t\ttripId: id,\n\t\t\t\t\t\tdata: { store: 'expenses' }\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (rec.userId !== userId) {\n\t\t\t\t\tawait tx.done;\n\t\t\t\t\tthis.load(userId);\n\t\t\t\t\tthrow new Error('Unauthorized');\n\t\t\t\t}\n\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst expiresAt = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\n\n\t\t\t\tconst trashItem = {\n\t\t\t\t\tid: rec.id,\n\t\t\t\t\ttype: 'expense',\n\t\t\t\t\trecordType: 'expense',\n\t\t\t\t\tdata: rec,\n\t\t\t\t\tdeletedAt: now.toISOString(),\n\t\t\t\t\tdeletedBy: userId,\n\t\t\t\t\texpiresAt: expiresAt.toISOString(),\n\t\t\t\t\toriginalKey: `expense:${userId}:${id}`,\n\t\t\t\t\tsyncStatus: 'pending' as const,\n\t\t\t\t\tamount: rec.amount,\n\t\t\t\t\tcategory: rec.category,\n\t\t\t\t\tdescription: rec.description\n\t\t\t\t};\n\n\t\t\t\tawait trashStore.put(trashItem);\n\t\t\t\tawait store.delete(id);\n\t\t\t\tawait tx.done;\n\n\t\t\t\t// [!code fix] Force reload to ensure disk sync matches UI\n\t\t\t\tawait this.load(userId);\n\n\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\taction: 'delete',\n\t\t\t\t\ttripId: id,\n\t\t\t\t\tdata: { store: 'expenses' }\n\t\t\t\t});\n\n\t\t\t\tconsole.log('✅ Expense moved to trash:', id);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to delete expense:', err);\n\t\t\t\tset(previousExpenses); // Revert on failure\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\n\t\tasync get(id: string, userId: string) {\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('expenses', 'readonly');\n\t\t\t\tconst expense = await tx.objectStore('expenses').get(id);\n\t\t\t\tif (!expense || expense.userId !== userId) return null;\n\t\t\t\treturn expense;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to get expense:', err);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\n\t\tclear() {\n\t\t\tset([]);\n\t\t},\n\n\t\tasync syncFromCloud(userId: string) {\n\t\t\tisLoading.set(true);\n\t\t\ttry {\n\t\t\t\tif (!navigator.onLine) return;\n\n\t\t\t\tconst lastSync = localStorage.getItem('last_sync_expenses');\n\t\t\t\tconst sinceDate = lastSync ? new Date(new Date(lastSync).getTime() - 5 * 60 * 1000) : null;\n\n\t\t\t\tconst url = sinceDate\n\t\t\t\t\t? `/api/expenses?since=${encodeURIComponent(sinceDate.toISOString())}`\n\t\t\t\t\t: '/api/expenses';\n\n\t\t\t\tconsole.log(\n\t\t\t\t\t`☁️ Syncing expenses... ${lastSync ? `(Delta since ${sinceDate?.toISOString()})` : '(Full)'}`\n\t\t\t\t);\n\n\t\t\t\tconst response = await fetch(url, { credentials: 'include' });\n\t\t\t\tif (!response.ok) throw new Error('Failed to fetch expenses');\n\n\t\t\t\tconst cloudExpenses: any = await response.json();\n\n\t\t\t\tif (cloudExpenses.length > 0) {\n\t\t\t\t\tconst db = await getDB();\n\t\t\t\t\tconst tx = db.transaction(['expenses', 'trash'], 'readwrite');\n\t\t\t\t\tconst store = tx.objectStore('expenses');\n\t\t\t\t\tconst trashStore = tx.objectStore('trash');\n\n\t\t\t\t\tconst trashKeys = await trashStore.getAllKeys();\n\t\t\t\t\tconst trashIds = new Set(trashKeys.map(String));\n\n\t\t\t\t\tfor (const cloudExpense of cloudExpenses) {\n\t\t\t\t\t\t// 1. Handle Server Deletes\n\t\t\t\t\t\tif (cloudExpense.deleted) {\n\t\t\t\t\t\t\tconst local = await store.get(cloudExpense.id);\n\t\t\t\t\t\t\tif (local) await store.delete(cloudExpense.id);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// 2. Prevent Resurrection of local trash\n\t\t\t\t\t\tif (trashIds.has(cloudExpense.id)) continue;\n\n\t\t\t\t\t\t// 3. Update/Create\n\t\t\t\t\t\tconst local = await store.get(cloudExpense.id);\n\t\t\t\t\t\tif (!local || new Date(cloudExpense.updatedAt) > new Date(local.updatedAt)) {\n\t\t\t\t\t\t\tawait store.put({\n\t\t\t\t\t\t\t\t...cloudExpense,\n\t\t\t\t\t\t\t\tsyncStatus: 'synced',\n\t\t\t\t\t\t\t\tlastSyncedAt: new Date().toISOString()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tawait tx.done;\n\t\t\t\t}\n\t\t\t\tlocalStorage.setItem('last_sync_expenses', new Date().toISOString());\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to sync expenses from cloud:', err);\n\t\t\t} finally {\n\t\t\t\t// Ensure hydration (if running) completes before loading DB to avoid races\n\t\t\t\tif (_hydrationPromise) await _hydrationPromise;\n\t\t\t\tawait this.load(userId);\n\t\t\t\tisLoading.set(false);\n\t\t\t}\n\t\t},\n\n\t\tasync migrateOfflineExpenses(tempUserId: string, realUserId: string) {\n\t\t\tif (!tempUserId || !realUserId || tempUserId === realUserId) return;\n\t\t\tconst db = await getDB();\n\t\t\tconst tx = db.transaction('expenses', 'readwrite');\n\t\t\tconst store = tx.objectStore('expenses');\n\t\t\tconst index = store.index('userId');\n\t\t\tconst offlineExpenses = await index.getAll(tempUserId);\n\n\t\t\tfor (const expense of offlineExpenses) {\n\t\t\t\texpense.userId = realUserId;\n\t\t\t\texpense.syncStatus = 'pending';\n\t\t\t\texpense.updatedAt = new Date().toISOString();\n\t\t\t\tawait store.put(expense);\n\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\taction: 'create',\n\t\t\t\t\ttripId: expense.id,\n\t\t\t\t\tdata: { ...expense, store: 'expenses' }\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait tx.done;\n\t\t\tawait this.load(realUserId);\n\t\t}\n\t};\n}\n\nexport const expenses = createExpensesStore();\n\nsyncManager.registerStore('expenses', {\n\tupdateLocal: (item) => {\n\t\tif (item && item.amount !== undefined && item.category !== undefined) {\n\t\t\texpenses.updateLocal(item);\n\t\t}\n\t},\n\tsyncDown: async () => {\n\t\tconst user = (get(auth) as { user?: User | null }).user;\n\t\tif (user?.id) await expenses.syncFromCloud(user.id);\n\t}\n});\n\nfunction createDraftStore() {\n\tconst STORAGE_KEY = 'draft_expense';\n\n\tconst getDraft = () => {\n\t\ttry {\n\t\t\tconst stored = localStorage.getItem(STORAGE_KEY);\n\t\t\treturn stored ? JSON.parse(stored) : null;\n\t\t} catch {\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tconst { subscribe, set } = writable(getDraft());\n\n\treturn {\n\t\tsubscribe,\n\t\tsave: (data: any) => {\n\t\t\tlocalStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n\t\t\tset(data);\n\t\t},\n\t\tload: () => getDraft(),\n\t\tclear: () => {\n\t\t\tlocalStorage.removeItem(STORAGE_KEY);\n\t\t\tset(null);\n\t\t}\n\t};\n}\n\nexport const draftExpense = createDraftStore();\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\mileage.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 23,
				"column": 25,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 23,
				"endColumn": 28,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [809, 812], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [809, 812], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 37,
				"column": 27,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 37,
				"endColumn": 30,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1225, 1228], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1225, 1228], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 190,
				"column": 48,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 190,
				"endColumn": 51,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6245, 6248], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6245, 6248], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 271,
				"column": 49,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 271,
				"endColumn": 52,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [9094, 9097], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [9094, 9097], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 285,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 285,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [9515, 9518], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [9515, 9518], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 299,
				"column": 12,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 299,
				"endColumn": 15,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [10017, 10020], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [10017, 10020], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 308,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 308,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [10268, 10271], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [10268, 10271], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 387,
				"column": 39,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 387,
				"endColumn": 42,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [12335, 12338], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [12335, 12338], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 394,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 394,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [12588, 12591], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [12588, 12591], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 403,
				"column": 12,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 403,
				"endColumn": 15,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [12832, 12835], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [12832, 12835], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 407,
				"column": 83,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 407,
				"endColumn": 86,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [13027, 13030], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [13027, 13030], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 463,
				"column": 18,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 463,
				"endColumn": 21,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [14662, 14665], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [14662, 14665], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 532,
				"column": 31,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 532,
				"endColumn": 34,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16975, 16978], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16975, 16978], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 556,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 556,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [17576, 17579], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [17576, 17579], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 14,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/stores/mileage.ts\nimport { writable, get } from 'svelte/store';\nimport { getDB, getMileageStoreName } from '$lib/db/indexedDB';\nimport { syncManager } from '$lib/sync/syncManager';\nimport type { MileageRecord } from '$lib/db/types';\nimport type { User } from '$lib/types';\nimport { auth } from '$lib/stores/auth';\nimport { calculateFuelCost } from '$lib/utils/calculations';\nimport { PLAN_LIMITS } from '$lib/constants';\n\nexport const isLoading = writable(false);\n\n// Type for trash items to avoid repeated `as any` casts\ninterface TrashItemLike {\n\tid?: string;\n\tdeletedAt?: string;\n\tmetadata?: { deletedAt?: string };\n}\n\nfunction createMileageStore() {\n\tconst { subscribe, set, update } = writable<MileageRecord[]>([]);\n\tlet _hydrationPromise: Promise<void> | null = null;\n\tlet _resolveHydration: any = null;\n\n\treturn {\n\t\tsubscribe,\n\t\tset,\n\t\t// Optimized hydrate: Set data immediately, defer IndexedDB work\n\t\tasync hydrate(data: MileageRecord[], _userId?: string) {\n\t\t\tvoid _userId;\n\t\t\t_hydrationPromise = new Promise((res) => (_resolveHydration = res));\n\n\t\t\t// PERFORMANCE: Set data immediately for instant UI response\n\t\t\tconst normalizedData = data\n\t\t\t\t.map((item) => ({\n\t\t\t\t\t...item,\n\t\t\t\t\tsyncStatus: (item as any).syncStatus ?? 'synced'\n\t\t\t\t}))\n\t\t\t\t.sort((a, b) => {\n\t\t\t\t\tconst dateA = new Date(a.date || a.createdAt).getTime();\n\t\t\t\t\tconst dateB = new Date(b.date || b.createdAt).getTime();\n\t\t\t\t\treturn dateB - dateA;\n\t\t\t\t});\n\t\t\tset(normalizedData);\n\n\t\t\tif (typeof window === 'undefined') {\n\t\t\t\t_resolveHydration?.();\n\t\t\t\t_hydrationPromise = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// PERFORMANCE: Do IndexedDB sync in background without blocking UI\n\t\t\tsetTimeout(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst db = await getDB();\n\t\t\t\t\tconst mileageStoreName = getMileageStoreName(db);\n\t\t\t\t\tconst tx = db.transaction(mileageStoreName, 'readwrite');\n\t\t\t\t\tconst store = tx.objectStore(mileageStoreName);\n\n\t\t\t\t\t// Batch write server data\n\t\t\t\t\tfor (const item of normalizedData) {\n\t\t\t\t\t\tawait store.put(item);\n\t\t\t\t\t}\n\n\t\t\t\t\tawait tx.done;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error('Background hydration failed:', err);\n\t\t\t\t}\n\t\t\t\t_resolveHydration?.();\n\t\t\t\t_hydrationPromise = null;\n\t\t\t}, 0);\n\t\t},\n\t\tupdateLocal(record: MileageRecord) {\n\t\t\t// ... copy from previous ...\n\t\t\tupdate((items) => {\n\t\t\t\tconst index = items.findIndex((r) => r.id === record.id);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tconst newItems = [...items];\n\t\t\t\t\tnewItems[index] = { ...newItems[index], ...record };\n\t\t\t\t\treturn newItems;\n\t\t\t\t} else {\n\t\t\t\t\treturn [record, ...items].sort(\n\t\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t\tnew Date(b.date || b.createdAt).getTime() - new Date(a.date || a.createdAt).getTime()\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tasync load(userId?: string) {\n\t\t\tisLoading.set(true);\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst mileageStoreName = getMileageStoreName(db);\n\t\t\t\t// PERFORMANCE: Use single transaction and build trash set efficiently\n\t\t\t\tconst tx = db.transaction([mileageStoreName, 'trash'], 'readonly');\n\t\t\t\tconst store = tx.objectStore(mileageStoreName);\n\t\t\t\tconst trashStore = tx.objectStore('trash');\n\n\t\t\t\t// Fetch in parallel\n\t\t\t\tconst [items, trashItems] = await Promise.all([\n\t\t\t\t\tuserId ? store.index('userId').getAll(userId) : store.getAll(),\n\t\t\t\t\ttrashStore.getAll()\n\t\t\t\t]);\n\n\t\t\t\t// PERFORMANCE: Build trash set once with both ID formats\n\t\t\t\tconst trashIds = new Set<string>();\n\t\t\t\tfor (const t of trashItems) {\n\t\t\t\t\tconst id = (t as TrashItemLike).id;\n\t\t\t\t\tif (id) {\n\t\t\t\t\t\ttrashIds.add(id);\n\t\t\t\t\t\tif (id.startsWith('mileage:')) {\n\t\t\t\t\t\t\ttrashIds.add(id.replace('mileage:', ''));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttrashIds.add(`mileage:${id}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// PERFORMANCE: Filter and sort in one pass\n\t\t\t\tconst activeItems = items\n\t\t\t\t\t.filter((item) => !trashIds.has(item.id))\n\t\t\t\t\t.sort((a, b) => {\n\t\t\t\t\t\tconst dateA = new Date(a.date || a.createdAt).getTime();\n\t\t\t\t\t\tconst dateB = new Date(b.date || b.createdAt).getTime();\n\t\t\t\t\t\treturn dateB - dateA;\n\t\t\t\t\t});\n\n\t\t\t\tset(activeItems);\n\t\t\t\treturn activeItems;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to load mileage:', err);\n\t\t\t\tset([]);\n\t\t\t\treturn [];\n\t\t\t} finally {\n\t\t\t\tisLoading.set(false);\n\t\t\t}\n\t\t},\n\t\tasync create(data: Partial<MileageRecord>, userId: string) {\n\t\t\t// --- CHECK FREE TIER LIMITS ---\n\t\t\tconst currentUser = get(auth).user as User | null;\n\t\t\tconst isFreeTier = !currentUser?.plan || currentUser.plan === 'free';\n\n\t\t\tif (isFreeTier) {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('mileage', 'readonly');\n\t\t\t\tconst index = tx.objectStore('mileage').index('userId');\n\t\t\t\tconst allUserMileage = await index.getAll(userId);\n\t\t\t\tconst windowDays = PLAN_LIMITS.FREE.WINDOW_DAYS || 30;\n\t\t\t\tconst windowMs = windowDays * 24 * 60 * 60 * 1000;\n\t\t\t\tconst cutoff = new Date(Date.now() - windowMs);\n\t\t\t\tconst recentCount = allUserMileage.filter((m) => {\n\t\t\t\t\tconst d = new Date(m.date || m.createdAt);\n\t\t\t\t\treturn d >= cutoff;\n\t\t\t\t}).length;\n\t\t\t\tconst allowed =\n\t\t\t\t\tPLAN_LIMITS.FREE.MAX_MILEAGE_PER_MONTH || PLAN_LIMITS.FREE.MAX_MILEAGE_IN_WINDOW || 10;\n\n\t\t\t\tif (recentCount >= allowed) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Free tier limit reached (${allowed} mileage logs per ${windowDays} days).`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// ... copy from previous ...\n\t\t\tconst record: MileageRecord = {\n\t\t\t\t...data,\n\t\t\t\tid: data.id || crypto.randomUUID(),\n\t\t\t\tuserId,\n\t\t\t\tdate: data.date || new Date().toISOString(),\n\t\t\t\tstartOdometer: (data.startOdometer as number) || 0,\n\t\t\t\tendOdometer: (data.endOdometer as number) || 0,\n\t\t\t\tmiles:\n\t\t\t\t\ttypeof data.miles === 'number'\n\t\t\t\t\t\t? data.miles\n\t\t\t\t\t\t: Math.max(0, Number(data.endOdometer) - Number(data.startOdometer)),\n\t\t\t\tmileageRate: typeof data.mileageRate === 'number' ? data.mileageRate : undefined,\n\t\t\t\tvehicle: data.vehicle || undefined,\n\t\t\t\treimbursement: typeof data.reimbursement === 'number' ? data.reimbursement : undefined,\n\t\t\t\tnotes: data.notes || '',\n\t\t\t\tcreatedAt: data.createdAt || new Date().toISOString(),\n\t\t\t\tupdatedAt: data.updatedAt || new Date().toISOString(),\n\t\t\t\tsyncStatus: 'pending'\n\t\t\t};\n\t\t\tif (typeof record.reimbursement !== 'number') {\n\t\t\t\tlet rate: number | undefined = record.mileageRate;\n\t\t\t\tif (rate == null) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst { userSettings } = await import('$lib/stores/userSettings');\n\t\t\t\t\t\trate = (userSettings && (userSettings as any).mileageRate) || undefined;\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t/* ignore */\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (typeof rate === 'number' && typeof record.miles === 'number') {\n\t\t\t\t\trecord.reimbursement = Number((record.miles * rate).toFixed(2));\n\t\t\t\t}\n\t\t\t}\n\t\t\tupdate((items) => [record, ...items]);\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst mileageStoreName = getMileageStoreName(db);\n\t\t\t\tconst tx = db.transaction(mileageStoreName, 'readwrite');\n\t\t\t\tawait tx.objectStore(mileageStoreName).put(record);\n\t\t\t\tawait tx.done;\n\t\t\t\t// PERFORMANCE: Queue sync in background without blocking\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsyncManager.addToQueue({\n\t\t\t\t\t\taction: 'create',\n\t\t\t\t\t\ttripId: record.id,\n\t\t\t\t\t\tdata: { ...record, store: 'mileage' }\n\t\t\t\t\t});\n\t\t\t\t}, 0);\n\t\t\t\treturn record;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to create mileage record:', err);\n\t\t\t\tthis.load(userId);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\t\tasync updateMileage(id: string, changes: Partial<MileageRecord>, userId: string) {\n\t\t\t// ... copy from previous ...\n\t\t\tupdate((items) =>\n\t\t\t\titems.map((r) =>\n\t\t\t\t\tr.id === id ? { ...r, ...changes, updatedAt: new Date().toISOString() } : r\n\t\t\t\t)\n\t\t\t);\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst mileageStoreName = getMileageStoreName(db);\n\t\t\t\tconst tx = db.transaction(mileageStoreName, 'readwrite');\n\t\t\t\tconst store = tx.objectStore(mileageStoreName);\n\t\t\t\tconst existing = await store.get(id);\n\t\t\t\tif (!existing) throw new Error('Mileage record not found');\n\t\t\t\tif (existing.userId !== userId) throw new Error('Unauthorized');\n\t\t\t\tconst updated: MileageRecord = {\n\t\t\t\t\t...existing,\n\t\t\t\t\t...changes,\n\t\t\t\t\tid,\n\t\t\t\t\tuserId,\n\t\t\t\t\tupdatedAt: new Date().toISOString(),\n\t\t\t\t\tsyncStatus: 'pending'\n\t\t\t\t};\n\t\t\t\tconst odometerUpdated =\n\t\t\t\t\tObject.prototype.hasOwnProperty.call(changes, 'startOdometer') ||\n\t\t\t\t\tObject.prototype.hasOwnProperty.call(changes, 'endOdometer');\n\t\t\t\tconst milesExplicit = Object.prototype.hasOwnProperty.call(changes, 'miles');\n\t\t\t\tif (\n\t\t\t\t\todometerUpdated &&\n\t\t\t\t\t!milesExplicit &&\n\t\t\t\t\ttypeof updated.startOdometer === 'number' &&\n\t\t\t\t\ttypeof updated.endOdometer === 'number'\n\t\t\t\t) {\n\t\t\t\t\tupdated.miles = Math.max(0, Number(updated.endOdometer) - Number(updated.startOdometer));\n\t\t\t\t}\n\t\t\t\tconst milesChanged = Object.prototype.hasOwnProperty.call(changes, 'miles');\n\t\t\t\tconst rateChanged = Object.prototype.hasOwnProperty.call(changes, 'mileageRate');\n\t\t\t\tconst reimbursementExplicit = Object.prototype.hasOwnProperty.call(\n\t\t\t\t\tchanges,\n\t\t\t\t\t'reimbursement'\n\t\t\t\t);\n\t\t\t\tif (\n\t\t\t\t\t!reimbursementExplicit &&\n\t\t\t\t\t(milesChanged || rateChanged) &&\n\t\t\t\t\ttypeof updated.miles === 'number'\n\t\t\t\t) {\n\t\t\t\t\tlet rate = typeof updated.mileageRate === 'number' ? updated.mileageRate : undefined;\n\t\t\t\t\tif (rate == null) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst { userSettings } = await import('$lib/stores/userSettings');\n\t\t\t\t\t\t\trate = (userSettings && (userSettings as any).mileageRate) || undefined;\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t/* ignore */\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof rate === 'number') {\n\t\t\t\t\t\tupdated.reimbursement = Number((updated.miles * rate).toFixed(2));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tawait store.put(updated);\n\t\t\t\tawait tx.done;\n\t\t\t\ttry {\n\t\t\t\t\tconst tripsTx = db.transaction('trips', 'readwrite');\n\t\t\t\t\tconst tripStore = tripsTx.objectStore('trips');\n\t\t\t\t\tconst trip = await tripStore.get(id as any);\n\t\t\t\t\tif (trip && trip.userId === userId) {\n\t\t\t\t\t\tconst nowIso = new Date().toISOString();\n\t\t\t\t\t\t// Recalculate fuelCost based on new miles\n\t\t\t\t\t\tconst newMiles = updated.miles || 0;\n\t\t\t\t\t\tconst mpg = trip.mpg || 25;\n\t\t\t\t\t\tconst gasPrice = trip.gasPrice || 3.5;\n\t\t\t\t\t\tconst newFuelCost = calculateFuelCost(newMiles, mpg, gasPrice);\n\t\t\t\t\t\tconst patched = {\n\t\t\t\t\t\t\t...trip,\n\t\t\t\t\t\t\ttotalMiles: newMiles,\n\t\t\t\t\t\t\tfuelCost: newFuelCost,\n\t\t\t\t\t\t\tupdatedAt: nowIso,\n\t\t\t\t\t\t\tsyncStatus: 'pending'\n\t\t\t\t\t\t} as any;\n\t\t\t\t\t\tawait tripStore.put(patched);\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst { trips } = await import('$lib/stores/trips');\n\t\t\t\t\t\t\ttrips.updateLocal({\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\ttotalMiles: newMiles,\n\t\t\t\t\t\t\t\tfuelCost: newFuelCost,\n\t\t\t\t\t\t\t\tupdatedAt: nowIso\n\t\t\t\t\t\t\t} as any);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t/* ignore */\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tawait tripsTx.done;\n\t\t\t\t} catch {\n\t\t\t\t\t/* ignore */\n\t\t\t\t}\n\t\t\t\t// PERFORMANCE: Queue sync in background without blocking\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsyncManager.addToQueue({\n\t\t\t\t\t\taction: 'update',\n\t\t\t\t\t\ttripId: id,\n\t\t\t\t\t\tdata: { ...updated, store: 'mileage' }\n\t\t\t\t\t});\n\t\t\t\t}, 0);\n\t\t\t\treturn updated;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to update mileage:', err);\n\t\t\t\tthis.load(userId);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\n\t\tasync deleteMileage(id: string, userId: string) {\n\t\t\t// PERFORMANCE: Optimistic update - remove from UI immediately\n\t\t\tlet previous: MileageRecord[] = [];\n\t\t\tupdate((current) => {\n\t\t\t\tprevious = current;\n\t\t\t\treturn current.filter((r) => r.id !== id);\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst mileageStoreName = getMileageStoreName(db);\n\t\t\t\tconst tx = db.transaction([mileageStoreName, 'trash'], 'readwrite');\n\t\t\t\tconst mileageStore = tx.objectStore(mileageStoreName);\n\t\t\t\tconst trashStore = tx.objectStore('trash');\n\n\t\t\t\tconst rec = await mileageStore.get(id);\n\t\t\t\tif (!rec) {\n\t\t\t\t\tawait tx.done;\n\t\t\t\t\t// Queue sync in background without blocking\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tsyncManager.addToQueue({\n\t\t\t\t\t\t\taction: 'delete',\n\t\t\t\t\t\t\ttripId: id,\n\t\t\t\t\t\t\tdata: { store: 'mileage' }\n\t\t\t\t\t\t});\n\t\t\t\t\t}, 0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (rec.userId !== userId) {\n\t\t\t\t\tawait tx.done;\n\t\t\t\t\tthrow new Error('Unauthorized');\n\t\t\t\t}\n\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst expiresAt = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\n\n\t\t\t\t// Use prefixed ID \"mileage:...\" to avoid collision\n\t\t\t\tconst trashItem = {\n\t\t\t\t\tid: `mileage:${rec.id}`,\n\t\t\t\t\ttripId: rec.tripId || undefined,\n\t\t\t\t\ttype: 'mileage',\n\t\t\t\t\trecordType: 'mileage',\n\t\t\t\t\tdata: rec,\n\t\t\t\t\tdeletedAt: now.toISOString(),\n\t\t\t\t\tdeletedBy: userId,\n\t\t\t\t\texpiresAt: expiresAt.toISOString(),\n\t\t\t\t\toriginalKey: `mileage:${userId}:${id}`,\n\t\t\t\t\tsyncStatus: 'pending',\n\t\t\t\t\tmiles: rec.miles,\n\t\t\t\t\tvehicle: rec.vehicle,\n\t\t\t\t\tdate: rec.date,\n\t\t\t\t\tbackups: { mileage: { ...rec } }\n\t\t\t\t};\n\n\t\t\t\tawait trashStore.put(trashItem as any);\n\t\t\t\tawait mileageStore.delete(id);\n\n\t\t\t\t// Update trip to 0 miles and 0 fuelCost\n\t\t\t\ttry {\n\t\t\t\t\tconst tripsTx = db.transaction('trips', 'readwrite');\n\t\t\t\t\tconst tripStore = tripsTx.objectStore('trips');\n\t\t\t\t\tconst trip = await tripStore.get(id as any);\n\t\t\t\t\tif (trip && trip.userId === userId) {\n\t\t\t\t\t\tconst nowIso = new Date().toISOString();\n\t\t\t\t\t\tconst patched = {\n\t\t\t\t\t\t\t...trip,\n\t\t\t\t\t\t\ttotalMiles: 0,\n\t\t\t\t\t\t\tfuelCost: 0,\n\t\t\t\t\t\t\tupdatedAt: nowIso,\n\t\t\t\t\t\t\tsyncStatus: 'pending'\n\t\t\t\t\t\t} as any;\n\t\t\t\t\t\tawait tripStore.put(patched);\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst { trips } = await import('$lib/stores/trips');\n\t\t\t\t\t\t\ttrips.updateLocal({ id, totalMiles: 0, fuelCost: 0, updatedAt: nowIso } as any);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t/* ignore */\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\t\t\taction: 'update',\n\t\t\t\t\t\t\ttripId: id,\n\t\t\t\t\t\t\tdata: { ...patched, store: 'trips', skipEnrichment: true }\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tawait tripsTx.done;\n\t\t\t\t} catch {\n\t\t\t\t\t/* ignore */\n\t\t\t\t}\n\n\t\t\t\t// PERFORMANCE: Queue sync in background without blocking UI\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsyncManager.addToQueue({ action: 'delete', tripId: id, data: { store: 'mileage' } });\n\t\t\t\t}, 0);\n\t\t\t\treturn;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to delete mileage record:', err);\n\t\t\t\tset(previous);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\n\t\t// ... (keep get, clear, syncFromCloud, migrateOfflineMileage) ...\n\t\tasync get(id: string, userId: string) {\n\t\t\t// ... copy existing get code ...\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('mileage', 'readonly');\n\t\t\t\tconst item = await tx.objectStore('mileage').get(id);\n\t\t\t\tif (!item || item.userId !== userId) return null;\n\t\t\t\treturn item;\n\t\t\t} catch {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tclear() {\n\t\t\tset([]);\n\t\t},\n\t\tasync syncFromCloud(userId: string) {\n\t\t\t// ... copy existing syncFromCloud code ...\n\t\t\tisLoading.set(true);\n\t\t\ttry {\n\t\t\t\tif (!navigator.onLine) return;\n\t\t\t\tconst lastSync = localStorage.getItem('last_sync_mileage');\n\t\t\t\tconst sinceDate = lastSync ? new Date(new Date(lastSync).getTime() - 5 * 60 * 1000) : null;\n\t\t\t\tconst url = sinceDate\n\t\t\t\t\t? `/api/mileage?since=${encodeURIComponent(sinceDate.toISOString())}`\n\t\t\t\t\t: '/api/mileage';\n\t\t\t\tconst response = await fetch(url, { credentials: 'include' });\n\t\t\t\tif (!response.ok) throw new Error('Failed to fetch mileage');\n\t\t\t\tconst cloud: any = await response.json();\n\t\t\t\tif (cloud.length > 0) {\n\t\t\t\t\tconst db = await getDB();\n\t\t\t\t\tconst tx = db.transaction(['mileage', 'trash'], 'readwrite');\n\t\t\t\t\tconst store = tx.objectStore('mileage');\n\t\t\t\t\tconst trashStore = tx.objectStore('trash');\n\t\t\t\t\tconst trashItems = await trashStore.getAll();\n\t\t\t\t\tconst trashIds = new Set(trashItems.map((t: TrashItemLike) => t.id || `mileage:${t.id}`));\n\t\t\t\t\tfor (const rec of cloud) {\n\t\t\t\t\t\tif (rec.deleted) {\n\t\t\t\t\t\t\tconst local = await store.get(rec.id);\n\t\t\t\t\t\t\tif (local) await store.delete(rec.id);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Check if this record is in trash (simple ID check)\n\t\t\t\t\t\tif (trashIds.has(rec.id) || trashIds.has(`mileage:${rec.id}`)) {\n\t\t\t\t\t\t\tcontinue; // Skip - this is deleted\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst local = await store.get(rec.id);\n\t\t\t\t\t\tif (!local || new Date(rec.updatedAt) > new Date(local.updatedAt)) {\n\t\t\t\t\t\t\tawait store.put({\n\t\t\t\t\t\t\t\t...rec,\n\t\t\t\t\t\t\t\tsyncStatus: 'synced',\n\t\t\t\t\t\t\t\tlastSyncedAt: new Date().toISOString()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tawait tx.done;\n\t\t\t\t}\n\t\t\t\t// Normalize to correct key name and keep backward compatibility if needed\n\t\t\t\tlocalStorage.setItem('last_sync_mileage', new Date().toISOString());\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to sync mileage from cloud:', err);\n\t\t\t} finally {\n\t\t\t\tif (_hydrationPromise) await _hydrationPromise;\n\t\t\t\tawait this.load(userId);\n\t\t\t\tisLoading.set(false);\n\t\t\t}\n\t\t},\n\t\tasync migrateOfflineMileage(tempUserId: string, realUserId: string) {\n\t\t\t// ... copy existing migrateOfflineMileage code ...\n\t\t\tif (!tempUserId || !realUserId || tempUserId === realUserId) return;\n\t\t\tconst db = await getDB();\n\t\t\tconst tx = db.transaction('mileage', 'readwrite');\n\t\t\tconst store = tx.objectStore('mileage');\n\t\t\tconst index = store.index('userId');\n\t\t\tconst offline = await index.getAll(tempUserId);\n\t\t\tfor (const r of offline) {\n\t\t\t\tr.userId = realUserId;\n\t\t\t\tr.syncStatus = 'pending';\n\t\t\t\tr.updatedAt = new Date().toISOString();\n\t\t\t\tawait store.put(r);\n\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\taction: 'create',\n\t\t\t\t\ttripId: r.id,\n\t\t\t\t\tdata: { ...r, store: 'mileage' }\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait tx.done;\n\t\t\tawait this.load(realUserId);\n\t\t}\n\t};\n}\n\nexport const mileage = createMileageStore();\n\nsyncManager.registerStore('mileage', {\n\tupdateLocal: (item) => {\n\t\tif (item && typeof (item as any).miles === 'number') {\n\t\t\tmileage.updateLocal(item as MileageRecord);\n\t\t}\n\t},\n\tsyncDown: async () => {\n\t\tconst user = (get(auth) as { user?: User | null }).user;\n\t\tif (user?.id) await mileage.syncFromCloud(user.id);\n\t}\n});\n\nfunction createDraftStore() {\n\t// ... copy existing createDraftStore code ...\n\tconst STORAGE_KEY = 'draft_mileage';\n\tconst getDraft = () => {\n\t\ttry {\n\t\t\tconst stored = localStorage.getItem(STORAGE_KEY);\n\t\t\treturn stored ? JSON.parse(stored) : null;\n\t\t} catch {\n\t\t\treturn null;\n\t\t}\n\t};\n\tconst { subscribe, set } = writable(getDraft());\n\treturn {\n\t\tsubscribe,\n\t\tsave: (data: any) => {\n\t\t\tlocalStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n\t\t\tset(data);\n\t\t},\n\t\tload: () => getDraft(),\n\t\tclear: () => {\n\t\t\tlocalStorage.removeItem(STORAGE_KEY);\n\t\t\tset(null);\n\t\t}\n\t};\n}\n\nexport const draftMileage = createDraftStore();\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\sync.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\toast.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\trash.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 150,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 150,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5200, 5203], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5200, 5203], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 151,
				"column": 66,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 151,
				"endColumn": 69,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5272, 5275], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5272, 5275], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 233,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 233,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8206, 8209], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8206, 8209], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 314,
				"column": 78,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 314,
				"endColumn": 81,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [10599, 10602], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [10599, 10602], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 332,
				"column": 23,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 332,
				"endColumn": 26,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [11048, 11051], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [11048, 11051], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 340,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 340,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [11304, 11307], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [11304, 11307], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 6,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/stores/trash.ts\nimport { writable, get } from 'svelte/store';\nimport { getDB, getMileageStoreName } from '$lib/db/indexedDB';\nimport { syncManager } from '$lib/sync/syncManager';\nimport type { TrashRecord } from '$lib/db/types';\nimport { user as authUser } from '$lib/stores/auth';\nimport type { User } from '$lib/types';\n\nfunction createTrashStore() {\n\tconst { subscribe, set, update } = writable<TrashRecord[]>([]);\n\n\t// Ensure we always work with prefixed ID if it exists\n\tconst getRealId = (trashId: string) => {\n\t\tif (trashId.startsWith('mileage:')) return trashId.replace('mileage:', '');\n\t\tif (trashId.startsWith('trip:')) return trashId.replace('trip:', '');\n\t\tif (trashId.startsWith('expense:')) return trashId.replace('expense:', '');\n\t\treturn trashId;\n\t};\n\n\t// Extract record type from prefixed ID\n\tconst getRecordType = (trashId: string): string | undefined => {\n\t\tif (trashId.startsWith('mileage:')) return 'mileage';\n\t\tif (trashId.startsWith('trip:')) return 'trip';\n\t\tif (trashId.startsWith('expense:')) return 'expense';\n\t\treturn undefined;\n\t};\n\n\t// Generate a unique trash ID with type prefix to avoid collisions\n\tconst getUniqueTrashId = (item: { id: string; recordType?: string; type?: string }) => {\n\t\tconst id = item.id;\n\t\tconst recordType = item.recordType || item.type || 'trip';\n\n\t\t// If ID already has a known prefix, return it as-is\n\t\tif (id.startsWith('mileage:') || id.startsWith('trip:') || id.startsWith('expense:')) {\n\t\t\treturn id;\n\t\t}\n\n\t\t// Otherwise, prefix based on record type\n\t\treturn `${recordType}:${id}`;\n\t};\n\n\treturn {\n\t\tsubscribe,\n\n\t\tasync load(userId?: string, type?: string) {\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('trash', 'readonly');\n\t\t\t\tconst store = tx.objectStore('trash');\n\t\t\t\tconst items = userId ? await store.index('userId').getAll(userId) : await store.getAll();\n\n\t\t\t\tconst normalizedItems = items.map((item) => {\n\t\t\t\t\tlet flat = { ...item };\n\t\t\t\t\tif (flat.data && typeof flat.data === 'object') {\n\t\t\t\t\t\tflat = { ...flat.data, ...flat };\n\t\t\t\t\t\tdelete flat.data;\n\t\t\t\t\t}\n\t\t\t\t\treturn flat;\n\t\t\t\t});\n\n\t\t\t\tconst filtered = type\n\t\t\t\t\t? normalizedItems.filter((it) => {\n\t\t\t\t\t\t\tif (it.recordType === type || it.type === type) return true;\n\t\t\t\t\t\t\tif (Array.isArray(it.recordTypes) && it.recordTypes.includes(type)) return true;\n\t\t\t\t\t\t\tif (type === 'expense' && it.originalKey?.startsWith('expense:')) return true;\n\t\t\t\t\t\t\tif (type === 'mileage' && it.originalKey?.startsWith('mileage:')) return true;\n\t\t\t\t\t\t\tif (type === 'trip' && it.originalKey?.startsWith('trip:')) return true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t})\n\t\t\t\t\t: normalizedItems;\n\n\t\t\t\tconst projected = filtered.map((it) => {\n\t\t\t\t\t// If filtering for \"mileage\" but found a bundled \"trip+mileage\" item,\n\t\t\t\t\t// present it as a mileage log for the UI\n\t\t\t\t\tif (type && it.recordType !== type) {\n\t\t\t\t\t\treturn { ...it, recordType: type, type: type };\n\t\t\t\t\t}\n\t\t\t\t\treturn it;\n\t\t\t\t});\n\n\t\t\t\tprojected.sort((a, b) => {\n\t\t\t\t\tconst aTime = a && a.deletedAt ? new Date(a.deletedAt).getTime() : 0;\n\t\t\t\t\tconst bTime = b && b.deletedAt ? new Date(b.deletedAt).getTime() : 0;\n\t\t\t\t\treturn bTime - aTime;\n\t\t\t\t});\n\n\t\t\t\tset(projected);\n\t\t\t\treturn projected;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to load trash:', err);\n\t\t\t\tset([]);\n\t\t\t\treturn [];\n\t\t\t}\n\t\t},\n\n\t\tasync restore(uniqueId: string, userId: string, targetType?: string) {\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\n\t\t\t\t// 1. Fetch Trash Item\n\t\t\t\tconst txRead = db.transaction('trash', 'readonly');\n\t\t\t\tconst stored = await txRead.objectStore('trash').get(uniqueId);\n\t\t\t\tawait txRead.done;\n\n\t\t\t\tif (!stored) throw new Error('Item not found in trash');\n\t\t\t\tif (stored.userId !== userId) throw new Error('Unauthorized');\n\n\t\t\t\tconst recordTypes: string[] = Array.from(\n\t\t\t\t\tnew Set(\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t...(Array.isArray(stored.recordTypes) ? stored.recordTypes : []),\n\t\t\t\t\t\t\tstored.recordType || stored.type\n\t\t\t\t\t\t].filter(Boolean) as string[]\n\t\t\t\t\t)\n\t\t\t\t);\n\n\t\t\t\tconst restoreType =\n\t\t\t\t\ttargetType || stored.recordType || stored.type || recordTypes[0] || 'trip';\n\n\t\t\t\t// 2. Logic Check: If restoring mileage, is parent trip safe?\n\t\t\t\tif (restoreType === 'mileage') {\n\t\t\t\t\tconst realId = getRealId(uniqueId);\n\t\t\t\t\tconst parentId = stored.tripId || realId;\n\n\t\t\t\t\t// Check trip existence if this mileage has a tripId (whether it's the same as realId or not)\n\t\t\t\t\t// This handles both auto logs (tripId !== realId) and trip-attached mileage (tripId === realId)\n\t\t\t\t\tif (stored.tripId) {\n\t\t\t\t\t\tconst txCheck = db.transaction(['trips', 'trash'], 'readonly');\n\t\t\t\t\t\tconst tripExists = await txCheck.objectStore('trips').get(parentId);\n\t\t\t\t\t\tconst tripTrash =\n\t\t\t\t\t\t\t(await txCheck.objectStore('trash').get(`trip:${parentId}`)) ||\n\t\t\t\t\t\t\t(await txCheck.objectStore('trash').get(parentId));\n\t\t\t\t\t\tawait txCheck.done;\n\n\t\t\t\t\t\tif (!tripExists) {\n\t\t\t\t\t\t\tif (tripTrash) {\n\t\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t\t'The parent Trip is currently in the Trash. Please restore the Trip first.'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t\t'This mileage log belongs to a trip that has been permanently deleted. It cannot be restored.'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// 3. Prepare Data\n\t\t\t\tconst backups: Record<string, any> =\n\t\t\t\t\tstored.backups || (stored.data && (stored.data.__backups as any)) || {};\n\n\t\t\t\t// Handle \"backup\" vs \"backups\" inconsistency from server vs local\n\t\t\t\tconst backupFor = (t: string) =>\n\t\t\t\t\tbackups[t] ||\n\t\t\t\t\t(stored.data && stored.data[t]) ||\n\t\t\t\t\tstored.backup ||\n\t\t\t\t\t(stored.recordType === t ? stored.data || stored : undefined) ||\n\t\t\t\t\tstored;\n\n\t\t\t\tconst restored = { ...(backupFor(restoreType) || {}) };\n\t\t\t\trestored.id = getRealId(uniqueId);\n\n\t\t\t\tdelete restored.deleted;\n\t\t\t\tdelete restored.deletedAt;\n\t\t\t\tdelete restored.metadata;\n\t\t\t\tdelete restored.backup;\n\t\t\t\tdelete restored.backups;\n\t\t\t\tdelete restored.recordTypes;\n\t\t\t\trestored.updatedAt = new Date().toISOString();\n\t\t\t\trestored.syncStatus = 'pending';\n\n\t\t\t\t// 4. Atomic Write\n\t\t\t\tconst mileageStoreName = getMileageStoreName(db);\n\t\t\t\tconst tx = db.transaction(['trash', 'expenses', mileageStoreName, 'trips'], 'readwrite');\n\t\t\t\tif (restoreType === 'expense') {\n\t\t\t\t\tawait tx.objectStore('expenses').put(restored);\n\t\t\t\t} else if (restoreType === 'mileage') {\n\t\t\t\t\tawait tx.objectStore(mileageStoreName).put(restored);\n\t\t\t\t} else if (restoreType === 'trip') {\n\t\t\t\t\t// FIX: Write restored trip to IndexedDB so it persists\n\t\t\t\t\tawait tx.objectStore('trips').put(restored);\n\t\t\t\t}\n\n\t\t\t\t// Always delete the trash item\n\t\t\t\tawait tx.objectStore('trash').delete(uniqueId);\n\t\t\t\tawait tx.done; // Finish transaction BEFORE updating Svelte stores\n\n\t\t\t\t// 5. Update Svelte Stores (Now safe to async import)\n\t\t\t\tif (restoreType === 'expense') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst { expenses } = await import('$lib/stores/expenses');\n\t\t\t\t\t\texpenses.updateLocal(restored);\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t/* ignore */\n\t\t\t\t\t}\n\t\t\t\t} else if (restoreType === 'mileage') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst { mileage } = await import('$lib/stores/mileage');\n\t\t\t\t\t\tmileage.updateLocal(restored);\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t/* ignore */\n\t\t\t\t\t}\n\t\t\t\t\t// Also update the associated trip's totalMiles and fuelCost\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst parentId = stored.tripId || getRealId(uniqueId);\n\t\t\t\t\t\tconst tripTx = db.transaction('trips', 'readwrite');\n\t\t\t\t\t\tconst tripStore = tripTx.objectStore('trips');\n\t\t\t\t\t\tconst trip = await tripStore.get(parentId);\n\t\t\t\t\t\tif (trip && trip.userId === userId) {\n\t\t\t\t\t\t\tconst { calculateFuelCost } = await import('$lib/utils/calculations');\n\t\t\t\t\t\t\tconst newMiles = restored.miles || 0;\n\t\t\t\t\t\t\tconst mpg = trip.mpg || 25;\n\t\t\t\t\t\t\tconst gasPrice = trip.gasPrice || 3.5;\n\t\t\t\t\t\t\tconst newFuelCost = calculateFuelCost(newMiles, mpg, gasPrice);\n\t\t\t\t\t\t\tconst nowIso = new Date().toISOString();\n\t\t\t\t\t\t\tconst patchedTrip = {\n\t\t\t\t\t\t\t\t...trip,\n\t\t\t\t\t\t\t\ttotalMiles: newMiles,\n\t\t\t\t\t\t\t\tfuelCost: newFuelCost,\n\t\t\t\t\t\t\t\tupdatedAt: nowIso,\n\t\t\t\t\t\t\t\tsyncStatus: 'pending'\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tawait tripStore.put(patchedTrip);\n\t\t\t\t\t\t\tawait tripTx.done;\n\t\t\t\t\t\t\t// Update the trips store\n\t\t\t\t\t\t\tconst { trips } = await import('$lib/stores/trips');\n\t\t\t\t\t\t\ttrips.updateLocal({\n\t\t\t\t\t\t\t\tid: parentId,\n\t\t\t\t\t\t\t\ttotalMiles: newMiles,\n\t\t\t\t\t\t\t\tfuelCost: newFuelCost,\n\t\t\t\t\t\t\t\tupdatedAt: nowIso\n\t\t\t\t\t\t\t} as any);\n\t\t\t\t\t\t\t// Queue sync for trip update\n\t\t\t\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\t\t\t\taction: 'update',\n\t\t\t\t\t\t\t\ttripId: parentId,\n\t\t\t\t\t\t\t\tdata: { ...patchedTrip, store: 'trips', skipEnrichment: true }\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait tripTx.done;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t/* ignore trip update errors */\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst { trips } = await import('$lib/stores/trips');\n\t\t\t\t\t\ttrips.updateLocal(restored);\n\t\t\t\t\t\t// Note: Bundled mileage is NOT auto-restored with trip.\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t/* ignore */\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tupdate((items) => items.filter((it) => it.id !== uniqueId));\n\n\t\t\t\t// 6. Queue Sync\n\t\t\t\tconst syncTarget =\n\t\t\t\t\trestoreType === 'expense' ? 'expenses' : restoreType === 'mileage' ? 'mileage' : 'trips';\n\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\taction: 'restore',\n\t\t\t\t\ttripId: restored.id,\n\t\t\t\t\tdata: { store: syncTarget, type: restoreType }\n\t\t\t\t});\n\n\t\t\t\treturn restored;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to restore item:', err);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\n\t\tasync permanentDelete(id: string) {\n\t\t\tconst db = await getDB();\n\n\t\t\t// First get the item to determine its record type\n\t\t\tconst txRead = db.transaction('trash', 'readonly');\n\t\t\tconst item = await txRead.objectStore('trash').get(id);\n\t\t\tawait txRead.done;\n\n\t\t\tconst tx = db.transaction('trash', 'readwrite');\n\t\t\tawait tx.objectStore('trash').delete(id);\n\t\t\tawait tx.done;\n\t\t\tupdate((l) => l.filter((t) => t.id !== id));\n\n\t\t\tconst realId = getRealId(id);\n\t\t\t// Get record type from prefix or from the item's recordType property\n\t\t\tconst recordType = getRecordType(id) || item?.recordType || item?.type;\n\t\t\tawait syncManager.addToQueue({\n\t\t\t\taction: 'permanentDelete',\n\t\t\t\ttripId: realId,\n\t\t\t\tdata: { recordType }\n\t\t\t});\n\t\t},\n\n\t\tasync emptyTrash(userId: string) {\n\t\t\tconst db = await getDB();\n\t\t\tconst txRead = db.transaction('trash', 'readonly');\n\t\t\tconst index = txRead.objectStore('trash').index('userId');\n\t\t\tconst userItems = await index.getAll(userId);\n\t\t\tawait txRead.done;\n\n\t\t\tconst tx = db.transaction('trash', 'readwrite');\n\t\t\tfor (const item of userItems) {\n\t\t\t\tawait tx.objectStore('trash').delete(item.id);\n\t\t\t}\n\t\t\tawait tx.done;\n\n\t\t\tupdate((current) => current.filter((item) => item.userId !== userId));\n\n\t\t\tfor (const item of userItems) {\n\t\t\t\tconst realId = getRealId(item.id);\n\t\t\t\tconst recordType = getRecordType(item.id) || item.recordType || (item as any).type;\n\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\taction: 'permanentDelete',\n\t\t\t\t\ttripId: realId,\n\t\t\t\t\tdata: { recordType }\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn userItems.length;\n\t\t},\n\n\t\tasync syncFromCloud(userId: string, type?: string) {\n\t\t\ttry {\n\t\t\t\tif (!navigator.onLine) return;\n\n\t\t\t\tconst url = type ? `/api/trash?type=${encodeURIComponent(type)}` : '/api/trash';\n\t\t\t\tconst response = await fetch(url);\n\t\t\t\tif (!response.ok) return;\n\n\t\t\t\tconst cloudTrash: any = await response.json();\n\t\t\t\tconst cloudIds = new Set<string>();\n\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('trash', 'readwrite');\n\t\t\t\tconst store = tx.objectStore('trash');\n\n\t\t\t\tfor (const rawItem of cloudTrash) {\n\t\t\t\t\tlet flatItem: any = { ...rawItem };\n\n\t\t\t\t\tif (flatItem.data) {\n\t\t\t\t\t\tflatItem = { ...flatItem.data, ...flatItem };\n\t\t\t\t\t\tdelete flatItem.data;\n\t\t\t\t\t}\n\t\t\t\t\tif (flatItem.trip) flatItem = { ...flatItem.trip, ...flatItem };\n\t\t\t\t\tdelete flatItem.trip;\n\n\t\t\t\t\tif (flatItem.metadata) {\n\t\t\t\t\t\tflatItem.deletedAt = flatItem.metadata.deletedAt || flatItem.deletedAt;\n\t\t\t\t\t\tflatItem.expiresAt = flatItem.metadata.expiresAt || flatItem.expiresAt;\n\t\t\t\t\t\tflatItem.originalKey = flatItem.metadata.originalKey || flatItem.originalKey;\n\n\t\t\t\t\t\tif (!flatItem.userId && typeof flatItem.metadata.originalKey === 'string') {\n\t\t\t\t\t\t\tconst parts = flatItem.metadata.originalKey.split(':');\n\t\t\t\t\t\t\tflatItem.userId = String(parts[1] || '');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdelete flatItem.metadata;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!flatItem.id) continue;\n\n\t\t\t\t\tif (!flatItem.recordType && !flatItem.type) {\n\t\t\t\t\t\tif (flatItem.originalKey?.startsWith('expense:')) flatItem.recordType = 'expense';\n\t\t\t\t\t\telse if (flatItem.originalKey?.startsWith('mileage:')) flatItem.recordType = 'mileage';\n\t\t\t\t\t\telse if (flatItem.originalKey?.startsWith('trip:')) flatItem.recordType = 'trip';\n\t\t\t\t\t\telse if (typeof flatItem.miles === 'number' && !flatItem.stops)\n\t\t\t\t\t\t\tflatItem.recordType = 'mileage';\n\t\t\t\t\t\telse flatItem.recordType = 'trip';\n\t\t\t\t\t} else if (flatItem.type && !flatItem.recordType) {\n\t\t\t\t\t\tflatItem.recordType = flatItem.type;\n\t\t\t\t\t}\n\t\t\t\t\tflatItem.type = flatItem.recordType;\n\n\t\t\t\t\t// [!code fix] Ensure Trash ID is unique on download\n\t\t\t\t\tconst uniqueId = getUniqueTrashId(flatItem);\n\t\t\t\t\tflatItem.id = uniqueId;\n\n\t\t\t\t\tcloudIds.add(uniqueId);\n\n\t\t\t\t\tconst local = await store.get(uniqueId);\n\t\t\t\t\tif (!local || new Date(flatItem.deletedAt) > new Date(local.deletedAt)) {\n\t\t\t\t\t\tawait store.put({\n\t\t\t\t\t\t\t...flatItem,\n\t\t\t\t\t\t\tsyncStatus: 'synced',\n\t\t\t\t\t\t\tlastSyncedAt: new Date().toISOString()\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst index = store.index('userId');\n\t\t\t\tconst localItems = await index.getAll(userId);\n\t\t\t\tfor (const localItem of localItems) {\n\t\t\t\t\tif (type && localItem.recordType !== type) continue;\n\n\t\t\t\t\tif (!cloudIds.has(localItem.id)) {\n\t\t\t\t\t\tif (localItem.syncStatus === 'pending') continue;\n\t\t\t\t\t\tawait store.delete(localItem.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tawait tx.done;\n\n\t\t\t\t// Cleanup Active Stores based on REAL IDs\n\t\t\t\tconst mileageStoreName = getMileageStoreName(db);\n\t\t\t\tconst cleanupTx = db.transaction(\n\t\t\t\t\t['trash', 'trips', 'expenses', mileageStoreName],\n\t\t\t\t\t'readwrite'\n\t\t\t\t);\n\t\t\t\tconst allTrash = await cleanupTx.objectStore('trash').getAll();\n\t\t\t\tconst tripStore = cleanupTx.objectStore('trips');\n\t\t\t\tconst expenseStore = cleanupTx.objectStore('expenses');\n\t\t\t\tconst mileageStore = cleanupTx.objectStore(mileageStoreName);\n\t\t\t\tfor (const trashItem of allTrash) {\n\t\t\t\t\tconst realId = getRealId(trashItem.id);\n\t\t\t\t\tconst rt = trashItem.recordType;\n\n\t\t\t\t\tif (rt === 'trip') {\n\t\t\t\t\t\tif (await tripStore.get(realId)) await tripStore.delete(realId);\n\t\t\t\t\t} else if (rt === 'expense') {\n\t\t\t\t\t\tif (await expenseStore.get(realId)) await expenseStore.delete(realId);\n\t\t\t\t\t} else if (rt === 'mileage') {\n\t\t\t\t\t\tif (await mileageStore.get(realId)) await mileageStore.delete(realId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tawait cleanupTx.done;\n\n\t\t\t\tawait this.load(userId, type);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to sync trash:', err);\n\t\t\t}\n\t\t},\n\n\t\tasync getCount(userId: string) {\n\t\t\tconst items = await this.load(userId);\n\t\t\treturn items.length;\n\t\t},\n\n\t\tclear() {\n\t\t\tset([]);\n\t\t}\n\t};\n}\n\nexport const trash = createTrashStore();\n\nsyncManager.registerStore('trash', {\n\tupdateLocal: () => {},\n\tsyncDown: async () => {\n\t\tconst user = get(authUser) as User | null;\n\t\tif (user?.id) await trash.syncFromCloud(user.id);\n\t}\n});\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\trips.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 55,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 55,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1872, 1875], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1872, 1875], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 55,
				"column": 49,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 55,
				"endColumn": 52,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1905, 1908], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1905, 1908], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 56,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 56,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1946, 1949], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1946, 1949], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 56,
				"column": 44,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 56,
				"endColumn": 47,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1977, 1980], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1977, 1980], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 57,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 57,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2014, 2017], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2014, 2017], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 58,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 58,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2055, 2058], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2055, 2058], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 59,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 59,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2110, 2113], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2110, 2113], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 98,
				"column": 60,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 98,
				"endColumn": 63,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3529, 3532], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3529, 3532], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 155,
				"column": 10,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 155,
				"endColumn": 13,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5594, 5597], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5594, 5597], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 192,
				"column": 37,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 192,
				"endColumn": 40,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6729, 6732], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6729, 6732], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 195,
				"column": 37,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 195,
				"endColumn": 40,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6810, 6813], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6810, 6813], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 201,
				"column": 36,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 201,
				"endColumn": 39,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7007, 7010], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7007, 7010], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 203,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 203,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7098, 7101], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7098, 7101], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 205,
				"column": 33,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 205,
				"endColumn": 36,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7180, 7183], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7180, 7183], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 206,
				"column": 33,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 206,
				"endColumn": 36,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7239, 7242], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7239, 7242], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 245,
				"column": 22,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 245,
				"endColumn": 25,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8378, 8381], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8378, 8381], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 263,
				"column": 27,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 263,
				"endColumn": 30,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [9013, 9016], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [9013, 9016], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 484,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 484,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16687, 16690], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16687, 16690], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 18,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/stores/trips.ts\nimport { writable, get } from 'svelte/store';\nimport { getDB, getMileageStoreName } from '$lib/db/indexedDB';\nimport { syncManager } from '$lib/sync/syncManager';\nimport type { TripRecord } from '$lib/db/types';\nimport { storage } from '$lib/utils/storage';\nimport { user as authUser } from '$lib/stores/auth';\nimport { userSettings } from '$lib/stores/userSettings';\nimport type { User } from '$lib/types';\nimport { PLAN_LIMITS } from '$lib/constants';\nimport { csrfFetch } from '$lib/utils/csrf';\n\nexport const isLoading = writable(false);\n\nfunction createTripsStore() {\n\tconst { subscribe, set, update } = writable<TripRecord[]>([]);\n\n\treturn {\n\t\tsubscribe,\n\t\tupdateLocal(trip: TripRecord) {\n\t\t\tupdate((items) => {\n\t\t\t\tconst index = items.findIndex((t) => t.id === trip.id);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tconst newItems = [...items];\n\t\t\t\t\tnewItems[index] = { ...newItems[index], ...trip };\n\t\t\t\t\treturn newItems;\n\t\t\t\t}\n\t\t\t\t// If trip doesn't exist in the store, add it (for restore from trash)\n\t\t\t\treturn [trip, ...items];\n\t\t\t});\n\t\t},\n\t\t// ... (keep load, create, updateTrip exactly as they are) ...\n\t\tasync load(userId?: string) {\n\t\t\t// ... copy existing load code ...\n\t\t\tisLoading.set(true);\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('trips', 'readonly');\n\t\t\t\tconst store = tx.objectStore('trips');\n\t\t\t\tlet trips: TripRecord[];\n\t\t\t\tif (userId) {\n\t\t\t\t\tconst index = store.index('userId');\n\t\t\t\t\ttrips = await index.getAll(userId);\n\t\t\t\t} else {\n\t\t\t\t\ttrips = await store.getAll();\n\t\t\t\t}\n\t\t\t\ttrips.sort((a, b) => {\n\t\t\t\t\tconst dateA = new Date(a.date || a.createdAt).getTime();\n\t\t\t\t\tconst dateB = new Date(b.date || b.createdAt).getTime();\n\t\t\t\t\treturn dateB - dateA;\n\t\t\t\t});\n\t\t\t\tconst dbRW = db.transaction('trips', 'readwrite');\n\t\t\t\tconst storeRW = dbRW.objectStore('trips');\n\t\t\t\tfor (const t of trips) {\n\t\t\t\t\tif ((t as any).totalMiles == null && (t as any).totalMileage != null) {\n\t\t\t\t\t\t(t as any).totalMiles = Number((t as any).totalMileage) || 0;\n\t\t\t\t\t\t(t as any).syncStatus = 'pending';\n\t\t\t\t\t\t(t as any).updatedAt = new Date().toISOString();\n\t\t\t\t\t\t(t as any).lastModified = new Date().toISOString();\n\t\t\t\t\t\tawait storeRW.put(t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tawait dbRW.done;\n\t\t\t\tset(trips);\n\t\t\t\treturn trips;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to load trips:', err);\n\t\t\t\tset([]);\n\t\t\t\treturn [];\n\t\t\t} finally {\n\t\t\t\tisLoading.set(false);\n\t\t\t}\n\t\t},\n\t\tasync create(tripData: Partial<TripRecord>, userId: string) {\n\t\t\t// ... copy existing create code ...\n\t\t\ttry {\n\t\t\t\tconst currentUser = get(authUser) as User | null;\n\t\t\t\tconst isFreeTier = !currentUser?.plan || currentUser.plan === 'free';\n\t\t\t\tif (isFreeTier) {\n\t\t\t\t\tconst db = await getDB();\n\t\t\t\t\tconst tx = db.transaction('trips', 'readonly');\n\t\t\t\t\tconst index = tx.objectStore('trips').index('userId');\n\t\t\t\t\tconst allUserTrips = await index.getAll(userId);\n\t\t\t\t\tconst windowDays = PLAN_LIMITS.FREE.WINDOW_DAYS || 30;\n\t\t\t\t\tconst windowMs = windowDays * 24 * 60 * 60 * 1000;\n\t\t\t\t\tconst cutoff = new Date(Date.now() - windowMs);\n\t\t\t\t\tconst recentCount = allUserTrips.filter((t) => {\n\t\t\t\t\t\tconst d = new Date(t.date || t.createdAt);\n\t\t\t\t\t\treturn d >= cutoff;\n\t\t\t\t\t}).length;\n\t\t\t\t\tconst allowed =\n\t\t\t\t\t\tPLAN_LIMITS.FREE.MAX_TRIPS_PER_MONTH || PLAN_LIMITS.FREE.MAX_TRIPS_IN_WINDOW || 10;\n\t\t\t\t\tif (recentCount >= allowed) {\n\t\t\t\t\t\tthrow new Error(`Free tier limit reached (${allowed} trips per ${windowDays} days).`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst now = new Date().toISOString();\n\t\t\t\tconst normalizedStops = (tripData.stops || []).map((s: any, i) => ({\n\t\t\t\t\tid: String(s.id || crypto.randomUUID()),\n\t\t\t\t\taddress: String(s.address || ''),\n\t\t\t\t\tearnings: Number(s.earnings) || 0,\n\t\t\t\t\tnotes: s.notes || '',\n\t\t\t\t\torder: typeof s.order === 'number' ? s.order : i,\n\t\t\t\t\tdistanceFromPrev: Number(s.distanceFromPrev) || 0,\n\t\t\t\t\ttimeFromPrev: Number(s.timeFromPrev) || 0\n\t\t\t\t}));\n\t\t\t\tconst trip: TripRecord = {\n\t\t\t\t\t...tripData,\n\t\t\t\t\tstops: normalizedStops,\n\t\t\t\t\tid: tripData.id || crypto.randomUUID(),\n\t\t\t\t\tuserId,\n\t\t\t\t\tcreatedAt: tripData.createdAt || now,\n\t\t\t\t\tupdatedAt: tripData.updatedAt || now,\n\t\t\t\t\tlastModified: now,\n\t\t\t\t\tsyncStatus: 'pending'\n\t\t\t\t} as TripRecord;\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('trips', 'readwrite');\n\t\t\t\tawait tx.objectStore('trips').put(trip);\n\t\t\t\tawait tx.done;\n\t\t\t\tupdate((trips) => {\n\t\t\t\t\tconst exists = trips.find((t) => t.id === trip.id);\n\t\t\t\t\tif (exists) return trips.map((t) => (t.id === trip.id ? trip : t));\n\t\t\t\t\treturn [trip, ...trips];\n\t\t\t\t});\n\t\t\t\t// Enqueue trip sync - mileage creation is handled server-side\n\t\t\t\ttry {\n\t\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\t\taction: 'create',\n\t\t\t\t\t\ttripId: trip.id,\n\t\t\t\t\t\tdata: { ...trip, store: 'trips' }\n\t\t\t\t\t});\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.warn('Failed to enqueue trip for sync:', err);\n\t\t\t\t}\n\t\t\t\t// NOTE: Mileage log creation is handled server-side in POST /api/trips\n\t\t\t\t// to ensure a single source of truth and include user settings\n\t\t\t\treturn trip;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to create trip:', err);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\t\tasync updateTrip(id: string, changes: Partial<TripRecord>, userId: string) {\n\t\t\t// ... copy existing updateTrip code ...\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('trips', 'readwrite');\n\t\t\t\tconst store = tx.objectStore('trips');\n\t\t\t\tconst existing = await store.get(id);\n\t\t\t\tif (!existing) throw new Error('Trip not found');\n\t\t\t\tif (existing.userId !== userId) throw new Error('Unauthorized');\n\t\t\t\tconst now = new Date().toISOString();\n\t\t\t\tconst normalizedStops = (changes.stops || existing.stops || []).map(\n\t\t\t\t\t(s: any, i: number) => ({\n\t\t\t\t\t\tid: String(s.id || crypto.randomUUID()),\n\t\t\t\t\t\taddress: String(s.address || ''),\n\t\t\t\t\t\tearnings: Number(s.earnings) || 0,\n\t\t\t\t\t\tnotes: s.notes || '',\n\t\t\t\t\t\torder: typeof s.order === 'number' ? s.order : i,\n\t\t\t\t\t\tdistanceFromPrev: Number(s.distanceFromPrev) || 0,\n\t\t\t\t\t\ttimeFromPrev: Number(s.timeFromPrev) || 0\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\tconst updated: TripRecord = {\n\t\t\t\t\t...existing,\n\t\t\t\t\t...changes,\n\t\t\t\t\tstops: normalizedStops,\n\t\t\t\t\tid,\n\t\t\t\t\tuserId,\n\t\t\t\t\tupdatedAt: now,\n\t\t\t\t\tlastModified: now,\n\t\t\t\t\tsyncStatus: 'pending'\n\t\t\t\t};\n\t\t\t\tawait store.put(updated);\n\t\t\t\tawait tx.done;\n\t\t\t\tupdate((trips) => trips.map((t) => (t.id === id ? updated : t)));\n\t\t\t\tawait syncManager.addToQueue({\n\t\t\t\t\taction: 'update',\n\t\t\t\t\ttripId: id,\n\t\t\t\t\tdata: updated\n\t\t\t\t});\n\t\t\t\ttry {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(changes, 'totalMiles')) {\n\t\t\t\t\t\tconst { mileage } = await import('$lib/stores/mileage');\n\t\t\t\t\t\tconst existingMileage = await mileage.get(id, userId);\n\n\t\t\t\t\t\tif (existingMileage) {\n\t\t\t\t\t\t\t// Update existing mileage record\n\t\t\t\t\t\t\tawait mileage.updateMileage(\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t{ miles: Number((changes as any).totalMiles) },\n\t\t\t\t\t\t\t\tuserId\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else if (Number((changes as any).totalMiles) > 0) {\n\t\t\t\t\t\t\t// Create new mileage record if none exists and miles > 0\n\t\t\t\t\t\t\tawait mileage.create(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\ttripId: id,\n\t\t\t\t\t\t\t\t\tmiles: Number((changes as any).totalMiles),\n\t\t\t\t\t\t\t\t\tdate: updated.date,\n\t\t\t\t\t\t\t\t\tmileageRate: (get(userSettings) as any)?.mileageRate ?? undefined,\n\t\t\t\t\t\t\t\t\tvehicle:\n\t\t\t\t\t\t\t\t\t\t(get(userSettings) as any)?.vehicles?.[0]?.id ??\n\t\t\t\t\t\t\t\t\t\t(get(userSettings) as any)?.vehicles?.[0]?.name ??\n\t\t\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\t\tcreatedAt: updated.createdAt,\n\t\t\t\t\t\t\t\t\tupdatedAt: updated.updatedAt\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuserId\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.warn('Failed to mirror trip mileage to local mileage store:', err);\n\t\t\t\t}\n\t\t\t\treturn updated;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to update trip:', err);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\n\t\t// [!code focus] THE FIX IS HERE\n\t\tasync deleteTrip(id: string, userId: string) {\n\t\t\tlet previousTrips: TripRecord[] = [];\n\t\t\tupdate((current) => {\n\t\t\t\tpreviousTrips = current;\n\t\t\t\treturn current.filter((t) => t.id !== id);\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tripsTx = db.transaction('trips', 'readonly');\n\t\t\t\tconst trip = await tripsTx.objectStore('trips').get(id);\n\t\t\t\tif (!trip) throw new Error('Trip not found');\n\t\t\t\tif (trip.userId !== userId) throw new Error('Unauthorized');\n\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst expiresAt = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\n\n\t\t\t\t// Prepare trip trash item\n\t\t\t\t// We use \"trip:\" prefix to ensure it never collides with mileage logs\n\t\t\t\tconst trashItem: any = {\n\t\t\t\t\t...trip,\n\t\t\t\t\tid: `trip:${id}`,\n\t\t\t\t\toriginalId: id,\n\t\t\t\t\tuserId: trip.userId,\n\t\t\t\t\tdeletedAt: now.toISOString(),\n\t\t\t\t\tdeletedBy: userId,\n\t\t\t\t\texpiresAt: expiresAt.toISOString(),\n\t\t\t\t\toriginalKey: `trip:${userId}:${id}`,\n\t\t\t\t\tsyncStatus: 'pending',\n\t\t\t\t\trecordType: 'trip',\n\t\t\t\t\tbackups: { trip: { ...trip } }\n\t\t\t\t};\n\n\t\t\t\t// Check and capture mileage - create SEPARATE trash item for mileage\n\t\t\t\tconst mileageStoreName = getMileageStoreName(db);\n\t\t\t\tconst mileageTx = db.transaction(mileageStoreName, 'readwrite');\n\t\t\t\tconst activeMileage = await mileageTx.objectStore(mileageStoreName).get(id);\n\t\t\t\tlet mileageTrashItem: any = null;\n\t\t\t\tif (activeMileage) {\n\t\t\t\t\t// Store mileage backup in trip item for reference\n\t\t\t\t\ttrashItem.backups.mileage = { ...activeMileage };\n\t\t\t\t\t// Also store top-level props for easy UI display\n\t\t\t\t\ttrashItem.miles = activeMileage.miles;\n\t\t\t\t\ttrashItem.vehicle = activeMileage.vehicle;\n\n\t\t\t\t\t// Create SEPARATE trash item for mileage so user can restore it independently\n\t\t\t\t\tmileageTrashItem = {\n\t\t\t\t\t\t...activeMileage,\n\t\t\t\t\t\tid: `mileage:${id}`,\n\t\t\t\t\t\toriginalId: id,\n\t\t\t\t\t\tuserId: activeMileage.userId,\n\t\t\t\t\t\tdeletedAt: now.toISOString(),\n\t\t\t\t\t\tdeletedBy: userId,\n\t\t\t\t\t\texpiresAt: expiresAt.toISOString(),\n\t\t\t\t\t\toriginalKey: `mileage:${userId}:${id}`,\n\t\t\t\t\t\tsyncStatus: 'pending',\n\t\t\t\t\t\trecordType: 'mileage',\n\t\t\t\t\t\ttripId: id,\n\t\t\t\t\t\tbackups: { mileage: { ...activeMileage } }\n\t\t\t\t\t};\n\n\t\t\t\t\t// Delete from active store\n\t\t\t\t\tawait mileageTx.objectStore(mileageStoreName).delete(id);\n\t\t\t\t}\n\t\t\t\tawait mileageTx.done;\n\t\t\t\t// Save trash items (trip and optionally mileage)\n\t\t\t\tconst trashTx = db.transaction('trash', 'readwrite');\n\t\t\t\tawait trashTx.objectStore('trash').put(trashItem);\n\t\t\t\tif (mileageTrashItem) {\n\t\t\t\t\tawait trashTx.objectStore('trash').put(mileageTrashItem);\n\t\t\t\t}\n\t\t\t\tawait trashTx.done;\n\n\t\t\t\t// Delete from active trips\n\t\t\t\tconst delTx = db.transaction('trips', 'readwrite');\n\t\t\t\tawait delTx.objectStore('trips').delete(id);\n\t\t\t\tawait delTx.done;\n\n\t\t\t\t// Only enqueue server sync if client is authenticated as the same user to avoid 401s\n\t\t\t\tconst currentUser = get(authUser) as User | null;\n\t\t\t\tif (currentUser && currentUser.id && currentUser.id === trip.userId) {\n\t\t\t\t\tawait syncManager.addToQueue({ action: 'delete', tripId: id });\n\t\t\t\t} else {\n\t\t\t\t\t// Skip server sync for unauthenticated/offline users. Sync will occur when a valid session is available.\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to delete trip:', err);\n\t\t\t\tset(previousTrips);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t},\n\n\t\t// ... (keep get, clear, syncFromCloud, syncPendingToCloud, migrateOfflineTrips) ...\n\t\tasync get(id: string, userId: string) {\n\t\t\t// ... copy existing get code ...\n\t\t\ttry {\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('trips', 'readonly');\n\t\t\t\tconst trip = await tx.objectStore('trips').get(id);\n\t\t\t\tif (!trip || trip.userId !== userId) return null;\n\t\t\t\treturn trip;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to get trip:', err);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tclear() {\n\t\t\tset([]);\n\t\t},\n\t\tasync syncFromCloud(userId: string) {\n\t\t\t// ... copy existing syncFromCloud code ...\n\t\t\tisLoading.set(true);\n\t\t\ttry {\n\t\t\t\tif (!navigator.onLine) return;\n\t\t\t\tconst lastSync = storage.getLastSync();\n\t\t\t\tlet url = '/api/trips';\n\t\t\t\tif (lastSync) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst adjusted = new Date(lastSync);\n\t\t\t\t\t\tadjusted.setMinutes(adjusted.getMinutes() - 5);\n\t\t\t\t\t\tconst now = new Date();\n\t\t\t\t\t\tif (adjusted.getTime() > now.getTime()) {\n\t\t\t\t\t\t\tadjusted.setTime(now.getTime() - 5 * 60 * 1000);\n\t\t\t\t\t\t}\n\t\t\t\t\t\turl = `/api/trips?since=${encodeURIComponent(adjusted.toISOString())}`;\n\t\t\t\t\t} catch {\n\t\t\t\t\t\turl = `/api/trips?since=${encodeURIComponent(lastSync)}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconsole.log(`☁️ Syncing trips... ${lastSync ? `(Delta since ${lastSync})` : '(Full)'}`);\n\t\t\t\tconst response = await fetch(url, { credentials: 'include' });\n\t\t\t\tif (!response.ok) throw new Error('Failed to fetch trips');\n\t\t\t\tconst cloudTrips: unknown[] = (await response.json()) as unknown[];\n\t\t\t\tif (cloudTrips.length === 0) {\n\t\t\t\t\tconsole.log('☁️ No new trip changes.');\n\t\t\t\t\tstorage.setLastSync(new Date().toISOString());\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst trashTx = db.transaction('trash', 'readonly');\n\t\t\t\tconst trashStore = trashTx.objectStore('trash');\n\t\t\t\tconst trashItems = await trashStore.getAll();\n\t\t\t\tconst trashIds = new Set(trashItems.map((t: { id: string }) => t.id));\n\t\t\t\tconst tx = db.transaction('trips', 'readwrite');\n\t\t\t\tconst store = tx.objectStore('trips');\n\t\t\t\tlet updateCount = 0;\n\t\t\t\tlet deleteCount = 0;\n\t\t\t\tfor (const cloudTripRaw of cloudTrips) {\n\t\t\t\t\tconst cloudTrip = cloudTripRaw as unknown as {\n\t\t\t\t\t\tid?: string;\n\t\t\t\t\t\tupdatedAt?: string;\n\t\t\t\t\t\tdeleted?: boolean;\n\t\t\t\t\t};\n\t\t\t\t\tif (!cloudTrip.id) continue;\n\t\t\t\t\t// Check simple ID AND prefixed ID to be safe\n\t\t\t\t\tif (trashIds.has(cloudTrip.id) || trashIds.has(`trip:${cloudTrip.id}`)) continue;\n\t\t\t\t\tconst local = await store.get(cloudTrip.id);\n\t\t\t\t\tif (!local || new Date(cloudTrip.updatedAt || '') > new Date(local.updatedAt || '')) {\n\t\t\t\t\t\tif (cloudTrip.deleted) {\n\t\t\t\t\t\t\tawait store.delete(cloudTrip.id);\n\t\t\t\t\t\t\tdeleteCount++;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait store.put({\n\t\t\t\t\t\t\t\t...(cloudTrip as object),\n\t\t\t\t\t\t\t\tsyncStatus: 'synced',\n\t\t\t\t\t\t\t\tlastSyncedAt: new Date().toISOString()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tupdateCount++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tawait tx.done;\n\t\t\t\tstorage.setLastSync(new Date().toISOString());\n\t\t\t\tconsole.log(`✅ Synced trips. Updated: ${updateCount}, Deleted: ${deleteCount}.`);\n\t\t\t\tawait this.load(userId);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to sync trips from cloud:', err);\n\t\t\t} finally {\n\t\t\t\tisLoading.set(false);\n\t\t\t}\n\t\t},\n\t\tasync syncPendingToCloud(userId: string) {\n\t\t\t// ... copy existing syncPendingToCloud code ...\n\t\t\ttry {\n\t\t\t\tif (!navigator.onLine) return { synced: 0, failed: 0 };\n\t\t\t\tconsole.log('⬆️ Syncing pending local changes...');\n\t\t\t\tconst db = await getDB();\n\t\t\t\tconst tx = db.transaction('trips', 'readonly');\n\t\t\t\tconst index = tx.objectStore('trips').index('userId');\n\t\t\t\tconst allTrips = await index.getAll(userId);\n\t\t\t\tawait tx.done;\n\t\t\t\tconst pendingTrips = allTrips.filter((t) => t.syncStatus === 'pending');\n\t\t\t\tif (pendingTrips.length === 0) return { synced: 0, failed: 0 };\n\t\t\t\tconsole.log(`📤 Uploading ${pendingTrips.length} pending trip(s)...`);\n\t\t\t\tlet synced = 0;\n\t\t\t\tlet failed = 0;\n\t\t\t\tfor (const trip of pendingTrips) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst method = trip.createdAt !== trip.updatedAt ? 'PUT' : 'POST';\n\t\t\t\t\t\tconst response = await csrfFetch('/api/trips', {\n\t\t\t\t\t\t\tmethod,\n\t\t\t\t\t\t\tcredentials: 'include'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\t\tconst updateTx = db.transaction('trips', 'readwrite');\n\t\t\t\t\t\t\tconst updatedTrip = { ...trip, syncStatus: 'synced' as const };\n\t\t\t\t\t\t\tawait updateTx.objectStore('trips').put(updatedTrip);\n\t\t\t\t\t\t\tawait updateTx.done;\n\t\t\t\t\t\t\tsynced++;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfailed++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tconsole.error('Error syncing trip:', trip.id, err);\n\t\t\t\t\t\tfailed++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn { synced, failed };\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('❌ Failed to sync pending changes:', err);\n\t\t\t\treturn { synced: 0, failed: 0 };\n\t\t\t}\n\t\t},\n\t\tasync migrateOfflineTrips(tempUserId: string, realUserId: string) {\n\t\t\t// ... copy existing migrateOfflineTrips code ...\n\t\t\tif (!tempUserId || !realUserId || tempUserId === realUserId) return;\n\t\t\tconst db = await getDB();\n\t\t\tconst tx = db.transaction('trips', 'readwrite');\n\t\t\tconst store = tx.objectStore('trips');\n\t\t\tconst index = store.index('userId');\n\t\t\tconst offlineTrips = await index.getAll(tempUserId);\n\t\t\tfor (const trip of offlineTrips) {\n\t\t\t\ttrip.userId = realUserId;\n\t\t\t\ttrip.syncStatus = 'pending';\n\t\t\t\ttrip.updatedAt = new Date().toISOString();\n\t\t\t\tawait store.put(trip);\n\t\t\t\tawait syncManager.addToQueue({ action: 'create', tripId: trip.id, data: trip });\n\t\t\t}\n\t\t\tawait tx.done;\n\t\t\tawait this.load(realUserId);\n\t\t}\n\t};\n}\n\nexport const trips = createTripsStore();\n\nsyncManager.registerStore('trips', {\n\tupdateLocal: (trip) => trips.updateLocal(trip),\n\tsyncDown: async () => {\n\t\tconst user = get(authUser) as User | null;\n\t\tif (user?.id) await trips.syncFromCloud(user.id);\n\t}\n});\n\nfunction createDraftStore() {\n\tconst { subscribe, set } = writable(storage.getDraftTrip());\n\treturn {\n\t\tsubscribe,\n\t\tsave: (data: any) => {\n\t\t\tstorage.saveDraftTrip(data);\n\t\t\tset(data);\n\t\t},\n\t\tload: () => storage.getDraftTrip(),\n\t\tclear: () => {\n\t\t\tstorage.clearDraftTrip();\n\t\t\tset(null);\n\t\t}\n\t};\n}\n\nexport const draftTrip = createDraftStore();\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\user.svelte.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\stores\\userSettings.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\sync\\syncManager.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 9,
				"column": 22,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 9,
				"endColumn": 25,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [335, 338], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [335, 338], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 183,
				"column": 37,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 183,
				"endColumn": 40,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5026, 5029], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5026, 5029], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 207,
				"column": 50,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 207,
				"endColumn": 53,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5815, 5818], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5815, 5818], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 222,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 222,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6239, 6242], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6239, 6242], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 222,
				"column": 24,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 222,
				"endColumn": 27,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6250, 6253], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6250, 6253], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 238,
				"column": 25,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 238,
				"endColumn": 28,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6753, 6756], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6753, 6756], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 266,
				"column": 31,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 266,
				"endColumn": 34,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7549, 7552], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7549, 7552], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 294,
				"column": 32,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 294,
				"endColumn": 35,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8679, 8682], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8679, 8682], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 305,
				"column": 9,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 305,
				"endColumn": 12,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8964, 8967], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8964, 8967], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 348,
				"column": 60,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 348,
				"endColumn": 63,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [10374, 10377], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [10374, 10377], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 10,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/sync/syncManager.ts\nimport { getDB } from '$lib/db/indexedDB';\nimport { syncStatus } from '$lib/stores/sync';\nimport type { SyncQueueItem, TripRecord } from '$lib/db/types';\nimport { loadGoogleMaps } from '$lib/utils/autocomplete';\nimport { csrfFetch } from '$lib/utils/csrf';\n\ninterface StoreHandler {\n\tupdateLocal: (data: any) => void;\n\tsyncDown: () => Promise<void>;\n}\n\nclass SyncManager {\n\tprivate initialized = false;\n\tprivate syncInterval: ReturnType<typeof setInterval> | null = null;\n\tprivate isSyncing = false;\n\tprivate apiKey: string = '';\n\tprivate syncDebounceTimer: ReturnType<typeof setTimeout> | null = null;\n\n\tprivate registeredStores = new Map<string, StoreHandler>();\n\tprivate storeUpdater?: (trip: TripRecord) => void;\n\n\tregisterStore(name: string, handler: StoreHandler) {\n\t\tthis.registeredStores.set(name, handler);\n\t}\n\n\tsetStoreUpdater(updater: (trip: TripRecord) => void) {\n\t\tthis.storeUpdater = updater;\n\t}\n\n\tasync initialize(apiKey?: string) {\n\t\tif (this.initialized) return;\n\n\t\tconsole.log('🔧 Initializing sync manager...');\n\t\tif (apiKey) this.apiKey = apiKey;\n\n\t\tsyncStatus.setOnline(navigator.onLine);\n\n\t\twindow.addEventListener('online', () => this.handleOnline());\n\t\twindow.addEventListener('offline', () => this.handleOffline());\n\n\t\tdocument.addEventListener('visibilitychange', () => {\n\t\t\tif (!document.hidden && navigator.onLine) {\n\t\t\t\tthis.syncNow();\n\t\t\t}\n\t\t});\n\n\t\tif (navigator.onLine) {\n\t\t\tawait this.syncNow();\n\t\t\t// Initial pull\n\t\t\tawait this.syncDownAll();\n\t\t\tthis.startAutoSync();\n\t\t}\n\n\t\tawait this.updatePendingCount();\n\t\tthis.initialized = true;\n\t\tconsole.log('✅ Sync manager initialized');\n\t}\n\n\tprivate async syncDownAll() {\n\t\tconsole.log('⬇️ Downloading latest data (Refresh)...');\n\t\tawait Promise.all(\n\t\t\tArray.from(this.registeredStores.values()).map((store) =>\n\t\t\t\tstore.syncDown().catch((e) => console.error('Store sync down failed:', e))\n\t\t\t)\n\t\t);\n\t}\n\n\tprivate async handleOnline() {\n\t\tconsole.log('🌐 Back online!');\n\t\tsyncStatus.setOnline(true);\n\t\tawait this.syncNow();\n\t\tthis.startAutoSync();\n\t}\n\n\tprivate handleOffline() {\n\t\tconsole.log('📴 Offline mode');\n\t\tsyncStatus.setOnline(false);\n\t\tthis.stopAutoSync();\n\t}\n\n\tprivate startAutoSync() {\n\t\tif (this.syncInterval) return;\n\t\tthis.syncInterval = setInterval(() => {\n\t\t\tif (navigator.onLine) this.syncNow();\n\t\t}, 30000);\n\t}\n\n\tprivate stopAutoSync() {\n\t\tif (this.syncInterval) {\n\t\t\tclearInterval(this.syncInterval);\n\t\t\tthis.syncInterval = null;\n\t\t}\n\t}\n\n\tasync addToQueue(item: Omit<SyncQueueItem, 'id' | 'timestamp' | 'retries'>) {\n\t\tconst db = await getDB();\n\t\tconst tx = db.transaction('syncQueue', 'readwrite');\n\t\tawait tx.objectStore('syncQueue').add({ ...item, timestamp: Date.now(), retries: 0 });\n\t\tawait tx.done;\n\t\tawait this.updatePendingCount();\n\t\tconsole.log(`📋 Added to sync queue: ${item.action} ${item.tripId}`);\n\n\t\t// PERFORMANCE: Debounce sync to avoid rapid-fire sync calls blocking UI\n\t\tif (navigator.onLine && !this.isSyncing) {\n\t\t\tthis.debouncedSync();\n\t\t}\n\t}\n\n\tprivate debouncedSync() {\n\t\t// Clear existing timer\n\t\tif (this.syncDebounceTimer) {\n\t\t\tclearTimeout(this.syncDebounceTimer);\n\t\t}\n\n\t\t// Set a new timer - sync after 500ms of inactivity\n\t\tthis.syncDebounceTimer = setTimeout(() => {\n\t\t\tthis.syncNow();\n\t\t}, 500);\n\t}\n\n\tprivate async updatePendingCount() {\n\t\tconst db = await getDB();\n\t\tconst tx = db.transaction('syncQueue', 'readonly');\n\t\tconst count = await tx.objectStore('syncQueue').count();\n\t\tsyncStatus.updatePendingCount(count);\n\t}\n\n\tasync syncNow() {\n\t\tif (!navigator.onLine || this.isSyncing) return;\n\n\t\tthis.isSyncing = true;\n\t\tsyncStatus.setSyncing();\n\n\t\ttry {\n\t\t\tconst db = await getDB();\n\t\t\tconst queue = await db.getAll('syncQueue');\n\n\t\t\tif (queue.length > 0) {\n\t\t\t\tconsole.log(`🔄 Syncing ${queue.length} item(s)...`);\n\t\t\t\tlet failCount = 0;\n\n\t\t\t\tfor (const item of queue) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Enrich only if it's a trip creation/update and not deleted\n\t\t\t\t\t\t// Also skip if explicitly flagged (e.g., when updating trip after mileage deletion)\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(item.action === 'create' || item.action === 'update') &&\n\t\t\t\t\t\t\titem.data &&\n\t\t\t\t\t\t\t(!item.data.store || item.data.store === 'trips') &&\n\t\t\t\t\t\t\t!item.data.skipEnrichment\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// [!code fix] Safe enrichment block\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tawait this.enrichTripData(item.data);\n\t\t\t\t\t\t\t} catch (enrichErr) {\n\t\t\t\t\t\t\t\tconsole.warn('⚠️ Failed to enrich trip data (proceeding anyway):', enrichErr);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tawait this.processSyncItem(item);\n\t\t\t\t\t\tawait this.removeFromQueue(item.id!);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tfailCount++;\n\t\t\t\t\t\tconsole.error(`❌ Failed to sync: ${item.action} ${item.tripId}`, err);\n\t\t\t\t\t\tawait this.handleSyncError(item, err);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tawait this.updatePendingCount();\n\t\t\t\tif (failCount > 0) syncStatus.setError(`${failCount} item(s) failed`);\n\t\t\t}\n\n\t\t\tsyncStatus.setSynced();\n\t\t} catch (err) {\n\t\t\tconsole.error('❌ Sync error:', err);\n\t\t\tsyncStatus.setError('Sync failed');\n\t\t} finally {\n\t\t\tthis.isSyncing = false;\n\t\t}\n\t}\n\n\tprivate async enrichTripData(trip: any) {\n\t\tif (trip.totalMiles === 0 && trip.startAddress) {\n\t\t\tconsole.log(`🧮 Calculating offline route for trip ${trip.id}...`);\n\n\t\t\ttry {\n\t\t\t\t// [!code fix] Explicitly catch Map loading errors\n\t\t\t\ttry {\n\t\t\t\t\tawait loadGoogleMaps(this.apiKey);\n\t\t\t\t} catch (loaderErr) {\n\t\t\t\t\tconsole.warn('⚠️ Google Maps failed to load (blocked/offline). Skipping.', loaderErr);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// [!code fix] Ensure service is available before constructing\n\t\t\t\tif (\n\t\t\t\t\ttypeof google === 'undefined' ||\n\t\t\t\t\t!google.maps ||\n\t\t\t\t\ttypeof google.maps.DirectionsService !== 'function'\n\t\t\t\t) {\n\t\t\t\t\tconsole.warn('⚠️ Google Maps DirectionsService not available.');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst directionsService = new google.maps.DirectionsService();\n\t\t\t\tconst waypoints = (trip.stops || []).map((s: any) => ({\n\t\t\t\t\tlocation: s.address,\n\t\t\t\t\tstopover: true\n\t\t\t\t}));\n\t\t\t\tconst destination = trip.endAddress || trip.startAddress;\n\n\t\t\t\tconst result = await directionsService.route({\n\t\t\t\t\torigin: trip.startAddress,\n\t\t\t\t\tdestination: destination,\n\t\t\t\t\twaypoints: waypoints,\n\t\t\t\t\ttravelMode: google.maps.TravelMode.DRIVING\n\t\t\t\t});\n\n\t\t\t\tif (result && result.routes[0]) {\n\t\t\t\t\tconst leg = result.routes[0].legs.reduce(\n\t\t\t\t\t\t(acc: any, curr: any) => ({\n\t\t\t\t\t\t\tdist: acc.dist + curr.distance.value,\n\t\t\t\t\t\t\tdur: acc.dur + curr.duration.value\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t{ dist: 0, dur: 0 }\n\t\t\t\t\t);\n\n\t\t\t\t\ttrip.totalMiles = Math.round((leg.dist / 1609.34) * 10) / 10;\n\t\t\t\t\ttrip.estimatedTime = Math.round(leg.dur / 60);\n\n\t\t\t\t\tif (trip.mpg && trip.gasPrice) {\n\t\t\t\t\t\tconst gallons = trip.totalMiles / trip.mpg;\n\t\t\t\t\t\ttrip.fuelCost = Math.round(gallons * trip.gasPrice * 100) / 100;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst earnings = (trip.stops || []).reduce(\n\t\t\t\t\t\t(s: number, stop: any) => s + (Number(stop.earnings) || 0),\n\t\t\t\t\t\t0\n\t\t\t\t\t);\n\t\t\t\t\tconst costs =\n\t\t\t\t\t\t(trip.fuelCost || 0) + (trip.maintenanceCost || 0) + (trip.suppliesCost || 0);\n\t\t\t\t\ttrip.netProfit = earnings - costs;\n\n\t\t\t\t\tconst db = await getDB();\n\t\t\t\t\tconst tx = db.transaction('trips', 'readwrite');\n\t\t\t\t\tawait tx.objectStore('trips').put(trip);\n\t\t\t\t\tawait tx.done;\n\n\t\t\t\t\tconst tripsStore = this.registeredStores.get('trips');\n\t\t\t\t\tif (this.storeUpdater) {\n\t\t\t\t\t\tthis.storeUpdater(trip as TripRecord);\n\t\t\t\t\t} else if (tripsStore) {\n\t\t\t\t\t\ttripsStore.updateLocal(trip);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('⚠️ Could not calculate route for offline trip:', e);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async processSyncItem(item: SyncQueueItem) {\n\t\tconst { action, tripId, data } = item;\n\n\t\tconst storeName = ((data as any)?.store as string) || 'trips';\n\t\tconst baseUrl =\n\t\t\tstoreName === 'expenses'\n\t\t\t\t? '/api/expenses'\n\t\t\t\t: storeName === 'mileage'\n\t\t\t\t\t? '/api/mileage'\n\t\t\t\t\t: '/api/trips';\n\n\t\tconst url =\n\t\t\taction === 'create'\n\t\t\t\t? baseUrl\n\t\t\t\t: action.includes('delete')\n\t\t\t\t\t? `${baseUrl}/${tripId}`\n\t\t\t\t\t: `${baseUrl}/${tripId}`;\n\n\t\tlet targetStore: 'trips' | 'expenses' | 'mileage' | 'trash' | null =\n\t\t\tstoreName === 'expenses' ? 'expenses' : storeName === 'mileage' ? 'mileage' : 'trips';\n\n\t\tif (action === 'delete') targetStore = 'trash';\n\t\tif (action === 'permanentDelete') targetStore = null;\n\n\t\tif (action === 'create') await this.apiCall(url, 'POST', data, targetStore, tripId);\n\t\telse if (action === 'update') await this.apiCall(url, 'PUT', data, targetStore, tripId);\n\t\telse if (action === 'delete') await this.apiCall(url, 'DELETE', null, 'trash', tripId);\n\t\telse if (action === 'restore')\n\t\t\tawait this.apiCall(`/api/trash/${tripId}`, 'POST', null, 'trips', tripId);\n\t\telse if (action === 'permanentDelete') {\n\t\t\t// Include record type as query param so server knows which service to delete from\n\t\t\tconst recordType = (data as any)?.recordType;\n\t\t\tconst deleteUrl = recordType\n\t\t\t\t? `/api/trash/${tripId}?type=${encodeURIComponent(recordType)}`\n\t\t\t\t: `/api/trash/${tripId}`;\n\t\t\tawait this.apiCall(deleteUrl, 'DELETE', null, null, tripId);\n\t\t}\n\t}\n\n\tprivate async apiCall(\n\t\turl: string,\n\t\tmethod: string,\n\t\tbody: any,\n\t\tupdateStore: 'trips' | 'expenses' | 'mileage' | 'trash' | null,\n\t\tid: string\n\t) {\n\t\tconst res = await csrfFetch(url, {\n\t\t\tmethod,\n\t\t\tkeepalive: true,\n\t\t\tcredentials: 'include',\n\t\t\theaders: body ? { 'Content-Type': 'application/json' } : undefined,\n\t\t\tbody: body ? JSON.stringify(body) : undefined\n\t\t});\n\n\t\tif (!res.ok) {\n\t\t\tif (res.status === 401) {\n\t\t\t\t// Authentication required: pause sync and retry later\n\t\t\t\tthrow new Error('AUTH_REQUIRED');\n\t\t\t}\n\t\t\tif (res.status >= 400 && res.status < 500) {\n\t\t\t\tconst errText = await res.text().catch(() => '');\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`ABORT_RETRY: Server rejected request (${res.status}): ${errText.substring(0, 100)}`\n\t\t\t\t);\n\t\t\t}\n\t\t\tthrow new Error(`${method} failed with status ${res.status}`);\n\t\t}\n\n\t\tif (updateStore) await this.markAsSynced(updateStore, id);\n\t}\n\n\tprivate async markAsSynced(store: 'trips' | 'expenses' | 'mileage' | 'trash', tripId: string) {\n\t\tconst db = await getDB();\n\t\tconst tx = db.transaction(store, 'readwrite');\n\t\tconst objectStore = tx.objectStore(store);\n\t\t// [!code fix] Handle prefixed IDs (like mileage:abc) by checking both if needed, or just standard get\n\t\tconst record = await objectStore.get(tripId);\n\t\tif (record) {\n\t\t\trecord.syncStatus = 'synced';\n\t\t\trecord.lastSyncedAt = new Date().toISOString();\n\t\t\tawait objectStore.put(record);\n\t\t}\n\t\tawait tx.done;\n\t}\n\n\tprivate async handleSyncError(item: SyncQueueItem, error: any) {\n\t\tconst db = await getDB();\n\t\tconst tx = db.transaction('syncQueue', 'readwrite');\n\t\tconst store = tx.objectStore('syncQueue');\n\n\t\tconst isAuthRequired = error.message?.includes('AUTH_REQUIRED');\n\t\tconst isFatal = error.message?.includes('ABORT_RETRY');\n\n\t\tif (isAuthRequired) {\n\t\t\tconsole.warn(`Sync paused due to authentication required for item ${item.id}`);\n\t\t\tsyncStatus.setError('Authentication required. Please refresh or sign in to resume sync.');\n\t\t\t// Pause sync processing by throwing to outer handler so we don't drop the queue item\n\t\t\tthrow new Error('PAUSE_SYNC');\n\t\t}\n\n\t\tif (isFatal) {\n\t\t\tconsole.error(\n\t\t\t\t`🛑 Sync failed permanently for item ${item.id} (Trip ${item.tripId}). Removing from queue.`\n\t\t\t);\n\t\t\tawait store.delete(item.id!);\n\t\t\tsyncStatus.setError(`Sync rejected: ${error.message.replace('ABORT_RETRY: ', '')}`);\n\t\t} else {\n\t\t\titem.retries = (item.retries || 0) + 1;\n\t\t\titem.lastError = error.message || String(error);\n\n\t\t\tif (item.retries > 5) await store.delete(item.id!);\n\t\t\telse await store.put(item);\n\t\t}\n\n\t\tawait tx.done;\n\t}\n\n\tprivate async removeFromQueue(id: number) {\n\t\tconst db = await getDB();\n\t\tawait db.delete('syncQueue', id);\n\t}\n\n\tasync forceSyncNow() {\n\t\tawait this.syncNow();\n\t}\n\n\tdestroy() {\n\t\tthis.stopAutoSync();\n\t\tthis.initialized = false;\n\t}\n}\n\nexport const syncManager = new SyncManager();\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\types\\index.d.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\types\\index.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 39,
				"column": 8,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 39,
				"endColumn": 11,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [944, 947], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [944, 947], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 147,
				"column": 12,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 147,
				"endColumn": 15,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3177, 3180], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3177, 3180], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 2,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/types/index.ts\n\n/** Core user type used across the app */\nexport interface User {\n\tid?: string; // optional user id\n\ttoken: string;\n\tplan: 'free' | 'pro' | 'business' | 'premium'; // include legacy 'premium' value used in fixtures\n\ttripsThisMonth: number;\n\tmaxTrips: number;\n\tresetDate: string;\n\tname?: string;\n\temail?: string;\n}\n\n/** Lightweight public user object exposed to client (no token or sensitive fields) */\nexport interface PublicUser {\n\tid?: string;\n\tname?: string;\n\tplan: 'free' | 'pro' | 'business' | 'premium';\n\ttripsThisMonth?: number;\n\tmaxTrips?: number;\n\tresetDate?: string;\n}\n\n/** Geo helpers */\nexport interface LatLng {\n\tlat: number;\n\tlng: number;\n}\n\nexport interface GeocodeResult {\n\t// Google/Mapbox style results (legacy code accesses these fields)\n\tformatted_address?: string;\n\tname?: string;\n\tgeometry?: { location?: { lat?: number; lng?: number } };\n\tlat?: number;\n\tlng?: number;\n\taddress?: string;\n\traw?: any;\n}\n\nexport interface Location extends LatLng {\n\taddress?: string;\n}\n\nexport interface UnsanitizedLocation {\n\tlat?: unknown;\n\tlng?: unknown;\n\taddress?: unknown;\n}\n\n/** Destination / stop shapes */\nexport interface Destination {\n\tid?: string;\n\taddress: string;\n\tearnings: number;\n\tlocation?: LatLng | null; // some code assigns a location object\n}\n\nexport interface Stop {\n\tid?: string;\n\taddress?: string;\n\tearnings?: number;\n\tnotes?: string;\n\torder?: number;\n\tlocation?: LatLng | null;\n}\n\nexport interface CostItem {\n\tid?: string;\n\ttype: string;\n\tcost: number;\n\ttaxDeductible?: boolean;\n}\n\nexport type MaintenanceCost = CostItem;\nexport type SupplyCost = CostItem;\n\n/** Trip shape (backwards-compatible fields included) */\nexport interface Trip {\n\tid?: string;\n\tdate?: string; // YYYY-MM-DD\n\t// legacy/start time variants\n\tstartTime?: string; // HH:MM\n\tendTime?: string; // HH:MM\n\tstartClock?: string; // legacy name\n\tendClock?: string; // legacy name\n\n\tstartAddress?: string;\n\tendAddress?: string;\n\tstartLocation?: LatLng | null;\n\tendLocation?: LatLng | null;\n\n\t// Stops may be called 'stops' or 'destinations' depending on past versions\n\tstops?: Stop[];\n\tdestinations?: Destination[];\n\n\t// mileage/earnings\n\ttotalMiles?: number;\n\ttotalMileage?: number;\n\testimatedTime?: number;\n\ttotalTime?: string;\n\ttotalEarnings?: number;\n\n\tfuelCost?: number;\n\tmaintenanceCost?: number;\n\tmaintenanceItems?: MaintenanceCost[];\n\tsuppliesCost?: number;\n\tsupplyItems?: SupplyCost[]; // canonical\n\tsuppliesItems?: SupplyCost[]; // legacy\n\n\thoursWorked?: number;\n\tnetProfit?: number;\n\tprofitPerHour?: number;\n\tmpg?: number;\n\tgasPrice?: number;\n\tnotes?: string;\n\tlastModified?: string; // ISO 8601 timestamp\n\tisOptimized?: boolean;\n\toriginalOrder?: Destination[];\n\tserviceType?: string;\n}\n\nexport interface RouteResult {\n\tdistance: number; // in miles\n\tduration: number; // in seconds\n\troute: google.maps.DirectionsResult;\n}\n\nexport interface Subscription {\n\tplan: 'free' | 'pro' | 'business' | 'premium';\n\ttripsThisMonth: number;\n\tmaxTrips: number;\n\tfeatures: string[];\n\tresetDate: string;\n}\n\nexport interface AuthResponse {\n\tid?: string;\n\ttoken: string;\n\tresetKey?: string;\n}\n\nexport interface ApiError {\n\terror: string;\n\tcode?: string;\n\tdetails?: any;\n}\n\nexport interface TripFilters {\n\tstartDate?: string;\n\tendDate?: string;\n\tsearchQuery?: string;\n\tminProfit?: number;\n\tmaxProfit?: number;\n}\n\nexport interface TripStats {\n\ttotalProfit: number;\n\ttotalTrips: number;\n\tavgProfitPerHour: number;\n\ttotalMiles: number;\n\ttotalFuelCost: number;\n\ttotalMaintenanceCost: number;\n\ttotalSuppliesCost: number;\n}\n\nexport interface ChartData {\n\tlabels: string[];\n\tdatasets: {\n\t\tlabel: string;\n\t\tdata: number[];\n\t\tbackgroundColor?: string | string[];\n\t\tborderColor?: string;\n\t}[];\n}\n\nexport interface Settings {\n\tdefaultStartAddress: string;\n\tdefaultEndAddress: string;\n\tdefaultMPG: number;\n\tdefaultGasPrice: number;\n\trecentDestinations: string[];\n\tmaintenanceCategories: string[];\n\tsupplyCategories: string[];\n}\n\n/** Unsanitized input shapes (used by sanitize utilities) */\nexport interface UnsanitizedStop {\n\tid?: unknown;\n\taddress?: unknown;\n\tearnings?: unknown;\n\tnotes?: unknown;\n\torder?: unknown;\n\tlocation?: unknown;\n}\n\nexport interface UnsanitizedDestination {\n\tid?: unknown;\n\taddress?: unknown;\n\tearnings?: unknown;\n\tlocation?: unknown;\n}\n\nexport interface UnsanitizedCostItem {\n\ttype?: unknown;\n\tcost?: unknown;\n\ttaxDeductible?: unknown;\n}\n\nexport interface UnsanitizedTrip {\n\tid?: unknown;\n\tdate?: unknown;\n\tstartTime?: unknown;\n\tendTime?: unknown;\n\thoursWorked?: unknown;\n\tstartAddress?: unknown;\n\tstartLocation?: unknown;\n\tendAddress?: unknown;\n\tendLocation?: unknown;\n\ttotalMiles?: unknown;\n\testimatedTime?: unknown;\n\ttotalTime?: unknown;\n\tmpg?: unknown;\n\tgasPrice?: unknown;\n\tfuelCost?: unknown;\n\tmaintenanceCost?: unknown;\n\tsuppliesCost?: unknown;\n\ttotalEarnings?: unknown;\n\tnetProfit?: unknown;\n\tnotes?: unknown;\n\tstops?: unknown;\n\tdestinations?: unknown;\n\tmaintenanceItems?: unknown;\n\tsuppliesItems?: unknown;\n\tlastModified?: unknown;\n}\n\n/** Cloudflare KV rate limit shape used by rate limiter */\nexport interface RateLimitData {\n\tcount: number;\n\twindowStart: number; // ms since epoch\n}\n\n// Backwards compat aliases (if code imports these exact names)\nexport type Geocode = GeocodeResult;\nexport type LatLngLiteral = LatLng;\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\analytics.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 254,
				"column": 43,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 254,
				"endColumn": 46,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6915, 6918], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6915, 6918], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// Analytics calculation functions for trip and expense data\n\nimport type { Trip } from '$lib/types';\n\nexport interface TripAnalytics {\n\t// Revenue metrics\n\ttotalRevenue: number;\n\tavgRevenuePerTrip: number;\n\tavgRevenuePerMile: number;\n\trevenueByServiceType: Record<string, number>;\n\n\t// Cost metrics\n\ttotalExpenses: number;\n\ttotalFuelCost: number;\n\ttotalMaintenanceCost: number;\n\ttotalSuppliesCost: number;\n\tavgExpensePerTrip: number;\n\tavgCostPerMile: number;\n\n\t// Profit metrics\n\tnetProfit: number;\n\tavgProfitPerTrip: number;\n\tprofitMargin: number;\n\n\t// Mileage metrics\n\ttotalMiles: number;\n\tavgMilesPerTrip: number;\n\n\t// Time metrics\n\ttotalHours: number;\n\tavgHoursPerTrip: number;\n\tavgHourlyRate: number;\n\n\t// Trip counts\n\ttotalTrips: number;\n\ttripsByServiceType: Record<string, number>;\n}\n\nexport interface MonthlyComparison {\n\tcurrentMonth: {\n\t\trevenue: number;\n\t\texpenses: number;\n\t\tprofit: number;\n\t\ttrips: number;\n\t\tmiles: number;\n\t};\n\tpreviousMonth: {\n\t\trevenue: number;\n\t\texpenses: number;\n\t\tprofit: number;\n\t\ttrips: number;\n\t\tmiles: number;\n\t};\n\tchanges: {\n\t\trevenue: { amount: number; percent: number };\n\t\texpenses: { amount: number; percent: number };\n\t\tprofit: { amount: number; percent: number };\n\t\ttrips: { amount: number; percent: number };\n\t\tmiles: { amount: number; percent: number };\n\t};\n}\n\nexport interface PeriodBreakdown {\n\tweekly: Array<{ week: string; revenue: number; expenses: number; profit: number; trips: number }>;\n\tmonthly: Array<{\n\t\tmonth: string;\n\t\trevenue: number;\n\t\texpenses: number;\n\t\tprofit: number;\n\t\ttrips: number;\n\t}>;\n\tquarterly: Array<{\n\t\tquarter: string;\n\t\trevenue: number;\n\t\texpenses: number;\n\t\tprofit: number;\n\t\ttrips: number;\n\t}>;\n}\n\n/**\n * Calculate comprehensive analytics from trip data\n */\nexport function calculateTripAnalytics(trips: Trip[]): TripAnalytics {\n\tif (trips.length === 0) {\n\t\treturn {\n\t\t\ttotalRevenue: 0,\n\t\t\tavgRevenuePerTrip: 0,\n\t\t\tavgRevenuePerMile: 0,\n\t\t\trevenueByServiceType: {},\n\t\t\ttotalExpenses: 0,\n\t\t\ttotalFuelCost: 0,\n\t\t\ttotalMaintenanceCost: 0,\n\t\t\ttotalSuppliesCost: 0,\n\t\t\tavgExpensePerTrip: 0,\n\t\t\tavgCostPerMile: 0,\n\t\t\tnetProfit: 0,\n\t\t\tavgProfitPerTrip: 0,\n\t\t\tprofitMargin: 0,\n\t\t\ttotalMiles: 0,\n\t\t\tavgMilesPerTrip: 0,\n\t\t\ttotalHours: 0,\n\t\t\tavgHoursPerTrip: 0,\n\t\t\tavgHourlyRate: 0,\n\t\t\ttotalTrips: 0,\n\t\t\ttripsByServiceType: {}\n\t\t};\n\t}\n\n\tlet totalRevenue = 0;\n\tlet totalFuelCost = 0;\n\tlet totalMaintenanceCost = 0;\n\tlet totalSuppliesCost = 0;\n\tlet totalMiles = 0;\n\tlet totalHours = 0;\n\tconst revenueByServiceType: Record<string, number> = {};\n\tconst tripsByServiceType: Record<string, number> = {};\n\n\ttrips.forEach((trip) => {\n\t\t// Revenue from stops\n\t\tconst tripRevenue =\n\t\t\ttrip.stops?.reduce(\n\t\t\t\t(sum: number, stop: { earnings?: number }) => sum + (stop.earnings || 0),\n\t\t\t\t0\n\t\t\t) || 0;\n\t\ttotalRevenue += tripRevenue;\n\n\t\t// Expenses\n\t\ttotalFuelCost += trip.fuelCost || 0;\n\t\ttotalMaintenanceCost += trip.maintenanceCost || 0;\n\t\ttotalSuppliesCost += trip.suppliesCost || 0;\n\n\t\t// Mileage\n\t\ttotalMiles += trip.totalMiles || 0;\n\n\t\t// Hours\n\t\ttotalHours += trip.hoursWorked || 0;\n\n\t\t// Service type tracking - ensure initialization before mutation\n\t\tconst serviceType = trip.serviceType || 'Other';\n\t\tconst prevRev = revenueByServiceType[serviceType] ?? 0;\n\t\tconst prevTrips = tripsByServiceType[serviceType] ?? 0;\n\t\trevenueByServiceType[serviceType] = prevRev + tripRevenue;\n\t\ttripsByServiceType[serviceType] = prevTrips + 1;\n\t});\n\n\tconst totalExpenses = totalFuelCost + totalMaintenanceCost + totalSuppliesCost;\n\tconst netProfit = totalRevenue - totalExpenses;\n\tconst totalTrips = trips.length;\n\n\treturn {\n\t\ttotalRevenue,\n\t\tavgRevenuePerTrip: totalTrips > 0 ? totalRevenue / totalTrips : 0,\n\t\tavgRevenuePerMile: totalMiles > 0 ? totalRevenue / totalMiles : 0,\n\t\trevenueByServiceType,\n\t\ttotalExpenses,\n\t\ttotalFuelCost,\n\t\ttotalMaintenanceCost,\n\t\ttotalSuppliesCost,\n\t\tavgExpensePerTrip: totalTrips > 0 ? totalExpenses / totalTrips : 0,\n\t\tavgCostPerMile: totalMiles > 0 ? totalExpenses / totalMiles : 0,\n\t\tnetProfit,\n\t\tavgProfitPerTrip: totalTrips > 0 ? netProfit / totalTrips : 0,\n\t\tprofitMargin: totalRevenue > 0 ? (netProfit / totalRevenue) * 100 : 0,\n\t\ttotalMiles,\n\t\tavgMilesPerTrip: totalTrips > 0 ? totalMiles / totalTrips : 0,\n\t\ttotalHours,\n\t\tavgHoursPerTrip: totalTrips > 0 ? totalHours / totalTrips : 0,\n\t\tavgHourlyRate: totalHours > 0 ? netProfit / totalHours : 0,\n\t\ttotalTrips,\n\t\ttripsByServiceType\n\t};\n}\n\n/**\n * Compare current month to previous month\n */\nexport function calculateMonthlyComparison(allTrips: Trip[]): MonthlyComparison {\n\tconst now = new Date();\n\tconst currentMonthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n\tconst previousMonthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n\tconst previousMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0);\n\n\tconst currentMonthTrips = allTrips.filter((trip) => {\n\t\tif (!trip.date) return false;\n\t\tconst tripDate = new Date(trip.date);\n\t\tif (isNaN(tripDate.getTime())) return false;\n\t\treturn tripDate >= currentMonthStart;\n\t});\n\n\tconst previousMonthTrips = allTrips.filter((trip) => {\n\t\tif (!trip.date) return false;\n\t\tconst tripDate = new Date(trip.date);\n\t\tif (isNaN(tripDate.getTime())) return false;\n\t\treturn tripDate >= previousMonthStart && tripDate <= previousMonthEnd;\n\t});\n\n\tconst current = calculateTripAnalytics(currentMonthTrips);\n\tconst previous = calculateTripAnalytics(previousMonthTrips);\n\n\tconst calculateChange = (curr: number, prev: number) => ({\n\t\tamount: curr - prev,\n\t\tpercent: prev > 0 ? ((curr - prev) / prev) * 100 : 0\n\t});\n\n\treturn {\n\t\tcurrentMonth: {\n\t\t\trevenue: current.totalRevenue,\n\t\t\texpenses: current.totalExpenses,\n\t\t\tprofit: current.netProfit,\n\t\t\ttrips: current.totalTrips,\n\t\t\tmiles: current.totalMiles\n\t\t},\n\t\tpreviousMonth: {\n\t\t\trevenue: previous.totalRevenue,\n\t\t\texpenses: previous.totalExpenses,\n\t\t\tprofit: previous.netProfit,\n\t\t\ttrips: previous.totalTrips,\n\t\t\tmiles: previous.totalMiles\n\t\t},\n\t\tchanges: {\n\t\t\trevenue: calculateChange(current.totalRevenue, previous.totalRevenue),\n\t\t\texpenses: calculateChange(current.totalExpenses, previous.totalExpenses),\n\t\t\tprofit: calculateChange(current.netProfit, previous.netProfit),\n\t\t\ttrips: calculateChange(current.totalTrips, previous.totalTrips),\n\t\t\tmiles: calculateChange(current.totalMiles, previous.totalMiles)\n\t\t}\n\t};\n}\n\n/**\n * Break down data by time periods\n */\nexport function calculatePeriodBreakdown(trips: Trip[]): PeriodBreakdown {\n\ttype PeriodAggregate = {\n\t\tweek: string;\n\t\tmonth: string;\n\t\tquarter: string;\n\t\trevenue: number;\n\t\texpenses: number;\n\t\tprofit: number;\n\t\ttrips: number;\n\t};\n\tconst weeklyData: Record<string, PeriodAggregate> = {};\n\tconst monthlyData: Record<string, PeriodAggregate> = {};\n\tconst quarterlyData: Record<string, PeriodAggregate> = {};\n\n\ttrips.forEach((trip) => {\n\t\tif (!trip.date) return;\n\t\tconst tripDate = new Date(trip.date);\n\t\tif (isNaN(tripDate.getTime())) return;\n\n\t\tconst revenue =\n\t\t\ttrip.stops?.reduce((sum: number, stop: any) => sum + (stop.earnings || 0), 0) || 0;\n\t\tconst expenses = (trip.fuelCost || 0) + (trip.maintenanceCost || 0) + (trip.suppliesCost || 0);\n\t\tconst profit = revenue - expenses;\n\n\t\t// Weekly\n\t\tconst weekStart = new Date(tripDate);\n\t\tweekStart.setDate(tripDate.getDate() - tripDate.getDay());\n\t\tconst weekKey: string = String(weekStart.toISOString().split('T')[0]);\n\t\tconst wk =\n\t\t\tweeklyData[weekKey] ??\n\t\t\t(weeklyData[weekKey] = {\n\t\t\t\tweek: weekKey,\n\t\t\t\tmonth: weekKey.slice(0, 7),\n\t\t\t\tquarter: `${weekKey.slice(0, 4)}-Q${Math.floor(new Date(weekKey).getMonth() / 3) + 1}`,\n\t\t\t\trevenue: 0,\n\t\t\t\texpenses: 0,\n\t\t\t\tprofit: 0,\n\t\t\t\ttrips: 0\n\t\t\t});\n\t\twk.revenue += revenue;\n\t\twk.expenses += expenses;\n\t\twk.profit += profit;\n\t\twk.trips++;\n\n\t\t// Monthly\n\t\tconst monthKey: string = `${tripDate.getFullYear()}-${String(tripDate.getMonth() + 1).padStart(2, '0')}`;\n\t\tconst mn =\n\t\t\tmonthlyData[monthKey] ??\n\t\t\t(monthlyData[monthKey] = {\n\t\t\t\tmonth: monthKey,\n\t\t\t\tweek: `${monthKey}-W01`,\n\t\t\t\tquarter: `${monthKey.slice(0, 4)}-Q${Math.floor(new Date(monthKey + '-01').getMonth() / 3) + 1}`,\n\t\t\t\trevenue: 0,\n\t\t\t\texpenses: 0,\n\t\t\t\tprofit: 0,\n\t\t\t\ttrips: 0\n\t\t\t});\n\t\tmn.revenue += revenue;\n\t\tmn.expenses += expenses;\n\t\tmn.profit += profit;\n\t\tmn.trips++;\n\n\t\t// Quarterly\n\t\tconst quarter = Math.floor(tripDate.getMonth() / 3) + 1;\n\t\tconst quarterKey = `${tripDate.getFullYear()}-Q${quarter}`;\n\t\tconst qtr =\n\t\t\tquarterlyData[quarterKey] ??\n\t\t\t(quarterlyData[quarterKey] = {\n\t\t\t\tquarter: quarterKey,\n\t\t\t\tmonth: `${quarterKey}-M01`,\n\t\t\t\tweek: `${quarterKey}-W01`,\n\t\t\t\trevenue: 0,\n\t\t\t\texpenses: 0,\n\t\t\t\tprofit: 0,\n\t\t\t\ttrips: 0\n\t\t\t});\n\t\tqtr.revenue += revenue;\n\t\tqtr.expenses += expenses;\n\t\tqtr.profit += profit;\n\t\tqtr.trips++;\n\t});\n\n\treturn {\n\t\tweekly: Object.values(weeklyData).sort((a: PeriodAggregate, b: PeriodAggregate) =>\n\t\t\t(a.week || '').localeCompare(b.week || '')\n\t\t),\n\t\tmonthly: Object.values(monthlyData).sort((a: PeriodAggregate, b: PeriodAggregate) =>\n\t\t\t(a.month || '').localeCompare(b.month || '')\n\t\t),\n\t\tquarterly: Object.values(quarterlyData).sort((a: PeriodAggregate, b: PeriodAggregate) =>\n\t\t\t(a.quarter || '').localeCompare(b.quarter || '')\n\t\t)\n\t};\n}\n\n/**\n * Format currency\n */\nexport function formatCurrency(amount: number): string {\n\treturn `$${amount.toFixed(2)}`;\n}\n\n/**\n * Format percentage with sign\n */\nexport function formatPercentChange(percent: number): string {\n\tconst sign = percent > 0 ? '+' : '';\n\treturn `${sign}${percent.toFixed(1)}%`;\n}\n\n/**\n * Get trend indicator\n */\nexport function getTrendIndicator(percent: number): string {\n\tif (percent > 5) return '↑';\n\tif (percent < -5) return '↓';\n\treturn '→';\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\api.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\autocomplete.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 59,
				"column": 47,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 59,
				"endColumn": 50,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1856, 1859], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1856, 1859], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 176,
				"column": 22,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 176,
				"endColumn": 25,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5287, 5290], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5287, 5290], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 177,
				"column": 17,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 177,
				"endColumn": 20,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5345, 5348], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5345, 5348], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 235,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 235,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7490, 7493], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7490, 7493], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 364,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 364,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [11423, 11426], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [11423, 11426], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 392,
				"column": 39,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 392,
				"endColumn": 42,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [12604, 12607], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [12604, 12607], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 397,
				"column": 40,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 397,
				"endColumn": 43,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [12762, 12765], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [12762, 12765], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 425,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 425,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [13574, 13577], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [13574, 13577], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 470,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 470,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [14878, 14881], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [14878, 14881], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 473,
				"column": 15,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 473,
				"endColumn": 18,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [14955, 14958], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [14955, 14958], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 522,
				"column": 38,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 522,
				"endColumn": 41,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16183, 16186], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16183, 16186], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 527,
				"column": 39,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 527,
				"endColumn": 42,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16336, 16339], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16336, 16339], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 541,
				"column": 65,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 541,
				"endColumn": 68,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16704, 16707], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16704, 16707], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 542,
				"column": 53,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 542,
				"endColumn": 56,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16762, 16765], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16762, 16765], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 543,
				"column": 63,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 543,
				"endColumn": 66,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16830, 16833], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16830, 16833], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 544,
				"column": 51,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 544,
				"endColumn": 54,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16886, 16889], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16886, 16889], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 545,
				"column": 64,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 545,
				"endColumn": 67,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16955, 16958], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16955, 16958], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 546,
				"column": 52,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 546,
				"endColumn": 55,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [17012, 17015], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [17012, 17015], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 547,
				"column": 49,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 547,
				"endColumn": 52,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [17066, 17069], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [17066, 17069], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 19,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/utils/autocomplete.ts\nimport type { Action } from 'svelte/action';\nimport { isAcceptableGeocode } from './geocode';\nimport { csrfFetch, jsonFetchOptions } from '$lib/utils/csrf';\n\n// Singleton Promise to prevent race conditions\nlet loadingPromise: Promise<void> | null = null;\nlet googleMapsError = false;\n\n// Exported Singleton Loader\nexport async function loadGoogleMaps(apiKey: string): Promise<void> {\n\tif (typeof google !== 'undefined' && google.maps) return Promise.resolve();\n\tif (googleMapsError) return Promise.reject(new Error('Google Maps previously failed'));\n\tif (loadingPromise) return loadingPromise;\n\n\tif (!apiKey || apiKey === 'undefined') {\n\t\tgoogleMapsError = true;\n\t\treturn Promise.reject(new Error('No API key'));\n\t}\n\n\tif (typeof document === 'undefined') {\n\t\tgoogleMapsError = true;\n\t\treturn Promise.reject(new Error('Document not available')); // Server-side: cannot load maps\n\t}\n\n\tconst existingScript = document.querySelector('script[src*=\"maps.googleapis.com\"]');\n\tif (existingScript) {\n\t\tloadingPromise = new Promise((resolve) => {\n\t\t\tconst check = setInterval(() => {\n\t\t\t\tif (typeof google !== 'undefined' && google.maps) {\n\t\t\t\t\tclearInterval(check);\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t});\n\t\treturn loadingPromise;\n\t}\n\n\tloadingPromise = new Promise((resolve, reject) => {\n\t\tconst script = document.createElement('script');\n\t\tscript.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places,geometry&loading=async`;\n\t\tscript.async = true;\n\t\tscript.defer = true;\n\n\t\tscript.onload = () => resolve();\n\t\tscript.onerror = () => {\n\t\t\tgoogleMapsError = true;\n\t\t\tloadingPromise = null;\n\t\t\treject(new Error('Failed to load Google Maps'));\n\t\t};\n\n\t\tdocument.head.appendChild(script);\n\t});\n\n\treturn loadingPromise;\n}\n\n// Lightweight validator for Rendering Phase\nexport function isRenderableCandidate(result: any, input: string) {\n\treturn isAcceptableGeocode(result, input);\n}\n\nexport const autocomplete: Action<HTMLInputElement, { apiKey: string }> = (node, params) => {\n\tlet dropdown: HTMLDivElement | null = null;\n\tlet debounceTimer: number | undefined;\n\tlet isSelecting = false;\n\tlet stop: (e: Event) => void;\n\tlet stopAndPrevent: (e: Event) => void;\n\n\tif (params.apiKey && params.apiKey !== 'undefined') {\n\t\tloadGoogleMaps(params.apiKey).catch(console.error);\n\t}\n\n\tfunction initUI() {\n\t\tdropdown = document.createElement('div');\n\t\tdropdown.className = 'pac-container';\n\n\t\tObject.assign(dropdown.style, {\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: '2147483647',\n\t\t\tbackgroundColor: '#fff',\n\t\t\tborderTop: '1px solid #e6e6e6',\n\t\t\tfontFamily: '\"Roboto\", \"Arial\", sans-serif',\n\t\t\tboxShadow: '0 4px 6px rgba(32, 33, 36, 0.28)',\n\t\t\tboxSizing: 'border-box',\n\t\t\toverflow: 'hidden',\n\t\t\tdisplay: 'none',\n\t\t\tborderRadius: '0 0 8px 8px',\n\t\t\tmarginTop: '-2px',\n\t\t\tpaddingBottom: '8px',\n\t\t\tpointerEvents: 'auto'\n\t\t});\n\n\t\tconst dialogAncestor = node.closest && node.closest('dialog');\n\t\tif (dialogAncestor) {\n\t\t\t(dropdown as HTMLElement & { __autocompleteContainer?: Element }).__autocompleteContainer =\n\t\t\t\tdialogAncestor;\n\t\t\tdialogAncestor.appendChild(dropdown);\n\t\t\tdropdown.style.position = 'absolute';\n\t\t} else {\n\t\t\tdocument.body.appendChild(dropdown);\n\t\t\tdropdown.style.position = 'fixed';\n\t\t}\n\n\t\tstop = (e: Event) => {\n\t\t\te.stopPropagation();\n\t\t};\n\t\tstopAndPrevent = (e: Event) => {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t};\n\n\t\tdropdown.addEventListener('pointerdown', stopAndPrevent);\n\t\tdropdown.addEventListener('pointerup', stop);\n\t\tdropdown.addEventListener('mousedown', stopAndPrevent);\n\t\tdropdown.addEventListener('mouseup', stop);\n\t\tdropdown.addEventListener('touchstart', stopAndPrevent);\n\t\tdropdown.addEventListener('touchend', stop);\n\t\tdropdown.addEventListener('click', stop);\n\t}\n\n\tfunction updatePosition() {\n\t\tif (!dropdown) return;\n\t\tconst rect = node.getBoundingClientRect();\n\n\t\tconst container = (dropdown as HTMLElement & { __autocompleteContainer?: Element })\n\t\t\t.__autocompleteContainer;\n\t\tif (container && container instanceof Element) {\n\t\t\tconst parentRect = container.getBoundingClientRect();\n\t\t\tObject.assign(dropdown.style, {\n\t\t\t\ttop: `${rect.bottom - parentRect.top}px`,\n\t\t\t\tleft: `${rect.left - parentRect.left}px`,\n\t\t\t\twidth: `${rect.width}px`\n\t\t\t});\n\t\t} else {\n\t\t\tObject.assign(dropdown.style, {\n\t\t\t\ttop: `${rect.bottom}px`,\n\t\t\t\tleft: `${rect.left}px`,\n\t\t\t\twidth: `${rect.width}px`\n\t\t\t});\n\t\t}\n\t}\n\n\tasync function handleInput(e: Event) {\n\t\tif (isSelecting) {\n\t\t\tisSelecting = false;\n\t\t\treturn;\n\t\t}\n\n\t\tconst value = (e.target as HTMLInputElement).value;\n\t\tupdatePosition();\n\n\t\tif (!value || value.length < 2) {\n\t\t\tif (dropdown) dropdown.style.display = 'none';\n\t\t\treturn;\n\t\t}\n\n\t\tif (debounceTimer) clearTimeout(debounceTimer);\n\t\tdebounceTimer = window.setTimeout(async () => {\n\t\t\ttry {\n\t\t\t\tconst kvUrl = `/api/autocomplete?q=${encodeURIComponent(value)}`;\n\t\t\t\tconst kvRes = await fetch(kvUrl);\n\t\t\t\tconst data = await kvRes.json();\n\n\t\t\t\tconst validData = Array.isArray(data) ? data : [];\n\t\t\t\tlet source: 'kv' | 'google' = 'kv';\n\n\t\t\t\tif (validData.length > 0) {\n\t\t\t\t\tif (validData[0].source === 'google_proxy') source = 'google';\n\t\t\t\t}\n\n\t\t\t\t// Mandatory: Strict Filter BEFORE rendering\n\t\t\t\tconst suggestionsToShow = validData.slice(0, 5);\n\t\t\t\tconst acceptableSet = new Set(\n\t\t\t\t\tsuggestionsToShow\n\t\t\t\t\t\t.filter((item: any) => isAcceptableGeocode(item, value))\n\t\t\t\t\t\t.map((it: any) => it.place_id || it.formatted_address || JSON.stringify(it))\n\t\t\t\t);\n\t\t\t\tlet filtered = suggestionsToShow; // Keep the top suggestions visible regardless of acceptability (we'll validate on blur/selection)\n\t\t\t\tfiltered = suggestionsToShow;\n\t\t\t\tif (filtered.length > 0) {\n\t\t\t\t\t// [!code --] Removed client-side caching call (moved to server)\n\t\t\t\t\trenderResults(filtered.slice(0, 5), source, acceptableSet);\n\t\t\t\t} else {\n\t\t\t\t\trenderEmpty();\n\t\t\t\t}\n\t\t\t} catch (err: unknown) {\n\t\t\t\tconsole.error('[autocomplete] search failed', err);\n\t\t\t\trenderError();\n\t\t\t}\n\t\t}, 300);\n\t}\n\n\t// [!code --] Removed redundant cacheToKV function\n\n\tasync function savePlaceToKV(place: Record<string, unknown>) {\n\t\ttry {\n\t\t\t// POST to the authenticated autocomplete endpoint which records user selections in KV\n\t\t\t// Use the CSRF wrapper so the double-submit token is included and cookies are sent.\n\t\t\t// Also avoid mass-assignment by whitelisting fields.\n\t\t\tconst payload = {\n\t\t\t\tformatted_address:\n\t\t\t\t\t(place as Record<string, unknown>)['formatted_address'] ||\n\t\t\t\t\t(place as Record<string, unknown>)['name'] ||\n\t\t\t\t\tundefined,\n\t\t\t\tname: (place as Record<string, unknown>)['name'] || undefined,\n\t\t\t\tsecondary_text: (place as Record<string, unknown>)['secondary_text'] || undefined,\n\t\t\t\tplace_id: (place as Record<string, unknown>)['place_id'] || undefined,\n\t\t\t\tgeometry: (place as Record<string, unknown>)['geometry'] || undefined,\n\t\t\t\tsource: (place as Record<string, unknown>)['source'] || undefined\n\t\t\t};\n\n\t\t\tvoid csrfFetch('/api/autocomplete', jsonFetchOptions('POST', payload)).catch(\n\t\t\t\t(err: unknown) => {\n\t\t\t\t\tconsole.error('[autocomplete] savePlaceToKV failed', err);\n\t\t\t\t}\n\t\t\t);\n\t\t} catch (_e: unknown) {\n\t\t\tvoid _e;\n\t\t\tconsole.error('[autocomplete] Failed to save place details');\n\t\t}\n\t}\n\n\tfunction renderResults(\n\t\titems: Array<Record<string, unknown>>,\n\t\tsource: 'kv' | 'google' = 'kv',\n\t\t/* timing removed */\n\t\t/* acceptableSet */ acceptableSet?: Set<string>\n\t) {\n\t\tif (!dropdown) return;\n\t\twhile (dropdown.firstChild) dropdown.removeChild(dropdown.firstChild);\n\n\t\titems.forEach((item) => {\n\t\t\tconst row = document.createElement('div');\n\t\t\tconst it: any = item;\n\n\t\t\tconst mainText =\n\t\t\t\tit.name ||\n\t\t\t\t(typeof it.formatted_address === 'string' ? it.formatted_address.split(',')[0] : '');\n\t\t\tconst secondaryText =\n\t\t\t\tit.secondary_text ||\n\t\t\t\t(typeof it.formatted_address === 'string' && it.formatted_address.includes(',')\n\t\t\t\t\t? it.formatted_address.split(',').slice(1).join(',').trim()\n\t\t\t\t\t: '');\n\n\t\t\t// Determine if this suggestion is address-grade (acceptable) — google is always acceptable\n\t\t\tconst key = it.place_id || it.formatted_address || JSON.stringify(it);\n\t\t\tconst isAcceptable = source === 'google' || (acceptableSet && acceptableSet.has(key));\n\n\t\t\t// [SECURITY FIX #12] Create SVG using createElementNS instead of innerHTML\n\t\t\t// This prevents XSS risks from dynamic content injection patterns\n\t\t\tconst createPinIcon = (): SVGSVGElement => {\n\t\t\t\tconst svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n\t\t\t\tsvg.setAttribute('focusable', 'false');\n\t\t\t\tsvg.setAttribute('viewBox', '0 0 24 24');\n\t\t\t\tsvg.setAttribute('fill', '#9AA0A6');\n\t\t\t\tsvg.setAttribute('width', '20px');\n\t\t\t\tsvg.setAttribute('height', '20px');\n\t\t\t\tconst path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\t\t\t\tpath.setAttribute(\n\t\t\t\t\t'd',\n\t\t\t\t\t'M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z'\n\t\t\t\t);\n\t\t\t\tsvg.appendChild(path);\n\t\t\t\treturn svg;\n\t\t\t};\n\n\t\t\tObject.assign(row.style, {\n\t\t\t\tdisplay: 'flex',\n\t\t\t\talignItems: 'center',\n\t\t\t\tpadding: '10px 16px',\n\t\t\t\tcursor: 'pointer',\n\t\t\t\tborderBottom: '1px solid #fff'\n\t\t\t});\n\n\t\t\tconst iconWrap = document.createElement('div');\n\t\t\tObject.assign(iconWrap.style, {\n\t\t\t\tminWidth: '24px',\n\t\t\t\tmarginRight: '12px',\n\t\t\t\tdisplay: 'flex',\n\t\t\t\talignItems: 'center'\n\t\t\t});\n\t\t\ticonWrap.appendChild(createPinIcon());\n\n\t\t\tconst content = document.createElement('div');\n\t\t\tObject.assign(content.style, { flex: '1', overflow: 'hidden' });\n\n\t\t\tconst mainDiv = document.createElement('div');\n\t\t\tObject.assign(mainDiv.style, {\n\t\t\t\tfontSize: '14px',\n\t\t\t\tcolor: '#202124',\n\t\t\t\tfontWeight: '500',\n\t\t\t\toverflow: 'hidden',\n\t\t\t\ttextOverflow: 'ellipsis',\n\t\t\t\twhiteSpace: 'nowrap'\n\t\t\t});\n\t\t\tmainDiv.textContent = mainText;\n\n\t\t\tconst secondaryDiv = document.createElement('div');\n\t\t\tObject.assign(secondaryDiv.style, {\n\t\t\t\tfontSize: '12px',\n\t\t\t\tcolor: '#70757A',\n\t\t\t\toverflow: 'hidden',\n\t\t\t\ttextOverflow: 'ellipsis',\n\t\t\t\twhiteSpace: 'nowrap',\n\t\t\t\tmarginTop: '2px'\n\t\t\t});\n\t\t\tsecondaryDiv.textContent = secondaryText;\n\n\t\t\tcontent.appendChild(mainDiv);\n\t\t\t// If the suggestion is not address-grade, mark it as unverified (google is considered acceptable already)\n\t\t\tif (!isAcceptable) {\n\t\t\t\tsecondaryDiv.textContent = secondaryDiv.textContent\n\t\t\t\t\t? secondaryDiv.textContent + ' • Unverified address'\n\t\t\t\t\t: 'Unverified address';\n\t\t\t\trow.style.opacity = '0.85';\n\t\t\t\trow.setAttribute('data-unverified', 'true');\n\t\t\t}\n\n\t\t\tcontent.appendChild(secondaryDiv);\n\n\t\t\trow.appendChild(iconWrap);\n\t\t\trow.appendChild(content);\n\n\t\t\trow.addEventListener('mouseenter', () => {\n\t\t\t\trow.style.backgroundColor = '#e8f0fe';\n\t\t\t});\n\t\t\trow.addEventListener('mouseleave', () => {\n\t\t\t\trow.style.backgroundColor = '#fff';\n\t\t\t});\n\t\t\trow.addEventListener('pointerdown', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tselectItem(item, source);\n\t\t\t});\n\n\t\t\tdropdown!.appendChild(row);\n\t\t});\n\n\t\tdropdown.style.display = 'block';\n\t\tupdatePosition();\n\t}\n\n\tfunction renderEmpty() {\n\t\tif (!dropdown) return;\n\t\tconst emptyDiv = document.createElement('div');\n\t\tObject.assign(emptyDiv.style, {\n\t\t\tpadding: '16px',\n\t\t\tcolor: '#70757A',\n\t\t\tfontSize: '13px',\n\t\t\ttextAlign: 'center'\n\t\t});\n\t\temptyDiv.textContent = 'No results found';\n\t\tdropdown.appendChild(emptyDiv);\n\t\tdropdown.style.display = 'block';\n\t\tupdatePosition();\n\t}\n\n\tfunction renderError() {\n\t\t/* ... */\n\t}\n\n\tasync function selectItem(item: Record<string, unknown>, source: 'kv' | 'google') {\n\t\tconst it: any = item;\n\t\tif (dropdown) dropdown.style.display = 'none';\n\t\tisSelecting = true;\n\n\t\t// Normalize once at top of selectItem\n\t\tconst normalized = {\n\t\t\t...it,\n\t\t\thouse_number: it.house_number || (it.properties && it.properties.housenumber),\n\t\t\tstreet: it.street || (it.properties && it.properties.street),\n\t\t\tname: it.name,\n\t\t\tnosm_value: it.osm_value || (it.properties && it.properties.osm_value) || null,\n\t\t\tnosm_key: it.osm_key || (it.properties && it.properties.osm_key) || null\n\t\t};\n\n\t\t// Use the canonical validator imported at top of the module (isAcceptableGeocode)\n\t\t// This keeps selection-time logic consistent with client-side rendering rules.\n\n\t\t// Use normalized object for validation\n\t\tif (source === 'kv') {\n\t\t\tconst candidate = { ...normalized, geometry: it.geometry };\n\t\t\tif (!isAcceptableGeocode(candidate, node.value)) {\n\t\t\t\t// Try a fallback search to Google if validation failed on selection (double safety)\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await fetch(\n\t\t\t\t\t\t`/api/autocomplete?q=${encodeURIComponent(node.value)}&forceGoogle=true`\n\t\t\t\t\t);\n\t\t\t\t\tconst data = await res.json();\n\t\t\t\t\tif (Array.isArray(data) && data.length > 0) {\n\t\t\t\t\t\tconst googleHit = data.find((d: any) => d.source === 'google_proxy');\n\t\t\t\t\t\tif (googleHit) {\n\t\t\t\t\t\t\tcommitSelection(googleHit);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst acceptable = data.find((d: any) => {\n\t\t\t\t\t\t\tconst normD = {\n\t\t\t\t\t\t\t\t...d,\n\t\t\t\t\t\t\t\thouse_number: d.house_number || (d.properties && d.properties.housenumber),\n\t\t\t\t\t\t\t\tstreet: d.street || d.name || (d.properties && d.properties.street)\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn isAcceptableGeocode(normD, node.value);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (acceptable) {\n\t\t\t\t\t\t\tcommitSelection(acceptable);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (err: unknown) {\n\t\t\t\t\tconsole.error('[autocomplete] fallback search failed', err);\n\t\t\t\t}\n\n\t\t\t\tnode.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('place-invalid', { detail: { candidate: item, input: node.value } })\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!it.geometry || !it.geometry.location) {\n\t\t\tif (it.place_id && source === 'google') {\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await fetch(`/api/autocomplete?placeid=${it.place_id}`);\n\t\t\t\t\tconst details: any = await res.json();\n\n\t\t\t\t\tif (details && details.geometry) {\n\t\t\t\t\t\tconst fullItem = {\n\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\tformatted_address: details.formatted_address || it.formatted_address,\n\t\t\t\t\t\t\tname: details.name || it.name,\n\t\t\t\t\t\t\tgeometry: details.geometry\n\t\t\t\t\t\t};\n\t\t\t\t\t\tsavePlaceToKV(fullItem);\n\t\t\t\t\t\tcommitSelection(fullItem);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch (err: unknown) {\n\t\t\t\t\tconsole.error('Details fetch failed', err);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcommitSelection(item);\n\t\t} else {\n\t\t\tcommitSelection(item);\n\t\t}\n\t}\n\n\tfunction commitSelection(data: Record<string, unknown>) {\n\t\tnode.value = (data['formatted_address'] as string) || (data['name'] as string);\n\t\tnode.dispatchEvent(new Event('input', { bubbles: true }));\n\t\tnode.dispatchEvent(new CustomEvent('place-selected', { detail: data }));\n\n\t\t// Only restore focus when the selection was explicit (isSelecting)\n\t\t// or when the input is already the active element. This prevents\n\t\t// blur-triggered validation from stealing focus when the user\n\t\t// is trying to focus another field (causing a bounce).\n\t\tsetTimeout(() => {\n\t\t\ttry {\n\t\t\t\tif (isSelecting || document.activeElement === node) {\n\t\t\t\t\tnode.focus();\n\t\t\t\t}\n\t\t\t} catch (_e: unknown) {\n\t\t\t\tvoid _e;\n\t\t\t}\n\t\t}, 0);\n\n\t\tconst dlg = node.closest && node.closest('dialog');\n\t\tif (dlg) {\n\t\t\ttry {\n\t\t\t\t(dlg as any).__suppressClose = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t(dlg as any).__suppressClose = false;\n\t\t\t\t\t} catch (_e: unknown) {\n\t\t\t\t\t\tvoid _e;\n\t\t\t\t\t}\n\t\t\t\t}, 500);\n\t\t\t} catch (_e: unknown) {\n\t\t\t\tvoid _e;\n\t\t\t}\n\t\t}\n\n\t\tif (dlg && !(dlg as HTMLDialogElement).open) {\n\t\t\ttry {\n\t\t\t\t(dlg as HTMLDialogElement).showModal();\n\t\t\t} catch (_e: unknown) {\n\t\t\t\tvoid _e;\n\t\t\t}\n\t\t\tsetTimeout(() => {\n\t\t\t\ttry {\n\t\t\t\t\tnode.focus();\n\t\t\t\t} catch (_e: unknown) {\n\t\t\t\t\tvoid _e;\n\t\t\t\t}\n\t\t\t}, 60);\n\t\t}\n\t}\n\n\tinitUI();\n\n\tnode.addEventListener('input', handleInput);\n\tnode.addEventListener('focus', () => {\n\t\tif (node.value.length > 1) {\n\t\t\tconst inputEvent = new Event('input', { bubbles: true });\n\t\t\tObject.defineProperty(inputEvent, 'target', { value: node, enumerable: true });\n\t\t\thandleInput(inputEvent);\n\t\t}\n\t});\n\tnode.addEventListener('blur', () =>\n\t\tsetTimeout(async () => {\n\t\t\tif (dropdown) dropdown.style.display = 'none';\n\n\t\t\t// On blur, revalidate the raw input and silently escalate to Google if needed\n\t\t\tconst value = node.value;\n\t\t\tif (!value || value.length < 2) return;\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\n\t\t\t\t\t`/api/autocomplete?q=${encodeURIComponent(value)}&forceGoogle=true`\n\t\t\t\t);\n\t\t\t\tconst data = await res.json();\n\t\t\t\tif (Array.isArray(data) && data.length > 0) {\n\t\t\t\t\tconst googleHit = data.find((d: any) => d.source === 'google_proxy');\n\t\t\t\t\tif (googleHit) {\n\t\t\t\t\t\tcommitSelection(googleHit);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst acceptable = data.find((d: any) => isAcceptableGeocode(d, value));\n\t\t\t\t\tif (acceptable) {\n\t\t\t\t\t\tcommitSelection(acceptable);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (err: unknown) {\n\t\t\t\tconsole.error('[autocomplete] blur validation failed', err);\n\t\t\t}\n\t\t}, 200)\n\t);\n\n\tconst _removeDropdownHandlers = () => {\n\t\tif (!dropdown) return;\n\t\tdropdown.removeEventListener('pointerdown', stopAndPrevent as any);\n\t\tdropdown.removeEventListener('pointerup', stop as any);\n\t\tdropdown.removeEventListener('mousedown', stopAndPrevent as any);\n\t\tdropdown.removeEventListener('mouseup', stop as any);\n\t\tdropdown.removeEventListener('touchstart', stopAndPrevent as any);\n\t\tdropdown.removeEventListener('touchend', stop as any);\n\t\tdropdown.removeEventListener('click', stop as any);\n\t};\n\n\twindow.addEventListener('scroll', updatePosition);\n\twindow.addEventListener('resize', updatePosition);\n\n\treturn {\n\t\tdestroy() {\n\t\t\tif (dropdown) {\n\t\t\t\t_removeDropdownHandlers();\n\t\t\t\tdropdown.remove();\n\t\t\t}\n\t\t\tnode.removeEventListener('input', handleInput);\n\t\t\twindow.removeEventListener('scroll', updatePosition);\n\t\t\twindow.removeEventListener('resize', updatePosition);\n\t\t}\n\t};\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\calculations.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 127,
				"column": 7,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 127,
				"endColumn": 10,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4036, 4039], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4036, 4039], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/utils/calculations.ts\n\nimport type { Trip, Destination, MaintenanceCost, SupplyCost } from '$lib/types';\n\n// [!code ++] Helper functions for Integer Math\nconst toCents = (amount: number) => Math.round(amount * 100);\nconst toDollars = (cents: number) => cents / 100;\n\nexport function calculateFuelCost(miles: number, mpg: number, gasPrice: number): number {\n\tif (mpg <= 0) return 0;\n\tconst gallons = miles / mpg;\n\n\t// Calculate in cents to avoid floating point errors\n\tconst costInCents = Math.round(gallons * gasPrice * 100);\n\treturn toDollars(costInCents);\n}\n\nexport function calculateTotalEarnings(destinations: Destination[]): number {\n\tconst totalCents = destinations.reduce((sum, dest) => {\n\t\treturn sum + toCents(dest.earnings || 0);\n\t}, 0);\n\treturn toDollars(totalCents);\n}\n\nexport function calculateMaintenanceCost(items: MaintenanceCost[]): number {\n\tconst totalCents = items.reduce((sum, item) => {\n\t\treturn sum + toCents(item.cost || 0);\n\t}, 0);\n\treturn toDollars(totalCents);\n}\n\nexport function calculateSupplyCost(items: SupplyCost[]): number {\n\tconst totalCents = items.reduce((sum, item) => {\n\t\treturn sum + toCents(item.cost || 0);\n\t}, 0);\n\treturn toDollars(totalCents);\n}\n\nexport function calculateNetProfit(\n\ttotalEarnings: number,\n\tfuelCost: number,\n\tmaintenanceCost: number,\n\tsuppliesCost: number\n): number {\n\t// Convert all inputs to cents before subtracting\n\tconst earningsCents = toCents(totalEarnings);\n\tconst fuelCents = toCents(fuelCost);\n\tconst maintCents = toCents(maintenanceCost);\n\tconst suppliesCents = toCents(suppliesCost);\n\n\tconst netCents = earningsCents - fuelCents - maintCents - suppliesCents;\n\treturn toDollars(netCents);\n}\n\nexport function calculateProfitPerHour(netProfit: number, hoursWorked: number): number {\n\tif (hoursWorked <= 0) return 0;\n\n\tconst netCents = toCents(netProfit);\n\t// Calculate rate in cents/hour, then round to nearest cent\n\tconst perHourCents = netCents / hoursWorked;\n\n\treturn toDollars(Math.round(perHourCents));\n}\n\nexport function calculateHoursWorked(startTime: string, endTime: string): number {\n\tif (!startTime || !endTime) return 0;\n\n\tconst [startHour = 0, startMin = 0] = startTime.split(':').map(Number);\n\tconst [endHour = 0, endMin = 0] = endTime.split(':').map(Number);\n\n\tconst startMinutes = (startHour || 0) * 60 + (startMin || 0);\n\tconst endMinutes = (endHour || 0) * 60 + (endMin || 0);\n\n\tlet diffMinutes = endMinutes - startMinutes;\n\tif (diffMinutes < 0) {\n\t\tdiffMinutes += 24 * 60; // Handle overnight shifts\n\t}\n\n\treturn Number((diffMinutes / 60).toFixed(2));\n}\n\nexport function formatTime(minutes: number): string {\n\tconst hours = Math.floor(minutes / 60);\n\tconst mins = Math.round(minutes % 60);\n\n\tif (hours === 0) {\n\t\treturn `${mins} minutes`;\n\t} else if (mins === 0) {\n\t\treturn `${hours} hour${hours > 1 ? 's' : ''}`;\n\t} else {\n\t\treturn `${hours} hour${hours > 1 ? 's' : ''} ${mins} minute${mins > 1 ? 's' : ''}`;\n\t}\n}\n\nexport function calculateTripTotals(\n\tdistance: number,\n\tdurationMinutes: number,\n\tdestinations: Destination[],\n\tmpg: number,\n\tgasPrice: number,\n\tmaintenanceItems: MaintenanceCost[] = [],\n\tsupplyItems: SupplyCost[] = [],\n\tstartTime?: string,\n\tendTime?: string\n): Partial<Trip> {\n\t// Use the integer-math functions\n\tconst totalEarnings = calculateTotalEarnings(destinations);\n\tconst fuelCost = calculateFuelCost(distance, mpg, gasPrice);\n\tconst maintenanceCost = calculateMaintenanceCost(maintenanceItems);\n\tconst suppliesCost = calculateSupplyCost(supplyItems);\n\n\tconst netProfit = calculateNetProfit(totalEarnings, fuelCost, maintenanceCost, suppliesCost);\n\tconst hoursWorked = startTime && endTime ? calculateHoursWorked(startTime, endTime) : 0;\n\tconst profitPerHour = hoursWorked > 0 ? calculateProfitPerHour(netProfit, hoursWorked) : 0;\n\n\treturn {\n\t\ttotalMiles: Number(distance.toFixed(2)),\n\t\ttotalMileage: Number(distance.toFixed(2)), // backward-compat alias\n\t\ttotalTime: formatTime(durationMinutes),\n\t\ttotalEarnings,\n\t\tfuelCost,\n\t\tmaintenanceCost,\n\t\tsuppliesCost,\n\t\tnetProfit,\n\t\tprofitPerHour,\n\t\thoursWorked\n\t} as any;\n}\n\nexport function milesToKm(miles: number): number {\n\treturn Number((miles * 1.60934).toFixed(2));\n}\n\nexport function kmToMiles(km: number): number {\n\treturn Number((km / 1.60934).toFixed(2));\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\csrf.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\dashboardLogic.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 49,
				"column": 12,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 49,
				"endColumn": 15,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1574, 1577], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1574, 1577], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 50,
				"column": 15,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 50,
				"endColumn": 18,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1595, 1598], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1595, 1598], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 131,
				"column": 22,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 131,
				"endColumn": 25,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3911, 3914], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3911, 3914], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 150,
				"column": 41,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 150,
				"endColumn": 44,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4407, 4410], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4407, 4410], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 4,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/lib/utils/dashboardLogic.ts\n\nexport type TimeRange = '7d' | '30d' | '60d' | '90d' | '1y' | 'prev-1y' | 'all';\n\nexport function formatCurrency(amount: number): string {\n\treturn new Intl.NumberFormat('en-US', {\n\t\tstyle: 'currency',\n\t\tcurrency: 'USD',\n\t\tminimumFractionDigits: 0,\n\t\tmaximumFractionDigits: 0\n\t}).format(amount);\n}\n\nexport function formatDate(dateString: string): string {\n\tif (/^\\d{4}-\\d{2}$/.test(dateString)) {\n\t\tconst parts = dateString.split('-');\n\t\tconst y = Number(parts[0] || '0');\n\t\tconst m = Number(parts[1] || '1');\n\t\tconst date = new Date(y, (m || 1) - 1, 1);\n\t\treturn new Intl.DateTimeFormat('en-US', { month: 'short', year: 'numeric' }).format(date);\n\t}\n\tconst date = new Date(dateString.includes('T') ? dateString : dateString + 'T00:00:00');\n\treturn new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric' }).format(date);\n}\n\n// Helper to assign consistent colors to categories\nfunction getCategoryColor(category: string): string {\n\tconst map: Record<string, string> = {\n\t\tfuel: '#FF7F50', // Orange\n\t\tmaintenance: '#29ABE2', // Blue\n\t\tsupplies: '#8DC63F', // Green\n\t\tinsurance: '#9333EA', // Purple\n\t\tother: '#6B7280' // Gray\n\t};\n\tconst catKey = category.toLowerCase();\n\tconst mappedColor = map[catKey];\n\tif (mappedColor) return mappedColor;\n\n\t// Generate pastel color for custom categories\n\tlet hash = 0;\n\tfor (let i = 0; i < category.length; i++) {\n\t\thash = category.charCodeAt(i) + ((hash << 5) - hash);\n\t}\n\tconst h = Math.abs(hash) % 360;\n\treturn `hsl(${h}, 70%, 60%)`;\n}\n\nexport function calculateDashboardStats(\n\tallTrips: any[],\n\tallExpenses: any[] = [],\n\trange: TimeRange = '30d'\n) {\n\tconst now = new Date();\n\tnow.setHours(23, 59, 59, 999);\n\tconst currentYear = now.getFullYear();\n\n\t// 1. Determine Date Ranges\n\tlet startDate: Date;\n\tlet prevStartDate: Date;\n\tlet groupBy: 'day' | 'month' = 'day';\n\tlet endDate: Date = now;\n\n\tswitch (range) {\n\t\tcase '7d':\n\t\t\tstartDate = new Date(now);\n\t\t\tstartDate.setDate(now.getDate() - 7);\n\t\t\tprevStartDate = new Date(startDate);\n\t\t\tprevStartDate.setDate(startDate.getDate() - 7);\n\t\t\tbreak;\n\t\tcase '30d':\n\t\t\tstartDate = new Date(now);\n\t\t\tstartDate.setDate(now.getDate() - 30);\n\t\t\tprevStartDate = new Date(startDate);\n\t\t\tprevStartDate.setDate(startDate.getDate() - 30);\n\t\t\tbreak;\n\t\tcase '60d':\n\t\t\tstartDate = new Date(now);\n\t\t\tstartDate.setDate(now.getDate() - 60);\n\t\t\tprevStartDate = new Date(startDate);\n\t\t\tprevStartDate.setDate(startDate.getDate() - 60);\n\t\t\tbreak;\n\t\tcase '90d':\n\t\t\tstartDate = new Date(now);\n\t\t\tstartDate.setDate(now.getDate() - 90);\n\t\t\tprevStartDate = new Date(startDate);\n\t\t\tprevStartDate.setDate(startDate.getDate() - 90);\n\t\t\tbreak;\n\t\tcase '1y':\n\t\t\t// Current year to date\n\t\t\tstartDate = new Date(currentYear, 0, 1);\n\t\t\tprevStartDate = new Date(currentYear - 1, 0, 1);\n\t\t\tgroupBy = 'month';\n\t\t\tbreak;\n\t\tcase 'prev-1y':\n\t\t\t// Entire previous calendar year\n\t\t\tstartDate = new Date(currentYear - 1, 0, 1);\n\t\t\tprevStartDate = new Date(currentYear - 2, 0, 1);\n\t\t\tgroupBy = 'month';\n\t\t\tendDate = new Date(currentYear - 1, 11, 31, 23, 59, 59, 999);\n\t\t\tbreak;\n\t\tcase 'all':\n\t\t\tstartDate = new Date(0);\n\t\t\tprevStartDate = new Date(0);\n\t\t\tgroupBy = 'month';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tstartDate = new Date(now);\n\t\t\tstartDate.setDate(now.getDate() - 30);\n\t\t\tprevStartDate = new Date(startDate);\n\t\t\tprevStartDate.setDate(startDate.getDate() - 30);\n\t}\n\n\tconst chartDataMap = new Map<string, number>();\n\n\t// Fill buckets\n\tif (range !== 'all') {\n\t\tconst d = new Date(startDate);\n\t\twhile (d <= endDate) {\n\t\t\tlet key: string;\n\t\t\tif (groupBy === 'month') {\n\t\t\t\tkey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n\t\t\t\td.setMonth(d.getMonth() + 1);\n\t\t\t} else {\n\t\t\t\tkey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n\t\t\t\td.setDate(d.getDate() + 1);\n\t\t\t}\n\t\t\tif (!chartDataMap.has(key)) chartDataMap.set(key, 0);\n\t\t}\n\t}\n\n\tconst currentTrips: any[] = [];\n\tlet totalProfit = 0;\n\tlet prevTotalProfit = 0;\n\tlet totalMiles = 0;\n\n\t// Track costs by category (e.g., fuel: 100, insurance: 50)\n\tconst categoryTotals: Record<string, number> = {\n\t\tfuel: 0,\n\t\tmaintenance: 0,\n\t\tsupplies: 0\n\t};\n\n\t// 2. Process Trips\n\tfor (const trip of allTrips) {\n\t\tif (!trip.date) continue;\n\t\tconst d = new Date(trip.date.includes('T') ? trip.date : trip.date + 'T00:00:00');\n\t\tconst tTime = d.getTime();\n\n\t\tconst earnings =\n\t\t\ttrip.stops?.reduce((s: number, stop: any) => s + (Number(stop.earnings) || 0), 0) || 0;\n\t\tconst fuelCost = Number(trip.fuelCost) || 0;\n\t\tconst maintCost = Number(trip.maintenanceCost) || 0;\n\t\tconst supplyCost = Number(trip.suppliesCost) || 0;\n\n\t\tconst tripCosts = fuelCost + maintCost + supplyCost;\n\t\tconst tripProfit = earnings - tripCosts;\n\n\t\t// Current Range\n\t\tif (tTime >= startDate.getTime() && tTime <= endDate.getTime()) {\n\t\t\tcurrentTrips.push(trip);\n\t\t\ttotalProfit += tripProfit;\n\t\t\ttotalMiles += Number(trip.totalMiles) || 0;\n\n\t\t\tcategoryTotals['fuel'] = (categoryTotals['fuel'] || 0) + fuelCost;\n\t\t\tcategoryTotals['maintenance'] = (categoryTotals['maintenance'] || 0) + maintCost;\n\t\t\tcategoryTotals['supplies'] = (categoryTotals['supplies'] || 0) + supplyCost;\n\n\t\t\t// Chart Data\n\t\t\tlet key: string;\n\t\t\tif (groupBy === 'month') {\n\t\t\t\tkey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n\t\t\t} else {\n\t\t\t\tkey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n\t\t\t}\n\t\t\tconst currentVal = chartDataMap.get(key) || 0;\n\t\t\tchartDataMap.set(key, currentVal + tripProfit);\n\t\t}\n\n\t\t// Previous Range\n\t\tif (range !== 'all' && tTime >= prevStartDate.getTime() && tTime < startDate.getTime()) {\n\t\t\tprevTotalProfit += tripProfit;\n\t\t}\n\t}\n\n\t// 3. Process General Expenses\n\tfor (const exp of allExpenses) {\n\t\tif (!exp.date) continue;\n\t\tconst d = new Date(exp.date.includes('T') ? exp.date : exp.date + 'T00:00:00');\n\t\tconst tTime = d.getTime();\n\t\tconst amount = Number(exp.amount) || 0;\n\t\tconst category = (exp.category || 'other').toLowerCase();\n\n\t\tif (tTime >= startDate.getTime() && tTime <= endDate.getTime()) {\n\t\t\ttotalProfit -= amount; // Deduct expense from profit\n\n\t\t\t// Add to Cost Breakdown\n\t\t\tcategoryTotals[category] = (categoryTotals[category] || 0) + amount;\n\n\t\t\t// Deduct from Chart Data (Daily Profit)\n\t\t\tlet key: string;\n\t\t\tif (groupBy === 'month') {\n\t\t\t\tkey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n\t\t\t} else {\n\t\t\t\tkey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n\t\t\t}\n\t\t\t// For 'all' range with month grouping, key might not exist yet if only expense exists\n\t\t\tif (!chartDataMap.has(key) && range === 'all') chartDataMap.set(key, 0);\n\n\t\t\tif (chartDataMap.has(key)) {\n\t\t\t\tchartDataMap.set(key, chartDataMap.get(key)! - amount);\n\t\t\t}\n\t\t}\n\n\t\tif (range !== 'all' && tTime >= prevStartDate.getTime() && tTime < startDate.getTime()) {\n\t\t\tprevTotalProfit -= amount;\n\t\t}\n\t}\n\n\t// 4. Final Shaping\n\tconst chartData = Array.from(chartDataMap.entries())\n\t\t.sort((a, b) => a[0].localeCompare(b[0]))\n\t\t.map(([date, profit]) => ({ date, profit }));\n\n\t// Generate Dynamic Cost Breakdown Array\n\tconst totalCost = Object.values(categoryTotals).reduce((a, b) => a + b, 0);\n\n\tconst costBreakdown = Object.entries(categoryTotals)\n\t\t.filter(([, amount]) => amount > 0)\n\t\t.map(([category, amount]) => ({\n\t\t\tcategory,\n\t\t\tamount,\n\t\t\tpercentage: totalCost > 0 ? (amount / totalCost) * 100 : 0,\n\t\t\tcolor: getCategoryColor(category)\n\t\t}))\n\t\t.sort((a, b) => b.amount - a.amount); // Largest first\n\n\t// Comparison Stats\n\tlet change = 0;\n\tif (range !== 'all') {\n\t\tif (prevTotalProfit !== 0) {\n\t\t\tchange = ((totalProfit - prevTotalProfit) / Math.abs(prevTotalProfit)) * 100;\n\t\t} else if (totalProfit > 0) {\n\t\t\tchange = 100;\n\t\t}\n\t}\n\n\tconst periodComparison = {\n\t\tcurrent: totalProfit,\n\t\tlast: prevTotalProfit,\n\t\tchange: change,\n\t\tisPositive: change >= 0\n\t};\n\n\tconst sortedCurrentTrips = [...currentTrips].sort(\n\t\t(a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()\n\t);\n\n\treturn {\n\t\trecentTrips: sortedCurrentTrips.slice(0, 5),\n\t\ttotalTrips: currentTrips.length,\n\t\ttotalProfit,\n\t\ttotalMiles,\n\t\tavgProfitPerTrip: currentTrips.length > 0 ? totalProfit / currentTrips.length : 0,\n\t\tchartData,\n\t\tcostBreakdown, // Now an array of objects\n\t\ttotalCost,\n\t\tperiodComparison\n\t};\n}\n\n/**\n * Compute maintenance banner visibility and message.\n * Returns { visible, message, dueIn, reminderThreshold }\n */\nexport function computeMaintenance(opts: {\n\tvehicleOdometerStart?: number | string;\n\ttotalMilesAllTime?: number | string;\n\tlastServiceOdometer?: number | string;\n\tserviceIntervalMiles?: number | string;\n\treminderThresholdMiles?: number | string;\n}) {\n\tconst vehicleOdometerStart = Number(opts.vehicleOdometerStart || 0);\n\tconst totalMilesAllTime = Number(opts.totalMilesAllTime || 0);\n\tconst lastServiceOdometer = Number(opts.lastServiceOdometer || 0);\n\tconst serviceIntervalMiles = Number(opts.serviceIntervalMiles || 0);\n\tconst reminderThreshold = Number(opts.reminderThresholdMiles || 500);\n\n\tconst currentOdometer = vehicleOdometerStart + totalMilesAllTime;\n\tconst milesSinceService = Math.max(0, currentOdometer - lastServiceOdometer);\n\tconst dueIn = serviceIntervalMiles - milesSinceService;\n\n\tconst visible = Boolean(serviceIntervalMiles && dueIn <= reminderThreshold);\n\tconst message =\n\t\tdueIn >= 0\n\t\t\t? `You have driven ${Math.round(milesSinceService).toLocaleString()} miles since your last service. Due in ${Math.round(dueIn).toLocaleString()} miles.`\n\t\t\t: `Overdue by ${Math.abs(Math.round(dueIn)).toLocaleString()} miles — please service now.`;\n\n\treturn { visible, message, dueIn, reminderThreshold };\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\dates.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\geocode.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 1,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 1,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [44, 47], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [44, 47], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "export function isAcceptableGeocode(result: any, input: string): boolean {\n\tif (!result) return false;\n\n\t// Always trust Google results\n\tif (result.source === 'google' || result.source === 'google_proxy' || result.source === 'google')\n\t\treturn true;\n\n\t// Reject numeric-only labels (\"407\")\n\tif (result.name && String(result.name).trim().match(/^\\d+$/)) return false;\n\n\t// Reject broad OSM types\n\tconst broadTypes = [\n\t\t'city',\n\t\t'state',\n\t\t'country',\n\t\t'county',\n\t\t'state_district',\n\t\t'place',\n\t\t'administrative'\n\t];\n\tif (\n\t\t(result.osm_value && broadTypes.includes(String(result.osm_value))) ||\n\t\t(result.osm_key && broadTypes.includes(String(result.osm_key)))\n\t) {\n\t\treturn false;\n\t}\n\n\t// Normalize address access from different providers\n\tconst addr = result.address || {};\n\tconst hn =\n\t\tresult.house_number ||\n\t\t(result.properties && result.properties.housenumber) ||\n\t\taddr.house_number ||\n\t\tnull;\n\tconst road =\n\t\tresult.street ||\n\t\t(result.properties && result.properties.street) ||\n\t\taddr.road ||\n\t\taddr.road ||\n\t\tnull;\n\tconst text = (\n\t\t(result.name || '') +\n\t\t' ' +\n\t\t(result.formatted_address || '') +\n\t\t' ' +\n\t\t(road || '')\n\t).toLowerCase();\n\n\t// If input looks like a house-level address, require house number and road and token match\n\tconst inputIsAddress = /^\\d+\\s+\\w+/i.test(input);\n\tif (inputIsAddress) {\n\t\t// Must have housenumber and road\n\t\tif (!hn || !road) return false;\n\n\t\t// Ensure the street token from input appears in the result text\n\t\tconst streetMatch = input.match(/^\\d+\\s+([A-Za-z0-9-]+)/);\n\t\tlet streetToken = '';\n\t\tconst rawToken = streetMatch?.[1] ?? '';\n\t\tif (rawToken) {\n\t\t\tconst parts = String(rawToken).split(/\\s+/);\n\t\t\tconst first = parts[0] ?? '';\n\t\t\tstreetToken = first.toLowerCase();\n\t\t}\n\t\tif (streetToken.length > 3 && !text.includes(streetToken)) return false;\n\n\t\t// Ensure house number appears in result as well\n\t\tconst inputHouseNumber = input.match(/^\\d+/)?.[0] ?? '';\n\t\tif (!String(hn).includes(inputHouseNumber)) return false;\n\n\t\treturn true;\n\t}\n\n\t// For non-address inputs, prefer to accept if it has a name and geometry\n\tif (result.geometry && result.geometry.location && (result.name || result.formatted_address))\n\t\treturn true;\n\n\treturn false;\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\keys.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\sanitize.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\storage.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\trip-helpers.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 49,
				"column": 42,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 49,
				"endColumn": 45,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1332, 1335], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1332, 1335], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 50,
				"column": 56,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 50,
				"endColumn": 59,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1402, 1405], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1402, 1405], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 55,
				"column": 42,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 55,
				"endColumn": 45,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1609, 1612], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1609, 1612], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 3,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "export function formatCurrency(amount: number): string {\n\treturn new Intl.NumberFormat('en-US', {\n\t\tstyle: 'currency',\n\t\tcurrency: 'USD',\n\t\tminimumFractionDigits: 2\n\t}).format(amount);\n}\n\nexport function formatDate(dateString: string): string {\n\tconst date = new Date(dateString);\n\treturn new Intl.DateTimeFormat('en-US', {\n\t\tmonth: 'short',\n\t\tday: 'numeric',\n\t\tyear: 'numeric',\n\t\ttimeZone: 'UTC'\n\t}).format(date);\n}\n\nexport function formatTime(time: string): string {\n\tif (!time) return '';\n\tif (time.toLowerCase().includes('am') || time.toLowerCase().includes('pm')) {\n\t\treturn time;\n\t}\n\tconst [h = 0, m = 0] = time.split(':').map(Number);\n\tif (isNaN(h)) return time;\n\tconst ampm = h >= 12 ? 'PM' : 'AM';\n\tconst h12 = h % 12 || 12;\n\tconst mStr = !isNaN(m) ? m.toString().padStart(2, '0') : '00';\n\treturn `${h12}:${mStr} ${ampm}`;\n}\n\nexport function formatDuration(minutes: number): string {\n\tif (!minutes) return '-';\n\tconst h = Math.floor(minutes / 60);\n\tconst m = minutes % 60;\n\tif (h > 0) return `${h}h ${m}m`;\n\treturn `${m}m`;\n}\n\nexport function formatHours(hours: number): string {\n\tif (!hours || hours === 0) return '-';\n\tconst h = Math.floor(hours);\n\tconst m = Math.round((hours - h) * 60);\n\tif (h > 0 && m > 0) return `${h}h ${m}m`;\n\tif (h > 0) return `${h}h`;\n\treturn `${m}m`;\n}\n\nexport function calculateNetProfit(trip: any): number {\n\tconst earnings = trip.stops?.reduce((s: number, stop: any) => s + (stop.earnings || 0), 0) || 0;\n\tconst costs = (trip.fuelCost || 0) + (trip.maintenanceCost || 0) + (trip.suppliesCost || 0);\n\treturn earnings - costs;\n}\n\nexport function calculateHourlyPay(trip: any): number {\n\tconst profit = calculateNetProfit(trip);\n\tconst hours = trip.hoursWorked || 0;\n\treturn hours > 0 ? profit / hours : 0;\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\user-display.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\vehicle.spec.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\utils\\vehicle.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\vendor-stubs\\canvg-stub.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\vendor-stubs\\html2canvas-stub.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 3,
				"column": 60,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 3,
				"endColumn": 63,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [222, 225], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [222, 225], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 3,
				"column": 74,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 3,
				"endColumn": 77,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [236, 239], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [236, 239], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 2,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// Minimal browser stub for html2canvas used to avoid bundling heavy library in client builds.\n// The real library is imported on the server when generating PDFs.\nexport default async function html2canvas(_: Element, __?: any): Promise<any> {\n\t// Refer to the parameters so linters don't mark them as unused in the browser stub.\n\tvoid _;\n\tvoid __;\n\treturn Promise.reject(\n\t\tnew Error('html2canvas stub called in browser build. Use server-side import instead.')\n\t);\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\lib\\vendor-stubs\\types\\index.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\+error.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-at-html-tags",
				"severity": 2,
				"message": "`{@html}` can lead to XSS attack.",
				"line": 98,
				"column": 4,
				"nodeType": "SvelteMustacheTag",
				"messageId": "unexpected",
				"endLine": 98,
				"endColumn": 21
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 112,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 112,
				"endColumn": 35
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { page } from '$app/stores';\n\timport { onMount } from 'svelte';\n\timport { base } from '$app/paths';\n\timport { sanitizeStaticSvg } from '$lib/utils/sanitize';\n\tconst resolve = (href: string) => `${base}${href}`;\n\n\tconst errorDetails = $state({\n\t\tstatus: $page.status || 500,\n\t\tmessage: $page.error?.message || 'An unexpected error occurred',\n\t\tshowDetails: false\n\t});\n\n\t// Log error for debugging\n\tonMount(() => {\n\t\tif ($page.error) {\n\t\t\tconsole.error('Error caught by boundary:', {\n\t\t\t\tstatus: $page.status,\n\t\t\t\terror: $page.error,\n\t\t\t\turl: $page.url.pathname\n\t\t\t});\n\t\t}\n\t});\n\n\tfunction toggleDetails() {\n\t\terrorDetails.showDetails = !errorDetails.showDetails;\n\t}\n\n\tfunction getErrorTitle(status: number): string {\n\t\tconst titles: Record<number, string> = {\n\t\t\t400: 'Bad Request',\n\t\t\t401: 'Unauthorized',\n\t\t\t403: 'Access Denied',\n\t\t\t404: 'Page Not Found',\n\t\t\t429: 'Too Many Requests',\n\t\t\t500: 'Server Error',\n\t\t\t503: 'Service Unavailable'\n\t\t};\n\t\treturn titles[status] || 'Error';\n\t}\n\n\tfunction getErrorDescription(status: number): string {\n\t\tconst descriptions: Record<number, string> = {\n\t\t\t400: 'The request could not be understood by the server.',\n\t\t\t401: 'Please log in to access this page.',\n\t\t\t403: \"You don't have permission to access this resource.\",\n\t\t\t404: \"The page you're looking for doesn't exist or has been moved.\",\n\t\t\t429: \"You've made too many requests. Please try again in a moment.\",\n\t\t\t500: 'Something went wrong on our end. Our team has been notified.',\n\t\t\t503: 'The service is temporarily unavailable. Please try again later.'\n\t\t};\n\t\treturn descriptions[status] || 'An unexpected error occurred while processing your request.';\n\t}\n\n\t// [!code fix] SECURITY (Issue #7, #43): Sanitize static SVG icons\n\tfunction getErrorIcon(status: number): string {\n\t\tif (status === 404) {\n\t\t\treturn sanitizeStaticSvg(`<svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n\t\t\t\t<circle cx=\"12\" cy=\"12\" r=\"10\"/>\n\t\t\t\t<path d=\"M16 16s-1.5-2-4-2-4 2-4 2\"/>\n\t\t\t\t<line x1=\"9\" y1=\"9\" x2=\"9.01\" y2=\"9\"/>\n\t\t\t\t<line x1=\"15\" y1=\"9\" x2=\"15.01\" y2=\"9\"/>\n\t\t\t</svg>`);\n\t\t}\n\t\tif (status === 403) {\n\t\t\treturn sanitizeStaticSvg(`<svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n\t\t\t\t<rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"/>\n\t\t\t\t<path d=\"M7 11V7a5 5 0 0 1 10 0v4\"/>\n\t\t\t</svg>`);\n\t\t}\n\t\tif (status === 429) {\n\t\t\treturn sanitizeStaticSvg(`<svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n\t\t\t\t<circle cx=\"12\" cy=\"12\" r=\"10\"/>\n\t\t\t\t<polyline points=\"12 6 12 12 16 14\"/>\n\t\t\t</svg>`);\n\t\t}\n\t\t// Default error icon\n\t\treturn sanitizeStaticSvg(`<svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n\t\t\t<circle cx=\"12\" cy=\"12\" r=\"10\"/>\n\t\t\t<line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"/>\n\t\t\t<line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"/>\n\t\t</svg>`);\n\t}\n\n\t// ← FIXED: Use $derived instead of $:\n\tconst errorIcon = $derived(getErrorIcon(errorDetails.status));\n\tconst errorTitle = $derived(getErrorTitle(errorDetails.status));\n\tconst errorDescription = $derived(getErrorDescription(errorDetails.status));\n</script>\n\n<svelte:head>\n\t<title>{errorDetails.status} - {errorTitle} | Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"error-container\">\n\t<div class=\"error-content\">\n\t\t<div class=\"error-icon\" class:not-found={errorDetails.status === 404}>\n\t\t\t{@html errorIcon}\n\t\t</div>\n\n\t\t<h1 class=\"error-status\">{errorDetails.status}</h1>\n\t\t<h2 class=\"error-title\">{errorTitle}</h2>\n\t\t<p class=\"error-description\">{errorDescription}</p>\n\n\t\t{#if errorDetails.message && errorDetails.message !== 'An unexpected error occurred'}\n\t\t\t<div class=\"error-message\">\n\t\t\t\t<p>{errorDetails.message}</p>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"error-actions\">\n\t\t\t<a href={resolve('/dashboard')} class=\"btn-primary\">\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t>\n\t\t\t\t\t<path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\" />\n\t\t\t\t\t<polyline points=\"9 22 9 12 15 12 15 22\" />\n\t\t\t\t</svg>\n\t\t\t\tGo to Dashboard\n\t\t\t</a>\n\n\t\t\t<button onclick={() => window.history.back()} class=\"btn-secondary\">\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t>\n\t\t\t\t\t<line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\" />\n\t\t\t\t\t<polyline points=\"12 19 5 12 12 5\" />\n\t\t\t\t</svg>\n\t\t\t\tGo Back\n\t\t\t</button>\n\n\t\t\t{#if errorDetails.status >= 500}\n\t\t\t\t<button onclick={toggleDetails} class=\"btn-text\">\n\t\t\t\t\t{errorDetails.showDetails ? 'Hide' : 'Show'} Technical Details\n\t\t\t\t</button>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t{#if errorDetails.showDetails && $page.error}\n\t\t\t<div class=\"error-details\">\n\t\t\t\t<h3>Technical Information</h3>\n\t\t\t\t<pre><code\n\t\t\t\t\t\t>{JSON.stringify(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstatus: $page.status,\n\t\t\t\t\t\t\t\tmessage: $page.error.message,\n\t\t\t\t\t\t\t\turl: $page.url.pathname,\n\t\t\t\t\t\t\t\ttimestamp: new Date().toISOString()\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t2\n\t\t\t\t\t\t)}</code\n\t\t\t\t\t></pre>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"error-help\">\n\t\t\t<p>\n\t\t\t\tNeed help? <a href=\"mailto:support@gorouteyourself.com\">Contact Support</a>\n\t\t\t</p>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.error-container {\n\t\tmin-height: 100vh;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 2rem;\n\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t}\n\n\t.error-content {\n\t\tmax-width: 600px;\n\t\twidth: 100%;\n\t\tbackground: white;\n\t\tborder-radius: 16px;\n\t\tpadding: 3rem;\n\t\ttext-align: center;\n\t\tbox-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n\t\tanimation: slideUp 0.5s ease-out;\n\t}\n\n\t@keyframes slideUp {\n\t\tfrom {\n\t\t\topacity: 0;\n\t\t\ttransform: translateY(20px);\n\t\t}\n\t\tto {\n\t\t\topacity: 1;\n\t\t\ttransform: translateY(0);\n\t\t}\n\t}\n\n\t.error-icon {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\twidth: 80px;\n\t\theight: 80px;\n\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\tborder-radius: 50%;\n\t\tmargin-bottom: 1.5rem;\n\t\tcolor: white;\n\t\tanimation: pulse 2s ease-in-out infinite;\n\t}\n\n\t.error-icon.not-found {\n\t\tbackground: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\n\t}\n\n\t@keyframes pulse {\n\t\t0%,\n\t\t100% {\n\t\t\ttransform: scale(1);\n\t\t}\n\t\t50% {\n\t\t\ttransform: scale(1.05);\n\t\t}\n\t}\n\n\t.error-status {\n\t\tfont-size: 4rem;\n\t\tfont-weight: 800;\n\t\tmargin: 0;\n\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\t-webkit-background-clip: text;\n\t\t-webkit-text-fill-color: transparent;\n\t\tbackground-clip: text;\n\t\tline-height: 1;\n\t}\n\n\t.error-title {\n\t\tfont-size: 1.75rem;\n\t\tfont-weight: 600;\n\t\tmargin: 0.5rem 0;\n\t\tcolor: #1f2937;\n\t}\n\n\t.error-description {\n\t\tfont-size: 1rem;\n\t\tcolor: #6b7280;\n\t\tmargin: 1rem 0 1.5rem;\n\t\tline-height: 1.6;\n\t}\n\n\t.error-message {\n\t\tbackground: #fef2f2;\n\t\tborder: 1px solid #fecaca;\n\t\tborder-radius: 8px;\n\t\tpadding: 1rem;\n\t\tmargin: 1.5rem 0;\n\t}\n\n\t.error-message p {\n\t\tmargin: 0;\n\t\tcolor: #991b1b;\n\t\tfont-size: 0.875rem;\n\t}\n\n\t.error-actions {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 0.75rem;\n\t\tmargin: 2rem 0;\n\t}\n\n\t.btn-primary,\n\t.btn-secondary,\n\t.btn-text {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 0.5rem;\n\t\tpadding: 0.75rem 1.5rem;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 500;\n\t\tfont-size: 1rem;\n\t\ttext-decoration: none;\n\t\ttransition: all 0.2s;\n\t\tcursor: pointer;\n\t\tborder: none;\n\t\tfont-family: inherit;\n\t}\n\n\t.btn-primary {\n\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\tcolor: white;\n\t}\n\n\t.btn-primary:hover {\n\t\ttransform: translateY(-2px);\n\t\tbox-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);\n\t}\n\n\t.btn-secondary {\n\t\tbackground: #f3f4f6;\n\t\tcolor: #374151;\n\t}\n\n\t.btn-secondary:hover {\n\t\tbackground: #e5e7eb;\n\t}\n\n\t.btn-text {\n\t\tbackground: transparent;\n\t\tcolor: #6b7280;\n\t\tpadding: 0.5rem;\n\t}\n\n\t.btn-text:hover {\n\t\tcolor: #374151;\n\t\ttext-decoration: underline;\n\t}\n\n\t.error-details {\n\t\tmargin-top: 2rem;\n\t\ttext-align: left;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 8px;\n\t\tpadding: 1.5rem;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\n\t.error-details h3 {\n\t\tmargin: 0 0 1rem;\n\t\tfont-size: 1rem;\n\t\tcolor: #374151;\n\t\tfont-weight: 600;\n\t}\n\n\t.error-details pre {\n\t\tmargin: 0;\n\t\tbackground: #1f2937;\n\t\tcolor: #f3f4f6;\n\t\tpadding: 1rem;\n\t\tborder-radius: 6px;\n\t\toverflow-x: auto;\n\t\tfont-size: 0.875rem;\n\t\tline-height: 1.5;\n\t}\n\n\t.error-help {\n\t\tmargin-top: 2rem;\n\t\tpadding-top: 2rem;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\n\t.error-help p {\n\t\tmargin: 0;\n\t\tcolor: #6b7280;\n\t\tfont-size: 0.875rem;\n\t}\n\n\t.error-help a {\n\t\tcolor: #667eea;\n\t\ttext-decoration: none;\n\t\tfont-weight: 500;\n\t}\n\n\t.error-help a:hover {\n\t\ttext-decoration: underline;\n\t}\n\n\t@media (min-width: 640px) {\n\t\t.error-actions {\n\t\t\tflex-direction: row;\n\t\t\tjustify-content: center;\n\t\t}\n\t}\n\n\t@media (max-width: 639px) {\n\t\t.error-content {\n\t\t\tpadding: 2rem 1.5rem;\n\t\t}\n\n\t\t.error-status {\n\t\t\tfont-size: 3rem;\n\t\t}\n\n\t\t.error-title {\n\t\t\tfont-size: 1.5rem;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\+layout.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\+layout.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\+page.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 110,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 110,
				"endColumn": 21
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 111,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 111,
				"endColumn": 24
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 115,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 115,
				"endColumn": 21
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 145,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 145,
				"endColumn": 23
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 160,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 160,
				"endColumn": 24
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 319,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 319,
				"endColumn": 24
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 343,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 343,
				"endColumn": 24
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 358,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 358,
				"endColumn": 24
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 392,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 392,
				"endColumn": 21
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 393,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 393,
				"endColumn": 23
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 394,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 394,
				"endColumn": 20
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 399,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 399,
				"endColumn": 23
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 400,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 400,
				"endColumn": 21
			}
		],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 13,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\tlet isMobileMenuOpen = false;\n\n\tfunction scrollToSection(id: string) {\n\t\tconst element = document.getElementById(id);\n\t\tif (element) {\n\t\t\telement.scrollIntoView({ behavior: 'smooth' });\n\t\t\tisMobileMenuOpen = false;\n\t\t}\n\t}\n\n\tfunction toggleMenu() {\n\t\tisMobileMenuOpen = !isMobileMenuOpen;\n\t}\n</script>\n\n<svelte:head>\n\t<title>Go Route Yourself - Route Planning & Profit Tracking for Drivers</title>\n\t<meta\n\t\tname=\"description\"\n\t\tcontent=\"The easiest way to plan routes, track costs, and maximize profits for delivery drivers and field workers. Free route optimizer and expense tracker.\"\n\t/>\n\t<meta\n\t\tname=\"keywords\"\n\t\tcontent=\"route planner, delivery driver app, profit tracker, mileage tracker, route optimization, field service software\"\n\t/>\n\n\t<link rel=\"canonical\" href=\"https://gorouteyourself.com/\" />\n\n\t<meta property=\"og:type\" content=\"website\" />\n\t<meta property=\"og:url\" content=\"https://gorouteyourself.com/\" />\n\t<meta property=\"og:title\" content=\"Go Route Yourself - Maximize Your Driving Profits\" />\n\t<meta\n\t\tproperty=\"og:description\"\n\t\tcontent=\"Plan optimal routes, track fuel and expenses, and see your true profit per hour. The all-in-one tool for drivers.\"\n\t/>\n\t<meta\n\t\tproperty=\"og:image\"\n\t\tcontent=\"https://gorouteyourself.com/optimized/og-source-1200x630.png\"\n\t/>\n\n\t<meta property=\"twitter:card\" content=\"summary_large_image\" />\n\t<meta property=\"twitter:url\" content=\"https://gorouteyourself.com/\" />\n\t<meta property=\"twitter:title\" content=\"Go Route Yourself - Route Planning & Profit Tracking\" />\n\t<meta\n\t\tproperty=\"twitter:description\"\n\t\tcontent=\"Stop guessing your profits. Track every mile, expense, and earning with Go Route Yourself.\"\n\t/>\n\t<meta\n\t\tproperty=\"twitter:image\"\n\t\tcontent=\"https://gorouteyourself.com/optimized/og-source-1200x630.png\"\n\t/>\n\t<link rel=\"icon\" href=\"/180x75.avif\" sizes=\"180x75\" type=\"image/avif\" />\n\t<link rel=\"apple-touch-icon\" href=\"/180x75.avif\" sizes=\"180x75\" />\n\t<link\n\t\trel=\"preload\"\n\t\thref=\"/180x75.avif\"\n\t\tas=\"image\"\n\t\timagesrcset=\"/180x75.avif 1x, /180x75.avif 2x\"\n\t\timagesizes=\"180px\"\n\t/>\n\n\t<script type=\"application/ld+json\">\n\t\t{\n\t\t\t\"@context\": \"https://schema.org\",\n\t\t\t\"@type\": \"SoftwareApplication\",\n\t\t\t\"name\": \"Go Route Yourself\",\n\t\t\t\"headline\": \"Route Planning & Profit Tracking for Drivers\",\n\t\t\t\"image\": \"https://gorouteyourself.com/180x75.avif\",\n\t\t\t\"applicationCategory\": \"BusinessApplication\",\n\t\t\t\"operatingSystem\": \"Web, Android, iOS\",\n\t\t\t\"offers\": {\n\t\t\t\t\"@type\": \"AggregateOffer\",\n\t\t\t\t\"priceCurrency\": \"USD\",\n\t\t\t\t\"lowPrice\": \"0\",\n\t\t\t\t\"offerCount\": \"2\"\n\t\t\t},\n\t\t\t\"aggregateRating\": {\n\t\t\t\t\"@type\": \"AggregateRating\",\n\t\t\t\t\"ratingValue\": \"4.8\",\n\t\t\t\t\"ratingCount\": \"500\"\n\t\t\t},\n\t\t\t\"featureList\": \"Route Optimization, Profit Tracking, Mileage Tracking, Expense Management, Analytics Dashboard, Tax Reports\"\n\t\t}\n\t</script>\n</svelte:head>\n\n<div class=\"landing\">\n\t<header class=\"header\">\n\t\t<div class=\"container\">\n\t\t\t<div class=\"header-content\">\n\t\t\t\t<picture>\n\t\t\t\t\t<source type=\"image/avif\" srcset=\"/180x75.avif 180w\" sizes=\"64px\" />\n\t\t\t\t\t<source type=\"image/webp\" srcset=\"/180x75.avif 180w\" sizes=\"64px\" />\n\t\t\t\t\t<img\n\t\t\t\t\t\tsrc=\"/180x75.avif\"\n\t\t\t\t\t\talt=\"Go Route Yourself\"\n\t\t\t\t\t\tclass=\"logo logo-full\"\n\t\t\t\t\t\twidth=\"64\"\n\t\t\t\t\t\theight=\"27\"\n\t\t\t\t\t\tsrcset=\"/180x75.avif 1x, /180x75.avif 2x\"\n\t\t\t\t\t\tdecoding=\"async\"\n\t\t\t\t\t/>\n\t\t\t\t</picture>\n\t\t\t\t<nav class=\"nav desktop-nav\">\n\t\t\t\t\t<button on:click={() => scrollToSection('features')}>Features</button>\n\t\t\t\t\t<button on:click={() => scrollToSection('how-it-works')}>How It Works</button>\n\t\t\t\t\t<button on:click={() => scrollToSection('pricing')}>Pricing</button>\n\n\t\t\t\t\t<a href=\"/login\" class=\"btn-login\">Sign In</a>\n\t\t\t\t\t<a href=\"/register\" class=\"btn-primary\">Get Started Free</a>\n\t\t\t\t</nav>\n\n\t\t\t\t<div class=\"mobile-nav-controls\">\n\t\t\t\t\t<a href=\"/login\" class=\"mobile-signin\">Sign In</a>\n\n\t\t\t\t\t<button class=\"hamburger-btn\" on:click={toggleMenu} aria-label=\"Toggle menu\">\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"24\"\n\t\t\t\t\t\t\theight=\"24\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if isMobileMenuOpen}\n\t\t\t\t\t\t\t\t<path d=\"M18 6L6 18M6 6L18 18\"></path>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<path d=\"M3 12h18M3 6h18M3 18h18\"></path>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if isMobileMenuOpen}\n\t\t\t<div class=\"mobile-menu\">\n\t\t\t\t<button on:click={() => scrollToSection('features')}>Features</button>\n\t\t\t\t<button on:click={() => scrollToSection('pricing')}>Pricing</button>\n\t\t\t\t<button on:click={() => scrollToSection('how-it-works')}>How It Works</button>\n\t\t\t\t<div class=\"divider\"></div>\n\t\t\t\t<a href=\"/register\" class=\"btn-primary mobile-btn\">Get Started Free</a>\n\t\t\t</div>\n\t\t{/if}\n\t</header>\n\n\t<section class=\"hero\">\n\t\t<div class=\"container\">\n\t\t\t<div class=\"hero-content\">\n\t\t\t\t<h1>Plan Routes. Track Costs. <span class=\"highlight\">Maximize Profits.</span></h1>\n\t\t\t\t<p class=\"hero-subtitle\">\n\t\t\t\t\tThe complete route planning and profit tracking solution for delivery drivers, field\n\t\t\t\t\tworkers, and anyone who gets paid by the route.\n\t\t\t\t</p>\n\n\t\t\t\t<div class=\"hero-buttons\">\n\t\t\t\t\t<a href=\"/register\" class=\"btn-hero-primary\">Start Free Trial</a>\n\t\t\t\t\t<button on:click={() => scrollToSection('how-it-works')} class=\"btn-hero-secondary\">\n\t\t\t\t\t\tLearn More\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"hero-stats\">\n\t\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t\t<div class=\"stat-number\">10K+</div>\n\t\t\t\t\t\t<div class=\"stat-label\">Routes Planned</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t\t<div class=\"stat-number\">$2M+</div>\n\t\t\t\t\t\t<div class=\"stat-label\">Profit Tracked</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t\t<div class=\"stat-number\">500+</div>\n\t\t\t\t\t\t<div class=\"stat-label\">Active Drivers</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</section>\n\n\t<section id=\"features\" class=\"features\">\n\t\t<div class=\"container\">\n\t\t\t<h2 class=\"section-title\">Everything You Need to Succeed</h2>\n\t\t\t<p class=\"section-subtitle\">Powerful features designed specifically for drivers</p>\n\n\t\t\t<div class=\"features-grid\">\n\t\t\t\t<div class=\"feature-card orange\">\n\t\t\t\t\t<div class=\"feature-icon\">🗺️</div>\n\t\t\t\t\t<h3>Google Maps Integration</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tPlan optimal routes with real-time traffic data, turn-by-turn directions, and automatic\n\t\t\t\t\t\tmileage calculation.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"feature-card blue\">\n\t\t\t\t\t<div class=\"feature-icon\">💰</div>\n\t\t\t\t\t<h3>Profit Tracking</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tTrack earnings, fuel costs, maintenance, and supplies. See your actual profit per trip\n\t\t\t\t\t\tand per hour worked.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"feature-card green\">\n\t\t\t\t\t<div class=\"feature-icon\">�</div>\n\t\t\t\t\t<h3>Mileage Tracking</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tAutomatically log every mile driven with GPS precision. IRS-compliant mileage logs for\n\t\t\t\t\t\ttax deductions and reimbursements.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"feature-card navy\">\n\t\t\t\t\t<div class=\"feature-icon\">📊</div>\n\t\t\t\t\t<h3>Analytics Dashboard</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tBeautiful charts and stats showing trends, costs breakdown, and performance over time.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"feature-card purple\">\n\t\t\t\t\t<div class=\"feature-icon\">📱</div>\n\t\t\t\t\t<h3>Mobile Friendly</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tWorks perfectly on your phone, tablet, or computer. Access your routes anywhere,\n\t\t\t\t\t\tanytime.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"feature-card orange\">\n\t\t\t\t\t<div class=\"feature-icon\">📤</div>\n\t\t\t\t\t<h3>Export Reports</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tGenerate CSV and PDF reports for taxes, record-keeping, or sharing with your accountant.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"feature-card blue\">\n\t\t\t\t\t<div class=\"feature-icon\">💾</div>\n\t\t\t\t\t<h3>Cloud Sync</h3>\n\t\t\t\t\t<p>Your data syncs automatically across all devices. Never lose a trip log again.</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</section>\n\n\t<section id=\"how-it-works\" class=\"how-it-works\">\n\t\t<div class=\"container\">\n\t\t\t<h2 class=\"section-title\">How It Works</h2>\n\t\t\t<p class=\"section-subtitle\">Start tracking profits in 3 simple steps</p>\n\n\t\t\t<div class=\"steps\">\n\t\t\t\t<div class=\"step\">\n\t\t\t\t\t<div class=\"step-number orange\">1</div>\n\t\t\t\t\t<div class=\"step-content\">\n\t\t\t\t\t\t<h3>Plan Your Route</h3>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tEnter your starting point and destinations. We'll calculate the optimal route and\n\t\t\t\t\t\t\testimate drive time using Google Maps.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"step\">\n\t\t\t\t\t<div class=\"step-number blue\">2</div>\n\t\t\t\t\t<div class=\"step-content\">\n\t\t\t\t\t\t<h3>Track Your Costs</h3>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tAdd earnings per stop, fuel costs, maintenance, and supplies. We automatically\n\t\t\t\t\t\t\tcalculate your profit.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"step\">\n\t\t\t\t\t<div class=\"step-number green\">3</div>\n\t\t\t\t\t<div class=\"step-content\">\n\t\t\t\t\t\t<h3>View Your Analytics</h3>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tSee your profit trends, cost breakdowns, and performance metrics. Export reports for\n\t\t\t\t\t\t\ttaxes.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</section>\n\n\t<section id=\"pricing\" class=\"pricing\">\n\t\t<div class=\"container\">\n\t\t\t<h2 class=\"section-title\">Simple, Transparent Pricing</h2>\n\t\t\t<p class=\"section-subtitle\">Choose the plan that works for you</p>\n\n\t\t\t<div class=\"pricing-grid\">\n\t\t\t\t<div class=\"pricing-card\">\n\t\t\t\t\t<div class=\"plan-header\">\n\t\t\t\t\t\t<h3>Free</h3>\n\t\t\t\t\t\t<div class=\"price\">\n\t\t\t\t\t\t\t<span class=\"currency\">$</span>\n\t\t\t\t\t\t\t<span class=\"amount\">0</span>\n\t\t\t\t\t\t\t<span class=\"period\">/month</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<ul class=\"features-list\">\n\t\t\t\t\t\t<li>✓ 10 trips per month</li>\n\t\t\t\t\t\t<li>✓ Up to 5 stops per trip</li>\n\t\t\t\t\t\t<li>✓ Google Maps routing</li>\n\t\t\t\t\t\t<li>✓ Profit tracking</li>\n\t\t\t\t\t\t<li>✓ Analytics dashboard</li>\n\t\t\t\t\t\t<li>✓ Export CSV & PDF reports</li>\n\t\t\t\t\t\t<li>✓ Cloud sync</li>\n\t\t\t\t\t</ul>\n\n\t\t\t\t\t<a href=\"/register\" class=\"btn-plan\">Get Started</a>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"pricing-card featured\">\n\t\t\t\t\t<div class=\"badge\">Most Popular</div>\n\t\t\t\t\t<div class=\"plan-header\">\n\t\t\t\t\t\t<h3>Pro</h3>\n\t\t\t\t\t\t<div class=\"price\">\n\t\t\t\t\t\t\t<span class=\"currency\">$</span>\n\t\t\t\t\t\t\t<span class=\"amount\">2.99</span>\n\t\t\t\t\t\t\t<span class=\"period\">/month</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<ul class=\"features-list\">\n\t\t\t\t\t\t<li>✓ Unlimited trips</li>\n\t\t\t\t\t\t<li>✓ Unlimited stops per trip</li>\n\t\t\t\t\t\t<li>✓ Google Maps routing</li>\n\t\t\t\t\t\t<li>✓ Profit tracking</li>\n\t\t\t\t\t\t<li>✓ Analytics dashboard</li>\n\t\t\t\t\t\t<li>✓ Export CSV & PDF reports</li>\n\t\t\t\t\t\t<li>✓ Cloud sync</li>\n\t\t\t\t\t</ul>\n\n\t\t\t\t\t<a href=\"/register\" class=\"btn-plan featured\">Start Free Trial</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</section>\n\n\t<section class=\"cta\">\n\t\t<div class=\"container\">\n\t\t\t<div class=\"cta-content\">\n\t\t\t\t<h2>Ready to Maximize Your Profits?</h2>\n\t\t\t\t<p>\n\t\t\t\t\tJoin hundreds of drivers who are already tracking their routes and increasing their\n\t\t\t\t\tearnings.\n\t\t\t\t</p>\n\t\t\t\t<div class=\"cta-buttons\">\n\t\t\t\t\t<a href=\"/register\" class=\"btn-cta-primary\">Start Free Trial</a>\n\t\t\t\t\t<span class=\"cta-note\">No credit card required</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</section>\n\n\t<footer class=\"footer\">\n\t\t<div class=\"container\">\n\t\t\t<div class=\"footer-content\">\n\t\t\t\t<div class=\"footer-section\">\n\t\t\t\t\t<picture>\n\t\t\t\t\t\t<source type=\"image/avif\" srcset=\"/96x40.avif 96w\" sizes=\"40px\" />\n\t\t\t\t\t\t<source type=\"image/webp\" srcset=\"/96x40.avif 96w\" sizes=\"40px\" />\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tsrc=\"/96x40.avif\"\n\t\t\t\t\t\t\talt=\"Go Route Yourself\"\n\t\t\t\t\t\t\tclass=\"footer-logo\"\n\t\t\t\t\t\t\twidth=\"96\"\n\t\t\t\t\t\t\theight=\"40\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</picture>\n\t\t\t\t\t<p>Route planning and profit tracking for drivers.</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"footer-section\">\n\t\t\t\t\t<h3>Product</h3>\n\t\t\t\t\t<a href=\"#features\">Features</a>\n\t\t\t\t\t<a href=\"#pricing\">Pricing</a>\n\t\t\t\t\t<a href=\"#how-it-works\">How It Works</a>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"footer-section\">\n\t\t\t\t\t<h3>Company</h3>\n\t\t\t\t\t<a href=\"/about\">About</a>\n\t\t\t\t\t<a href=\"/contact\">Contact</a>\n\t\t\t\t\t<a href=\"/blog\">Blog</a>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"footer-section\">\n\t\t\t\t\t<h3>Legal</h3>\n\t\t\t\t\t<a href=\"/privacy\">Privacy Policy</a>\n\t\t\t\t\t<a href=\"/terms\">Terms of Service</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"footer-bottom\">\n\t\t\t\t<p>&copy; {new Date().getFullYear()} Go Route Yourself. All rights reserved.</p>\n\t\t\t</div>\n\t\t</div>\n\t</footer>\n</div>\n\n<style>\n\t/* Brand Colors */\n\t:root {\n\t\t--orange: #ff7f50;\n\t\t--blue: #29abe2;\n\t\t--navy: #2c4a6e;\n\t\t--green: #8dc63f;\n\t\t--purple: #8b5a9e;\n\t\t--gray-50: #f9fafb;\n\t\t--gray-100: #f3f4f6;\n\t\t--gray-200: #e5e7eb;\n\t\t--gray-500: #6b7280;\n\t\t--gray-600: #4b5563;\n\t\t--gray-900: #111827;\n\t}\n\n\t* {\n\t\tmargin: 0;\n\t\tpadding: 0;\n\t\tbox-sizing: border-box;\n\t}\n\n\t.landing {\n\t\tfont-family:\n\t\t\t-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n\t\tline-height: 1.6;\n\t\tcolor: var(--gray-900);\n\t}\n\n\t.container {\n\t\tmax-width: 1200px;\n\t\tmargin: 0 auto;\n\t\tpadding: 0 20px;\n\t}\n\n\t/* Header & Navigation */\n\t.header {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbackground: white;\n\t\tborder-bottom: 1px solid var(--gray-100);\n\t\tz-index: 1000;\n\t\tpadding: 16px 0;\n\t}\n\n\t.header-content {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t}\n\n\t.logo {\n\t\theight: 100%;\n\t\twidth: 100%;\n\t\tobject-fit: contain;\n\t}\n\n\t.logo-full {\n\t\theight: 100%;\n\t\twidth: 100%;\n\t\tobject-fit: contain;\n\t}\n\n\t/* Desktop Navigation */\n\t.desktop-nav {\n\t\tdisplay: none; /* Changed from flex to none */\n\t\talign-items: center;\n\t\tgap: 24px;\n\t}\n\n\t.desktop-nav button {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcolor: var(--gray-600);\n\t\tfont-size: 16px;\n\t\tcursor: pointer;\n\t\ttransition: color 0.2s;\n\t}\n\n\t.desktop-nav button:hover {\n\t\tcolor: var(--orange);\n\t}\n\n\t.btn-login {\n\t\tcolor: var(--gray-600);\n\t\ttext-decoration: none;\n\t\tfont-weight: 500;\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\theight: 44px;\n\t\tpadding: 0 8px;\n\t}\n\n\t.btn-primary {\n\t\tbackground: var(--orange);\n\t\tcolor: white;\n\t\tpadding: 10px 24px;\n\t\tborder-radius: 8px;\n\t\ttext-decoration: none;\n\t\tfont-weight: 600;\n\t\ttransition: transform 0.2s;\n\t}\n\n\t.btn-primary:hover {\n\t\ttransform: translateY(-2px);\n\t}\n\n\t/* Mobile Controls Container (Hidden on Desktop) */\n\t.mobile-nav-controls {\n\t\tdisplay: flex; /* Changed from none to flex */\n\t\talign-items: center;\n\t\tgap: 16px;\n\t}\n\n\t.mobile-signin {\n\t\ttext-decoration: none;\n\t\tcolor: var(--navy);\n\t\tfont-weight: 600;\n\t\tfont-size: 15px;\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\theight: 44px;\n\t\tpadding: 0 8px;\n\t}\n\n\t.hamburger-btn {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t\tcolor: var(--gray-600);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 4px;\n\t}\n\n\t/* Mobile Dropdown Menu */\n\t.mobile-menu {\n\t\tposition: absolute;\n\t\ttop: 100%;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\tbackground: white;\n\t\tborder-bottom: 1px solid var(--gray-100);\n\t\tpadding: 16px;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t\tbox-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n\t}\n\n\t.mobile-menu button {\n\t\tbackground: none;\n\t\tborder: none;\n\t\ttext-align: left;\n\t\tfont-size: 16px;\n\t\tcolor: var(--gray-600);\n\t\tpadding: 8px 0;\n\t\tcursor: pointer;\n\t\ttext-decoration: none;\n\t}\n\n\t.divider {\n\t\theight: 1px;\n\t\tbackground: var(--gray-100);\n\t\tmargin: 4px 0;\n\t}\n\t.mobile-btn {\n\t\ttext-align: center;\n\t\tdisplay: block;\n\t}\n\n\t/* Hero Section */\n\t.hero {\n\t\t/* Mobile-first padding (reduced top) */\n\t\tpadding: 100px 0 60px;\n\t\tbackground: linear-gradient(135deg, var(--navy) 0%, var(--blue) 100%);\n\t\tcolor: white;\n\t\ttext-align: center;\n\t}\n\n\t.hero h1 {\n\t\t/* Mobile-first font size */\n\t\tfont-size: 36px;\n\t\tfont-weight: 800;\n\t\tmargin-bottom: 24px;\n\t\tline-height: 1.2;\n\t}\n\n\t.highlight {\n\t\tcolor: var(--orange);\n\t}\n\n\t.hero-subtitle {\n\t\tfont-size: 18px;\n\t\t/* Slightly smaller for mobile */\n\t\tmax-width: 700px;\n\t\tmargin: 0 auto 40px;\n\t\topacity: 0.95;\n\t}\n\n\t.hero-buttons {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\t/* Stack buttons on mobile */\n\t\tgap: 16px;\n\t\tjustify-content: center;\n\t\tmargin-bottom: 60px;\n\t}\n\n\t.btn-hero-primary {\n\t\tbackground: var(--orange);\n\t\tcolor: white;\n\t\tpadding: 16px 40px;\n\t\tborder-radius: 12px;\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\ttext-decoration: none;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.btn-hero-primary:hover {\n\t\ttransform: translateY(-2px);\n\t\tbox-shadow: 0 8px 24px rgba(255, 127, 80, 0.4);\n\t}\n\n\t.btn-hero-secondary {\n\t\tbackground: transparent;\n\t\tcolor: white;\n\t\tborder: 2px solid white;\n\t\tpadding: 14px 38px;\n\t\tborder-radius: 12px;\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.btn-hero-secondary:hover {\n\t\tbackground: white;\n\t\tcolor: var(--navy);\n\t}\n\n\t.hero-stats {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\t/* Stack stats on mobile */\n\t\tjustify-content: center;\n\t\tgap: 32px;\n\t}\n\n\t.stat {\n\t\ttext-align: center;\n\t}\n\n\t.stat-number {\n\t\tfont-size: 36px;\n\t\tfont-weight: 800;\n\t\tmargin-bottom: 8px;\n\t\tmin-height: 48px; /* reserve space to avoid layout shifts */\n\t}\n\n\t.stat-label {\n\t\tfont-size: 14px;\n\t\topacity: 0.9;\n\t}\n\n\t/* Features Section */\n\t.features {\n\t\tpadding: 60px 0;\n\t\tbackground: white;\n\t}\n\n\t.section-title {\n\t\tfont-size: 32px;\n\t\t/* Smaller mobile title */\n\t\tfont-weight: 800;\n\t\ttext-align: center;\n\t\tmargin-bottom: 16px;\n\t\tcolor: var(--navy);\n\t}\n\n\t.section-subtitle {\n\t\tfont-size: 18px;\n\t\tcolor: var(--gray-600);\n\t\ttext-align: center;\n\t\tmargin-bottom: 40px;\n\t}\n\n\t.features-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr;\n\t\t/* 1 column on mobile */\n\t\tgap: 32px;\n\t}\n\n\t.feature-card {\n\t\tpadding: 32px;\n\t\tbackground: white;\n\t\tborder-radius: 16px;\n\t\tborder: 2px solid var(--gray-100);\n\t\ttransition: all 0.3s;\n\t}\n\n\t.feature-card:hover {\n\t\ttransform: translateY(-8px);\n\t\tbox-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);\n\t}\n\n\t.feature-card.orange:hover {\n\t\tborder-color: var(--orange);\n\t}\n\t.feature-card.blue:hover {\n\t\tborder-color: var(--blue);\n\t}\n\t.feature-card.green:hover {\n\t\tborder-color: var(--green);\n\t}\n\t.feature-card.navy:hover {\n\t\tborder-color: var(--navy);\n\t}\n\t.feature-card.purple:hover {\n\t\tborder-color: var(--purple);\n\t}\n\n\t.feature-icon {\n\t\tfont-size: 48px;\n\t\tmargin-bottom: 20px;\n\t}\n\n\t.feature-card h3 {\n\t\tfont-size: 24px;\n\t\tmargin-bottom: 12px;\n\t\tcolor: var(--navy);\n\t}\n\n\t.feature-card p {\n\t\tcolor: var(--gray-600);\n\t\tline-height: 1.7;\n\t}\n\n\t/* How It Works */\n\t.how-it-works {\n\t\tpadding: 60px 0;\n\t\tbackground: var(--gray-50);\n\t}\n\n\t.steps {\n\t\tmax-width: 800px;\n\t\tmargin: 0 auto;\n\t}\n\n\t.step {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\t/* Stack vertical on mobile */\n\t\tgap: 24px;\n\t\tmargin-bottom: 60px;\n\t\talign-items: center;\n\t\t/* Center align items */\n\t\ttext-align: center;\n\t}\n\n\t.step-number {\n\t\twidth: 60px;\n\t\theight: 60px;\n\t\tcolor: white;\n\t\tborder-radius: 50%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 28px;\n\t\tfont-weight: 800;\n\t\tflex-shrink: 0;\n\t}\n\n\t.step-number.orange {\n\t\tbackground: var(--orange);\n\t}\n\t.step-number.blue {\n\t\tbackground: var(--blue);\n\t}\n\t.step-number.green {\n\t\tbackground: var(--green);\n\t}\n\n\t.step-content h3 {\n\t\tfont-size: 24px;\n\t\tmargin-bottom: 12px;\n\t\tcolor: var(--navy);\n\t}\n\n\t.step-content p {\n\t\tcolor: var(--gray-600);\n\t\tfont-size: 16px;\n\t\tline-height: 1.7;\n\t}\n\n\t/* Pricing Section */\n\t.pricing {\n\t\tpadding: 60px 0;\n\t\tbackground: white;\n\t}\n\n\t.pricing-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr;\n\t\tgap: 32px;\n\t\tmax-width: 1000px;\n\t\tmargin: 0 auto;\n\t}\n\n\t.pricing-card {\n\t\tbackground: white;\n\t\tborder: 2px solid var(--gray-100);\n\t\tborder-radius: 16px;\n\t\tpadding: 40px;\n\t\tposition: relative;\n\t\ttransition: all 0.3s;\n\t}\n\n\t.pricing-card:hover {\n\t\ttransform: translateY(-8px);\n\t\tbox-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);\n\t}\n\n\t.pricing-card.featured {\n\t\tborder-color: var(--orange);\n\t\tbox-shadow: 0 8px 32px rgba(255, 127, 80, 0.2);\n\t}\n\n\t.badge {\n\t\tposition: absolute;\n\t\ttop: -12px;\n\t\tright: 20px;\n\t\tbackground: var(--orange);\n\t\tcolor: white;\n\t\tpadding: 6px 16px;\n\t\tborder-radius: 20px;\n\t\tfont-size: 12px;\n\t\tfont-weight: 700;\n\t}\n\n\t.plan-header {\n\t\ttext-align: center;\n\t\tmargin-bottom: 32px;\n\t}\n\n\t.plan-header h3 {\n\t\tfont-size: 24px;\n\t\tmargin-bottom: 16px;\n\t\tcolor: var(--navy);\n\t}\n\n\t.price {\n\t\tdisplay: flex;\n\t\talign-items: flex-start;\n\t\tjustify-content: center;\n\t}\n\n\t.currency {\n\t\tfont-size: 24px;\n\t\tfont-weight: 700;\n\t\tcolor: var(--navy);\n\t}\n\n\t.amount {\n\t\tfont-size: 56px;\n\t\tfont-weight: 800;\n\t\tline-height: 1;\n\t\tcolor: var(--navy);\n\t}\n\n\t.period {\n\t\tfont-size: 18px;\n\t\tcolor: var(--gray-600);\n\t\tmargin-left: 4px;\n\t\talign-self: flex-end;\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.features-list {\n\t\tlist-style: none;\n\t\tmargin-bottom: 32px;\n\t}\n\n\t.features-list li {\n\t\tpadding: 12px 0;\n\t\tborder-bottom: 1px solid var(--gray-100);\n\t\tcolor: var(--gray-900);\n\t}\n\n\t.btn-plan {\n\t\tdisplay: block;\n\t\twidth: 100%;\n\t\ttext-align: center;\n\t\tpadding: 14px;\n\t\tbackground: var(--gray-100);\n\t\tcolor: var(--navy);\n\t\tborder-radius: 8px;\n\t\ttext-decoration: none;\n\t\tfont-weight: 600;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.btn-plan:hover {\n\t\tbackground: var(--gray-100);\n\t}\n\n\t.btn-plan.featured {\n\t\tbackground: var(--orange);\n\t\tcolor: white;\n\t}\n\n\t.btn-plan.featured:hover {\n\t\ttransform: translateY(-2px);\n\t}\n\n\t/* CTA Section */\n\t.cta {\n\t\tpadding: 80px 0;\n\t\tbackground: linear-gradient(135deg, var(--orange) 0%, var(--green) 100%);\n\t\tcolor: white;\n\t\ttext-align: center;\n\t}\n\n\t.cta h2 {\n\t\tfont-size: 32px;\n\t\tfont-weight: 800;\n\t\tmargin-bottom: 16px;\n\t}\n\n\t.cta p {\n\t\tfont-size: 18px;\n\t\tmargin-bottom: 40px;\n\t\topacity: 0.95;\n\t}\n\n\t.cta-buttons {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t}\n\n\t.btn-cta-primary {\n\t\tbackground: white;\n\t\tcolor: var(--orange);\n\t\tpadding: 16px 48px;\n\t\tborder-radius: 12px;\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\ttext-decoration: none;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.btn-cta-primary:hover {\n\t\ttransform: translateY(-2px);\n\t\tbox-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);\n\t}\n\n\t.cta-note {\n\t\tfont-size: 14px;\n\t\topacity: 0.9;\n\t}\n\n\t/* Footer */\n\t.footer {\n\t\tbackground: var(--gray-50);\n\t\tcolor: var(--gray-900);\n\t\tpadding: 60px 0 20px;\n\t\tborder-top: 1px solid var(--gray-200);\n\t}\n\n\t.footer-content {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr;\n\t\tgap: 40px;\n\t\tmargin-bottom: 40px;\n\t}\n\n\t.footer-logo {\n\t\theight: 40px;\n\t\tmargin-bottom: 16px;\n\t}\n\n\t.footer-section h3 {\n\t\tmargin-bottom: 16px;\n\t\tfont-size: 16px;\n\t\tcolor: var(--navy);\n\t\tfont-weight: 700;\n\t}\n\n\t.footer-section a {\n\t\tdisplay: block;\n\t\tcolor: var(--gray-600);\n\t\ttext-decoration: none;\n\t\tmargin-bottom: 12px;\n\t\ttransition: color 0.2s;\n\t}\n\n\t.footer-section a:hover {\n\t\tcolor: var(--orange);\n\t}\n\n\t.footer-section p {\n\t\tcolor: var(--gray-600);\n\t}\n\n\t.footer-bottom {\n\t\ttext-align: center;\n\t\tpadding-top: 20px;\n\t\tborder-top: 1px solid var(--gray-200);\n\t\tcolor: var(--gray-500);\n\t}\n\n\t/* --- Desktop Responsive --- */\n\t@media (min-width: 768px) {\n\t\t.desktop-nav {\n\t\t\tdisplay: flex;\n\t\t}\n\n\t\t.mobile-nav-controls {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\t.hero {\n\t\t\tpadding: 140px 0 80px;\n\t\t}\n\n\t\t.hero h1 {\n\t\t\tfont-size: 56px;\n\t\t}\n\n\t\t.hero-subtitle {\n\t\t\tfont-size: 20px;\n\t\t}\n\n\t\t.hero-buttons {\n\t\t\tflex-direction: row;\n\t\t}\n\n\t\t.hero-stats {\n\t\t\tflex-direction: row;\n\t\t\tgap: 80px;\n\t\t}\n\n\t\t.features {\n\t\t\tpadding: 100px 0;\n\t\t}\n\n\t\t.features-grid {\n\t\t\tgrid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n\t\t}\n\n\t\t.section-title {\n\t\t\tfont-size: 42px;\n\t\t}\n\n\t\t.section-subtitle {\n\t\t\tfont-size: 20px;\n\t\t}\n\n\t\t.how-it-works {\n\t\t\tpadding: 100px 0;\n\t\t}\n\n\t\t.step {\n\t\t\tflex-direction: row;\n\t\t\ttext-align: left;\n\t\t\talign-items: flex-start;\n\t\t}\n\n\t\t.step-content h3 {\n\t\t\tfont-size: 28px;\n\t\t}\n\n\t\t.step-content p {\n\t\t\tfont-size: 18px;\n\t\t}\n\n\t\t.pricing {\n\t\t\tpadding: 100px 0;\n\t\t}\n\n\t\t.pricing-grid {\n\t\t\tgrid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n\t\t}\n\n\t\t.footer-content {\n\t\t\tgrid-template-columns: 2fr 1fr 1fr 1fr;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\auth\\session\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\auth\\webauthn\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\auth\\webauthn\\delete\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\auth\\webauthn\\list-for-email\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\auth\\webauthn\\list\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\autocomplete\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\autocomplete\\cache\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\change-password\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\delete-account\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\directions\\cache\\+server.ts",
		"messages": [
			{
				"ruleId": "no-restricted-imports",
				"severity": 2,
				"message": "'@cloudflare/workers-types' import is restricted from being used. Do not import from @cloudflare/workers-types. Use global ambient types (e.g. KVNamespace) instead. See AI_AGENTS.md Pattern #18.",
				"line": 4,
				"column": 1,
				"nodeType": "ImportDeclaration",
				"messageId": "pathWithCustomMessage",
				"endLine": 4,
				"endColumn": 62
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 52,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 52,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1622, 1625], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1622, 1625], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 58,
				"column": 43,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 58,
				"endColumn": 46,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1905, 1908], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1905, 1908], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 89,
				"column": 42,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 89,
				"endColumn": 45,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3358, 3361], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3358, 3361], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 119,
				"column": 15,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 119,
				"endColumn": 18,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4479, 4482], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4479, 4482], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 130,
				"column": 43,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 130,
				"endColumn": 46,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4855, 4858], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4855, 4858], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 176,
				"column": 69,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 176,
				"endColumn": 72,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6397, 6400], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6397, 6400], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 177,
				"column": 65,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 177,
				"endColumn": 68,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6487, 6490], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6487, 6490], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 186,
				"column": 50,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 186,
				"endColumn": 53,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6755, 6758], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6755, 6758], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 203,
				"column": 56,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 203,
				"endColumn": 59,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7325, 7328], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7325, 7328], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 10,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/api/directions/cache/+server.ts\r\nimport { json } from '@sveltejs/kit';\r\nimport type { RequestHandler } from './$types';\r\nimport type { KVNamespace } from '@cloudflare/workers-types';\r\nimport { log } from '$lib/server/log';\r\nimport {\r\n\tcheckRateLimitEnhanced,\r\n\tcreateRateLimitHeaders,\r\n\tgetClientIdentifier\r\n} from '$lib/server/rateLimit';\r\nimport { safeKV } from '$lib/server/env';\r\n\r\nexport const GET: RequestHandler = async ({ url, platform, locals, request }) => {\r\n\t// 1. Security: Ensure user is logged in\r\n\tif (!locals.user) {\r\n\t\treturn json({ error: 'Unauthorized' }, { status: 401 });\r\n\t}\r\n\r\n\t// [!code fix] SECURITY: Rate limit directions API (60/min per user - higher since cached results are fast)\r\n\tconst sessionsKV = safeKV(platform?.env, 'BETA_SESSIONS_KV');\r\n\tif (sessionsKV) {\r\n\t\tconst identifier = getClientIdentifier(request, locals);\r\n\t\tconst rateLimitResult = await checkRateLimitEnhanced(\r\n\t\t\tsessionsKV,\r\n\t\t\tidentifier,\r\n\t\t\t'directions_cache',\r\n\t\t\t60, // 60 requests per minute\r\n\t\t\t60000\r\n\t\t);\r\n\r\n\t\tconst headers = createRateLimitHeaders(rateLimitResult);\r\n\r\n\t\tif (!rateLimitResult.allowed) {\r\n\t\t\tlog.warn('[DirectionsCache] Rate limit exceeded', { identifier });\r\n\t\t\treturn json(\r\n\t\t\t\t{\r\n\t\t\t\t\terror: 'Too many direction requests. Please try again later.',\r\n\t\t\t\t\tresetAt: rateLimitResult.resetAt\r\n\t\t\t\t},\r\n\t\t\t\t{ status: 429, headers }\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tconst start = url.searchParams.get('start');\r\n\tconst end = url.searchParams.get('end');\r\n\r\n\tif (!start || !end) {\r\n\t\treturn json({ error: 'Missing start or end address' }, { status: 400 });\r\n\t}\r\n\r\n\tconst apiKey = (platform?.env as any)?.PRIVATE_GOOGLE_MAPS_API_KEY;\r\n\r\n\t// 2a. Handle identical origin and destination: return zero route and cache it\r\n\tconst normalize = (s?: string) => (s || '').toLowerCase().trim();\r\n\tif (normalize(start) === normalize(end)) {\r\n\t\ttry {\r\n\t\t\tconst directionsKV = (platform?.env as any)?.BETA_DIRECTIONS_KV as KVNamespace | undefined;\r\n\t\t\tconst TTL = 30 * 24 * 60 * 60;\r\n\t\t\tif (directionsKV) {\r\n\t\t\t\tlet key = `dir:${normalize(start)}_to_${normalize(end)}`;\r\n\t\t\t\tkey = key.replace(/[^a-z0-9_:-]/g, '');\r\n\t\t\t\tif (key.length > 512) key = key.substring(0, 512);\r\n\t\t\t\tawait directionsKV.put(key, JSON.stringify({ distance: 0, duration: 0, source: 'same' }), {\r\n\t\t\t\t\texpirationTtl: TTL\r\n\t\t\t\t});\r\n\t\t\t\tlog.info(`[DirectionsCache] Cached same-origin: ${key}`);\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tlog.warn('[DirectionsCache] Failed caching same-origin', e);\r\n\t\t}\r\n\t\tlog.info('DirectionsCache: same-origin request', { start, end });\r\n\t\treturn json({ source: 'same', data: { distance: 0, duration: 0 } });\r\n\t}\r\n\r\n\t// 2. Directly use Google Directions API (Server-side) — OSRM removed in favor of Google + KV cache.\r\n\t// Geocoding-based approaches were previously attempted, but we now prefer Google for consistent results.\r\n\r\n\t// 3. Fallback: Call Google Directions API (Server-Side)\r\n\tif (!apiKey) {\r\n\t\t// No API key configured — for local/dev/test we return a deterministic route to keep UI features\r\n\t\t// functional without external dependencies. This prevents flaky e2e failures when the key\r\n\t\t// is intentionally absent in test environments.\r\n\t\treturn json({ source: 'test', data: { distance: 16093, duration: 900 } });\r\n\t}\r\n\r\n\t// 3a. Check KV cache first (prefer server KV over client/local cache)\r\n\ttry {\r\n\t\tconst directionsKV = (platform?.env as any)?.BETA_DIRECTIONS_KV as KVNamespace | undefined;\r\n\t\tif (directionsKV) {\r\n\t\t\tlet cacheKey = `dir:${start?.toLowerCase().trim()}_to_${end?.toLowerCase().trim()}`;\r\n\t\t\tcacheKey = cacheKey.replace(/[^a-z0-9_:-]/g, '');\r\n\t\t\tif (cacheKey.length > 512) cacheKey = cacheKey.substring(0, 512);\r\n\t\t\tconst cached = await directionsKV.get(cacheKey);\r\n\t\t\tif (cached) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst parsed = JSON.parse(cached);\r\n\t\t\t\t\tif (parsed && parsed.distance != null && parsed.duration != null) {\r\n\t\t\t\t\t\tlog.info('DirectionsCache: KV HIT', { start, end, cacheKey });\r\n\t\t\t\t\t\treturn json({\r\n\t\t\t\t\t\t\tsource: 'kv',\r\n\t\t\t\t\t\t\tdata: { distance: parsed.distance, duration: parsed.duration }\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch {\r\n\t\t\t\t\t// ignore corrupt cache\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} catch (e) {\r\n\t\tlog.warn('[DirectionsCache] KV check failed', e);\r\n\t}\r\n\r\n\ttry {\r\n\t\tlog.info('Fetching route from Google', { start, end });\r\n\t\tconst googleUrl = `https://maps.googleapis.com/maps/api/directions/json?origin=${encodeURIComponent(start)}&destination=${encodeURIComponent(end)}&key=${apiKey}`;\r\n\r\n\t\tconst response = await fetch(googleUrl);\r\n\t\tconst data: any = await response.json();\r\n\r\n\t\tif (data && data.status === 'OK' && data.routes?.[0]?.legs?.[0]) {\r\n\t\t\tconst leg = data.routes[0].legs[0];\r\n\r\n\t\t\tconst result = {\r\n\t\t\t\tdistance: leg.distance.value,\r\n\t\t\t\tduration: leg.duration.value\r\n\t\t\t};\r\n\r\n\t\t\t// Non-blocking: cache leg result and geocodes into BETA_DIRECTIONS_KV with 30-day TTL\r\n\t\t\tconst directionsKV = (platform?.env as any)?.BETA_DIRECTIONS_KV as KVNamespace | undefined;\r\n\t\t\tconst TTL = 30 * 24 * 60 * 60; // 30 days\r\n\t\t\tif (directionsKV) {\r\n\t\t\t\tconst doCache = async () => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tlet key = `dir:${start?.toLowerCase().trim()}_to_${end?.toLowerCase().trim()}`;\r\n\t\t\t\t\t\tkey = key.replace(/[^a-z0-9_:-]/g, '');\r\n\t\t\t\t\t\tif (key.length > 512) key = key.substring(0, 512);\r\n\r\n\t\t\t\t\t\tawait directionsKV.put(\r\n\t\t\t\t\t\t\tkey,\r\n\t\t\t\t\t\t\tJSON.stringify({\r\n\t\t\t\t\t\t\t\tdistance: result.distance,\r\n\t\t\t\t\t\t\t\tduration: result.duration,\r\n\t\t\t\t\t\t\t\tsource: 'google'\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t{ expirationTtl: TTL }\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tlog.info(`[DirectionsCache] Cached: ${key}`);\r\n\r\n\t\t\t\t\t\tconst writeIfMissing = async (\r\n\t\t\t\t\t\t\taddr: string | undefined,\r\n\t\t\t\t\t\t\tloc: { lat?: number; lng?: number } | undefined,\r\n\t\t\t\t\t\t\tformatted?: string\r\n\t\t\t\t\t\t) => {\r\n\t\t\t\t\t\t\tif (!addr || !loc || loc.lat == null || loc.lng == null) return;\r\n\t\t\t\t\t\t\tconst geoKey = `geo:${addr\r\n\t\t\t\t\t\t\t\t.toLowerCase()\r\n\t\t\t\t\t\t\t\t.trim()\r\n\t\t\t\t\t\t\t\t.replace(/[^a-z0-9]/g, '_')}`;\r\n\t\t\t\t\t\t\tconst existing = await directionsKV.get(geoKey);\r\n\t\t\t\t\t\t\tif (!existing) {\r\n\t\t\t\t\t\t\t\tawait directionsKV.put(\r\n\t\t\t\t\t\t\t\t\tgeoKey,\r\n\t\t\t\t\t\t\t\t\tJSON.stringify({\r\n\t\t\t\t\t\t\t\t\t\tlat: Number(loc.lat),\r\n\t\t\t\t\t\t\t\t\t\tlon: Number(loc.lng),\r\n\t\t\t\t\t\t\t\t\t\tformattedAddress: formatted || addr,\r\n\t\t\t\t\t\t\t\t\t\tsource: 'directions_cache'\r\n\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t{ expirationTtl: TTL }\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tlog.info(`[DirectionsCache] Geocode cached (directions KV): ${geoKey}`);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tawait writeIfMissing(leg.start_address, leg.start_location as any, leg.start_address);\r\n\t\t\t\t\t\tawait writeIfMissing(leg.end_address, leg.end_location as any, leg.end_address);\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tlog.warn('[DirectionsCache] Auto geocode write failed', e);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst cachePromise = doCache();\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (platform?.context?.waitUntil) {\r\n\t\t\t\t\t\tplatform.context.waitUntil(cachePromise as any);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvoid cachePromise;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch {\r\n\t\t\t\t\tvoid cachePromise;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn json({ source: 'google', data: result });\r\n\t\t}\r\n\r\n\t\t// If Google returns an unexpected status, log and fall back to a deterministic route for\r\n\t\t// local/dev/test environments to avoid breaking client flows.\r\n\t\tlog.warn('Google Directions returned unexpected status', { status: data?.status });\r\n\t\treturn json({ source: 'fallback', data: { distance: 16093, duration: 900 } });\r\n\t} catch (e) {\r\n\t\tlog.error('Directions proxy error', { message: (e as any)?.message });\r\n\t\treturn json({ error: 'Failed to calculate route' }, { status: 500 });\r\n\t}\r\n};\r\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\directions\\optimize\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\expenses\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\expenses\\[id]\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\forgot-password\\+page.svelte",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'err' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 27,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 27,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 42,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 42,
				"endColumn": 19
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\tlet email = '';\n\tlet loading = false;\n\tlet message = '';\n\tlet error = '';\n\n\tasync function handleSubmit() {\n\t\tloading = true;\n\t\tmessage = '';\n\t\terror = '';\n\n\t\ttry {\n\t\t\tconst res = await fetch('/api/forgot-password', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ email })\n\t\t\t});\n\n\t\t\tconst data: any = await res.json();\n\n\t\t\tif (res.ok) {\n\t\t\t\tmessage = 'If an account exists with that email, we have sent a reset link.';\n\t\t\t\temail = ''; // Clear form\n\t\t\t} else {\n\t\t\t\terror = data.message || 'An error occurred.';\n\t\t\t}\n\t\t} catch (err) {\n\t\t\terror = 'Network error. Please try again.';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n</script>\n\n<svelte:head>\n\t<title>Forgot Password - Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"auth-page\">\n\t<div class=\"form-container\">\n\t\t<div class=\"form-header\">\n\t\t\t<a href=\"/login\" class=\"back-link\">← Back to Login</a>\n\t\t\t<h1>Reset Password</h1>\n\t\t\t<p>Enter your email to receive a reset link.</p>\n\t\t</div>\n\n\t\t{#if message}\n\t\t\t<div class=\"alert success\">{message}</div>\n\t\t{/if}\n\n\t\t{#if error}\n\t\t\t<div class=\"alert error\">{error}</div>\n\t\t{/if}\n\n\t\t<form on:submit|preventDefault={handleSubmit}>\n\t\t\t<div class=\"field-group\">\n\t\t\t\t<label for=\"email\">Email Address</label>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"email\"\n\t\t\t\t\tid=\"email\"\n\t\t\t\t\tbind:value={email}\n\t\t\t\t\trequired\n\t\t\t\t\tplaceholder=\"Enter your email\"\n\t\t\t\t\tclass=\"input-field\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<button type=\"submit\" class=\"btn-submit\" disabled={loading}>\n\t\t\t\t{loading ? 'Sending...' : 'Send Reset Link'}\n\t\t\t</button>\n\t\t</form>\n\t</div>\n</div>\n\n<style>\n\t/* Reusing similar styles to your login page for consistency */\n\t.auth-page {\n\t\tmin-height: 100vh;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbackground: #f9fafb;\n\t\tfont-family: 'Inter', sans-serif;\n\t}\n\t.form-container {\n\t\tbackground: white;\n\t\tpadding: 40px;\n\t\tborder-radius: 12px;\n\t\tbox-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n\t\twidth: 100%;\n\t\tmax-width: 400px;\n\t}\n\t.form-header {\n\t\tmargin-bottom: 24px;\n\t\ttext-align: center;\n\t}\n\th1 {\n\t\tfont-size: 24px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 10px 0;\n\t}\n\tp {\n\t\tcolor: #6b7280;\n\t\tfont-size: 14px;\n\t}\n\t.back-link {\n\t\tcolor: #ff7f50;\n\t\ttext-decoration: none;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t}\n\t.input-field {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-size: 15px;\n\t\tmargin-top: 6px;\n\t}\n\t.field-group {\n\t\tmargin-bottom: 20px;\n\t}\n\t.btn-submit {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tbackground: #ff7f50;\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t}\n\t.btn-submit:disabled {\n\t\topacity: 0.7;\n\t}\n\t.alert {\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tmargin-bottom: 20px;\n\t\tfont-size: 14px;\n\t}\n\t.alert.success {\n\t\tbackground: #f0fdf4;\n\t\tcolor: #166534;\n\t}\n\t.alert.error {\n\t\tbackground: #fef2f2;\n\t\tcolor: #991b1b;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\forgot-password\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\hughesnet\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\hughesnet\\archived\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 97,
				"column": 53,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 97,
				"endColumn": 56,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3147, 3150], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3147, 3150], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/api/hughesnet/archived/+server.ts\nimport { json } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { getEnv, safeKV } from '$lib/server/env';\nimport { log } from '$lib/server/log';\nimport { createSafeErrorMessage } from '$lib/server/sanitize';\n\ntype SessionUser = { id?: string; name?: string; token?: string };\n\nexport const GET: RequestHandler = async ({ platform, locals, url }) => {\n\tconst env = getEnv(platform);\n\tconst ordersKV = safeKV(env, 'BETA_HUGHESNET_ORDERS_KV');\n\tif (!ordersKV) {\n\t\treturn json({ success: false, error: 'Orders KV not configured' }, { status: 500 });\n\t}\n\n\tconst user = locals.user as SessionUser | undefined;\n\t// [!code fix] Strictly use ID.\n\tconst userId = user?.id;\n\tif (!userId) {\n\t\treturn json({ success: false, error: 'Unauthorized' }, { status: 401 });\n\t}\n\n\tconst id = url.searchParams.get('id');\n\n\ttry {\n\t\tconst kv = ordersKV;\n\n\t\tif (id) {\n\t\t\t// First, check the Orders KV for an archived record\n\t\t\tconst raw = await kv.get(`hns:order:${id}`);\n\t\t\tif (raw) {\n\t\t\t\tlet parsed;\n\t\t\t\ttry {\n\t\t\t\t\tparsed = JSON.parse(raw);\n\t\t\t\t} catch (err: unknown) {\n\t\t\t\t\tlog.warn('Corrupt archived record', { id, message: createSafeErrorMessage(err) });\n\t\t\t\t\treturn json({ success: false, error: 'Corrupt record' }, { status: 500 });\n\t\t\t\t}\n\t\t\t\tif (parsed.ownerId !== userId)\n\t\t\t\t\treturn json({ success: false, error: 'Not found' }, { status: 404 });\n\t\t\t\treturn json({ success: true, order: parsed.order });\n\t\t\t}\n\n\t\t\t// If not found in Orders KV, check the per-user HNS DB as a fallback\n\t\t\tconst hnsKV = safeKV(env, 'BETA_HUGHESNET_KV');\n\t\t\tif (hnsKV) {\n\t\t\t\ttry {\n\t\t\t\t\tconst dbRaw = await hnsKV.get(`hns:db:${userId}`);\n\t\t\t\t\tif (dbRaw) {\n\t\t\t\t\t\tconst db = JSON.parse(dbRaw) as Record<string, unknown>;\n\t\t\t\t\t\tif (db && Object.prototype.hasOwnProperty.call(db, id)) {\n\t\t\t\t\t\t\treturn json({ success: true, order: db[id] });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (err: unknown) {\n\t\t\t\t\tlog.warn('Failed to read user HNS DB as archived fallback', {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tmessage: createSafeErrorMessage(err)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn json({ success: false, error: 'Not found' }, { status: 404 });\n\t\t}\n\n\t\t// list all keys and return those owned by the current user\n\t\tconst listRes = await kv.list({ prefix: 'hns:order:' });\n\t\tconst keys = listRes.keys || [];\n\t\tconst results: Array<{ id: string; storedAt?: number; order: unknown }> = [];\n\t\tfor (const k of keys) {\n\t\t\tconst raw = await kv.get(k.name);\n\t\t\tif (!raw) continue;\n\t\t\ttry {\n\t\t\t\tconst p = JSON.parse(raw);\n\t\t\t\tif (p && p.ownerId === userId && p.order) {\n\t\t\t\t\tresults.push({\n\t\t\t\t\t\tid: k.name.replace(/^hns:order:/, ''),\n\t\t\t\t\t\tstoredAt: p.storedAt,\n\t\t\t\t\t\torder: p.order\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (err: unknown) {\n\t\t\t\tlog.warn('Skipping corrupt archived record', {\n\t\t\t\t\tkey: k.name,\n\t\t\t\t\tmessage: createSafeErrorMessage(err)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Also include orders present in the user's HNS DB (hns:db) that may not have been persisted to Orders KV yet\n\t\ttry {\n\t\t\tconst hnsKV = safeKV(env, 'BETA_HUGHESNET_KV');\n\t\t\tif (hnsKV) {\n\t\t\t\tconst dbRaw = await hnsKV.get(`hns:db:${userId}`);\n\t\t\t\tif (dbRaw) {\n\t\t\t\t\tconst db = JSON.parse(dbRaw) as Record<string, any>;\n\t\t\t\t\tfor (const [oid, order] of Object.entries(db)) {\n\t\t\t\t\t\tif (!results.some((r) => r.id === oid)) {\n\t\t\t\t\t\t\tresults.push({ id: oid, storedAt: undefined, order });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err: unknown) {\n\t\t\tlog.warn('Failed to include HNS DB orders in archived list', {\n\t\t\t\tmessage: createSafeErrorMessage(err)\n\t\t\t});\n\t\t}\n\n\t\treturn json({ success: true, orders: results });\n\t} catch (err: unknown) {\n\t\treturn json({ success: false, error: createSafeErrorMessage(err) }, { status: 500 });\n\t}\n};\n\n// Development helper: Insert a test archived order for the authenticated user\nexport const POST: RequestHandler = async ({ platform, locals, request }) => {\n\t// Only allow when explicitly enabled via env var to avoid accidental writes in production\n\tconst env = getEnv(platform);\n\tconst ordersKV = safeKV(env, 'BETA_HUGHESNET_ORDERS_KV');\n\tif (!ordersKV) {\n\t\treturn json({ success: false, error: 'Orders KV not configured' }, { status: 500 });\n\t}\n\n\tconst allowInsert =\n\t\tenv['ALLOW_HNS_ARCHIVE_INSERT'] === 'true' ||\n\t\tprocess.env['ALLOW_HNS_ARCHIVE_INSERT'] === 'true';\n\tif (!allowInsert) return json({ success: false, error: 'Not allowed' }, { status: 403 });\n\n\tconst user = locals.user as SessionUser | undefined;\n\t// [!code fix] Strictly use ID.\n\tconst userId = user?.id;\n\tif (!userId) {\n\t\treturn json({ success: false, error: 'Unauthorized' }, { status: 401 });\n\t}\n\n\ttry {\n\t\tconst body = (await request.json()) as unknown;\n\t\tconst bodyObj = body as Record<string, unknown>;\n\t\tconst id = String(bodyObj['id'] || `dev_${Date.now()}`);\n\t\tconst order = (bodyObj['order'] as unknown) || {\n\t\t\tid,\n\t\t\taddress: String(bodyObj['address'] || 'Dev Inserted Address')\n\t\t};\n\t\tconst kv = ordersKV;\n\t\tawait kv.put(\n\t\t\t`hns:order:${id}`,\n\t\t\tJSON.stringify({ ownerId: userId, storedAt: Date.now(), order })\n\t\t);\n\t\treturn json({ success: true, id });\n\t} catch (err: unknown) {\n\t\treturn json({ success: false, error: createSafeErrorMessage(err) }, { status: 500 });\n\t}\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\hughesnet\\archived\\import\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\internal\\trip-index\\compute-now\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 13,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 13,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [387, 390], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [387, 390], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 32,
				"column": 15,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 32,
				"endColumn": 18,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1035, 1038], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1035, 1038], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 47,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 47,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1262, 1265], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1262, 1265], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 3,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import type { RequestHandler } from './$types';\nimport { json } from '@sveltejs/kit';\nimport { ensureDebugEnabled } from '$lib/server/debug';\nimport { getEnv, safeDO } from '$lib/server/env';\n\nexport const POST: RequestHandler = async ({ request, platform }) => {\n\ttry {\n\t\tensureDebugEnabled(platform);\n\t} catch {\n\t\treturn json({ error: 'Not found' }, { status: 404 });\n\t}\n\n\tconst body: any = await request.json().catch(() => ({}));\n\tconst { userId, tripId } = body;\n\tif (!userId || !tripId) {\n\t\treturn json({ error: 'userId and tripId required' }, { status: 400 });\n\t}\n\n\tconst env = getEnv(platform);\n\tconst tripIndexDO = safeDO(env, 'TRIP_INDEX_DO');\n\tif (!tripIndexDO) return json({ error: 'TRIP_INDEX_DO binding not found' }, { status: 503 });\n\n\ttry {\n\t\tconst id = tripIndexDO.idFromName(userId);\n\t\tconst stub = tripIndexDO.get(id);\n\t\tconst res = await stub.fetch('http://internal/compute-routes', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ id: tripId })\n\t\t});\n\n\t\tconst text = await res.text().catch(() => null);\n\t\tlet parsed: any = null;\n\t\ttry {\n\t\t\tparsed = text ? JSON.parse(text) : null;\n\t\t} catch {\n\t\t\tparsed = null;\n\t\t}\n\n\t\treturn json(\n\t\t\t{\n\t\t\t\tok: res.ok,\n\t\t\t\tstatus: res.status,\n\t\t\t\tbody: parsed ?? text\n\t\t\t},\n\t\t\t{ status: 200 }\n\t\t);\n\t} catch (e: any) {\n\t\treturn json({ error: 'Compute failed', message: e.message }, { status: 500 });\n\t}\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\logout\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\mileage\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\mileage\\[id]\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\mileage\\post-validation.spec.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 4,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 4,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [113, 116], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [113, 116], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 5,
				"column": 17,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 5,
				"endColumn": 20,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [134, 137], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [134, 137], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 6,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 6,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [152, 155], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [152, 155], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 14,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 14,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [333, 336], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [333, 336], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 23,
				"column": 23,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 23,
				"endColumn": 26,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [589, 592], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [589, 592], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 65,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 65,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1555, 1558], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1555, 1558], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 72,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 72,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1787, 1790], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1787, 1790], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 88,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 88,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2235, 2238], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2235, 2238], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 95,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 95,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2467, 2470], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2467, 2470], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 120,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 120,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3081, 3084], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3081, 3084], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 127,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 127,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3313, 3316], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3313, 3316], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 152,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 152,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3955, 3958], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3955, 3958], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 159,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 159,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4187, 4190], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4187, 4190], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 175,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 175,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4551, 4554], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4551, 4554], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 182,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 182,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4783, 4786], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4783, 4786], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 15,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Mock the services and env\nlet mockMileageSvc: any;\nlet mockTripKV: any;\nlet mockEnv: any;\n\nvi.mock('$lib/server/mileageService', () => ({\n\tmakeMileageService: () => mockMileageSvc\n}));\n\nvi.mock('$lib/server/env', () => ({\n\tgetEnv: () => mockEnv,\n\tsafeKV: (envParam: any, name: string) => {\n\t\tif (name === 'BETA_LOGS_KV') return mockTripKV;\n\t\tif (envParam && typeof envParam[name] !== 'undefined') return envParam[name];\n\t\treturn {};\n\t},\n\tsafeDO: () => ({})\n}));\n\nvi.mock('$lib/server/user', () => ({\n\tgetStorageId: (user: any) => user?.id || 'test_user'\n}));\n\ndescribe('POST /api/mileage - Parent trip validation', () => {\n\tbeforeEach(() => {\n\t\tmockMileageSvc = {\n\t\t\tput: vi.fn().mockResolvedValue(undefined),\n\t\t\tlist: vi.fn().mockResolvedValue([]),\n\t\t\tget: vi.fn()\n\t\t};\n\t\tmockTripKV = {\n\t\t\tget: vi.fn()\n\t\t};\n\t\tmockEnv = {};\n\t\t// Provide BETA_USERS_KV for user lookups\n\t\tmockEnv.BETA_USERS_KV = {\n\t\t\tget: vi.fn().mockResolvedValue(\n\t\t\t\tJSON.stringify({\n\t\t\t\t\tid: 'u1',\n\t\t\t\t\tplan: 'free',\n\t\t\t\t\tusername: 'u1',\n\t\t\t\t\temail: 'u1@example.com',\n\t\t\t\t\tpassword: 'pw',\n\t\t\t\t\tname: 'u1',\n\t\t\t\t\tcreatedAt: new Date().toISOString()\n\t\t\t\t})\n\t\t\t)\n\t\t};\n\t});\n\n\tit('returns 409 when parent trip does not exist (tripId provided)', async () => {\n\t\t// Mock: trip not found\n\t\tmockTripKV.get.mockResolvedValue(null);\n\n\t\tconst tripId = '550e8400-e29b-41d4-a716-446655440000'; // valid UUID\n\t\tconst body = {\n\t\t\ttripId,\n\t\t\tmiles: 50,\n\t\t\tmileageRate: 0.725,\n\t\t\tstartOdometer: 0,\n\t\t\tendOdometer: 50\n\t\t};\n\t\tconst event: any = {\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv, context: { waitUntil: vi.fn() } }\n\t\t};\n\n\t\tconst { POST } = await import('./+server');\n\t\tconst res = await POST(event as any);\n\n\t\texpect(res.status).toBe(409);\n\t\tconst json = JSON.parse(await res.text());\n\t\texpect(json.error).toContain('Parent trip not found');\n\t});\n\n\tit('succeeds when no tripId provided (create standalone mileage)', async () => {\n\t\t// Mock: trip not found, but no tripId provided so validation should be skipped\n\t\tmockTripKV.get.mockResolvedValue(null);\n\n\t\tconst body = {\n\t\t\tmiles: 20,\n\t\t\tstartOdometer: 100,\n\t\t\tendOdometer: 120\n\t\t};\n\t\tconst event: any = {\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv, context: { waitUntil: vi.fn() } }\n\t\t};\n\n\t\tconst { POST } = await import('./+server');\n\t\tconst res = await POST(event as any);\n\n\t\texpect(res.status).toBe(201);\n\t\texpect(mockMileageSvc.put).toHaveBeenCalled();\n\t});\n\n\tit('returns 409 when parent trip is deleted (tripId provided)', async () => {\n\t\t// Mock: trip exists but is deleted\n\t\tconst tripId = '550e8400-e29b-41d4-a716-446655440001'; // valid UUID\n\t\tconst deletedTrip = {\n\t\t\tid: tripId,\n\t\t\tuserId: 'u1',\n\t\t\tdeleted: true,\n\t\t\tdeletedAt: new Date().toISOString(),\n\t\t\tbackup: {}\n\t\t};\n\t\tmockTripKV.get.mockResolvedValue(JSON.stringify(deletedTrip));\n\n\t\tconst body = {\n\t\t\ttripId: tripId,\n\t\t\tmiles: 50,\n\t\t\tmileageRate: 0.725,\n\t\t\tstartOdometer: 0,\n\t\t\tendOdometer: 50\n\t\t};\n\t\tconst event: any = {\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv, context: { waitUntil: vi.fn() } }\n\t\t};\n\n\t\tconst { POST } = await import('./+server');\n\t\tconst res = await POST(event as any);\n\n\t\texpect(res.status).toBe(409);\n\t\tconst json = JSON.parse(await res.text());\n\t\texpect(json.error).toContain('Parent trip is deleted');\n\t});\n\n\tit('succeeds when parent trip exists and is active (tripId provided)', async () => {\n\t\t// Mock: trip exists and is active\n\t\tconst tripId = '550e8400-e29b-41d4-a716-446655440002'; // valid UUID\n\t\tconst activeTrip = {\n\t\t\tid: tripId,\n\t\t\tuserId: 'u1',\n\t\t\ttitle: 'Active Trip',\n\t\t\ttotalMiles: 0\n\t\t};\n\t\tmockTripKV.get.mockResolvedValue(JSON.stringify(activeTrip));\n\n\t\tconst body = {\n\t\t\ttripId: tripId,\n\t\t\tmiles: 50,\n\t\t\tmileageRate: 0.725,\n\t\t\tstartOdometer: 0,\n\t\t\tendOdometer: 50\n\t\t};\n\t\tconst event: any = {\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv, context: { waitUntil: vi.fn() } }\n\t\t};\n\n\t\tconst { POST } = await import('./+server');\n\t\tconst res = await POST(event as any);\n\n\t\texpect(res.status).toBe(201);\n\t\texpect(mockMileageSvc.put).toHaveBeenCalled();\n\t});\n\n\tit('skips validation when tripKV is not available (e.g., tests)', async () => {\n\t\t// Mock: tripKV returns empty object (no get method)\n\t\tmockTripKV = {};\n\n\t\tconst body = {\n\t\t\tmiles: 50,\n\t\t\tmileageRate: 0.725,\n\t\t\tstartOdometer: 0,\n\t\t\tendOdometer: 50\n\t\t};\n\t\tconst event: any = {\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv, context: { waitUntil: vi.fn() } }\n\t\t};\n\n\t\tconst { POST } = await import('./+server');\n\t\tconst res = await POST(event as any);\n\n\t\texpect(res.status).toBe(201);\n\t\texpect(mockMileageSvc.put).toHaveBeenCalled();\n\t});\n});\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\mileage\\post.spec.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 3,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 3,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [77, 80], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [77, 80], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 4,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 4,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [95, 98], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [95, 98], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 10,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 10,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [262, 265], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [262, 265], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 40,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 40,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1083, 1086], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1083, 1086], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 47,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 47,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1315, 1318], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1315, 1318], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 5,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { describe, it, expect, vi, beforeEach } from 'vitest';\n\nlet mockSvc: any;\nlet mockEnv: any;\nvi.mock('$lib/server/mileageService', () => ({\n\tmakeMileageService: () => mockSvc\n}));\nvi.mock('$lib/server/env', () => ({\n\tgetEnv: () => mockEnv,\n\tsafeKV: (env: any, name: string) => {\n\t\tif (env && typeof env[name] !== 'undefined') return env[name];\n\t\treturn {};\n\t},\n\tsafeDO: () => ({})\n}));\n\ndescribe('POST /api/mileage handler', () => {\n\tbeforeEach(() => {\n\t\tmockSvc = { put: vi.fn().mockResolvedValue(undefined), list: vi.fn().mockResolvedValue([]) };\n\t\t// Mock platform env: BETA_USERS_KV for findUserById and a context.waitUntil for background tasks\n\t\tmockEnv = {\n\t\t\tBETA_USERS_KV: {\n\t\t\t\tget: vi.fn().mockResolvedValue(\n\t\t\t\t\tJSON.stringify({\n\t\t\t\t\t\tid: 'u1',\n\t\t\t\t\t\tplan: 'free',\n\t\t\t\t\t\tusername: 'u1',\n\t\t\t\t\t\temail: 'u1@example.com',\n\t\t\t\t\t\tpassword: 'pw',\n\t\t\t\t\t\tname: 'u1',\n\t\t\t\t\t\tcreatedAt: new Date().toISOString()\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t}\n\t\t};\n\t});\n\n\tit('accepts miles + rate and computes reimbursement', async () => {\n\t\tconst body = { miles: 50, mileageRate: 0.725 };\n\t\tconst event: any = {\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv, context: { waitUntil: vi.fn() } }\n\t\t};\n\n\t\tconst { POST } = await import('./+server');\n\t\tconst res = await POST(event as any);\n\t\texpect(res.status).toBe(201);\n\t\tconst json = JSON.parse(await res.text());\n\t\texpect(json.miles).toBeCloseTo(50, 6);\n\t\texpect(json.reimbursement).toBeCloseTo(50 * 0.725, 2);\n\t\texpect(mockSvc.put).toHaveBeenCalled();\n\t});\n});\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\mileage\\put-validation.spec.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 4,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 4,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [113, 116], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [113, 116], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 5,
				"column": 17,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 5,
				"endColumn": 20,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [134, 137], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [134, 137], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 6,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 6,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [152, 155], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [152, 155], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 14,
				"column": 17,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 14,
				"endColumn": 20,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [329, 332], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [329, 332], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 22,
				"column": 23,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 22,
				"endColumn": 26,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [505, 508], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [505, 508], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 48,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 48,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1091, 1094], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1091, 1094], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 56,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 56,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1324, 1327], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1324, 1327], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 68,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 68,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1723, 1726], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1723, 1726], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 76,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 76,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1956, 1959], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1956, 1959], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 94,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 94,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2398, 2401], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2398, 2401], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 102,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 102,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2631, 2634], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2631, 2634], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 120,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 120,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3103, 3106], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3103, 3106], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 128,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 128,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3336, 3339], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3336, 3339], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 139,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 139,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3618, 3621], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3618, 3621], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 147,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 147,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3851, 3854], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3851, 3854], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 15,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Mock the services and env\nlet mockMileageSvc: any;\nlet mockTripKV: any;\nlet mockEnv: any;\n\nvi.mock('$lib/server/mileageService', () => ({\n\tmakeMileageService: () => mockMileageSvc\n}));\n\nvi.mock('$lib/server/env', () => ({\n\tgetEnv: () => mockEnv,\n\tsafeKV: (_env: any, name: string) => {\n\t\tif (name === 'BETA_LOGS_KV') return mockTripKV;\n\t\treturn {};\n\t},\n\tsafeDO: () => ({})\n}));\n\nvi.mock('$lib/server/user', () => ({\n\tgetStorageId: (user: any) => user?.id || 'test_user'\n}));\n\ndescribe('PUT /api/mileage/[id] - Parent trip validation', () => {\n\tbeforeEach(() => {\n\t\tmockMileageSvc = {\n\t\t\tput: vi.fn(),\n\t\t\tget: vi.fn().mockResolvedValue({\n\t\t\t\tid: 'trip-123',\n\t\t\t\tuserId: 'u1',\n\t\t\t\tmiles: 100,\n\t\t\t\tstartOdometer: 0,\n\t\t\t\tendOdometer: 100\n\t\t\t})\n\t\t};\n\t\tmockTripKV = {\n\t\t\tget: vi.fn()\n\t\t};\n\t\tmockEnv = {};\n\t});\n\n\tit('returns 409 when parent trip does not exist (attaching tripId)', async () => {\n\t\t// Mock: trip not found\n\t\tmockTripKV.get.mockResolvedValue(null);\n\n\t\tconst body = { miles: 150, tripId: 'trip-123' };\n\t\tconst event: any = {\n\t\t\tparams: { id: 'trip-123' },\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv }\n\t\t};\n\n\t\tconst { PUT } = await import('./[id]/+server');\n\t\tconst res = await PUT(event as any);\n\n\t\texpect(res.status).toBe(409);\n\t\tconst json = JSON.parse(await res.text());\n\t\texpect(json.error).toContain('Parent trip not found');\n\t});\n\n\tit('succeeds when updating a standalone mileage (no tripId)', async () => {\n\t\t// Mock: trip not found but existing mileage has no tripId so validation is skipped\n\t\tmockTripKV.get.mockResolvedValue(null);\n\n\t\tconst body = { miles: 150 };\n\t\tconst event: any = {\n\t\t\tparams: { id: 'trip-123' },\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv }\n\t\t};\n\n\t\tconst { PUT } = await import('./[id]/+server');\n\t\tconst res = await PUT(event as any);\n\n\t\texpect(res.status).toBe(200);\n\t\texpect(mockMileageSvc.put).toHaveBeenCalled();\n\t});\n\n\tit('returns 409 when parent trip is deleted', async () => {\n\t\t// Mock: trip exists but is deleted\n\t\tconst deletedTrip = {\n\t\t\tid: 'trip-123',\n\t\t\tuserId: 'u1',\n\t\t\tdeleted: true,\n\t\t\tdeletedAt: new Date().toISOString(),\n\t\t\tbackup: {}\n\t\t};\n\t\tmockTripKV.get.mockResolvedValue(JSON.stringify(deletedTrip));\n\n\t\tconst body = { miles: 150 };\n\t\tconst event: any = {\n\t\t\tparams: { id: 'trip-123' },\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv }\n\t\t};\n\n\t\tconst { PUT } = await import('./[id]/+server');\n\t\tconst res = await PUT(event as any);\n\n\t\texpect(res.status).toBe(409);\n\t\tconst json = JSON.parse(await res.text());\n\t\texpect(json.error).toContain('Parent trip is deleted');\n\t});\n\n\tit('succeeds when parent trip exists and is active', async () => {\n\t\t// Mock: trip exists and is active\n\t\tconst activeTrip = {\n\t\t\tid: 'trip-123',\n\t\t\tuserId: 'u1',\n\t\t\ttitle: 'Active Trip',\n\t\t\ttotalMiles: 100\n\t\t};\n\t\tmockTripKV.get.mockResolvedValue(JSON.stringify(activeTrip));\n\n\t\tconst body = { miles: 150 };\n\t\tconst event: any = {\n\t\t\tparams: { id: 'trip-123' },\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv }\n\t\t};\n\n\t\tconst { PUT } = await import('./[id]/+server');\n\t\tconst res = await PUT(event as any);\n\n\t\texpect(res.status).toBe(200);\n\t\texpect(mockMileageSvc.put).toHaveBeenCalled();\n\t});\n\n\tit('skips validation when tripKV is not available', async () => {\n\t\t// Mock: tripKV returns empty object (no get method)\n\t\tmockTripKV = {};\n\n\t\tconst body = { miles: 150 };\n\t\tconst event: any = {\n\t\t\tparams: { id: 'trip-123' },\n\t\t\trequest: { json: async () => body },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\tplatform: { env: mockEnv }\n\t\t};\n\n\t\tconst { PUT } = await import('./[id]/+server');\n\t\tconst res = await PUT(event as any);\n\n\t\texpect(res.status).toBe(200);\n\t\texpect(mockMileageSvc.put).toHaveBeenCalled();\n\t});\n});\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\mileage\\put.spec.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 4,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 4,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [159, 162], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [159, 162], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 5,
				"column": 18,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 5,
				"endColumn": 21,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [181, 184], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [181, 184], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 33,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 33,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [906, 909], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [906, 909], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 42,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 42,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1164, 1167], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1164, 1167], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 56,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 56,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1692, 1695], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1692, 1695], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 65,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 65,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1950, 1953], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1950, 1953], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 84,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 84,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2688, 2691], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2688, 2691], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 92,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 92,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2902, 2905], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2902, 2905], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 109,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 109,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3646, 3649], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3646, 3649], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 117,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 117,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3859, 3862], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3859, 3862], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 10,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// Module-level mocks are declared here so vitest's hoisting behaves predictably.\nlet mockSvc: any;\nlet mockTripSvc: any;\nvi.mock('$lib/server/mileageService', () => ({\n\tmakeMileageService: () => mockSvc\n}));\nvi.mock('$lib/server/tripService', () => ({\n\tmakeTripService: () => mockTripSvc\n}));\nvi.mock('$lib/server/env', () => ({\n\tgetEnv: () => ({}),\n\tsafeKV: () => ({}),\n\tsafeDO: () => ({})\n}));\n\ndescribe('PUT /api/mileage/[id] handler', () => {\n\tbeforeEach(() => {\n\t\tmockSvc = {\n\t\t\tget: vi.fn(),\n\t\t\tput: vi.fn()\n\t\t};\n\t\tmockTripSvc = undefined;\n\t});\n\n\tit('respects an explicit miles value in the request body', async () => {\n\t\tconst existing = { id: 'r1', userId: 'u1', startOdometer: 0, endOdometer: 0, miles: 0 };\n\t\tmockSvc.get.mockResolvedValue(existing);\n\n\t\tconst body = { startOdometer: 0, endOdometer: 0, miles: 50 };\n\n\t\tconst event: any = {\n\t\t\tparams: { id: 'r1' },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\trequest: { json: async () => body },\n\t\t\tplatform: {}\n\t\t};\n\n\t\t// import handler after mocks are in place\n\t\tconst { PUT } = await import('./[id]/+server');\n\t\tconst res = await PUT(event as any);\n\t\texpect(res.status).toBe(200);\n\t\tconst json = JSON.parse(await res.text());\n\t\texpect(json.miles).toBeCloseTo(50, 6);\n\t\texpect(mockSvc.put).toHaveBeenCalled();\n\t\texpect(mockSvc.put.mock.calls[0][0].miles).toBeCloseTo(50, 6);\n\t});\n\n\tit('recomputes miles from odometers when miles is not provided', async () => {\n\t\tconst existing = { id: 'r2', userId: 'u1', startOdometer: 10, endOdometer: 20, miles: 10 };\n\t\tmockSvc.get.mockResolvedValue(existing);\n\n\t\tconst body = { startOdometer: 100, endOdometer: 160 };\n\n\t\tconst event: any = {\n\t\t\tparams: { id: 'r2' },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\trequest: { json: async () => body },\n\t\t\tplatform: {}\n\t\t};\n\n\t\t// import handler after mocks are in place\n\t\tconst { PUT } = await import('./[id]/+server');\n\t\tconst res = await PUT(event as any);\n\t\texpect(res.status).toBe(200);\n\t\tconst json = JSON.parse(await res.text());\n\t\texpect(json.miles).toBeCloseTo(60, 6);\n\t\texpect(mockSvc.put).toHaveBeenCalled();\n\t\texpect(mockSvc.put.mock.calls[0][0].miles).toBeCloseTo(60, 6);\n\t});\n\n\tit('also mirrors miles into the BETA_LOGS_KV trip record when present (best-effort)', async () => {\n\t\tconst existing = { id: 'rt1', userId: 'u1', totalMiles: 5, mpg: 25, gasPrice: 3.5 };\n\t\tmockSvc.get.mockResolvedValue({ id: 'rt1', userId: 'u1', miles: 5, tripId: 'rt1' });\n\n\t\t// Prepare mocked trip service (module-level holder populated below)\n\t\tmockTripSvc = {\n\t\t\tget: vi.fn().mockResolvedValue(existing),\n\t\t\tput: vi.fn().mockResolvedValue(null)\n\t\t};\n\n\t\tconst body = { miles: 77 };\n\t\tconst event: any = {\n\t\t\tparams: { id: 'rt1' },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\trequest: { json: async () => body },\n\t\t\tplatform: {}\n\t\t};\n\n\t\tconst { PUT } = await import('./[id]/+server');\n\t\tconst res = await PUT(event as any);\n\t\texpect(res.status).toBe(200);\n\t\tconst json = JSON.parse(await res.text());\n\t\texpect(json.miles).toBeCloseTo(77, 6);\n\t\texpect(mockSvc.put).toHaveBeenCalled();\n\t\texpect(mockTripSvc.get).toHaveBeenCalled();\n\t\texpect(mockTripSvc.put).toHaveBeenCalled();\n\t\texpect(mockTripSvc.put.mock.calls[0][0].totalMiles).toBeCloseTo(77, 6);\n\t\t// Verify fuelCost is also calculated (77 miles / 25 mpg * 3.5 gasPrice = 10.78)\n\t\texpect(mockTripSvc.put.mock.calls[0][0].fuelCost).toBeCloseTo(10.78, 2);\n\t});\n\n\tit('computes reimbursement when miles + rate are provided on PUT', async () => {\n\t\tconst existing = { id: 'r3', userId: 'u1', miles: 0 };\n\t\tmockSvc.get.mockResolvedValue(existing);\n\n\t\tconst body = { miles: 10, mileageRate: 0.725 };\n\t\tconst event: any = {\n\t\t\tparams: { id: 'r3' },\n\t\t\tlocals: { user: { id: 'u1' } },\n\t\t\trequest: { json: async () => body },\n\t\t\tplatform: {}\n\t\t};\n\n\t\tconst { PUT } = await import('./[id]/+server');\n\t\tconst res = await PUT(event as any);\n\t\texpect(res.status).toBe(200);\n\t\tconst json = JSON.parse(await res.text());\n\t\texpect(json.miles).toBeCloseTo(10, 6);\n\t\texpect(json.reimbursement).toBeCloseTo(7.25, 2);\n\t\texpect(mockSvc.put).toHaveBeenCalled();\n\t\texpect(mockSvc.put.mock.calls[0][0].reimbursement).toBeCloseTo(7.25, 2);\n\t});\n});\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\places\\cache\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 16,
				"column": 33,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 16,
				"endColumn": 36,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [542, 545], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [542, 545], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 22,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 22,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [658, 661], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [658, 661], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 76,
				"column": 10,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 76,
				"endColumn": 13,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2769, 2772], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2769, 2772], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 3,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { json } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\n\nimport { generatePlaceKey } from '$lib/utils/keys';\nimport { sanitizeString } from '$lib/server/sanitize';\nimport { log } from '$lib/server/log';\n\nexport const POST: RequestHandler = async ({ request, platform, locals }) => {\n\t// 1. Security: Block unauthenticated writes\n\tif (!locals.user) {\n\t\treturn json({ error: 'Unauthorized' }, { status: 401 });\n\t}\n\n\t// SECURITY (Issue #8): Get user ID for per-user cache isolation\n\n\tconst userId = (locals.user as any).id;\n\tif (!userId) {\n\t\treturn json({ error: 'Invalid session' }, { status: 401 });\n\t}\n\n\ttry {\n\t\tconst rawPlace: any = await request.json();\n\t\tconst placesKV = platform?.env?.BETA_PLACES_KV as KVNamespace;\n\n\t\tif (!placesKV) {\n\t\t\tlog.warn('BETA_PLACES_KV not found for caching');\n\t\t\treturn json({ success: false });\n\t\t}\n\n\t\tif (!rawPlace || (!rawPlace.formatted_address && !rawPlace.name)) {\n\t\t\treturn json({ success: false, error: 'Invalid data' });\n\t\t}\n\n\t\t// Sanitize data\n\t\tconst place = {\n\t\t\tformatted_address: sanitizeString(rawPlace.formatted_address, 500),\n\t\t\tname: sanitizeString(rawPlace.name, 200),\n\t\t\tsecondary_text: sanitizeString(rawPlace.secondary_text, 300),\n\t\t\tplace_id: sanitizeString(rawPlace.place_id, 200),\n\t\t\tgeometry: rawPlace.geometry,\n\t\t\tsource: 'autocomplete_selection', // Force source to ensure it looks 'local'\n\t\t\tcachedAt: new Date().toISOString(),\n\t\t\tcontributedBy: userId\n\t\t};\n\n\t\tconst keyText = place.formatted_address || place.name;\n\n\t\t// 1. Save \"Detail\" Record (place:<userId>:<hash>)\n\t\t// SECURITY: Scope to user to prevent cache poisoning\n\t\tconst key = await generatePlaceKey(keyText);\n\t\tconst userScopedKey = `place:${userId}:${key.replace('place:', '')}`;\n\t\tawait placesKV.put(userScopedKey, JSON.stringify(place));\n\n\t\t// 2. Update per-user Search Index Buckets (user:<userId>:prefix:...)\n\t\t// SECURITY (Issue #8): Scope buckets to user to prevent global cache poisoning\n\t\tconst normalized = keyText.toLowerCase().replace(/\\s+/g, '');\n\n\t\t// We update specific prefixes to ensure it appears as the user types\n\t\t// Limiting concurrency to avoid overwhelming the worker\n\t\tconst prefixesToUpdate = [];\n\t\tfor (let len = 2; len <= Math.min(10, normalized.length); len++) {\n\t\t\tprefixesToUpdate.push(normalized.substring(0, len));\n\t\t}\n\n\t\t// Process bucket updates in parallel (user-scoped)\n\t\tawait Promise.all(\n\t\t\tprefixesToUpdate.map(async (prefix) => {\n\t\t\t\t// SECURITY: Prefix with userId to isolate user's autocomplete data\n\t\t\t\tconst bucketKey = `user:${userId}:prefix:${prefix}`;\n\t\t\t\tconst existingRaw = await placesKV.get(bucketKey);\n\t\t\t\tlet bucket = existingRaw ? JSON.parse(existingRaw) : [];\n\n\t\t\t\t// Remove if exists (to update it), then add to top\n\n\t\t\t\tbucket = bucket.filter(\n\t\t\t\t\t(b: any) =>\n\t\t\t\t\t\tb.formatted_address !== place.formatted_address && b.place_id !== place.place_id\n\t\t\t\t);\n\n\t\t\t\tbucket.unshift(place); // Add to TOP of list since it was just selected\n\n\t\t\t\t// Cap bucket size\n\t\t\t\tif (bucket.length > 20) bucket = bucket.slice(0, 20);\n\n\t\t\t\t// Save prefix bucket (user-scoped)\n\t\t\t\tawait placesKV.put(bucketKey, JSON.stringify(bucket));\n\t\t\t})\n\t\t);\n\n\t\treturn json({ success: true });\n\t} catch (e) {\n\t\tlog.error('Cache Error', { message: (e as Error)?.message });\n\t\treturn json({ success: false, error: String(e) }, { status: 500 });\n\t}\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\remove\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 15,
				"column": 42,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 15,
				"endColumn": 45,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [617, 620], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [617, 620], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/api/delete-account/+server.ts\n// DEPRECATED: This is a legacy proxy endpoint that forwards to an external backend.\n// New code should use the local /api/user DELETE endpoint instead.\nimport { json } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { log } from '$lib/server/log';\n\nexport const POST: RequestHandler = async ({ request, fetch, cookies, locals }) => {\n\ttry {\n\t\t// SECURITY (Issue #11): Verify user is authenticated before forwarding\n\t\tif (!locals.user) {\n\t\t\treturn json({ error: 'Unauthorized' }, { status: 401 });\n\t\t}\n\n\t\tconst body = (await request.json()) as any;\n\t\tconst token = request.headers.get('Authorization');\n\n\t\t// 1. Forward the request to the real backend\n\t\tconst response = await fetch('https://logs.gorouteyourself.com/api/delete-account', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t...(token ? { Authorization: token } : {})\n\t\t\t},\n\t\t\tbody: JSON.stringify(body)\n\t\t});\n\n\t\t// 2. If successful, clear the cookie immediately so the user is logged out\n\t\tif (response.ok) {\n\t\t\tcookies.delete('token', { path: '/' });\n\t\t\tcookies.delete('session_id', { path: '/' });\n\t\t}\n\n\t\t// 3. Return the backend's response to the client\n\t\tlet data;\n\t\ttry {\n\t\t\tdata = await response.json();\n\t\t} catch (_e: unknown) {\n\t\t\tvoid _e;\n\t\t\tdata = { error: 'Failed to parse external API response' };\n\t\t}\n\n\t\treturn json(data, { status: response.status });\n\t} catch (err) {\n\t\tlog.error('Delete account proxy error', { message: (err as Error)?.message });\n\t\treturn json({ error: 'Internal Server Error' }, { status: 500 });\n\t}\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\reset-password\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 34,
				"column": 27,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 34,
				"endColumn": 35
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 38,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 38,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 54,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 54,
				"endColumn": 29
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 2,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { page } from '$app/stores';\n\timport { goto } from '$app/navigation';\n\n\tlet password = '';\n\tlet confirmPassword = '';\n\tlet loading = false;\n\tlet error = '';\n\tlet success = false;\n\n\t// Get token from URL\n\t$: token = $page.url.searchParams.get('token');\n\n\tasync function handleReset() {\n\t\tif (password !== confirmPassword) {\n\t\t\terror = 'Passwords do not match';\n\t\t\treturn;\n\t\t}\n\n\t\tloading = true;\n\t\terror = '';\n\n\t\ttry {\n\t\t\tconst res = await fetch('/api/reset-password', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ token, password })\n\t\t\t});\n\n\t\t\tconst data: any = await res.json();\n\n\t\t\tif (res.ok) {\n\t\t\t\tsuccess = true;\n\t\t\t\tsetTimeout(() => goto('/login'), 3000);\n\t\t\t} else {\n\t\t\t\terror = data.message || 'Failed to reset password.';\n\t\t\t}\n\t\t} catch (e) {\n\t\t\terror = 'Network error occurred.';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n</script>\n\n<svelte:head>\n\t<title>Set New Password - Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"auth-page\">\n\t<div class=\"form-container\">\n\t\t{#if !token}\n\t\t\t<div class=\"alert error\">Invalid link. Please request a new password reset.</div>\n\t\t\t<a href=\"/forgot-password\" class=\"back-link\">Go to Forgot Password</a>\n\t\t{:else if success}\n\t\t\t<div class=\"alert success\">\n\t\t\t\t<h3>Success!</h3>\n\t\t\t\t<p>Your password has been reset. Redirecting to login...</p>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"form-header\">\n\t\t\t\t<h1>New Password</h1>\n\t\t\t\t<p>Enter your new secure password.</p>\n\t\t\t</div>\n\n\t\t\t{#if error}\n\t\t\t\t<div class=\"alert error\">{error}</div>\n\t\t\t{/if}\n\n\t\t\t<form on:submit|preventDefault={handleReset}>\n\t\t\t\t<div class=\"field-group\">\n\t\t\t\t\t<label for=\"pass\">New Password</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tid=\"pass\"\n\t\t\t\t\t\tbind:value={password}\n\t\t\t\t\t\trequired\n\t\t\t\t\t\tclass=\"input-field\"\n\t\t\t\t\t\tminlength=\"6\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"field-group\">\n\t\t\t\t\t<label for=\"conf\">Confirm Password</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tid=\"conf\"\n\t\t\t\t\t\tbind:value={confirmPassword}\n\t\t\t\t\t\trequired\n\t\t\t\t\t\tclass=\"input-field\"\n\t\t\t\t\t\tminlength=\"6\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<button type=\"submit\" class=\"btn-submit\" disabled={loading}>\n\t\t\t\t\t{loading ? 'Updating...' : 'Set Password'}\n\t\t\t\t</button>\n\t\t\t</form>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t/* Same styles as above */\n\t.auth-page {\n\t\tmin-height: 100vh;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbackground: #f9fafb;\n\t\tfont-family: 'Inter', sans-serif;\n\t}\n\t.form-container {\n\t\tbackground: white;\n\t\tpadding: 40px;\n\t\tborder-radius: 12px;\n\t\tbox-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n\t\twidth: 100%;\n\t\tmax-width: 400px;\n\t}\n\t.form-header {\n\t\tmargin-bottom: 24px;\n\t\ttext-align: center;\n\t}\n\th1 {\n\t\tfont-size: 24px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 10px 0;\n\t}\n\tp {\n\t\tcolor: #6b7280;\n\t\tfont-size: 14px;\n\t}\n\t.input-field {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-size: 15px;\n\t\tmargin-top: 6px;\n\t}\n\t.field-group {\n\t\tmargin-bottom: 20px;\n\t}\n\t.btn-submit {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tbackground: #ff7f50;\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t}\n\t.alert {\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tmargin-bottom: 20px;\n\t\tfont-size: 14px;\n\t}\n\t.alert.success {\n\t\tbackground: #f0fdf4;\n\t\tcolor: #166534;\n\t\ttext-align: center;\n\t}\n\t.alert.error {\n\t\tbackground: #fef2f2;\n\t\tcolor: #991b1b;\n\t}\n\t.back-link {\n\t\tdisplay: block;\n\t\ttext-align: center;\n\t\tcolor: #ff7f50;\n\t\tmargin-top: 20px;\n\t\ttext-decoration: none;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\reset-password\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 27,
				"column": 15,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 27,
				"endColumn": 18,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [949, 952], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [949, 952], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 60,
				"column": 41,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 60,
				"endColumn": 44,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1895, 1898], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1895, 1898], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 93,
				"column": 56,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 93,
				"endColumn": 59,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3063, 3066], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3063, 3066], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 3,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/api/reset-password/+server.ts\nimport { json } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { hashPassword } from '$lib/server/auth';\nimport { findUserById, updatePasswordHash } from '$lib/server/userService';\nimport { z } from 'zod';\nimport { log } from '$lib/server/log';\nimport { validatePassword } from '$lib/server/passwordValidation';\n\n// Input validation schema\nconst resetSchema = z.object({\n\ttoken: z.string().min(1, 'Token is required'),\n\tpassword: z.string().min(8, 'Password must be at least 8 characters')\n});\n\nexport const POST: RequestHandler = async ({ request, platform, cookies }) => {\n\ttry {\n\t\tconst { getEnv, safeKV } = await import('$lib/server/env');\n\t\tconst env = getEnv(platform);\n\t\tconst kv = safeKV(env, 'BETA_USERS_KV');\n\t\tconst sessionsKV = safeKV(env, 'BETA_SESSIONS_KV');\n\n\t\tif (!kv) {\n\t\t\treturn json({ message: 'Service Unavailable' }, { status: 503 });\n\t\t}\n\n\t\tconst body: any = await request.json();\n\n\t\t// 1. Validate Input\n\t\tconst result = resetSchema.safeParse(body);\n\t\tif (!result.success) {\n\t\t\treturn json(\n\t\t\t\t{\n\t\t\t\t\tmessage: 'Invalid input',\n\t\t\t\t\terrors: result.error.flatten().fieldErrors\n\t\t\t\t},\n\t\t\t\t{ status: 400 }\n\t\t\t);\n\t\t}\n\n\t\tconst { token, password } = result.data;\n\n\t\t// [!code fix] SECURITY (Issue #9): Comprehensive password strength validation\n\t\tconst passwordCheck = validatePassword(password);\n\t\tif (!passwordCheck.valid) {\n\t\t\treturn json({ message: passwordCheck.error }, { status: 400 });\n\t\t}\n\n\t\t// 2. Validate Token\n\t\t// Look up the User ID associated with this reset token\n\t\tconst resetKey = `reset_token:${token}`;\n\t\tconst userId = await kv.get(resetKey);\n\n\t\tif (!userId) {\n\t\t\treturn json({ message: 'Invalid or expired reset token.' }, { status: 400 });\n\t\t}\n\n\t\t// 3. Fetch User Record\n\t\t// Must use service to ensure we get the full record (Core + Stats)\n\t\tconst user = await findUserById(kv as any, userId);\n\t\tif (!user) {\n\t\t\treturn json({ message: 'User not found.' }, { status: 404 });\n\t\t}\n\n\t\t// 4. Hash New Password\n\t\tconst newHash = await hashPassword(password);\n\n\t\t// 5. Update Password Securely\n\t\t// [Corrective Action] Use updatePasswordHash to prevent phantom writes/data loss\n\t\tawait updatePasswordHash(kv, user, newHash);\n\n\t\t// 6. Security: Cleanup & Session Invalidation\n\t\t// Delete the used token immediately\n\t\tawait kv.delete(resetKey);\n\n\t\t// Optional: Invalidate all existing sessions for this user to force re-login\n\t\t// (Highly recommended after a password reset)\n\t\tif (sessionsKV) {\n\t\t\tconst activeSessionKey = `active_session:${userId}`;\n\t\t\tconst activeSessionId = await sessionsKV.get(activeSessionKey);\n\t\t\tif (activeSessionId) {\n\t\t\t\tawait sessionsKV.delete(activeSessionId);\n\t\t\t\tawait sessionsKV.delete(activeSessionKey);\n\t\t\t}\n\t\t}\n\n\t\t// Clear any session cookies on this client\n\t\tcookies.delete('session_id', { path: '/' });\n\t\tcookies.delete('__Host-session_id', { path: '/' });\n\n\t\treturn json({ success: true, message: 'Password reset successfully. Please log in.' });\n\t} catch (err) {\n\t\tlog.error('Reset password error', { message: (err as any)?.message });\n\t\treturn json({ message: 'Internal Server Error' }, { status: 500 });\n\t}\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\settings\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\stripe\\checkout\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\stripe\\portal\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\stripe\\webhook\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\trash\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 39,
				"column": 10,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 39,
				"endColumn": 13,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1638, 1641], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1638, 1641], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 41,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 41,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1672, 1675], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1672, 1675], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 42,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 42,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1695, 1698], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1695, 1698], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 43,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 43,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1720, 1723], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1720, 1723], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 47,
				"column": 47,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 47,
				"endColumn": 50,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1817, 1820], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1817, 1820], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 48,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 48,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1840, 1843], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1840, 1843], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 52,
				"column": 46,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 52,
				"endColumn": 49,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1936, 1939], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1936, 1939], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 53,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 53,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1959, 1962], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1959, 1962], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 85,
				"column": 63,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 85,
				"endColumn": 66,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2943, 2946], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2943, 2946], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 85,
				"column": 71,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 85,
				"endColumn": 74,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2951, 2954], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2951, 2954], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 10,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/api/trash/+server.ts\nimport type { RequestHandler } from './$types';\nimport { makeTripService } from '$lib/server/tripService';\nimport { makeExpenseService } from '$lib/server/expenseService';\nimport { makeMileageService } from '$lib/server/mileageService';\nimport { safeKV, safeDO } from '$lib/server/env';\nimport { log } from '$lib/server/log';\nimport { getStorageId } from '$lib/server/user';\nimport { dev } from '$app/environment';\n\n// [!code fix] SECURITY: Removed fakeKV and fakeDO fallbacks that caused silent data loss in production.\n// Dev mode gracefully handles missing bindings; production fails safely.\n\nexport const GET: RequestHandler = async (event) => {\n\ttry {\n\t\tconst user = event.locals.user;\n\t\tif (!user) return new Response('Unauthorized', { status: 401 });\n\n\t\tconst platformEnv = event.platform?.env as Record<string, unknown> | undefined;\n\t\tconst kv = safeKV(platformEnv, 'BETA_LOGS_KV');\n\t\tconst placesKV = safeKV(platformEnv, 'BETA_PLACES_KV');\n\n\t\t// [!code fix] SECURITY: Fail properly in production if KV bindings are missing\n\t\tif (!kv && !dev) {\n\t\t\tlog.error('[API/trash] BETA_LOGS_KV binding missing in production');\n\t\t\treturn new Response('Service Unavailable', { status: 503 });\n\t\t}\n\n\t\t// Durable Object bindings\n\t\tconst tripIndexDO = safeDO(platformEnv, 'TRIP_INDEX_DO');\n\t\tif (!tripIndexDO && !dev) {\n\t\t\tlog.error('[API/trash] TRIP_INDEX_DO binding missing in production');\n\t\t\treturn new Response('Service Unavailable', { status: 503 });\n\t\t}\n\t\tconst placesIndexDO = safeDO(platformEnv, 'PLACES_INDEX_DO') ?? tripIndexDO;\n\n\t\t// Initialize Services\n\t\tconst tripSvc = makeTripService(\n\t\t\tkv as any,\n\t\t\tundefined,\n\t\t\tplacesKV as any,\n\t\t\ttripIndexDO as any,\n\t\t\tplacesIndexDO as any\n\t\t);\n\n\t\tconst expenseSvc = makeExpenseService(\n\t\t\tsafeKV(platformEnv, 'BETA_EXPENSES_KV') as any,\n\t\t\ttripIndexDO as any\n\t\t);\n\n\t\tconst mileageSvc = makeMileageService(\n\t\t\tsafeKV(platformEnv, 'BETA_MILEAGE_KV') as any,\n\t\t\ttripIndexDO as any\n\t\t);\n\n\t\tconst currentUser = user as { id?: string; name?: string; token?: string };\n\t\tconst storageId = getStorageId(currentUser);\n\n\t\tif (!storageId) {\n\t\t\treturn new Response(JSON.stringify([]), {\n\t\t\t\tstatus: 200,\n\t\t\t\theaders: { 'Content-Type': 'application/json' }\n\t\t\t});\n\t\t}\n\n\t\tlet cloudTrash: unknown[] = [];\n\t\ttry {\n\t\t\tconst type = (event.url.searchParams.get('type') || '').toLowerCase();\n\n\t\t\t// Fetch based on filter or fetch all\n\t\t\tif (type === 'expenses') {\n\t\t\t\tcloudTrash = await expenseSvc.listTrash(storageId);\n\t\t\t} else if (type === 'mileage') {\n\t\t\t\tcloudTrash = await mileageSvc.listTrash(storageId);\n\t\t\t} else if (type === 'trips') {\n\t\t\t\tcloudTrash = await tripSvc.listTrash(storageId);\n\t\t\t} else {\n\t\t\t\t// Fetch ALL and merge\n\t\t\t\tconst [trips, expenses, mileage] = await Promise.all([\n\t\t\t\t\ttripSvc.listTrash(storageId),\n\t\t\t\t\texpenseSvc.listTrash(storageId),\n\t\t\t\t\tmileageSvc.listTrash(storageId)\n\t\t\t\t]);\n\n\t\t\t\tcloudTrash = [...trips, ...expenses, ...mileage].sort((a: any, b: any) =>\n\t\t\t\t\t(b.metadata?.deletedAt || '').localeCompare(a.metadata?.deletedAt || '')\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconst message = err instanceof Error ? err.message : String(err);\n\t\t\tlog.warn('Failed to list cloud trash', { message });\n\t\t}\n\n\t\treturn new Response(JSON.stringify(cloudTrash), {\n\t\t\tstatus: 200,\n\t\t\theaders: { 'Content-Type': 'application/json' }\n\t\t});\n\t} catch (err) {\n\t\tconst message = err instanceof Error ? err.message : String(err);\n\t\tlog.error('GET /api/trash error', { message });\n\t\treturn new Response(JSON.stringify({ error: 'Internal Server Error' }), {\n\t\t\tstatus: 500\n\t\t});\n\t}\n};\n\nexport const DELETE: RequestHandler = async () => {\n\t// Bulk delete implementation usually done one-by-one by client,\n\t// or implemented here if needed. Keeping placeholder for now.\n\treturn new Response(JSON.stringify({ deleted: 0 }), { status: 200 });\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\trash\\[id]\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 29,
				"column": 43,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 29,
				"endColumn": 46,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1284, 1287], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1284, 1287], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 31,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 31,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1347, 1350], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1347, 1350], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 32,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 32,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1370, 1373], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1370, 1373], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 33,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 33,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1395, 1398], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1395, 1398], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 37,
				"column": 47,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 37,
				"endColumn": 50,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1492, 1495], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1492, 1495], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 38,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 38,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1515, 1518], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1515, 1518], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 42,
				"column": 46,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 42,
				"endColumn": 49,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1611, 1614], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1611, 1614], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 43,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 43,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1634, 1637], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1634, 1637], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 44,
				"column": 43,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 44,
				"endColumn": 46,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1681, 1684], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1681, 1684], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 66,
				"column": 40,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 66,
				"endColumn": 43,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2381, 2384], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2381, 2384], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 131,
				"column": 23,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 131,
				"endColumn": 26,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4743, 4746], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4743, 4746], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 131,
				"column": 50,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 131,
				"endColumn": 53,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4770, 4773], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4770, 4773], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 132,
				"column": 25,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 132,
				"endColumn": 28,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4815, 4818], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4815, 4818], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 175,
				"column": 43,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 175,
				"endColumn": 46,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6427, 6430], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6427, 6430], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 177,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 177,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6490, 6493], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6490, 6493], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 178,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 178,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6513, 6516], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6513, 6516], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 179,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 179,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6538, 6541], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6538, 6541], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 183,
				"column": 47,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 183,
				"endColumn": 50,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6635, 6638], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6635, 6638], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 184,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 184,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6658, 6661], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6658, 6661], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 188,
				"column": 46,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 188,
				"endColumn": 49,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6754, 6757], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6754, 6757], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 189,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 189,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6777, 6780], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6777, 6780], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 214,
				"column": 39,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 214,
				"endColumn": 42,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7844, 7847], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7844, 7847], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 222,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 222,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8082, 8085], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8082, 8085], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 230,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 230,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8332, 8335], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8332, 8335], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 24,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/api/trash/[id]/+server.ts\nimport type { RequestHandler } from './$types';\nimport { makeTripService } from '$lib/server/tripService';\nimport { makeExpenseService } from '$lib/server/expenseService';\nimport { makeMileageService, type MileageRecord } from '$lib/server/mileageService';\nimport { safeKV, safeDO } from '$lib/server/env';\nimport { log } from '$lib/server/log';\nimport { dev } from '$app/environment';\n\n// [!code fix] SECURITY: Removed dangerous fakeDO fallback that caused silent data loss in production.\n\nexport const POST: RequestHandler = async (event) => {\n\ttry {\n\t\tconst user = event.locals.user;\n\t\tif (!user) return new Response('Unauthorized', { status: 401 });\n\n\t\tconst { id } = event.params;\n\t\tconst platformEnv = event.platform?.env as Record<string, unknown> | undefined;\n\n\t\t// [!code fix] SECURITY: Fail properly in production if DO bindings are missing\n\t\tconst tripIndexDO = safeDO(platformEnv, 'TRIP_INDEX_DO');\n\t\tif (!tripIndexDO && !dev) {\n\t\t\tlog.error('[API/trash/[id]] TRIP_INDEX_DO binding missing in production');\n\t\t\treturn new Response('Service Unavailable', { status: 503 });\n\t\t}\n\t\tconst placesIndexDO = safeDO(platformEnv, 'PLACES_INDEX_DO') ?? tripIndexDO;\n\n\t\tconst tripSvc = makeTripService(\n\t\t\tsafeKV(platformEnv, 'BETA_LOGS_KV') as any,\n\t\t\tundefined,\n\t\t\tsafeKV(platformEnv, 'BETA_PLACES_KV') as any,\n\t\t\ttripIndexDO as any,\n\t\t\tplacesIndexDO as any\n\t\t);\n\n\t\tconst expenseSvc = makeExpenseService(\n\t\t\tsafeKV(platformEnv, 'BETA_EXPENSES_KV') as any,\n\t\t\ttripIndexDO as any\n\t\t);\n\n\t\tconst mileageSvc = makeMileageService(\n\t\t\tsafeKV(platformEnv, 'BETA_MILEAGE_KV') as any,\n\t\t\ttripIndexDO as any,\n\t\t\tsafeKV(platformEnv, 'BETA_LOGS_KV') as any\n\t\t);\n\n\t\tconst currentUser = user as { id?: string; name?: string; token?: string };\n\t\t// [!code fix] Strictly use ID. Prevents username spoofing.\n\t\tconst storageId = currentUser?.id || '';\n\n\t\tif (storageId) {\n\t\t\tlet restored: unknown | null = null;\n\t\t\tlet lastError: string | null = null;\n\n\t\t\t// Strategy: Try sequentially until one succeeds\n\t\t\ttry {\n\t\t\t\trestored = await tripSvc.restore(storageId, id);\n\t\t\t} catch {\n\t\t\t\ttry {\n\t\t\t\t\trestored = await expenseSvc.restore(storageId, id);\n\t\t\t\t} catch {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Get the mileage item from trash to check its tripId\n\t\t\t\t\t\tconst mileageKV = safeKV(platformEnv, 'BETA_MILEAGE_KV');\n\t\t\t\t\t\tif (mileageKV) {\n\t\t\t\t\t\t\tconst raw = await (mileageKV as any).get(`mileage:${storageId}:${id}`);\n\t\t\t\t\t\t\tif (raw) {\n\t\t\t\t\t\t\t\tconst tombstone = JSON.parse(raw);\n\t\t\t\t\t\t\t\tconst mileageData = tombstone.backup || tombstone.data || tombstone;\n\n\t\t\t\t\t\t\t\t// Check if mileage has a linked trip\n\t\t\t\t\t\t\t\tif (mileageData.tripId) {\n\t\t\t\t\t\t\t\t\t// Check if parent trip is deleted\n\t\t\t\t\t\t\t\t\tconst trip = await tripSvc.get(storageId, mileageData.tripId);\n\t\t\t\t\t\t\t\t\tif (!trip || trip.deleted) {\n\t\t\t\t\t\t\t\t\t\tthrow new Error('Cannot restore mileage: parent trip is deleted');\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Check if another active mileage log exists for this trip\n\t\t\t\t\t\t\t\t\tconst activeMileage = await mileageSvc.list(storageId);\n\t\t\t\t\t\t\t\t\tconst conflictingMileage = activeMileage.find(\n\t\t\t\t\t\t\t\t\t\t(m: MileageRecord) => m.tripId === mileageData.tripId && m.id !== id\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tif (conflictingMileage) {\n\t\t\t\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t\t\t\t'Cannot restore mileage: another active mileage log exists for this trip'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trestored = await mileageSvc.restore(storageId, id);\n\t\t\t\t\t\t// If restored mileage has a tripId, sync the miles back to the trip\n\t\t\t\t\t\tconst restoredMileage = restored as MileageRecord | undefined;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\trestoredMileage &&\n\t\t\t\t\t\t\trestoredMileage.tripId &&\n\t\t\t\t\t\t\ttypeof restoredMileage.miles === 'number'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst trip = await tripSvc.get(storageId, restoredMileage.tripId);\n\t\t\t\t\t\t\t\tif (trip && !trip.deleted) {\n\t\t\t\t\t\t\t\t\ttrip.totalMiles = restoredMileage.miles;\n\t\t\t\t\t\t\t\t\ttrip.updatedAt = new Date().toISOString();\n\t\t\t\t\t\t\t\t\tawait tripSvc.put(trip);\n\t\t\t\t\t\t\t\t\tlog.info('Synced restored mileage to trip', {\n\t\t\t\t\t\t\t\t\t\ttripId: restoredMileage.tripId,\n\t\t\t\t\t\t\t\t\t\tmiles: restoredMileage.miles\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tlog.warn('Failed to sync restored mileage to trip', { message: String(e) });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t// Check if this is a validation error that we should surface\n\t\t\t\t\t\tconst errMsg = err instanceof Error ? err.message : String(err);\n\t\t\t\t\t\tif (errMsg.includes('Cannot restore mileage')) {\n\t\t\t\t\t\t\treturn new Response(JSON.stringify({ error: errMsg }), { status: 409 });\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Store the error for later use if no restore succeeded\n\t\t\t\t\t\tlastError = errMsg;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (restored) {\n\t\t\t\t// Only trips need counter incrementing\n\t\t\t\ttry {\n\t\t\t\t\tif ((restored as any).stops || (restored as any).startAddress) {\n\t\t\t\t\t\tawait (tripSvc as any).incrementUserCounter?.(storageId, 1);\n\t\t\t\t\t}\n\t\t\t\t} catch {\n\t\t\t\t\tvoid 0;\n\t\t\t\t}\n\n\t\t\t\treturn new Response(JSON.stringify({ success: true }), { status: 200 });\n\t\t\t}\n\n\t\t\t// If all restore attempts failed with a validation error, surface it\n\t\t\tif (lastError) {\n\t\t\t\treturn new Response(JSON.stringify({ error: lastError }), { status: 409 });\n\t\t\t}\n\t\t}\n\n\t\treturn new Response(JSON.stringify({ error: 'Item not found in trash' }), { status: 404 });\n\t} catch (err) {\n\t\tconst message = err instanceof Error ? err.message : String(err);\n\t\tlog.error('POST /api/trash/[id]/restore error', { message });\n\t\treturn new Response(JSON.stringify({ error: 'Internal Server Error' }), { status: 500 });\n\t}\n};\n\nexport const DELETE: RequestHandler = async (event) => {\n\ttry {\n\t\tconst user = event.locals.user;\n\t\tif (!user) return new Response('Unauthorized', { status: 401 });\n\n\t\tconst { id } = event.params;\n\t\t// Accept optional 'type' query param to specify which record type to delete\n\t\tconst recordType = event.url.searchParams.get('type');\n\t\tconst platformEnv = event.platform?.env as Record<string, unknown> | undefined;\n\n\t\t// [!code fix] SECURITY: Fail properly in production if DO bindings are missing\n\t\tconst tripIndexDO = safeDO(platformEnv, 'TRIP_INDEX_DO');\n\t\tif (!tripIndexDO && !dev) {\n\t\t\tlog.error('[API/trash/[id]] TRIP_INDEX_DO binding missing in production');\n\t\t\treturn new Response('Service Unavailable', { status: 503 });\n\t\t}\n\t\tconst placesIndexDO = safeDO(platformEnv, 'PLACES_INDEX_DO') ?? tripIndexDO;\n\n\t\t// Initialize all services\n\t\tconst tripSvc = makeTripService(\n\t\t\tsafeKV(platformEnv, 'BETA_LOGS_KV') as any,\n\t\t\tundefined,\n\t\t\tsafeKV(platformEnv, 'BETA_PLACES_KV') as any,\n\t\t\ttripIndexDO as any,\n\t\t\tplacesIndexDO as any\n\t\t);\n\n\t\tconst expenseSvc = makeExpenseService(\n\t\t\tsafeKV(platformEnv, 'BETA_EXPENSES_KV') as any,\n\t\t\ttripIndexDO as any\n\t\t);\n\n\t\tconst mileageSvc = makeMileageService(\n\t\t\tsafeKV(platformEnv, 'BETA_MILEAGE_KV') as any,\n\t\t\ttripIndexDO as any\n\t\t);\n\n\t\tconst currentUser = user as { id?: string; name?: string; token?: string };\n\t\t// [!code fix] Strictly use ID. Prevents username spoofing.\n\t\tconst storageId = currentUser?.id || '';\n\n\t\tif (storageId) {\n\t\t\t// If record type is specified, only delete from that specific service\n\t\t\t// This prevents accidentally deleting a trip when user only wants to delete mileage\n\t\t\tif (recordType === 'mileage') {\n\t\t\t\tawait mileageSvc.permanentDelete(storageId, id);\n\t\t\t} else if (recordType === 'expense') {\n\t\t\t\tawait expenseSvc.permanentDelete(storageId, id);\n\t\t\t} else if (recordType === 'trip') {\n\t\t\t\tawait tripSvc.permanentDelete(storageId, id);\n\t\t\t} else {\n\t\t\t\t// No type specified - detect which service has this record in trash\n\t\t\t\t// by checking which KV has a tombstone for this ID\n\t\t\t\tconst tripKV = safeKV(platformEnv, 'BETA_LOGS_KV');\n\t\t\t\tconst expenseKV = safeKV(platformEnv, 'BETA_EXPENSES_KV');\n\t\t\t\tconst mileageKV = safeKV(platformEnv, 'BETA_MILEAGE_KV');\n\t\t\t\tlet foundType: string | null = null;\n\n\t\t\t\tif (tripKV) {\n\t\t\t\t\tconst tripRaw = await (tripKV as any).get(`trip:${storageId}:${id}`);\n\t\t\t\t\tif (tripRaw) {\n\t\t\t\t\t\tconst parsed = JSON.parse(tripRaw);\n\t\t\t\t\t\tif (parsed.deleted) foundType = 'trip';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!foundType && mileageKV) {\n\t\t\t\t\tconst mileageRaw = await (mileageKV as any).get(`mileage:${storageId}:${id}`);\n\t\t\t\t\tif (mileageRaw) {\n\t\t\t\t\t\tconst parsed = JSON.parse(mileageRaw);\n\t\t\t\t\t\tif (parsed.deleted) foundType = 'mileage';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!foundType && expenseKV) {\n\t\t\t\t\tconst expenseRaw = await (expenseKV as any).get(`expense:${storageId}:${id}`);\n\t\t\t\t\tif (expenseRaw) {\n\t\t\t\t\t\tconst parsed = JSON.parse(expenseRaw);\n\t\t\t\t\t\tif (parsed.deleted) foundType = 'expense';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Only delete from the service that has the tombstone\n\t\t\t\tif (foundType === 'trip') {\n\t\t\t\t\tawait tripSvc.permanentDelete(storageId, id);\n\t\t\t\t} else if (foundType === 'mileage') {\n\t\t\t\t\tawait mileageSvc.permanentDelete(storageId, id);\n\t\t\t\t} else if (foundType === 'expense') {\n\t\t\t\t\tawait expenseSvc.permanentDelete(storageId, id);\n\t\t\t\t} else {\n\t\t\t\t\t// If no tombstone found, log warning but still try cleanup as fallback\n\t\t\t\t\t// This handles edge cases where the tombstone was already deleted\n\t\t\t\t\tlog.warn('No tombstone found for permanent delete, skipping', { id, storageId });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn new Response(null, { status: 204 });\n\t} catch (err: unknown) {\n\t\tconst message = err instanceof Error ? err.message : String(err);\n\t\tlog.error('DELETE /api/trash/[id] error', { message });\n\t\treturn new Response(JSON.stringify({ error: message }), {\n\t\t\tstatus: 500,\n\t\t\theaders: { 'Content-Type': 'application/json' }\n\t\t});\n\t}\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\trash\\[id]\\permanent-delete.spec.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 3,
				"column": 18,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 3,
				"endColumn": 21,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [81, 84], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [81, 84], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 4,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 4,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [106, 109], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [106, 109], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 5,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 5,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [131, 134], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [131, 134], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 6,
				"column": 17,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 6,
				"endColumn": 20,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [152, 155], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [152, 155], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 7,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 7,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [176, 179], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [176, 179], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 8,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 8,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [200, 203], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [200, 203], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 57,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 57,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1492, 1495], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1492, 1495], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 75,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 75,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2134, 2137], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2134, 2137], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 93,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 93,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2780, 2783], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2780, 2783], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 123,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 123,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3746, 3749], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3746, 3749], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 153,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 153,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4695, 4698], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4695, 4698], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 176,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 176,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5528, 5531], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5528, 5531], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 12,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { describe, it, expect, vi, beforeEach } from 'vitest';\n\nlet mockTripSvc: any;\nlet mockExpenseSvc: any;\nlet mockMileageSvc: any;\nlet mockTripKV: any;\nlet mockExpenseKV: any;\nlet mockMileageKV: any;\n\nvi.mock('$lib/server/tripService', () => ({\n\tmakeTripService: () => mockTripSvc\n}));\n\nvi.mock('$lib/server/expenseService', () => ({\n\tmakeExpenseService: () => mockExpenseSvc\n}));\n\nvi.mock('$lib/server/mileageService', () => ({\n\tmakeMileageService: () => mockMileageSvc\n}));\n\nvi.mock('$lib/server/env', () => ({\n\tsafeKV: (_env: unknown, name: string) => {\n\t\tif (name === 'BETA_LOGS_KV') return mockTripKV;\n\t\tif (name === 'BETA_EXPENSES_KV') return mockExpenseKV;\n\t\tif (name === 'BETA_MILEAGE_KV') return mockMileageKV;\n\t\tif (name === 'BETA_PLACES_KV') return undefined;\n\t\treturn undefined;\n\t},\n\tsafeDO: () => undefined\n}));\n\nvi.mock('$lib/server/user', () => ({\n\tgetStorageId: (u: { id?: string }) => u.id || 'mock-storage-id'\n}));\n\nvi.mock('$lib/server/log', () => ({\n\tlog: {\n\t\tinfo: vi.fn(),\n\t\twarn: vi.fn(),\n\t\terror: vi.fn()\n\t}\n}));\n\ndescribe('DELETE /api/trash/[id] handler', () => {\n\tbeforeEach(() => {\n\t\tvi.clearAllMocks();\n\t\tmockTripSvc = { permanentDelete: vi.fn() };\n\t\tmockExpenseSvc = { permanentDelete: vi.fn() };\n\t\tmockMileageSvc = { permanentDelete: vi.fn() };\n\t\tmockTripKV = { get: vi.fn() };\n\t\tmockExpenseKV = { get: vi.fn() };\n\t\tmockMileageKV = { get: vi.fn() };\n\t});\n\n\tit('deletes only from mileage service when type=mileage is specified', async () => {\n\t\tconst event: any = {\n\t\t\trequest: {},\n\t\t\tlocals: { user: { id: 'u1', name: 'testuser' } },\n\t\t\tplatform: { env: {} },\n\t\t\tparams: { id: 'test-id-123' },\n\t\t\turl: new URL('http://localhost/api/trash/test-id-123?type=mileage')\n\t\t};\n\n\t\tconst { DELETE } = await import('./+server');\n\t\tconst res = await DELETE(event);\n\n\t\texpect(res.status).toBe(204);\n\t\texpect(mockMileageSvc.permanentDelete).toHaveBeenCalledWith('u1', 'test-id-123');\n\t\texpect(mockTripSvc.permanentDelete).not.toHaveBeenCalled();\n\t\texpect(mockExpenseSvc.permanentDelete).not.toHaveBeenCalled();\n\t});\n\n\tit('deletes only from trip service when type=trip is specified', async () => {\n\t\tconst event: any = {\n\t\t\trequest: {},\n\t\t\tlocals: { user: { id: 'u2', name: 'testuser2' } },\n\t\t\tplatform: { env: {} },\n\t\t\tparams: { id: 'trip-id-456' },\n\t\t\turl: new URL('http://localhost/api/trash/trip-id-456?type=trip')\n\t\t};\n\n\t\tconst { DELETE } = await import('./+server');\n\t\tconst res = await DELETE(event);\n\n\t\texpect(res.status).toBe(204);\n\t\texpect(mockTripSvc.permanentDelete).toHaveBeenCalledWith('u2', 'trip-id-456');\n\t\texpect(mockMileageSvc.permanentDelete).not.toHaveBeenCalled();\n\t\texpect(mockExpenseSvc.permanentDelete).not.toHaveBeenCalled();\n\t});\n\n\tit('deletes only from expense service when type=expense is specified', async () => {\n\t\tconst event: any = {\n\t\t\trequest: {},\n\t\t\tlocals: { user: { id: 'u3', name: 'testuser3' } },\n\t\t\tplatform: { env: {} },\n\t\t\tparams: { id: 'expense-id-789' },\n\t\t\turl: new URL('http://localhost/api/trash/expense-id-789?type=expense')\n\t\t};\n\n\t\tconst { DELETE } = await import('./+server');\n\t\tconst res = await DELETE(event);\n\n\t\texpect(res.status).toBe(204);\n\t\texpect(mockExpenseSvc.permanentDelete).toHaveBeenCalledWith('u3', 'expense-id-789');\n\t\texpect(mockTripSvc.permanentDelete).not.toHaveBeenCalled();\n\t\texpect(mockMileageSvc.permanentDelete).not.toHaveBeenCalled();\n\t});\n\n\tit('detects and deletes mileage tombstone when no type is specified', async () => {\n\t\t// Mock that only mileage KV has a tombstone\n\t\tmockTripKV.get = vi.fn().mockResolvedValue(null);\n\t\tmockExpenseKV.get = vi.fn().mockResolvedValue(null);\n\t\tmockMileageKV.get = vi.fn().mockResolvedValue(\n\t\t\tJSON.stringify({\n\t\t\t\tdeleted: true,\n\t\t\t\tid: 'mileage-id',\n\t\t\t\tuserId: 'u4',\n\t\t\t\tmiles: 100\n\t\t\t})\n\t\t);\n\n\t\tconst event: any = {\n\t\t\trequest: {},\n\t\t\tlocals: { user: { id: 'u4', name: 'testuser4' } },\n\t\t\tplatform: { env: {} },\n\t\t\tparams: { id: 'mileage-id' },\n\t\t\turl: new URL('http://localhost/api/trash/mileage-id')\n\t\t};\n\n\t\tconst { DELETE } = await import('./+server');\n\t\tconst res = await DELETE(event);\n\n\t\texpect(res.status).toBe(204);\n\t\texpect(mockMileageSvc.permanentDelete).toHaveBeenCalledWith('u4', 'mileage-id');\n\t\texpect(mockTripSvc.permanentDelete).not.toHaveBeenCalled();\n\t\texpect(mockExpenseSvc.permanentDelete).not.toHaveBeenCalled();\n\t});\n\n\tit('detects and deletes trip tombstone when no type is specified', async () => {\n\t\t// Mock that only trip KV has a tombstone\n\t\tmockTripKV.get = vi.fn().mockResolvedValue(\n\t\t\tJSON.stringify({\n\t\t\t\tdeleted: true,\n\t\t\t\tid: 'trip-id',\n\t\t\t\tuserId: 'u5',\n\t\t\t\tstartAddress: '123 Main St'\n\t\t\t})\n\t\t);\n\t\tmockExpenseKV.get = vi.fn().mockResolvedValue(null);\n\t\tmockMileageKV.get = vi.fn().mockResolvedValue(null);\n\n\t\tconst event: any = {\n\t\t\trequest: {},\n\t\t\tlocals: { user: { id: 'u5', name: 'testuser5' } },\n\t\t\tplatform: { env: {} },\n\t\t\tparams: { id: 'trip-id' },\n\t\t\turl: new URL('http://localhost/api/trash/trip-id')\n\t\t};\n\n\t\tconst { DELETE } = await import('./+server');\n\t\tconst res = await DELETE(event);\n\n\t\texpect(res.status).toBe(204);\n\t\texpect(mockTripSvc.permanentDelete).toHaveBeenCalledWith('u5', 'trip-id');\n\t\texpect(mockMileageSvc.permanentDelete).not.toHaveBeenCalled();\n\t\texpect(mockExpenseSvc.permanentDelete).not.toHaveBeenCalled();\n\t});\n\n\tit('does not delete anything when no tombstone is found and no type specified', async () => {\n\t\t// Mock that no KV has a tombstone\n\t\tmockTripKV.get = vi.fn().mockResolvedValue(null);\n\t\tmockExpenseKV.get = vi.fn().mockResolvedValue(null);\n\t\tmockMileageKV.get = vi.fn().mockResolvedValue(null);\n\n\t\tconst event: any = {\n\t\t\trequest: {},\n\t\t\tlocals: { user: { id: 'u6', name: 'testuser6' } },\n\t\t\tplatform: { env: {} },\n\t\t\tparams: { id: 'nonexistent-id' },\n\t\t\turl: new URL('http://localhost/api/trash/nonexistent-id')\n\t\t};\n\n\t\tconst { DELETE } = await import('./+server');\n\t\tconst res = await DELETE(event);\n\n\t\texpect(res.status).toBe(204);\n\t\texpect(mockTripSvc.permanentDelete).not.toHaveBeenCalled();\n\t\texpect(mockMileageSvc.permanentDelete).not.toHaveBeenCalled();\n\t\texpect(mockExpenseSvc.permanentDelete).not.toHaveBeenCalled();\n\t});\n});\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\trips\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\trips\\[id]\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\trips\\reindex\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\user\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\verify\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\api\\verify\\resend\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 26,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 26,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1142, 1145], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1142, 1145], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/api/verify/resend/+server.ts\nimport { json } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { sendVerificationEmail } from '$lib/server/email';\nimport { checkRateLimit } from '$lib/server/rateLimit';\n\n// [!code fix] Hardcode production URL to prevent Host Header Injection\nconst PRODUCTION_BASE_URL = 'https://gorouteyourself.com';\n\nexport const POST: RequestHandler = async ({ request, platform, getClientAddress }) => {\n\tconst { getEnv, safeKV } = await import('$lib/server/env');\n\tconst env = getEnv(platform);\n\tconst usersKV = safeKV(env, 'BETA_USERS_KV');\n\tif (!usersKV) return json({ message: 'DB Error' }, { status: 500 });\n\n\t// [!code fix] SECURITY: Use server-configured BASE_URL to prevent Host Header Injection\n\tconst baseUrl = (env['BASE_URL'] as string) || PRODUCTION_BASE_URL;\n\n\t// 1. Rate Limit\n\tconst clientIp = request.headers.get('CF-Connecting-IP') || getClientAddress();\n\tconst limitRes = await checkRateLimit(usersKV, clientIp, 'resend_limit', 5, 3600);\n\tif (!limitRes.allowed) {\n\t\treturn json({ message: 'Too many requests. Please wait.' }, { status: 429 });\n\t}\n\n\tconst body: any = await request.json();\n\tconst { email } = body;\n\tif (!email) return json({ message: 'Email required' }, { status: 400 });\n\n\tconst normEmail = email.toLowerCase().trim();\n\n\t// 2. Find the Pending Token via Lookup Index\n\tconst token = await usersKV.get(`lookup:pending:${normEmail}`);\n\n\tif (!token) {\n\t\t// Generic success to prevent email enumeration\n\t\treturn json({\n\t\t\tsuccess: true,\n\t\t\tmessage: 'If a pending registration exists, an email has been sent.'\n\t\t});\n\t}\n\n\t// 3. Resend\n\tconst emailSent = await sendVerificationEmail(normEmail, token, baseUrl);\n\n\tif (!emailSent) {\n\t\treturn json({ message: 'Failed to send email provider error.' }, { status: 500 });\n\t}\n\n\treturn json({ success: true, message: 'Verification email resent.' });\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\contact\\+page.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\contact\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 43,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 43,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 52,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 52,
				"endColumn": 37
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 53,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 53,
				"endColumn": 36
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 54,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 54,
				"endColumn": 41
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 56,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 56,
				"endColumn": 33
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 57,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 57,
				"endColumn": 36
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 61,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 61,
				"endColumn": 33
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 87,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 87,
				"endColumn": 36
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 88,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 88,
				"endColumn": 35
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 89,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 89,
				"endColumn": 40
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 91,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 91,
				"endColumn": 35
			}
		],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 11,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { base } from '$app/paths';\n\tconst resolve = (href: string) => `${base}${href}`;\n\texport let form; // [!code ++]\n\n\tlet isMobileMenuOpen = false;\n\n\tfunction toggleMenu() {\n\t\tisMobileMenuOpen = !isMobileMenuOpen;\n\t}\n</script>\n\n<svelte:head>\n\t<title>Contact Sales - Go Route Yourself</title>\n\t<meta\n\t\tname=\"description\"\n\t\tcontent=\"Contact our sales team for custom route planning solutions. Get a tailored plan for your delivery fleet.\"\n\t/>\n\n\t<meta property=\"og:title\" content=\"Contact Sales - Go Route Yourself\" />\n\t<meta\n\t\tproperty=\"og:description\"\n\t\tcontent=\"Need a custom solution for your drivers? Contact our sales team today.\"\n\t/>\n\t<meta property=\"og:type\" content=\"website\" />\n\t<meta property=\"og:url\" content=\"https://gorouteyourself.com/contact\" />\n\n\t<script type=\"application/ld+json\">\n\t\t{\n\t\t\t\"@context\": \"https://schema.org\",\n\t\t\t\"@type\": \"ContactPage\",\n\t\t\t\"name\": \"Contact Sales\",\n\t\t\t\"description\": \"Get in touch with our sales team for Go Route Yourself business plans.\",\n\t\t\t\"url\": \"https://gorouteyourself.com/contact\"\n\t\t}\n\t</script>\n</svelte:head>\n\n<div class=\"contact-page\">\n\t<header class=\"header\">\n\t\t<div class=\"container\">\n\t\t\t<div class=\"header-content\">\n\t\t\t\t<a href=\"/\" class=\"logo-link\">\n\t\t\t\t\t<picture>\n\t\t\t\t\t\t<source type=\"image/avif\" srcset=\"/180x75.avif 48w, /180x75.avif 120w\" sizes=\"48px\" />\n\t\t\t\t\t\t<source type=\"image/webp\" srcset=\"/180x75.avif 48w, /180x75.avif 120w\" sizes=\"48px\" />\n\t\t\t\t\t\t<img src=\"/180x75.avif\" alt=\"Go Route Yourself\" class=\"logo\" width=\"512\" height=\"512\" />\n\t\t\t\t\t</picture>\n\t\t\t\t</a>\n\n\t\t\t\t<nav class=\"nav desktop-nav\">\n\t\t\t\t\t<a href={resolve('/#features')}>Features</a>\n\t\t\t\t\t<a href={resolve('/#pricing')}>Pricing</a>\n\t\t\t\t\t<a href={resolve('/#how-it-works')}>How It Works</a>\n\n\t\t\t\t\t<a href={resolve('/login')} class=\"btn-login\">Sign In</a>\n\t\t\t\t\t<a href={resolve('/register')} class=\"btn-primary\">Get Started Free</a>\n\t\t\t\t</nav>\n\n\t\t\t\t<div class=\"mobile-nav-controls\">\n\t\t\t\t\t<a href={resolve('/login')} class=\"mobile-signin\">Sign In</a>\n\n\t\t\t\t\t<button class=\"hamburger-btn\" on:click={toggleMenu} aria-label=\"Toggle menu\">\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"24\"\n\t\t\t\t\t\t\theight=\"24\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if isMobileMenuOpen}\n\t\t\t\t\t\t\t\t<path d=\"M18 6L6 18M6 6L18 18\"></path>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<path d=\"M3 12h18M3 6h18M3 18h18\"></path>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if isMobileMenuOpen}\n\t\t\t<div class=\"mobile-menu\">\n\t\t\t\t<a href={resolve('/#features')}>Features</a>\n\t\t\t\t<a href={resolve('/#pricing')}>Pricing</a>\n\t\t\t\t<a href={resolve('/#how-it-works')}>How It Works</a>\n\t\t\t\t<div class=\"divider\"></div>\n\t\t\t\t<a href={resolve('/register')} class=\"btn-primary mobile-btn\">Get Started Free</a>\n\t\t\t</div>\n\t\t{/if}\n\t</header>\n\n\t<main class=\"main-content\">\n\t\t<div class=\"container\">\n\t\t\t<div class=\"content-wrapper\">\n\t\t\t\t<div class=\"text-column\">\n\t\t\t\t\t<h1>Contact Sales</h1>\n\t\t\t\t\t<p class=\"subtitle\">\n\t\t\t\t\t\tReady to scale your delivery operations? Let's talk about how Go Route Yourself can help\n\t\t\t\t\t\tyour team save time and maximize profits.\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<div class=\"contact-info\">\n\t\t\t\t\t\t<div class=\"info-item\">\n\t\t\t\t\t\t\t<span class=\"icon\">📧</span>\n\t\t\t\t\t\t\t<a href=\"mailto:sales@gorouteyourself.com\">sales@gorouteyourself.com</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"info-item\">\n\t\t\t\t\t\t\t<span class=\"icon\">🏢</span>\n\t\t\t\t\t\t\t<p>Business Plan Inquiries</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"form-column\">\n\t\t\t\t\t{#if form?.success}\n\t\t\t\t\t\t<div class=\"success-message\">\n\t\t\t\t\t\t\t<h2>Message Sent! 🚀</h2>\n\t\t\t\t\t\t\t<p>Thanks for reaching out. Our team will get back to you shortly.</p>\n\t\t\t\t\t\t\t<button class=\"btn-primary\" on:click={() => window.location.reload()}\n\t\t\t\t\t\t\t\t>Send Another</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<form class=\"contact-form\" method=\"POST\">\n\t\t\t\t\t\t\t{#if form?.error}\n\t\t\t\t\t\t\t\t<div class=\"error-banner\">{form.error}</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t<label for=\"name\">Name</label>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tid=\"name\"\n\t\t\t\t\t\t\t\t\tname=\"name\"\n\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\tplaceholder=\"Your name\"\n\t\t\t\t\t\t\t\t\tvalue={form?.name ?? ''}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t<label for=\"email\">Work Email</label>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\t\tid=\"email\"\n\t\t\t\t\t\t\t\t\tname=\"email\"\n\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\tplaceholder=\"you@company.com\"\n\t\t\t\t\t\t\t\t\tvalue={form?.email ?? ''}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t<label for=\"company\">Company Name</label>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tid=\"company\"\n\t\t\t\t\t\t\t\t\tname=\"company\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Your company\"\n\t\t\t\t\t\t\t\t\tvalue={form?.company ?? ''}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t<label for=\"message\">How can we help?</label>\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tid=\"message\"\n\t\t\t\t\t\t\t\t\tname=\"message\"\n\t\t\t\t\t\t\t\t\trows=\"4\"\n\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\tplaceholder=\"Tell us about your team size and needs...\"\n\t\t\t\t\t\t\t\t\t>{form?.message ?? ''}</textarea\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<button type=\"submit\" class=\"btn-submit\">Send Message</button>\n\t\t\t\t\t\t</form>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</main>\n</div>\n\n<style>\n\t/* Brand Colors & Variables */\n\t:root {\n\t\t--orange: #ff7f50;\n\t\t--blue: #29abe2;\n\t\t--navy: #2c4a6e;\n\t\t--gray-100: #f3f4f6;\n\t\t--gray-600: #4b5563;\n\t\t--gray-900: #111827;\n\t}\n\n\t* {\n\t\tbox-sizing: border-box;\n\t}\n\n\t/* Page Wrapper */\n\t.contact-page {\n\t\tfont-family:\n\t\t\t-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n\t\tcolor: var(--gray-900);\n\t\tbackground: white;\n\t\t/* Ensure it covers the full height and sits above the layout background */\n\t\tmin-height: 100vh;\n\t\tpadding-top: 80px; /* Space for fixed header */\n\t}\n\n\t.container {\n\t\tmax-width: 1200px;\n\t\tmargin: 0 auto;\n\t\tpadding: 0 20px;\n\t}\n\n\t/* Header Styles (Consistent with Landing) */\n\t.header {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbackground: white;\n\t\tborder-bottom: 1px solid var(--gray-100);\n\t\tz-index: 1000;\n\t\tpadding: 16px 0;\n\t}\n\n\t.header-content {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t}\n\n\t.logo {\n\t\theight: 50px;\n\t\twidth: auto;\n\t}\n\n\t.desktop-nav {\n\t\tdisplay: none;\n\t\talign-items: center;\n\t\tgap: 24px;\n\t}\n\t.desktop-nav a {\n\t\ttext-decoration: none;\n\t\tcolor: var(--gray-600);\n\t\tfont-size: 16px;\n\t\tfont-weight: 500;\n\t\ttransition: color 0.2s;\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t}\n\t.desktop-nav a:hover {\n\t\tcolor: var(--orange);\n\t}\n\n\t.btn-login {\n\t\tcolor: var(--gray-600);\n\t\tfont-weight: 500;\n\t}\n\t.btn-primary {\n\t\tbackground: var(--orange);\n\t\tcolor: white !important;\n\t\tpadding: 10px 24px;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t}\n\t.btn-primary:hover {\n\t\ttransform: translateY(-2px);\n\t}\n\n\t.mobile-nav-controls {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 16px;\n\t}\n\t.mobile-signin {\n\t\ttext-decoration: none;\n\t\tcolor: var(--navy);\n\t\tfont-weight: 600;\n\t\tfont-size: 15px;\n\t}\n\t.hamburger-btn {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t\tcolor: var(--gray-600);\n\t\tpadding: 4px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n\n\t.mobile-menu {\n\t\tposition: absolute;\n\t\ttop: 100%;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\tbackground: white;\n\t\tborder-bottom: 1px solid var(--gray-100);\n\t\tpadding: 16px;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t\tbox-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n\t}\n\t.mobile-menu a {\n\t\ttext-decoration: none;\n\t\tcolor: var(--gray-600);\n\t\tfont-size: 16px;\n\t}\n\t.divider {\n\t\theight: 1px;\n\t\tbackground: var(--gray-100);\n\t\tmargin: 4px 0;\n\t}\n\t.mobile-btn {\n\t\ttext-align: center;\n\t\tdisplay: block;\n\t}\n\n\t/* Content Area */\n\t.main-content {\n\t\tpadding: 60px 0;\n\t}\n\n\t.content-wrapper {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr;\n\t\tgap: 40px;\n\t}\n\n\th1 {\n\t\tfont-size: 36px;\n\t\tfont-weight: 800;\n\t\tcolor: var(--navy);\n\t\tmargin-bottom: 16px;\n\t\tline-height: 1.2;\n\t}\n\t.subtitle {\n\t\tfont-size: 18px;\n\t\tcolor: var(--gray-600);\n\t\tmargin-bottom: 32px;\n\t\tline-height: 1.6;\n\t}\n\n\t.contact-info {\n\t\tmargin-bottom: 32px;\n\t}\n\t.info-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tmargin-bottom: 16px;\n\t\tfont-size: 18px;\n\t\tcolor: var(--gray-600);\n\t}\n\t.info-item a {\n\t\tcolor: var(--blue);\n\t\ttext-decoration: none;\n\t\tfont-weight: 500;\n\t}\n\t.info-item .icon {\n\t\tfont-size: 24px;\n\t}\n\n\t/* Form Styles */\n\t.contact-form {\n\t\tbackground: var(--gray-100);\n\t\tpadding: 32px;\n\t\tborder-radius: 16px;\n\t}\n\n\t.form-group {\n\t\tmargin-bottom: 20px;\n\t}\n\tlabel {\n\t\tdisplay: block;\n\t\tmargin-bottom: 8px;\n\t\tfont-weight: 600;\n\t\tcolor: var(--navy);\n\t}\n\n\tinput,\n\ttextarea {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-size: 16px;\n\t\tfont-family: inherit;\n\t}\n\n\tinput:focus,\n\ttextarea:focus {\n\t\toutline: 2px solid var(--blue);\n\t\tborder-color: transparent;\n\t}\n\n\t.btn-submit {\n\t\twidth: 100%;\n\t\tbackground: var(--navy);\n\t\tcolor: white;\n\t\tpadding: 14px;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tcursor: pointer;\n\t\ttransition: background 0.2s;\n\t}\n\t.btn-submit:hover {\n\t\tbackground: var(--blue);\n\t}\n\n\t/* New Success/Error Styles */\n\t.success-message {\n\t\tbackground: var(--gray-100);\n\t\tpadding: 32px;\n\t\tborder-radius: 16px;\n\t\ttext-align: center;\n\t}\n\t.success-message h2 {\n\t\tcolor: var(--navy);\n\t\tmargin-bottom: 16px;\n\t}\n\t.success-message p {\n\t\tcolor: var(--gray-600);\n\t\tmargin-bottom: 24px;\n\t\tfont-size: 18px;\n\t}\n\t.error-banner {\n\t\tbackground: #fee2e2;\n\t\tcolor: #991b1b;\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tmargin-bottom: 20px;\n\t\tfont-weight: 500;\n\t\tborder: 1px solid #fecaca;\n\t}\n\n\t@media (min-width: 768px) {\n\t\t.desktop-nav {\n\t\t\tdisplay: flex;\n\t\t}\n\t\t.mobile-nav-controls {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\t.main-content {\n\t\t\tpadding: 100px 0;\n\t\t}\n\t\t.content-wrapper {\n\t\t\tgrid-template-columns: 1fr 1fr;\n\t\t\tgap: 80px;\n\t\t\talign-items: start;\n\t\t}\n\t\th1 {\n\t\t\tfont-size: 48px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\+layout.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\+layout.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 38,
				"column": 8,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 38,
				"endColumn": 21
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 48,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 48,
				"endColumn": 17
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 231,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 231,
				"endColumn": 44
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 275,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 285,
				"endColumn": 11
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 277,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 277,
				"endColumn": 22
			},
			{
				"ruleId": "svelte/no-at-html-tags",
				"severity": 2,
				"message": "`{@html}` can lead to XSS attack.",
				"line": 282,
				"column": 29,
				"nodeType": "SvelteMustacheTag",
				"messageId": "unexpected",
				"endLine": 282,
				"endColumn": 46
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 289,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 299,
				"endColumn": 11
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 291,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 291,
				"endColumn": 22
			},
			{
				"ruleId": "svelte/no-at-html-tags",
				"severity": 2,
				"message": "`{@html}` can lead to XSS attack.",
				"line": 296,
				"column": 29,
				"nodeType": "SvelteMustacheTag",
				"messageId": "unexpected",
				"endLine": 296,
				"endColumn": 46
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 305,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 305,
				"endColumn": 44
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 349,
				"column": 3,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 359,
				"endColumn": 10
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 351,
				"column": 10,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 351,
				"endColumn": 30
			},
			{
				"ruleId": "svelte/no-at-html-tags",
				"severity": 2,
				"message": "`{@html}` can lead to XSS attack.",
				"line": 356,
				"column": 35,
				"nodeType": "SvelteMustacheTag",
				"messageId": "unexpected",
				"endLine": 356,
				"endColumn": 52
			}
		],
		"suppressedMessages": [],
		"errorCount": 6,
		"fatalErrorCount": 0,
		"warningCount": 7,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { page } from '$app/stores';\n\timport { auth, user } from '$lib/stores/auth';\n\timport { goto } from '$app/navigation';\n\timport { base } from '$app/paths';\n\timport { trips } from '$lib/stores/trips';\n\timport { expenses } from '$lib/stores/expenses';\n\timport { mileage } from '$lib/stores/mileage';\n\timport { sanitizeStaticSvg } from '$lib/utils/sanitize';\n\timport { csrfFetch } from '$lib/utils/csrf';\n\n\tconst resolve = (href: string) => `${base}${href}`;\n\timport { trash } from '$lib/stores/trash';\n\timport { syncManager } from '$lib/sync/syncManager';\n\timport SyncIndicator from '$lib/components/SyncIndicator.svelte';\n\timport type { LayoutData } from './$types';\n\n\texport let data: LayoutData;\n\t$: if (data?.user) {\n\t\tauth.hydrate(data.user);\n\t}\n\n\tlet sidebarOpen = false;\n\n\tfunction closeSidebar() {\n\t\tsidebarOpen = false;\n\t}\n\n\tfunction handleOverlayKeydown(e: KeyboardEvent) {\n\t\tif (e.key === 'Escape') closeSidebar();\n\t}\n\n\t// Helper to force client-side navigation using goto\n\tfunction handleNav(e: MouseEvent, href: string) {\n\t\te.preventDefault();\n\t\tcloseSidebar();\n\t\tgoto(resolve(href));\n\t}\n\n\tasync function handleLogout() {\n\t\tif (confirm('Are you sure you want to logout?')) {\n\t\t\tawait csrfFetch('/api/logout', { method: 'POST' });\n\t\t\tauth.logout();\n\t\t\ttrips.clear();\n\t\t\texpenses.clear();\n\t\t\ttrash.clear();\n\t\t\tgoto('/login');\n\t\t}\n\t}\n\n\t// [!code fix] SECURITY (Issue #7, #43): Sanitize static SVG icons in navigation\n\tconst navItems = [\n\t\t{\n\t\t\thref: '/dashboard/',\n\t\t\ticon: sanitizeStaticSvg(\n\t\t\t\t`<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M3 9L10 2L17 9V17C17 17.5304 16.7893 18.0391 16.4142 18.4142C16.0391 18.7893 15.5304 18 15 18H5C4.46957 18 3.96086 17.7893 3.58579 17.4142C3.21071 17.0391 3 16.5304 3 16V9Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>`\n\t\t\t),\n\t\t\tlabel: 'Home',\n\t\t\texact: true\n\t\t},\n\t\t{\n\t\t\thref: '/dashboard/expenses/',\n\t\t\ticon: sanitizeStaticSvg(\n\t\t\t\t`<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M12 1V23\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/><path d=\"M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3688 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>`\n\t\t\t),\n\t\t\tlabel: 'Expenses'\n\t\t},\n\t\t{\n\t\t\thref: '/dashboard/mileage/',\n\t\t\ticon: sanitizeStaticSvg(\n\t\t\t\t`<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t\t<path d=\"M3 11h18v3a2 2 0 0 1-2 2h-1.5a2 2 0 0 1-4 0H11.5a2 2 0 0 1-4 0H6a2 2 0 0 1-2-2v-3z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t\t<path d=\"M5 11L7 6h10l2 5\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t\t<circle cx=\"7.5\" cy=\"17.5\" r=\"1.5\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t\t<circle cx=\"16.5\" cy=\"17.5\" r=\"1.5\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t</svg>`\n\t\t\t),\n\t\t\tlabel: 'Mileage'\n\t\t},\n\t\t{\n\t\t\thref: '/dashboard/trips/',\n\t\t\ticon: sanitizeStaticSvg(\n\t\t\t\t`<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t<path d=\"M12 2C8.13 2 5 5.13 5 9c0 5 7 11 7 11s7-6 7-11c0-3.87-3.13-7-7-7z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<circle cx=\"12\" cy=\"9\" r=\"2.5\" stroke=\"currentColor\" stroke-width=\"2\"/>\n\t\t\t\t<path d=\"M3 12c4-2 6 1 9-1s6 0 9 1\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-dasharray=\"3 3\"/>\n\t\t\t</svg>`\n\t\t\t),\n\t\t\tlabel: 'Trips',\n\t\t\texclude: ['/dashboard/trips/new']\n\t\t}\n\t];\n\n\t// Hamburger menu items (Data Management, Settings)\n\tconst hamburgerItems = [\n\t\t{\n\t\t\thref: '/dashboard/data-management/',\n\t\t\ticon: sanitizeStaticSvg(\n\t\t\t\t`<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M7 10L12 15L17 10\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M12 15V3\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>`\n\t\t\t),\n\t\t\tlabel: 'Data Management'\n\t\t},\n\t\t{\n\t\t\thref: '/dashboard/settings/',\n\t\t\ticon: sanitizeStaticSvg(\n\t\t\t\t`<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M19.4 15C20.4 14.3 21 13.2 21 12C21 10.8 20.4 9.7 19.4 9L20 8C20.5 7.2 20.2 6.1 19.4 5.6L18.4 5C17.6 4.5 16.6 4.8 16.1 5.6L15.5 6.6C14.5 5.9 13.3 5.5 12 5.5C10.7 5.5 9.5 5.9 8.5 6.6L7.9 5.6C7.4 4.8 6.4 4.5 5.6 5L4.6 5.6C3.8 6.1 3.5 7.2 4 8L4.6 9C3.6 9.7 3 10.8 3 12C3 13.2 3.6 14.3 4.6 15L4 16C3.5 16.8 3.8 17.9 4.6 18.4L5.6 19C6.4 19.5 7.4 19.2 7.9 18.4L8.5 17.4C9.5 18.1 10.7 18.5 12 18.5C13.3 18.5 14.5 18.1 15.5 17.4L16.1 18.4C16.6 19.2 17.6 19.5 18.4 19L19.4 18.4C20.2 17.9 20.5 16.8 20 16L19.4 15Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>`\n\t\t\t),\n\t\t\tlabel: 'Settings'\n\t\t}\n\t];\n\n\t// [!code fix] UPDATED: Now accepts currentPath argument for guaranteed reactivity\n\tfunction isActive(\n\t\thref: string,\n\t\tcurrentPath: string,\n\t\texact = false,\n\t\texclude: string[] = []\n\t): boolean {\n\t\t// Normalize both to ensure trailing slash consistency\n\t\tconst path = currentPath.endsWith('/') ? currentPath : currentPath + '/';\n\t\tconst link = href.endsWith('/') ? href : href + '/';\n\n\t\tif (exclude.length > 0) {\n\t\t\tif (exclude.some((e) => path.startsWith(e))) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (exact) {\n\t\t\treturn path === link;\n\t\t}\n\n\t\treturn path.startsWith(link);\n\t}\n\n\tfunction getInitial(name: string): string {\n\t\treturn name ? name.charAt(0).toUpperCase() : 'U';\n\t}\n\n\tonMount(async () => {\n\t\tconsole.log('[DASHBOARD LAYOUT] Initializing...');\n\n\t\tconst apiKey = data.googleMapsApiKey;\n\n\t\tlet userId = (data?.user as any)?.id || $user?.id;\n\n\t\tif (!userId) {\n\t\t\tuserId = localStorage.getItem('offline_user_id');\n\t\t\tif (userId) {\n\t\t\t\tconsole.log('[DASHBOARD LAYOUT] Using Offline ID:', userId);\n\t\t\t}\n\t\t}\n\n\t\tif (userId) {\n\t\t\t// Defer heavy initialization until after first paint so the LCP can render quickly\n\t\t\tawait new Promise((resolve) => requestAnimationFrame(() => resolve(undefined)));\n\n\t\t\tconst doInit = async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconsole.log('[DASHBOARD LAYOUT] Loading data for:', userId);\n\n\t\t\t\t\tawait syncManager.initialize(apiKey);\n\n\t\t\t\t\t// Kick off loads without awaiting them so we don't block initial paint\n\t\t\t\t\ttrips.load(userId);\n\t\t\t\t\texpenses.load(userId);\n\t\t\t\t\tmileage.load(userId);\n\t\t\t\t\ttrash.load(userId);\n\n\t\t\t\t\t// Background syncs\n\t\t\t\t\ttrips.syncFromCloud(userId);\n\t\t\t\t\texpenses.syncFromCloud(userId);\n\t\t\t\t\tmileage.syncFromCloud(userId);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error('[DASHBOARD LAYOUT] ❌ Failed to start data load:', err);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Prefer requestIdleCallback when available to do non-critical work\n\t\t\tif (typeof window !== 'undefined' && 'requestIdleCallback' in window) {\n\t\t\t\t(requestIdleCallback as any)(() => doInit().catch(console.error));\n\t\t\t} else {\n\t\t\t\tsetTimeout(() => doInit().catch(console.error), 0);\n\t\t\t}\n\t\t} else {\n\t\t\tawait auth.init();\n\t\t}\n\t});\n</script>\n\n<svelte:head>\n\t<link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n\t<link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin=\"anonymous\" />\n\t<link\n\t\thref=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap\"\n\t\trel=\"stylesheet\"\n\t/>\n\t<!-- Preload the dashboard mobile logo to improve LCP discoverability and priority -->\n\t<link\n\t\trel=\"preload\"\n\t\thref=\"/180x75.avif\"\n\t\tas=\"image\"\n\t\ttype=\"image/avif\"\n\t\timagesrcset=\"/180x75.avif 48w, /180x75.avif 120w\"\n\t\timagesizes=\"40px\"\n\t\tfetchpriority=\"high\"\n\t/>\n</svelte:head>\n\n<div class=\"layout\">\n\t<header class=\"mobile-header\">\n\t\t<picture>\n\t\t\t<source type=\"image/avif\" srcset=\"/180x75.avif 48w, /180x75.avif 120w\" sizes=\"40px\" />\n\t\t\t<source type=\"image/webp\" srcset=\"/180x75.avif 48w, /180x75.avif 120w\" sizes=\"40px\" />\n\t\t\t<img\n\t\t\t\tsrc=\"/180x75.avif\"\n\t\t\t\talt=\"Go Route Yourself\"\n\t\t\t\tclass=\"mobile-logo\"\n\t\t\t\twidth=\"48\"\n\t\t\t\theight=\"48\"\n\t\t\t\tdecoding=\"async\"\n\t\t\t\tloading=\"eager\"\n\t\t\t\tfetchpriority=\"high\"\n\t\t\t/>\n\t\t</picture>\n\t\t<div class=\"mobile-actions\">\n\t\t\t<SyncIndicator />\n\t\t\t{#if $user}\n\t\t\t\t<a\n\t\t\t\t\thref={resolve('/dashboard/settings/')}\n\t\t\t\t\tclass=\"mobile-user\"\n\t\t\t\t\taria-label=\"Profile Settings\"\n\t\t\t\t\ton:click={(e) => handleNav(e, '/dashboard/settings/')}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"user-avatar small\">\n\t\t\t\t\t\t{getInitial($user.name || $user.email || '')}\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t{/if}\n\t\t</div>\n\t</header>\n\n\t<aside class=\"sidebar\" class:open={sidebarOpen}>\n\t\t<div class=\"sidebar-header\">\n\t\t\t<img\n\t\t\t\tsrc=\"/180x75.avif\"\n\t\t\t\talt=\"Go Route Yourself\"\n\t\t\t\tclass=\"sidebar-logo\"\n\t\t\t\twidth=\"64\"\n\t\t\t\theight=\"64\"\n\t\t\t\tdecoding=\"async\"\n\t\t\t\tloading=\"eager\"\n\t\t\t\tfetchpriority=\"high\"\n\t\t\t\tstyle=\"width:64px; height:64px; object-fit:contain;\"\n\t\t\t/>\n\n\t\t\t<button class=\"close-btn\" on:click={closeSidebar} aria-label=\"Close menu\">\n\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M18 6L6 18M6 6L18 18\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"sidebar-sync\">\n\t\t\t<SyncIndicator />\n\t\t</div>\n\n\t\t<nav class=\"nav\">\n\t\t\t{#each navItems as item}\n\t\t\t\t<a\n\t\t\t\t\thref={item.href}\n\t\t\t\t\tclass=\"nav-item\"\n\t\t\t\t\tclass:active={isActive(item.href, $page.url.pathname, item.exact, item.exclude)}\n\t\t\t\t\ton:click={(e) => handleNav(e, item.href)}\n\t\t\t\t>\n\t\t\t\t\t<span class=\"nav-icon\">{@html item.icon}</span>\n\t\t\t\t\t<span class=\"nav-label\">{item.label}</span>\n\t\t\t\t</a>\n\t\t\t{/each}\n\n\t\t\t<div class=\"nav-divider\"></div>\n\n\t\t\t{#each hamburgerItems as item}\n\t\t\t\t<a\n\t\t\t\t\thref={item.href}\n\t\t\t\t\tclass=\"nav-item\"\n\t\t\t\t\tclass:active={isActive(item.href, $page.url.pathname)}\n\t\t\t\t\ton:click={(e) => handleNav(e, item.href)}\n\t\t\t\t>\n\t\t\t\t\t<span class=\"nav-icon\">{@html item.icon}</span>\n\t\t\t\t\t<span class=\"nav-label\">{item.label}</span>\n\t\t\t\t</a>\n\t\t\t{/each}\n\t\t</nav>\n\n\t\t<div class=\"sidebar-footer\">\n\t\t\t{#if $user}\n\t\t\t\t<a\n\t\t\t\t\thref={resolve('/dashboard/settings/')}\n\t\t\t\t\tclass=\"user-card\"\n\t\t\t\t\ton:click={(e) => handleNav(e, '/dashboard/settings/')}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"user-avatar\">\n\t\t\t\t\t\t{getInitial($user.name || $user.email || '')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"user-info\">\n\t\t\t\t\t\t<div class=\"user-name\">{$user.name || 'User'}</div>\n\t\t\t\t\t\t<div class=\"user-plan\">{$user.plan || 'Free'} Plan</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\n\t\t\t\t<button class=\"logout-btn\" on:click={handleLogout}>\n\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M7 17H3C2.46957 17 1.96086 16.7893 1.58579 16.4142C1.21071 16.0391 1 15.5304 1 15V3C1 2.46957 1.21071 1.96086 1.58579 1.58579C1.96086 1.21071 2.46957 1 3 1H7M13 13L17 9M17 9L13 5M17 9H7\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span>Logout</span>\n\t\t\t\t</button>\n\t\t\t{/if}\n\t\t</div>\n\t</aside>\n\n\t{#if sidebarOpen}\n\t\t<div\n\t\t\tclass=\"overlay\"\n\t\t\trole=\"button\"\n\t\t\ttabindex=\"0\"\n\t\t\ton:click={closeSidebar}\n\t\t\ton:keydown={handleOverlayKeydown}\n\t\t></div>\n\t{/if}\n\n\t<main class=\"main-content\">\n\t\t<slot />\n\t</main>\n\n\t<nav class=\"bottom-nav\">\n\t\t{#each navItems as item}\n\t\t\t<a\n\t\t\t\thref={resolve(item.href)}\n\t\t\t\tclass=\"bottom-nav-item\"\n\t\t\t\tclass:active={isActive(item.href, $page.url.pathname, item.exact, item.exclude)}\n\t\t\t\ton:click={(e) => handleNav(e, item.href)}\n\t\t\t>\n\t\t\t\t<span class=\"bottom-nav-icon\">{@html item.icon}</span>\n\t\t\t\t<span class=\"bottom-nav-label\">{item.label}</span>\n\t\t\t</a>\n\t\t{/each}\n\t\t<button\n\t\t\tclass=\"bottom-nav-item hamburger-nav-btn\"\n\t\t\ton:click={() => (sidebarOpen = !sidebarOpen)}\n\t\t\taria-label=\"Open menu\"\n\t\t\taria-expanded={sidebarOpen}\n\t\t>\n\t\t\t<span class=\"bottom-nav-icon\">\n\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M3 12H21M3 6H21M3 18H21\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</span>\n\t\t\t<span class=\"bottom-nav-label\">Menu</span>\n\t\t</button>\n\t</nav>\n</div>\n\n<style>\n\t/* font import moved to `src/app.css` */\n\t:root {\n\t\t--orange: #ff7f50;\n\t\t--blue: #29abe2;\n\t\t--navy: #2c4a6e;\n\t\t--green: #8dc63f;\n\t\t--purple: #8b5a9e;\n\t\t--sidebar-width: 280px;\n\t\t--mobile-header-height: 60px;\n\t}\n\n\t:global(body) {\n\t\tfont-family:\n\t\t\t'Inter',\n\t\t\t-apple-system,\n\t\t\tBlinkMacSystemFont,\n\t\t\t'Segoe UI',\n\t\t\tsans-serif;\n\t}\n\n\t:global(html) {\n\t\tscroll-padding-top: var(--mobile-header-height);\n\t}\n\n\t.layout {\n\t\tdisplay: flex;\n\t\tmin-height: 100dvh;\n\t\tbackground: #f9fafb;\n\t}\n\n\t/* --- Mobile Header --- */\n\t.mobile-header {\n\t\tdisplay: flex;\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\theight: var(--mobile-header-height);\n\t\tbackground: white;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t\tpadding: 0 16px;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\tz-index: 100;\n\t}\n\n\t.mobile-actions {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t}\n\n\t.mobile-logo {\n\t\twidth: auto;\n\t\theight: 48px;\n\t}\n\n\t.mobile-user {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\ttext-decoration: none;\n\t\tcolor: inherit;\n\t\tcursor: pointer;\n\t}\n\n\t/* --- Sidebar (Hidden by default on mobile) --- */\n\t.sidebar {\n\t\tposition: fixed;\n\t\tleft: 0;\n\t\ttop: 0;\n\t\tbottom: 0;\n\t\twidth: var(--sidebar-width);\n\t\tbackground: white;\n\t\tborder-right: 1px solid #e5e7eb;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tz-index: 1001;\n\t\ttransform: translateX(-100%);\n\t\ttransition: transform 0.3s ease;\n\t}\n\n\t.sidebar.open {\n\t\ttransform: translateX(0);\n\t}\n\n\t.sidebar-header {\n\t\tpadding: 24px 20px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t}\n\n\t.sidebar-logo {\n\t\twidth: auto;\n\t\theight: 64px;\n\t}\n\n\t/* Sync Indicator in Sidebar */\n\t.sidebar-sync {\n\t\tpadding: 16px 20px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t}\n\n\t.nav {\n\t\tflex: 1;\n\t\tpadding: 24px 16px;\n\t\toverflow-y: auto;\n\t\toverscroll-behavior: contain;\n\t}\n\n\t.nav-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding: 12px 16px;\n\t\tborder-radius: 10px;\n\t\ttext-decoration: none;\n\t\tcolor: #6b7280;\n\t\tfont-weight: 500;\n\t\tfont-size: 15px;\n\t\tmargin-bottom: 4px;\n\t\ttransition: all 0.2s;\n\t\tposition: relative;\n\t\tcursor: pointer;\n\t}\n\n\t.nav-item:hover {\n\t\tbackground: #f9fafb;\n\t\tcolor: #111827;\n\t}\n\n\t.nav-item.active {\n\t\tbackground: linear-gradient(135deg, var(--orange) 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tbox-shadow: 0 4px 12px rgba(255, 127, 80, 0.3);\n\t}\n\n\t.nav-icon {\n\t\tflex-shrink: 0;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\n\t.nav-label {\n\t\tfont-size: 15px;\n\t}\n\n\t.nav-divider {\n\t\theight: 1px;\n\t\tbackground: #e5e7eb;\n\t\tmargin: 12px 16px;\n\t}\n\n\t.sidebar-footer {\n\t\tpadding: 20px;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\n\t.user-card {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding: 12px;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 12px;\n\t\tmargin-bottom: 12px;\n\t\ttext-decoration: none;\n\t\tcolor: inherit;\n\t\ttransition: background-color 0.2s ease;\n\t\tcursor: pointer;\n\t}\n\n\t.user-card:hover {\n\t\tbackground: #f3f4f6;\n\t}\n\n\t.user-avatar {\n\t\twidth: 48px;\n\t\theight: 48px;\n\t\tborder-radius: 12px;\n\t\tbackground: linear-gradient(135deg, var(--navy) 0%, var(--blue) 100%);\n\t\tcolor: white;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-weight: 700;\n\t\tfont-size: 18px;\n\t\tflex-shrink: 0;\n\t}\n\n\t.user-avatar.small {\n\t\twidth: 32px;\n\t\theight: 32px;\n\t\tfont-size: 14px;\n\t}\n\n\t.user-info {\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t}\n\n\t.user-name {\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcolor: #111827;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t.user-plan {\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t\ttext-transform: capitalize;\n\t}\n\n\t.logout-btn {\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 8px;\n\t\tpadding: 12px;\n\t\tbackground: white;\n\t\tcolor: #6b7280;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tfont-family: inherit;\n\t}\n\n\t/* --- Main Content --- */\n\t.main-content {\n\t\tmargin-left: 0;\n\t\tpadding: calc(var(--mobile-header-height) + 20px) 16px 100px 16px;\n\t\tflex: 1;\n\t\tmin-height: 100dvh;\n\t}\n\n\t.overlay {\n\t\tdisplay: block;\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\tz-index: 1000;\n\t\tbackdrop-filter: blur(4px);\n\t}\n\n\t.close-btn {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tpadding: 8px;\n\t\tcursor: pointer;\n\t\tcolor: #374151;\n\t}\n\n\t/* --- Bottom Navigation (Mobile) --- */\n\t.bottom-nav {\n\t\tdisplay: flex;\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbackground: white;\n\t\tborder-top: 1px solid #e5e7eb;\n\t\tpadding-bottom: env(safe-area-inset-bottom, 20px);\n\t\theight: calc(60px + env(safe-area-inset-bottom, 20px));\n\t\tz-index: 900;\n\t\tjustify-content: space-around;\n\t\talign-items: flex-start;\n\t\tpadding-top: 8px;\n\t\tbox-shadow: 0 -2px 10px rgba(0, 0, 0, 0.03);\n\t}\n\n\t.bottom-nav-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\ttext-decoration: none;\n\t\tcolor: #9ca3af;\n\t\tfont-size: 12px;\n\t\tfont-weight: 500;\n\t\twidth: 100%;\n\t\tgap: 6px;\n\t\tcursor: pointer;\n\t\tpadding: 6px 8px;\n\t\tmin-height: 48px;\n\t\tmin-width: 48px;\n\t\tbox-sizing: border-box;\n\t}\n\n\t.bottom-nav-item.active {\n\t\tcolor: var(--orange);\n\t}\n\n\t.bottom-nav-icon :global(svg) {\n\t\twidth: 24px;\n\t\theight: 24px;\n\t}\n\n\t.hamburger-nav-btn {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t}\n\n\t/* --- Desktop Overrides --- */\n\t@media (min-width: 1024px) {\n\t\t.mobile-header {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\t.sidebar {\n\t\t\ttransform: translateX(0);\n\t\t}\n\n\t\t.main-content {\n\t\t\tmargin-left: var(--sidebar-width);\n\t\t\tpadding: 32px;\n\t\t}\n\n\t\t.bottom-nav {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\t.close-btn {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\t.overlay {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\+layout.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 90,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 90,
				"endColumn": 45
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 112,
				"column": 41,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 112,
				"endColumn": 60
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 286,
				"column": 7,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 296,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 331,
				"column": 9,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 350,
				"endColumn": 16
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 354,
				"column": 9,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 364,
				"endColumn": 16
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 392,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 392,
				"endColumn": 29
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 408,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 469,
				"endColumn": 12
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 417,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 417,
				"endColumn": 35
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 491,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 491,
				"endColumn": 34
			}
		],
		"suppressedMessages": [],
		"errorCount": 4,
		"fatalErrorCount": 0,
		"warningCount": 5,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { trips } from '$lib/stores/trips';\n\timport { base } from '$app/paths';\n\tconst resolve = (href: string) => `${base}${href}`;\n\timport { expenses } from '$lib/stores/expenses'; // [!code ++]\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { toasts } from '$lib/stores/toast';\n\timport {\n\t\tcalculateDashboardStats,\n\t\tformatCurrency,\n\t\tformatDate,\n\t\tcomputeMaintenance,\n\t\ttype TimeRange\n\t} from '$lib/utils/dashboardLogic';\n\n\tlet selectedRange: TimeRange = '30d';\n\n\t// [!code change] Pass $expenses to the calculator\n\t$: stats = calculateDashboardStats($trips, $expenses, selectedRange);\n\n\t// --- Maintenance reminder calculations (all-time) ---\n\t$: allStats = calculateDashboardStats($trips, $expenses, 'all');\n\t$: currentOdometer =\n\t\tNumber($userSettings.vehicleOdometerStart || 0) + Number(allStats.totalMiles || 0);\n\t$: maintenance = computeMaintenance({\n\t\tvehicleOdometerStart: $userSettings.vehicleOdometerStart,\n\t\ttotalMilesAllTime: allStats.totalMiles,\n\t\tlastServiceOdometer: $userSettings.lastServiceOdometer,\n\t\tserviceIntervalMiles: $userSettings.serviceIntervalMiles,\n\t\treminderThresholdMiles: $userSettings.reminderThresholdMiles\n\t});\n\n\timport { saveSettings } from './settings/lib/save-settings';\n\n\tasync function markServicedNow() {\n\t\tconst newOdo = Math.round(currentOdometer || 0);\n\t\tconst payload = { lastServiceOdometer: newOdo, lastServiceDate: new Date().toISOString() };\n\t\ttry {\n\t\t\tuserSettings.update((s) => ({ ...s, ...payload }));\n\t\t\tconst result = await saveSettings(payload);\n\t\t\tif (!result.ok) throw new Error(result.error);\n\t\t\ttoasts.success('Marked vehicle as serviced');\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\ttoasts.error('Could not mark serviced');\n\t\t}\n\t}\n\n\tconst rangeLabels = {\n\t\t// ... existing labels\n\t\t'7d': 'Last 7 days',\n\t\t'30d': 'Last 30 days',\n\t\t'60d': 'Last 60 days',\n\t\t'90d': 'Last 90 days',\n\t\t'1y': 'Current Year',\n\t\t'prev-1y': 'Previous Year',\n\t\tall: 'All Time'\n\t};\n</script>\n\n<svelte:head>\n\t<title>Dashboard - Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"dashboard\">\n\t<div class=\"page-header\">\n\t\t<div class=\"header-left\">\n\t\t\t<h1 class=\"page-title\">Dashboard</h1>\n\t\t\t<p class=\"page-subtitle\">\n\t\t\t\tOverview for <span class=\"highlight-text\">{rangeLabels[selectedRange]}</span>\n\t\t\t</p>\n\t\t</div>\n\n\t\t<div class=\"header-actions\">\n\t\t\t<select\n\t\t\t\tid=\"range-select\"\n\t\t\t\tname=\"selectedRange\"\n\t\t\t\tbind:value={selectedRange}\n\t\t\t\tclass=\"range-select\"\n\t\t\t\taria-label=\"Select time range\"\n\t\t\t>\n\t\t\t\t<option value=\"7d\">Last 7 Days</option>\n\t\t\t\t<option value=\"30d\">Last 30 Days</option>\n\t\t\t\t<option value=\"60d\">Last 60 Days</option>\n\t\t\t\t<option value=\"90d\">Last 90 Days</option>\n\t\t\t\t<option value=\"1y\">Current Year</option>\n\t\t\t\t<option value=\"prev-1y\">Previous Year</option>\n\t\t\t</select>\n\n\t\t\t<a href={resolve('/dashboard/trips/new')} class=\"btn-primary\">\n\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M10 4V16M4 10H16\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\tNew Trip\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\n\t{#if $userSettings.lastServiceOdometer && $userSettings.lastServiceOdometer > currentOdometer}\n\t\t<div\n\t\t\tclass=\"alert info\"\n\t\t\tstyle=\"background:#E0F2FE; color:#0369A1; border:1px solid #60A5FA; padding:12px; border-radius:8px; margin:16px 0;\"\n\t\t>\n\t\t\tNote: Your recorded last service odometer ({$userSettings.lastServiceOdometer.toLocaleString()})\n\t\t\tis higher than the current estimated odometer ({Math.round(currentOdometer).toLocaleString()} mi).\n\t\t\tIf this isn't expected, set <a href=\"/dashboard/settings\">Vehicle odometer start</a> in Settings\n\t\t\tor update your last service reading.\n\t\t</div>\n\t{/if}\n\n\t{#if maintenance.visible}\n\t\t<div\n\t\t\tclass=\"alert maintenance\"\n\t\t\tclass:error={maintenance.dueIn < 0}\n\t\t\tclass:warning={maintenance.dueIn >= 0 && maintenance.dueIn <= maintenance.reminderThreshold}\n\t\t\tstyle=\"display:flex; align-items:center; gap:12px; margin:16px 0; padding:12px; border-radius:10px; background:#FFFBEB; color:#92400E; border:1px solid #F59E0B;\"\n\t\t>\n\t\t\t<div style=\"font-weight:600\">{maintenance.message}</div>\n\t\t\t<div style=\"margin-left:auto\">\n\t\t\t\t<button class=\"btn-secondary\" on:click={markServicedNow}>Mark serviced now</button>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n\n\t<div class=\"stats-grid\">\n\t\t<div class=\"stat-card featured\">\n\t\t\t<div class=\"stat-header\">\n\t\t\t\t<div class=\"stat-icon orange\">\n\t\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M12 2L2 7L12 12L22 7L12 2Z\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M2 17L12 22L22 17\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M2 12L12 17L22 12\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"stat-label\">Total Profit</span>\n\t\t\t</div>\n\t\t\t<div class=\"stat-value\">{formatCurrency(stats.totalProfit)}</div>\n\n\t\t\t{#if selectedRange !== 'all'}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"stat-change\"\n\t\t\t\t\tclass:positive={stats.periodComparison.isPositive}\n\t\t\t\t\tclass:negative={!stats.periodComparison.isPositive}\n\t\t\t\t>\n\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n\t\t\t\t\t\t{#if stats.periodComparison.isPositive}\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M8 12V4M8 4L4 8M8 4L12 8\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M8 4V12M8 12L4 8M8 12L12 8\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</svg>\n\t\t\t\t\t{Math.abs(stats.periodComparison.change).toFixed(1)}% vs previous\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"stat-card\">\n\t\t\t<div class=\"stat-header\">\n\t\t\t\t<div class=\"stat-icon blue\">\n\t\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"stat-label\">Total Trips</span>\n\t\t\t</div>\n\t\t\t<div class=\"stat-value\">{stats.totalTrips}</div>\n\t\t\t<div class=\"stat-info\">{rangeLabels[selectedRange]}</div>\n\t\t</div>\n\n\t\t<div class=\"stat-card\">\n\t\t\t<div class=\"stat-header\">\n\t\t\t\t<div class=\"stat-icon green\">\n\t\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M13 2L3 14H12L11 22L21 10H12L13 2Z\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"stat-label\">Avg Profit/Trip</span>\n\t\t\t</div>\n\t\t\t<div class=\"stat-value\">{formatCurrency(stats.avgProfitPerTrip)}</div>\n\t\t\t<div class=\"stat-info\">{rangeLabels[selectedRange]}</div>\n\t\t</div>\n\n\t\t<div class=\"stat-card\">\n\t\t\t<div class=\"stat-header\">\n\t\t\t\t<div class=\"stat-icon purple\">\n\t\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M2 12H22\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"stat-label\">Total Miles</span>\n\t\t\t</div>\n\t\t\t<div class=\"stat-value\">\n\t\t\t\t{stats.totalMiles.toLocaleString(undefined, { maximumFractionDigits: 1 })}\n\t\t\t</div>\n\t\t\t<div class=\"stat-info\">{rangeLabels[selectedRange]}</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"charts-grid\">\n\t\t<div class=\"chart-card\">\n\t\t\t<div class=\"chart-header\">\n\t\t\t\t<div>\n\t\t\t\t\t<h2 class=\"chart-title\">Profit Trend</h2>\n\t\t\t\t\t<p class=\"chart-subtitle\">{rangeLabels[selectedRange]}</p>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-legend\">\n\t\t\t\t\t<div class=\"legend-item\">\n\t\t\t\t\t\t<div class=\"legend-dot orange\"></div>\n\t\t\t\t\t\t<span>Daily Profit</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"chart-container\">\n\t\t\t\t{#if stats.chartData.some((d) => d.profit !== 0)}\n\t\t\t\t\t{@const maxProfit = Math.max(...stats.chartData.map((d) => Math.abs(d.profit)), 1)}\n\t\t\t\t\t<div class=\"bar-chart\">\n\t\t\t\t\t\t{#each stats.chartData as day}\n\t\t\t\t\t\t\t{@const height = (Math.abs(day.profit) / maxProfit) * 100}\n\t\t\t\t\t\t\t<div class=\"bar-wrapper\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"bar\"\n\t\t\t\t\t\t\t\t\tclass:negative={day.profit < 0}\n\t\t\t\t\t\t\t\t\tstyle=\"height: {height}%; opacity: {day.profit === 0 ? 0 : 1}\"\n\t\t\t\t\t\t\t\t\ttitle=\"{formatDate(day.date)}: {formatCurrency(day.profit)}\"\n\t\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<div class=\"empty-state\">\n\t\t\t\t\t\t<svg width=\"48\" height=\"48\" viewBox=\"0 0 48 48\" fill=\"none\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M8 36V12M16 36V20M24 36V24M32 36V16M40 36V28\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<p>No data for this period</p>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"chart-card\">\n\t\t\t<div class=\"chart-header\">\n\t\t\t\t<div>\n\t\t\t\t\t<h2 class=\"chart-title\">Cost Breakdown</h2>\n\t\t\t\t\t<p class=\"chart-subtitle\">Expenses in period</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"chart-container\">\n\t\t\t\t{#if stats.totalCost > 0}\n\t\t\t\t\t{#key stats.costBreakdown}\n\t\t\t\t\t\t{@const radius = 70}\n\t\t\t\t\t\t{@const circumference = 2 * Math.PI * radius}\n\n\t\t\t\t\t\t<div class=\"donut-chart\">\n\t\t\t\t\t\t\t<svg viewBox=\"0 0 200 200\">\n\t\t\t\t\t\t\t\t{#each stats.costBreakdown as item, i}\n\t\t\t\t\t\t\t\t\t{@const prevItems = stats.costBreakdown.slice(0, i)}\n\t\t\t\t\t\t\t\t\t{@const offset = prevItems.reduce(\n\t\t\t\t\t\t\t\t\t\t(acc, curr) => acc + (curr.percentage / 100) * circumference,\n\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{@const length = (item.percentage / 100) * circumference}\n\n\t\t\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\t\t\tcx=\"100\"\n\t\t\t\t\t\t\t\t\t\tcy=\"100\"\n\t\t\t\t\t\t\t\t\t\tr={radius}\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tstroke={item.color}\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"30\"\n\t\t\t\t\t\t\t\t\t\tstroke-dasharray=\"{length} {circumference}\"\n\t\t\t\t\t\t\t\t\t\tstroke-dashoffset={-offset}\n\t\t\t\t\t\t\t\t\t\ttransform=\"rotate(-90 100 100)\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</svg>\n\n\t\t\t\t\t\t\t<div class=\"donut-legend\">\n\t\t\t\t\t\t\t\t{#each stats.costBreakdown as item}\n\t\t\t\t\t\t\t\t\t<div class=\"legend-item\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"legend-dot\" style=\"background: {item.color}\"></div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"legend-text\">\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"legend-label\" style=\"text-transform: capitalize\"\n\t\t\t\t\t\t\t\t\t\t\t\t>{item.category}</span\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"legend-value\">{formatCurrency(item.amount)}</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/key}\n\t\t\t\t{:else}\n\t\t\t\t\t<div class=\"empty-state\">\n\t\t\t\t\t\t<svg width=\"48\" height=\"48\" viewBox=\"0 0 48 48\" fill=\"none\">\n\t\t\t\t\t\t\t<circle cx=\"24\" cy=\"24\" r=\"20\" stroke=\"currentColor\" stroke-width=\"2\" />\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M24 14V24L30 30\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<p>No expenses for this period</p>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"section-card\">\n\t\t<div class=\"section-header\">\n\t\t\t<div>\n\t\t\t\t<h2 class=\"section-title\">Recent Trips</h2>\n\t\t\t\t<p class=\"section-subtitle\">Latest from selected period</p>\n\t\t\t</div>\n\t\t\t<a href=\"/dashboard/trips\" class=\"btn-secondary\">\n\t\t\t\tView All\n\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M6 12L10 8L6 4\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</a>\n\t\t</div>\n\n\t\t{#if stats.recentTrips.length > 0}\n\t\t\t<div class=\"trips-list\">\n\t\t\t\t{#each stats.recentTrips as trip}\n\t\t\t\t\t{@const earnings =\n\t\t\t\t\t\ttrip.stops?.reduce((s: number, stop: any) => s + (Number(stop.earnings) || 0), 0) || 0}\n\t\t\t\t\t{@const costs =\n\t\t\t\t\t\t(Number(trip.fuelCost) || 0) +\n\t\t\t\t\t\t(Number(trip.maintenanceCost) || 0) +\n\t\t\t\t\t\t(Number(trip.suppliesCost) || 0)}\n\t\t\t\t\t{@const profit = earnings - costs}\n\n\t\t\t\t\t<a href=\"/dashboard/trips?id={trip.id}\" class=\"trip-item\">\n\t\t\t\t\t\t<div class=\"trip-icon\">\n\t\t\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M17 9L9 2L1 9V17C1 17.5304 1.21071 18.0391 1.58579 18.4142C1.96086 18.7893 2.46957 19 3 19H15C15.5304 19 16.0391 18.7893 16.4142 18.4142C16.7893 18.0391 17 17.5304 17 17V9Z\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"trip-info\">\n\t\t\t\t\t\t\t<div class=\"trip-route\">\n\t\t\t\t\t\t\t\t<span class=\"trip-start\"\n\t\t\t\t\t\t\t\t\t>{typeof trip.startAddress === 'string'\n\t\t\t\t\t\t\t\t\t\t? trip.startAddress.split(',')[0]\n\t\t\t\t\t\t\t\t\t\t: 'Unknown'}</span\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"M6 12L10 8L6 4\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<span class=\"trip-destination\">\n\t\t\t\t\t\t\t\t\t{trip.stops && trip.stops.length > 0\n\t\t\t\t\t\t\t\t\t\t? typeof trip.stops[trip.stops.length - 1]?.address === 'string'\n\t\t\t\t\t\t\t\t\t\t\t? trip.stops[trip.stops.length - 1].address.split(',')[0]\n\t\t\t\t\t\t\t\t\t\t\t: 'Multiple stops'\n\t\t\t\t\t\t\t\t\t\t: 'No stops'}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"trip-meta\">\n\t\t\t\t\t\t\t\t<span>{formatDate(trip.date || '')}</span>\n\t\t\t\t\t\t\t\t<span>•</span>\n\t\t\t\t\t\t\t\t<span>{(Number(trip.totalMiles) || 0).toFixed(1)} mi</span>\n\t\t\t\t\t\t\t\t{#if trip.stops && trip.stops.length > 0}\n\t\t\t\t\t\t\t\t\t<span>•</span>\n\t\t\t\t\t\t\t\t\t<span>{trip.stops.length} stops</span>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"trip-profit\" class:positive={profit >= 0} class:negative={profit < 0}>\n\t\t\t\t\t\t\t{formatCurrency(profit)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"empty-state-large\">\n\t\t\t\t<svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" fill=\"none\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M8 24L32 8L56 24V48C56 49.0609 55.5786 50.0783 54.8284 50.8284C54.0783 51.5786 53.0609 52 52 52H12C10.9391 52 9.92172 51.5786 9.17157 50.8284C8.42143 50.0783 8 49.0609 8 48V24Z\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M24 52V32H40V52\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<h3>No trips found</h3>\n\t\t\t\t<p>No trips found in this date range.</p>\n\t\t\t\t<a href=\"/dashboard/trips/new\" class=\"btn-primary\">\n\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M10 4V16M4 10H16\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t\tCreate Trip\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t.bar.negative {\n\t\tbackground: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);\n\t}\n\n\t.dashboard {\n\t\tmax-width: 1400px;\n\t\tmargin: 0 auto;\n\t\tpadding: 16px;\n\t}\n\t.page-header {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t\tmargin-bottom: 24px;\n\t}\n\t.header-actions {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\twidth: 100%;\n\t}\n\t.range-select {\n\t\tflex: 1;\n\t\tpadding: 10px;\n\t\tborder-radius: 10px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tbackground: white;\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tcursor: pointer;\n\t}\n\t@media (min-width: 640px) {\n\t\t.page-header {\n\t\t\tflex-direction: row;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\t\t}\n\t\t.header-actions {\n\t\t\twidth: auto;\n\t\t}\n\t\t.range-select {\n\t\t\twidth: 160px;\n\t\t\tflex: none;\n\t\t}\n\t}\n\t.page-title {\n\t\tfont-size: 24px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t\tmargin-top: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tmargin: 0;\n\t}\n\t.highlight-text {\n\t\tcolor: #b0422a; /* darker orange for WCAG contrast */\n\t\tfont-weight: 600;\n\t}\n\t.btn-primary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 8px;\n\t\tpadding: 12px 16px;\n\t\tbackground: linear-gradient(135deg, var(--orange) 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\ttext-decoration: none;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tbox-shadow: 0 4px 12px rgba(255, 127, 80, 0.3);\n\t\twhite-space: nowrap;\n\t}\n\t.btn-primary:hover {\n\t\ttransform: translateY(-2px);\n\t\tbox-shadow: 0 8px 16px rgba(255, 127, 80, 0.4);\n\t}\n\t.btn-secondary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tpadding: 8px 16px;\n\t\tbackground: white;\n\t\tcolor: #6b7280;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\ttext-decoration: none;\n\t\ttransition: all 0.2s;\n\t}\n\t.btn-secondary:hover {\n\t\tborder-color: var(--orange);\n\t\tcolor: var(--orange);\n\t}\n\t.stats-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr;\n\t\tgap: 16px;\n\t\tmargin-bottom: 24px;\n\t}\n\t.stat-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 20px;\n\t\ttransition: all 0.2s;\n\t}\n\t.stat-card:hover {\n\t\tbox-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);\n\t\ttransform: translateY(-2px);\n\t}\n\t.stat-card.featured {\n\t\tbackground: linear-gradient(135deg, var(--orange) 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tbox-shadow: 0 8px 24px rgba(255, 127, 80, 0.3);\n\t}\n\t.stat-header {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tmargin-bottom: 12px;\n\t}\n\t.stat-icon {\n\t\twidth: 40px;\n\t\theight: 40px;\n\t\tborder-radius: 10px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcolor: white;\n\t}\n\t.stat-icon.orange {\n\t\tbackground: rgba(255, 127, 80, 0.2);\n\t}\n\t.stat-icon.blue {\n\t\tbackground: linear-gradient(135deg, var(--blue) 0%, #1e9bcf 100%);\n\t}\n\t.stat-icon.green {\n\t\tbackground: linear-gradient(135deg, var(--green) 0%, #7ab82e 100%);\n\t}\n\t.stat-icon.purple {\n\t\tbackground: linear-gradient(135deg, var(--purple) 0%, #764a89 100%);\n\t}\n\t.stat-card.featured .stat-icon {\n\t\tbackground: rgba(255, 255, 255, 0.2);\n\t}\n\t.stat-label {\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t}\n\t.stat-card.featured .stat-label {\n\t\tcolor: rgba(255, 255, 255, 0.9);\n\t}\n\t.stat-value {\n\t\tfont-size: 28px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t\t/* Reserve vertical space so numbers changing on load don't cause CLS */\n\t\tmin-height: 36px;\n\t\t/* Use tabular numbers to avoid width changes when digits update */\n\t\tfont-variant-numeric: tabular-nums;\n\t\twhite-space: nowrap;\n\t\tmin-width: 6ch;\n\t}\n\n\t.stat-change {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tfont-size: 13px;\n\t\tfont-weight: 600;\n\t\t/* Reserve space even when the element is visually empty */\n\t\tmin-height: 20px;\n\t\tmin-width: 6ch;\n\t}\n\n\t/* Reserve horizontal space when .stat-change is empty (prevents CLS) */\n\t.stat-change:empty::after {\n\t\tcontent: '\\00a0';\n\t\tdisplay: inline-block;\n\t\twidth: 6ch;\n\t\theight: 16px;\n\t\topacity: 0;\n\t}\n\t.stat-card.featured .stat-value {\n\t\tcolor: white;\n\t}\n\t.stat-change {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tfont-size: 13px;\n\t\tfont-weight: 600;\n\t}\n\t.stat-change.positive {\n\t\tcolor: rgba(255, 255, 255, 0.9);\n\t}\n\t.stat-change.negative {\n\t\tcolor: rgba(255, 255, 255, 0.8);\n\t}\n\t.stat-info {\n\t\tfont-size: 13px;\n\t\tcolor: #4b5563; /* darker gray for sufficient contrast */\n\t}\n\t.charts-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr;\n\t\tgap: 24px;\n\t\tmargin-bottom: 32px;\n\t}\n\t.chart-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 20px;\n\t}\n\t.chart-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: flex-start;\n\t\tmargin-bottom: 20px;\n\t\tflex-wrap: wrap;\n\t\tgap: 12px;\n\t}\n\t.chart-title {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0 0 4px 0;\n\t}\n\t.chart-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tmargin: 0;\n\t}\n\t.chart-legend {\n\t\tdisplay: flex;\n\t\tgap: 16px;\n\t}\n\t.legend-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-size: 13px;\n\t\tcolor: #6b7280;\n\t}\n\t.legend-dot {\n\t\twidth: 12px;\n\t\theight: 12px;\n\t\tborder-radius: 50%;\n\t}\n\t.legend-dot.orange {\n\t\tbackground: var(--orange);\n\t}\n\t.chart-container {\n\t\theight: 240px;\n\t\tposition: relative;\n\t}\n\t.bar-chart {\n\t\tdisplay: flex;\n\t\talign-items: flex-end;\n\t\tgap: 2px;\n\t\theight: 100%;\n\t\tpadding: 12px 0;\n\t}\n\t.bar-wrapper {\n\t\tflex: 1;\n\t\theight: 100%;\n\t\tdisplay: flex;\n\t\talign-items: flex-end;\n\t}\n\t.bar {\n\t\twidth: 100%;\n\t\tbackground: linear-gradient(180deg, var(--orange) 0%, #ff6a3d 100%);\n\t\tborder-radius: 4px 4px 0 0;\n\t\tmin-height: 4px;\n\t\ttransition: all 0.2s;\n\t\tcursor: pointer;\n\t}\n\t.bar:hover {\n\t\topacity: 0.8;\n\t}\n\t.donut-chart {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24px;\n\t\talign-items: center;\n\t\theight: 100%;\n\t\tjustify-content: center;\n\t}\n\t.donut-chart svg {\n\t\twidth: 180px;\n\t\theight: 180px;\n\t}\n\t.donut-legend {\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t}\n\t.donut-legend .legend-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\twidth: 100%;\n\t}\n\t.donut-legend .legend-dot {\n\t\twidth: 16px;\n\t\theight: 16px;\n\t\tborder-radius: 4px;\n\t\tflex-shrink: 0;\n\t}\n\t.legend-text {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\twidth: 100%;\n\t}\n\t.legend-label {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t}\n\t.legend-value {\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t}\n\t.section-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 20px;\n\t}\n\t.section-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 20px;\n\t}\n\t.section-title {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0 0 4px 0;\n\t}\n\t.section-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tmargin: 0;\n\t}\n\t.trips-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t}\n\t.trip-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t\tpadding: 16px;\n\t\tbackground: #f9fafb;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\ttext-decoration: none;\n\t\ttransition: all 0.2s;\n\t}\n\t.trip-item:hover {\n\t\tborder-color: var(--orange);\n\t\tbackground: white;\n\t\tbox-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\n\t}\n\t.trip-icon {\n\t\twidth: 40px;\n\t\theight: 40px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcolor: var(--orange);\n\t\tflex-shrink: 0;\n\t\talign-self: flex-start;\n\t}\n\t.trip-info {\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t\twidth: 100%;\n\t}\n\t.trip-route {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-weight: 600;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t\tflex-wrap: wrap;\n\t}\n\t.trip-route svg {\n\t\tcolor: #9ca3af;\n\t\tflex-shrink: 0;\n\t}\n\t.trip-start,\n\t.trip-destination {\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tmax-width: 100%;\n\t}\n\t.trip-meta {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-size: 13px;\n\t\tcolor: #4b5563; /* darker gray for sufficient contrast */\n\t}\n\t.trip-profit {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tflex-shrink: 0;\n\t\talign-self: flex-end;\n\t}\n\t.trip-profit.positive {\n\t\tcolor: #2e7d32; /* darker green for contrast */\n\t}\n\t.trip-profit.negative {\n\t\tcolor: #dc2626;\n\t}\n\t.empty-state {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\theight: 100%;\n\t\tcolor: #9ca3af;\n\t\ttext-align: center;\n\t}\n\t.empty-state svg {\n\t\tmargin-bottom: 12px;\n\t\tcolor: #d1d5db;\n\t}\n\t.empty-state p {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t}\n\t.empty-state-large {\n\t\tpadding: 48px 24px;\n\t\ttext-align: center;\n\t}\n\t.empty-state-large svg {\n\t\tcolor: #d1d5db;\n\t\tmargin: 0 auto 24px;\n\t}\n\t.empty-state-large h3 {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 8px;\n\t}\n\t.empty-state-large p {\n\t\tfont-size: 15px;\n\t\tcolor: #6b7280;\n\t\tmargin-bottom: 24px;\n\t}\n\t@media (min-width: 640px) {\n\t\t.page-title {\n\t\t\tfont-size: 32px;\n\t\t}\n\t\t.page-subtitle {\n\t\t\tfont-size: 16px;\n\t\t}\n\t\t.btn-primary {\n\t\t\tpadding: 12px 24px;\n\t\t\tfont-size: 15px;\n\t\t}\n\t\t.stats-grid {\n\t\t\tgrid-template-columns: repeat(2, 1fr);\n\t\t}\n\t\t.trip-item {\n\t\t\tflex-direction: row;\n\t\t\talign-items: center;\n\t\t}\n\t\t.trip-icon {\n\t\t\talign-self: center;\n\t\t}\n\t\t.trip-profit {\n\t\t\talign-self: center;\n\t\t}\n\t}\n\t@media (min-width: 1024px) {\n\t\t.stats-grid {\n\t\t\tgrid-template-columns: repeat(4, 1fr);\n\t\t}\n\t\t.charts-grid {\n\t\t\tgrid-template-columns: repeat(2, 1fr);\n\t\t}\n\t\t.donut-chart {\n\t\t\tflex-direction: row;\n\t\t\tjustify-content: flex-start;\n\t\t}\n\t\t.donut-chart svg {\n\t\t\twidth: 200px;\n\t\t\theight: 200px;\n\t\t}\n\t\t.legend-text {\n\t\t\tflex-direction: column;\n\t\t\talign-items: flex-start;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\data-management\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 23,
				"column": 22,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 23,
				"endColumn": 39
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 24,
				"column": 25,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 24,
				"endColumn": 42
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 25,
				"column": 24,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 25,
				"endColumn": 41
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 900,
				"column": 7,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 902,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1027,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1076,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1107,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1131,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1157,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1186,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1254,
				"column": 7,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1258,
				"endColumn": 14
			}
		],
		"suppressedMessages": [],
		"errorCount": 8,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<!-- src/routes/dashboard/data-management/+page.svelte -->\n<script lang=\"ts\">\n\timport { trips } from '$lib/stores/trips';\n\timport { expenses } from '$lib/stores/expenses';\n\timport { mileage } from '$lib/stores/mileage';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { user } from '$lib/stores/auth';\n\timport { browser } from '$app/environment';\n\timport { exportMileageCSV, parseMileageCSV } from './lib/mileage-export';\n\timport {\n\t\texportTripsPDF,\n\t\texportExpensesPDF,\n\t\texportMileagePDF,\n\t\texportTaxBundlePDF\n\t} from './lib/pdf-export';\n\timport { getVehicleDisplayName } from '$lib/utils/vehicle';\n\n\tlet exportFormat: 'csv' | 'pdf' = 'csv';\n\tlet dataType: 'trips' | 'expenses' | 'mileage' | 'tax-bundle' = 'trips';\n\tlet dateFrom = '';\n\tlet dateTo = '';\n\tlet taxYear = new Date().getFullYear(); // Default to current year\n\tlet selectedTrips = new Set<string>();\n\tlet selectedExpenses = new Set<string>();\n\tlet selectedMileage = new Set<string>();\n\tlet selectAll = false;\n\tconst includeSummary = true;\n\n\t// Search state\n\tlet searchQuery = '';\n\n\t// Update date range when tax year changes\n\t$: if (dataType === 'tax-bundle' && taxYear) {\n\t\tdateFrom = `${taxYear}-01-01`;\n\t\tdateTo = `${taxYear}-12-31`;\n\t}\n\n\t// Pagination state\n\tlet tripsDisplayCount = 10;\n\tlet expensesDisplayCount = 10;\n\tlet mileageDisplayCount = 10;\n\n\t// Import/Backup/Restore state\n\tlet importFile: FileList | null = null;\n\tlet importPreview: any[] = [];\n\tlet importType: 'trips' | 'expenses' | 'mileage' = 'trips';\n\tlet showImportPreview = false;\n\tlet restoreFile: FileList | null = null;\n\tlet showClearConfirm = false;\n\n\t// Search helper function - improved to search through nested objects and arrays\n\tfunction matchesSearch(item: any, query: string): boolean {\n\t\tif (!query.trim()) return true;\n\t\tconst lowerQuery = query.toLowerCase();\n\n\t\t// Helper to recursively extract searchable text from nested objects/arrays\n\t\tfunction extractText(obj: any, depth: number = 0): string {\n\t\t\tif (depth > 3) return ''; // Prevent infinite recursion\n\t\t\tif (obj === null || obj === undefined) return '';\n\t\t\tif (typeof obj === 'string' || typeof obj === 'number' || typeof obj === 'boolean') {\n\t\t\t\treturn String(obj).toLowerCase() + ' ';\n\t\t\t}\n\t\t\tif (Array.isArray(obj)) {\n\t\t\t\treturn obj.map((v) => extractText(v, depth + 1)).join(' ');\n\t\t\t}\n\t\t\tif (typeof obj === 'object') {\n\t\t\t\treturn Object.values(obj)\n\t\t\t\t\t.map((v) => extractText(v, depth + 1))\n\t\t\t\t\t.join(' ');\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tconst searchableText = extractText(item);\n\n\t\t// Also resolve vehicle names for search\n\t\tif (item.vehicle || item.vehicleId) {\n\t\t\tconst vehicleName = getVehicleDisplayName(\n\t\t\t\titem.vehicle || item.vehicleId,\n\t\t\t\t$userSettings.vehicles\n\t\t\t);\n\t\t\tif (vehicleName.toLowerCase().includes(lowerQuery)) return true;\n\t\t}\n\n\t\treturn searchableText.includes(lowerQuery);\n\t}\n\n\t// Filter trips by date and search\n\t$: filteredTrips = $trips.filter((trip) => {\n\t\tif (!trip.date) return false;\n\n\t\t// Extract YYYY-MM-DD for comparison (avoids timezone issues)\n\t\tconst tripDateStr = trip.date.includes('T') ? trip.date.split('T')[0]! : trip.date;\n\n\t\tif (dateFrom && tripDateStr < dateFrom) return false;\n\t\tif (dateTo && tripDateStr > dateTo) return false;\n\n\t\tif (!matchesSearch(trip, searchQuery)) return false;\n\n\t\treturn true;\n\t});\n\n\t// Filter expenses by date and search\n\t$: filteredExpenses = $expenses.filter((expense) => {\n\t\tif (!expense.date) return false;\n\n\t\t// Extract YYYY-MM-DD for comparison (avoids timezone issues)\n\t\tconst expenseDateStr = expense.date.includes('T') ? expense.date.split('T')[0]! : expense.date;\n\n\t\tif (dateFrom && expenseDateStr < dateFrom) return false;\n\t\tif (dateTo && expenseDateStr > dateTo) return false;\n\n\t\tif (!matchesSearch(expense, searchQuery)) return false;\n\n\t\treturn true;\n\t});\n\n\t// Filter mileage by date and search\n\t$: filteredMileage = $mileage.filter((m) => {\n\t\tif (!m.date) return false;\n\n\t\t// Extract YYYY-MM-DD for comparison (avoids timezone issues)\n\t\tconst mileageDateStr = m.date.includes('T') ? m.date.split('T')[0]! : m.date;\n\n\t\tif (dateFrom && mileageDateStr < dateFrom) return false;\n\t\tif (dateTo && mileageDateStr > dateTo) return false;\n\n\t\tif (!matchesSearch(m, searchQuery)) return false;\n\n\t\treturn true;\n\t});\n\n\t// Paginated data for display\n\t$: displayedTrips = filteredTrips.slice(0, tripsDisplayCount);\n\t$: displayedExpenses = filteredExpenses.slice(0, expensesDisplayCount);\n\t$: displayedMileage = filteredMileage.slice(0, mileageDisplayCount);\n\n\t// Reset pagination when filters change\n\t$: if (searchQuery || dateFrom || dateTo) {\n\t\ttripsDisplayCount = 10;\n\t\texpensesDisplayCount = 10;\n\t\tmileageDisplayCount = 10;\n\t}\n\n\t// Load more functions\n\tfunction loadMoreTrips() {\n\t\ttripsDisplayCount += 10;\n\t}\n\n\tfunction loadMoreExpenses() {\n\t\texpensesDisplayCount += 10;\n\t}\n\n\tfunction loadMoreMileage() {\n\t\tmileageDisplayCount += 10;\n\t}\n\n\t// Update selection when dataType changes\n\t$: if (dataType === 'tax-bundle') {\n\t\tselectedTrips = new Set(filteredTrips.map((t) => t.id));\n\t\tselectedExpenses = new Set(filteredExpenses.map((e) => e.id));\n\t\tselectedMileage = new Set(filteredMileage.map((m) => m.id));\n\t\tselectAll = true;\n\t}\n\n\t// Handle select all for current data type\n\t$: if (selectAll && dataType !== 'tax-bundle') {\n\t\tif (dataType === 'trips') {\n\t\t\tselectedTrips = new Set(filteredTrips.map((t) => t.id));\n\t\t} else if (dataType === 'expenses') {\n\t\t\tselectedExpenses = new Set(filteredExpenses.map((e) => e.id));\n\t\t} else if (dataType === 'mileage') {\n\t\t\tselectedMileage = new Set(filteredMileage.map((m) => m.id));\n\t\t}\n\t}\n\n\tfunction toggleSelectAll() {\n\t\tif (dataType === 'trips') {\n\t\t\tif (selectAll) {\n\t\t\t\tselectedTrips = new Set();\n\t\t\t} else {\n\t\t\t\tselectedTrips = new Set(filteredTrips.map((t) => t.id));\n\t\t\t}\n\t\t} else if (dataType === 'expenses') {\n\t\t\tif (selectAll) {\n\t\t\t\tselectedExpenses = new Set();\n\t\t\t} else {\n\t\t\t\tselectedExpenses = new Set(filteredExpenses.map((e) => e.id));\n\t\t\t}\n\t\t} else if (dataType === 'mileage') {\n\t\t\tif (selectAll) {\n\t\t\t\tselectedMileage = new Set();\n\t\t\t} else {\n\t\t\t\tselectedMileage = new Set(filteredMileage.map((m) => m.id));\n\t\t\t}\n\t\t}\n\t\tselectAll = !selectAll;\n\t}\n\n\tfunction toggleTrip(id: string) {\n\t\tif (selectedTrips.has(id)) {\n\t\t\tselectedTrips.delete(id);\n\t\t\tselectedTrips = selectedTrips;\n\t\t} else {\n\t\t\tselectedTrips.add(id);\n\t\t\tselectedTrips = selectedTrips;\n\t\t}\n\t}\n\n\tfunction toggleExpense(id: string) {\n\t\tif (selectedExpenses.has(id)) {\n\t\t\tselectedExpenses.delete(id);\n\t\t\tselectedExpenses = selectedExpenses;\n\t\t} else {\n\t\t\tselectedExpenses.add(id);\n\t\t\tselectedExpenses = selectedExpenses;\n\t\t}\n\t}\n\n\tfunction toggleMileage(id: string) {\n\t\tif (selectedMileage.has(id)) {\n\t\t\tselectedMileage.delete(id);\n\t\t\tselectedMileage = selectedMileage;\n\t\t} else {\n\t\t\tselectedMileage.add(id);\n\t\t\tselectedMileage = selectedMileage;\n\t\t}\n\t}\n\n\tfunction formatCurrency(amount: number): string {\n\t\treturn new Intl.NumberFormat('en-US', {\n\t\t\tstyle: 'currency',\n\t\t\tcurrency: 'USD',\n\t\t\tminimumFractionDigits: 2\n\t\t}).format(amount);\n\t}\n\n\tfunction formatDate(dateString: string): string {\n\t\treturn new Date(dateString).toLocaleDateString();\n\t}\n\n\tfunction exportTripsCSV() {\n\t\tconst tripsToExport = filteredTrips.filter((t) => selectedTrips.has(t.id));\n\n\t\tif (tripsToExport.length === 0) {\n\t\t\talert('Please select at least one trip to export');\n\t\t\treturn;\n\t\t}\n\n\t\tlet csv =\n\t\t\t'Date,Start Time,End Time,Start Address,Stops,Miles,Earnings,Fuel Cost,Maintenance,Supplies,Total Costs,Net Profit,Notes\\n';\n\n\t\tlet totalMiles = 0;\n\t\tlet totalEarnings = 0;\n\t\tlet totalFuel = 0;\n\t\tlet totalMaintenance = 0;\n\t\tlet totalSupplies = 0;\n\t\tlet totalProfit = 0;\n\n\t\ttripsToExport.forEach((trip) => {\n\t\t\tconst earnings = trip.stops?.reduce((sum, stop) => sum + (stop.earnings || 0), 0) || 0;\n\t\t\tconst costs =\n\t\t\t\t((trip as any)['fuelCost'] || 0) +\n\t\t\t\t((trip as any)['maintenanceCost'] || 0) +\n\t\t\t\t((trip as any)['suppliesCost'] || 0);\n\t\t\tconst profit = earnings - costs;\n\n\t\t\ttotalMiles += (trip as any).totalMiles || 0;\n\t\t\ttotalEarnings += earnings;\n\t\t\ttotalFuel += (trip as any)['fuelCost'] || 0;\n\t\t\ttotalMaintenance += (trip as any)['maintenanceCost'] || 0;\n\t\t\ttotalSupplies += (trip as any)['suppliesCost'] || 0;\n\t\t\ttotalProfit += profit;\n\n\t\t\tconst row = [\n\t\t\t\tformatDate(trip.date || ''),\n\t\t\t\ttrip.startTime || '',\n\t\t\t\ttrip.endTime || '',\n\t\t\t\t`\"${trip.startAddress || ''}\"`,\n\t\t\t\ttrip.stops?.length || 0,\n\t\t\t\t(Number((trip as any).totalMiles) || 0).toFixed(2),\n\t\t\t\tearnings.toFixed(2),\n\t\t\t\t(Number((trip as any)['fuelCost']) || 0).toFixed(2),\n\t\t\t\t(Number((trip as any)['maintenanceCost']) || 0).toFixed(2),\n\t\t\t\t(Number((trip as any)['suppliesCost']) || 0).toFixed(2),\n\t\t\t\t(Number(costs) || 0).toFixed(2),\n\t\t\t\t(Number(profit) || 0).toFixed(2),\n\t\t\t\t`\"${trip.notes || ''}\"`\n\t\t\t];\n\n\t\t\tcsv += row.join(',') + '\\n';\n\t\t});\n\n\t\tif (includeSummary) {\n\t\t\tcsv += '\\n';\n\t\t\tcsv += 'SUMMARY\\n';\n\t\t\tcsv += `Total Trips,${tripsToExport.length}\\n`;\n\t\t\tcsv += `Total Miles,${totalMiles.toFixed(2)}\\n`;\n\t\t\tcsv += `Total Earnings,${totalEarnings.toFixed(2)}\\n`;\n\t\t\tcsv += `Total Fuel Cost,${totalFuel.toFixed(2)}\\n`;\n\t\t\tcsv += `Total Maintenance,${totalMaintenance.toFixed(2)}\\n`;\n\t\t\tcsv += `Total Supplies,${totalSupplies.toFixed(2)}\\n`;\n\t\t\tcsv += `Total Costs,${(totalFuel + totalMaintenance + totalSupplies).toFixed(2)}\\n`;\n\t\t\tcsv += `Net Profit,${totalProfit.toFixed(2)}\\n`;\n\t\t}\n\n\t\treturn csv;\n\t}\n\n\tfunction exportExpensesCSV() {\n\t\tconst expensesToExport = filteredExpenses.filter((e) => selectedExpenses.has(e.id));\n\n\t\tif (expensesToExport.length === 0) {\n\t\t\talert('Please select at least one expense to export');\n\t\t\treturn;\n\t\t}\n\n\t\tlet csv = 'Date,Category,Amount,Description\\n';\n\n\t\tconst totalByCategory: Record<string, number> = {};\n\t\tlet grandTotal = 0;\n\n\t\texpensesToExport.forEach((expense) => {\n\t\t\tconst row = [\n\t\t\t\tformatDate(expense.date),\n\t\t\t\t`\"${expense.category}\"`,\n\t\t\t\texpense.amount.toFixed(2),\n\t\t\t\t`\"${expense.description || ''}\"`\n\t\t\t];\n\n\t\t\tcsv += row.join(',') + '\\n';\n\n\t\t\t// Track totals by category\n\t\t\ttotalByCategory[expense.category] = (totalByCategory[expense.category] || 0) + expense.amount;\n\t\t\tgrandTotal += expense.amount;\n\t\t});\n\n\t\tif (includeSummary) {\n\t\t\tcsv += '\\n';\n\t\t\tcsv += 'SUMMARY BY CATEGORY\\n';\n\t\t\tObject.entries(totalByCategory).forEach(([category, total]) => {\n\t\t\t\tcsv += `${category},${total.toFixed(2)}\\n`;\n\t\t\t});\n\t\t\tcsv += '\\n';\n\t\t\tcsv += `Total Expenses,${grandTotal.toFixed(2)}\\n`;\n\t\t}\n\n\t\treturn csv;\n\t}\n\n\tfunction exportTaxBundle() {\n\t\tconst tripsToExport = filteredTrips.filter((t) => selectedTrips.has(t.id));\n\t\tconst expensesToExport = filteredExpenses.filter((e) => selectedExpenses.has(e.id));\n\t\tconst mileageToExport = filteredMileage.filter((m) => selectedMileage.has(m.id));\n\n\t\tif (\n\t\t\ttripsToExport.length === 0 &&\n\t\t\texpensesToExport.length === 0 &&\n\t\t\tmileageToExport.length === 0\n\t\t) {\n\t\t\talert('No data available in the selected date range');\n\t\t\treturn;\n\t\t}\n\n\t\t// Generate PDF tax bundle\n\t\tconst pdfBlob = exportTaxBundlePDF(\n\t\t\ttripsToExport,\n\t\t\texpensesToExport,\n\t\t\tmileageToExport,\n\t\t\t$userSettings.vehicles,\n\t\t\tdateFrom,\n\t\t\tdateTo\n\t\t);\n\n\t\tconst url = URL.createObjectURL(pdfBlob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `tax-bundle-${Date.now()}.pdf`;\n\t\ta.click();\n\t\tURL.revokeObjectURL(url);\n\t}\n\n\tfunction handleExport() {\n\t\tif (dataType === 'tax-bundle') {\n\t\t\texportTaxBundle();\n\t\t} else if (dataType === 'trips') {\n\t\t\tconst tripsToExport = filteredTrips.filter((t) => selectedTrips.has(t.id));\n\t\t\tif (tripsToExport.length === 0) {\n\t\t\t\talert('Please select at least one trip to export');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (exportFormat === 'csv') {\n\t\t\t\tconst csv = exportTripsCSV();\n\t\t\t\tif (csv) {\n\t\t\t\t\tconst blob = new Blob([csv], { type: 'text/csv' });\n\t\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\t\tconst a = document.createElement('a');\n\t\t\t\t\ta.href = url;\n\t\t\t\t\ta.download = `trips-export-${Date.now()}.csv`;\n\t\t\t\t\ta.click();\n\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t}\n\t\t\t} else if (exportFormat === 'pdf') {\n\t\t\t\tconst pdfBlob = exportTripsPDF(tripsToExport, dateFrom, dateTo);\n\t\t\t\tconst url = URL.createObjectURL(pdfBlob);\n\t\t\t\tconst a = document.createElement('a');\n\t\t\t\ta.href = url;\n\t\t\t\ta.download = `trips-export-${Date.now()}.pdf`;\n\t\t\t\ta.click();\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t}\n\t\t} else if (dataType === 'expenses') {\n\t\t\tconst expensesToExport = filteredExpenses.filter((e) => selectedExpenses.has(e.id));\n\t\t\tif (expensesToExport.length === 0) {\n\t\t\t\talert('Please select at least one expense to export');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (exportFormat === 'csv') {\n\t\t\t\tconst csv = exportExpensesCSV();\n\t\t\t\tif (csv) {\n\t\t\t\t\tconst blob = new Blob([csv], { type: 'text/csv' });\n\t\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\t\tconst a = document.createElement('a');\n\t\t\t\t\ta.href = url;\n\t\t\t\t\ta.download = `expenses-export-${Date.now()}.csv`;\n\t\t\t\t\ta.click();\n\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t}\n\t\t\t} else if (exportFormat === 'pdf') {\n\t\t\t\tconst pdfBlob = exportExpensesPDF(expensesToExport, dateFrom, dateTo);\n\t\t\t\tconst url = URL.createObjectURL(pdfBlob);\n\t\t\t\tconst a = document.createElement('a');\n\t\t\t\ta.href = url;\n\t\t\t\ta.download = `expenses-export-${Date.now()}.pdf`;\n\t\t\t\ta.click();\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t}\n\t\t} else if (dataType === 'mileage') {\n\t\t\tconst mileageToExport = filteredMileage.filter((m) => selectedMileage.has(m.id));\n\t\t\tif (mileageToExport.length === 0) {\n\t\t\t\talert('Please select at least one mileage log to export');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (exportFormat === 'csv') {\n\t\t\t\tconst csv = exportMileageCSV(\n\t\t\t\t\tmileageToExport,\n\t\t\t\t\tselectedMileage,\n\t\t\t\t\tincludeSummary,\n\t\t\t\t\tformatDate,\n\t\t\t\t\tformatCurrency\n\t\t\t\t);\n\t\t\t\tif (csv) {\n\t\t\t\t\tconst blob = new Blob([csv], { type: 'text/csv' });\n\t\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\t\tconst a = document.createElement('a');\n\t\t\t\t\ta.href = url;\n\t\t\t\t\ta.download = `mileage-export-${Date.now()}.csv`;\n\t\t\t\t\ta.click();\n\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t}\n\t\t\t} else if (exportFormat === 'pdf') {\n\t\t\t\tconst pdfBlob = exportMileagePDF(mileageToExport, $userSettings.vehicles, dateFrom, dateTo);\n\t\t\t\tconst url = URL.createObjectURL(pdfBlob);\n\t\t\t\tconst a = document.createElement('a');\n\t\t\t\ta.href = url;\n\t\t\t\ta.download = `mileage-export-${Date.now()}.pdf`;\n\t\t\t\ta.click();\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t}\n\t\t}\n\t}\n\n\t// ============ Import CSV Functions ============\n\tasync function handleImportFile(event: Event) {\n\t\tconst input = event.target as HTMLInputElement;\n\t\tconst file = input.files?.[0];\n\t\tif (!file) return;\n\n\t\tconst text = await file.text();\n\n\t\tif (importType === 'mileage') {\n\t\t\ttry {\n\t\t\t\tconst parsed = parseMileageCSV(text);\n\t\t\t\timportPreview = parsed.slice(0, 10);\n\t\t\t\tshowImportPreview = true;\n\t\t\t} catch (error) {\n\t\t\t\talert('Failed to parse mileage CSV: ' + (error as Error).message);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst lines = text.split('\\n').filter((line) => line.trim());\n\t\tif (lines.length < 2) {\n\t\t\talert('CSV file is empty or invalid');\n\t\t\treturn;\n\t\t}\n\n\t\tconst headers = lines[0]?.split(',').map((h) => h.trim().toLowerCase()) ?? [];\n\t\tconst data = lines.slice(1).map((line) => {\n\t\t\tconst values = line.split(',');\n\t\t\tconst obj: any = {};\n\t\t\theaders.forEach((h, i) => {\n\t\t\t\tobj[h] = values[i]?.replace(/^\"|\"$/g, '').trim();\n\t\t\t});\n\t\t\treturn obj;\n\t\t});\n\n\t\timportPreview = data.slice(0, 10); // Show first 10 rows\n\t\tshowImportPreview = true;\n\t}\n\n\tasync function confirmImport() {\n\t\tif (!browser) return;\n\n\t\tconst text = await importFile?.[0]?.text();\n\t\tif (!text) return;\n\n\t\tconst userId = $user?.id;\n\t\tif (!userId) {\n\t\t\talert('User not authenticated');\n\t\t\treturn;\n\t\t}\n\n\t\tif (importType === 'mileage') {\n\t\t\ttry {\n\t\t\t\tconst parsed = parseMileageCSV(text);\n\t\t\t\tfor (const mileageLog of parsed) {\n\t\t\t\t\tawait mileage.create(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdate: mileageLog.date,\n\t\t\t\t\t\t\tvehicle: mileageLog.vehicle,\n\t\t\t\t\t\t\tstartOdometer: mileageLog.startOdometer,\n\t\t\t\t\t\t\tendOdometer: mileageLog.endOdometer,\n\t\t\t\t\t\t\tmiles: mileageLog.miles,\n\t\t\t\t\t\t\tpurpose: mileageLog['purpose'],\n\t\t\t\t\t\t\tnotes: mileageLog.notes\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuserId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\talert(`Imported ${parsed.length} mileage logs successfully`);\n\t\t\t\tshowImportPreview = false;\n\t\t\t\timportFile = null;\n\t\t\t\treturn;\n\t\t\t} catch (error) {\n\t\t\t\talert('Failed to import mileage CSV: ' + (error as Error).message);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst lines = text.split('\\n').filter((line) => line.trim());\n\t\tconst headers = lines[0]?.split(',').map((h) => h.trim().toLowerCase()) ?? [];\n\t\tconst data = lines.slice(1).map((line) => {\n\t\t\tconst values = line.split(',');\n\t\t\tconst obj: any = {};\n\t\t\theaders.forEach((h, i) => {\n\t\t\t\tobj[h] = values[i]?.replace(/^\"|\"$/g, '').trim();\n\t\t\t});\n\t\t\treturn obj;\n\t\t});\n\n\t\t// Import based on type\n\t\tif (importType === 'trips') {\n\t\t\tfor (const row of data) {\n\t\t\t\tawait trips.create(\n\t\t\t\t\t{\n\t\t\t\t\t\tdate: row.date || new Date().toISOString().split('T')[0],\n\t\t\t\t\t\tstartTime: row['start time'] || row.starttime || '',\n\t\t\t\t\t\tendTime: row['end time'] || row.endtime || '',\n\t\t\t\t\t\tstartAddress: row['start address'] || row.startaddress || '',\n\t\t\t\t\t\ttotalMiles: parseFloat(row.miles || row.totalmiles || '0'),\n\t\t\t\t\t\tnotes: row.notes || '',\n\t\t\t\t\t\tstops: []\n\t\t\t\t\t},\n\t\t\t\t\tuserId\n\t\t\t\t);\n\t\t\t}\n\t\t\talert(`Imported ${data.length} trips successfully`);\n\t\t} else if (importType === 'expenses') {\n\t\t\tfor (const row of data) {\n\t\t\t\tawait expenses.create(\n\t\t\t\t\t{\n\t\t\t\t\t\tdate: row.date || new Date().toISOString().split('T')[0],\n\t\t\t\t\t\tcategory: row.category || 'other',\n\t\t\t\t\t\tamount: parseFloat(row.amount || '0'),\n\t\t\t\t\t\tdescription: row.description || ''\n\t\t\t\t\t},\n\t\t\t\t\tuserId\n\t\t\t\t);\n\t\t\t}\n\t\t\talert(`Imported ${data.length} expenses successfully`);\n\t\t}\n\n\t\tshowImportPreview = false;\n\t\timportFile = null;\n\t}\n\n\t// ============ Backup Full Data ============\n\tasync function backupFullData() {\n\t\tif (!browser) return;\n\n\t\tconst userId = $user?.id;\n\t\tif (!userId) {\n\t\t\talert('User not authenticated');\n\t\t\treturn;\n\t\t}\n\n\t\tconst backup = {\n\t\t\tmetadata: {\n\t\t\t\texportDate: new Date().toISOString(),\n\t\t\t\tappVersion: '1.0.0',\n\t\t\t\tschemaVersion: '1.0'\n\t\t\t},\n\t\t\ttrips: $trips,\n\t\t\texpenses: $expenses,\n\t\t\tmileage: $mileage,\n\t\t\tsettings: $userSettings\n\t\t};\n\n\t\tconst blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `go-route-yourself-backup-${Date.now()}.json`;\n\t\ta.click();\n\t\tURL.revokeObjectURL(url);\n\t}\n\n\t// ============ Restore Full Data ============\n\tasync function handleRestoreFile(event: Event) {\n\t\tconst input = event.target as HTMLInputElement;\n\t\tconst file = input.files?.[0];\n\t\tif (!file) return;\n\n\t\tif (\n\t\t\t!confirm(\n\t\t\t\t'This will replace ALL your current data with the backup. This cannot be undone. Continue?'\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst text = await file.text();\n\t\t\tconst backup = JSON.parse(text);\n\n\t\t\tconst userId = $user?.id;\n\t\t\tif (!userId) {\n\t\t\t\talert('You must be signed in to restore data.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Validate backup structure\n\t\t\tif (!backup || !backup.trips || !backup.expenses) {\n\t\t\t\talert('Invalid backup file format');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Restore data by loading from backup\n\t\t\tawait trips.load(userId);\n\t\t\tawait expenses.load(userId);\n\t\t\tawait mileage.load(userId);\n\t\t\tif (backup.settings) userSettings.set(backup.settings);\n\n\t\t\talert('Data restored successfully! Please refresh the page.');\n\t\t} catch (error) {\n\t\t\tconsole.error('Restore error:', error);\n\t\t\talert('Failed to restore backup. Please check the file format.');\n\t\t}\n\t}\n\n\t// ============ Clear Local Data ============\n\tfunction confirmClearData() {\n\t\tshowClearConfirm = true;\n\t}\n\n\tasync function clearLocalData() {\n\t\tif (!browser) return;\n\n\t\tconst userId = $user?.id;\n\t\tif (!userId) return;\n\n\t\ttrips.clear();\n\t\texpenses.clear();\n\t\tmileage.clear();\n\n\t\tshowClearConfirm = false;\n\t\talert('All local data has been cleared.');\n\t}\n</script>\n\n<svelte:head>\n\t<title>Data Management - Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"export-page\">\n\t<!-- Header -->\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">Data Management</h1>\n\t\t\t<p class=\"page-subtitle\">Export, import, backup, and restore your trip data and expenses</p>\n\t\t</div>\n\t</div>\n\n\t<div class=\"export-grid\">\n\t\t<!-- Export Options -->\n\t\t<div class=\"options-card\">\n\t\t\t<h2 class=\"card-title\">Export Options</h2>\n\n\t\t\t<!-- Data Type Selection -->\n\t\t\t<fieldset class=\"option-group\">\n\t\t\t\t<legend class=\"option-label\">Data Type</legend>\n\t\t\t\t<div class=\"data-type-buttons\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"type-btn\"\n\t\t\t\t\t\tclass:active={dataType === 'trips'}\n\t\t\t\t\t\ton:click={() => (dataType = 'trips')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path>\n\t\t\t\t\t\t\t<polyline points=\"9 22 9 12 15 12 15 22\"></polyline>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"type-name\">Trips</div>\n\t\t\t\t\t\t\t<div class=\"type-desc\">Mileage & routes</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"type-btn\"\n\t\t\t\t\t\tclass:active={dataType === 'expenses'}\n\t\t\t\t\t\ton:click={() => (dataType = 'expenses')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<rect x=\"2\" y=\"7\" width=\"20\" height=\"15\" rx=\"2\" ry=\"2\"></rect>\n\t\t\t\t\t\t\t<path d=\"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16\"></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"type-name\">Expenses</div>\n\t\t\t\t\t\t\t<div class=\"type-desc\">Business costs</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"type-btn\"\n\t\t\t\t\t\tclass:active={dataType === 'mileage'}\n\t\t\t\t\t\ton:click={() => (dataType = 'mileage')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n\t\t\t\t\t\t\t<polyline points=\"12 6 12 12 16 14\"></polyline>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"type-name\">Mileage</div>\n\t\t\t\t\t\t\t<div class=\"type-desc\">Odometer logs</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"type-btn tax-bundle\"\n\t\t\t\t\t\tclass:active={dataType === 'tax-bundle'}\n\t\t\t\t\t\ton:click={() => (dataType = 'tax-bundle')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n\t\t\t\t\t\t\t<polyline points=\"14 2 14 8 20 8\"></polyline>\n\t\t\t\t\t\t\t<line x1=\"9\" y1=\"15\" x2=\"15\" y2=\"15\"></line>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"type-name\">Tax Bundle</div>\n\t\t\t\t\t\t\t<div class=\"type-desc\">Professional PDF report</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n\n\t\t\t{#if dataType !== 'tax-bundle'}\n\t\t\t\t<fieldset class=\"option-group\">\n\t\t\t\t\t<legend class=\"option-label\">Format</legend>\n\t\t\t\t\t<div class=\"format-buttons\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"format-btn\"\n\t\t\t\t\t\t\tclass:active={exportFormat === 'csv'}\n\t\t\t\t\t\t\ton:click={() => (exportFormat = 'csv')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n\t\t\t\t\t\t\t\t<polyline points=\"14 2 14 8 20 8\"></polyline>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"format-name\">CSV</div>\n\t\t\t\t\t\t\t\t<div class=\"format-desc\">Spreadsheet format</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"format-btn\"\n\t\t\t\t\t\t\tclass:active={exportFormat === 'pdf'}\n\t\t\t\t\t\t\ton:click={() => (exportFormat = 'pdf')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n\t\t\t\t\t\t\t\t<polyline points=\"14 2 14 8 20 8\"></polyline>\n\t\t\t\t\t\t\t\t<line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\n\t\t\t\t\t\t\t\t<line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\n\t\t\t\t\t\t\t\t<polyline points=\"10 9 9 9 8 9\"></polyline>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"format-name\">PDF</div>\n\t\t\t\t\t\t\t\t<div class=\"format-desc\">Professional report</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</fieldset>\n\t\t\t{/if}\n\n\t\t\t<button\n\t\t\t\tclass=\"btn-export\"\n\t\t\t\ton:click={handleExport}\n\t\t\t\tdisabled={dataType === 'trips'\n\t\t\t\t\t? selectedTrips.size === 0\n\t\t\t\t\t: dataType === 'expenses'\n\t\t\t\t\t\t? selectedExpenses.size === 0\n\t\t\t\t\t\t: dataType === 'mileage'\n\t\t\t\t\t\t\t? selectedMileage.size === 0\n\t\t\t\t\t\t\t: filteredTrips.length === 0 && filteredExpenses.length === 0}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t>\n\t\t\t\t\t<path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n\t\t\t\t\t<polyline points=\"7 10 12 15 17 10\"></polyline>\n\t\t\t\t\t<line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\n\t\t\t\t</svg>\n\t\t\t\t{#if dataType === 'tax-bundle'}\n\t\t\t\t\tExport Tax Bundle PDF\n\t\t\t\t{:else if dataType === 'trips'}\n\t\t\t\t\tExport {selectedTrips.size} Trips ({exportFormat.toUpperCase()})\n\t\t\t\t{:else if dataType === 'expenses'}\n\t\t\t\t\tExport {selectedExpenses.size} Expenses ({exportFormat.toUpperCase()})\n\t\t\t\t{:else}\n\t\t\t\t\tExport {selectedMileage.size} Mileage Logs ({exportFormat.toUpperCase()})\n\t\t\t\t{/if}\n\t\t\t</button>\n\n\t\t\t<!-- Selection Card -->\n\t\t\t{#if dataType === 'tax-bundle'}\n\t\t\t\t<div class=\"year-selector\">\n\t\t\t\t\t<label for=\"tax-year\" class=\"year-label\">Tax Year</label>\n\t\t\t\t\t<select id=\"tax-year\" bind:value={taxYear} class=\"year-select\">\n\t\t\t\t\t\t{#each Array.from({ length: 10 }, (_, i) => new Date().getFullYear() - i) as year}\n\t\t\t\t\t\t\t<option value={year}>{year}</option>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"bundle-preview\">\n\t\t\t\t\t<div class=\"preview-section\">\n\t\t\t\t\t\t<div class=\"preview-header\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"18\"\n\t\t\t\t\t\t\t\theight=\"18\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<span>Mileage Log</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"preview-stats\">\n\t\t\t\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t\t\t\t<div class=\"stat-value\">{filteredTrips.length}</div>\n\t\t\t\t\t\t\t\t<div class=\"stat-label\">Trips</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t\t\t\t<div class=\"stat-value\">\n\t\t\t\t\t\t\t\t\t{filteredTrips.reduce((sum, t) => sum + (t.totalMiles || 0), 0).toFixed(0)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"stat-label\">Miles</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"preview-section\">\n\t\t\t\t\t\t<div class=\"preview-header\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"18\"\n\t\t\t\t\t\t\t\theight=\"18\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<rect x=\"2\" y=\"7\" width=\"20\" height=\"15\" rx=\"2\" ry=\"2\"></rect>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<span>Expense Log</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"preview-stats\">\n\t\t\t\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t\t\t\t<div class=\"stat-value\">{filteredExpenses.length}</div>\n\t\t\t\t\t\t\t\t<div class=\"stat-label\">Expenses</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t\t\t\t<div class=\"stat-value\">\n\t\t\t\t\t\t\t\t\t{formatCurrency(filteredExpenses.reduce((sum, e) => sum + e.amount, 0))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"stat-label\">Total</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"preview-section highlight\">\n\t\t\t\t\t\t<div class=\"preview-header\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"18\"\n\t\t\t\t\t\t\t\theight=\"18\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n\t\t\t\t\t\t\t\t<polyline points=\"14 2 14 8 20 8\"></polyline>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<span>Tax Summary</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"preview-deduction\">\n\t\t\t\t\t\t\t<div class=\"deduction-label\">Estimated Total Deduction</div>\n\t\t\t\t\t\t\t<div class=\"deduction-value\">\n\t\t\t\t\t\t\t\t{formatCurrency(\n\t\t\t\t\t\t\t\t\tfilteredTrips.reduce((sum, t) => sum + (t.totalMiles || 0), 0) * 0.67 +\n\t\t\t\t\t\t\t\t\t\tfilteredExpenses.reduce((sum, e) => sum + e.amount, 0)\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"selection-header\">\n\t\t\t\t\t<h2 class=\"card-title\">\n\t\t\t\t\t\tSelect {dataType === 'trips'\n\t\t\t\t\t\t\t? 'Trips'\n\t\t\t\t\t\t\t: dataType === 'expenses'\n\t\t\t\t\t\t\t\t? 'Expenses'\n\t\t\t\t\t\t\t\t: 'Mileage Logs'}\n\t\t\t\t\t\t({dataType === 'trips'\n\t\t\t\t\t\t\t? filteredTrips.length\n\t\t\t\t\t\t\t: dataType === 'expenses'\n\t\t\t\t\t\t\t\t? filteredExpenses.length\n\t\t\t\t\t\t\t\t: filteredMileage.length})\n\t\t\t\t\t</h2>\n\t\t\t\t\t{#if (dataType === 'trips' && filteredTrips.length > 0) || (dataType === 'expenses' && filteredExpenses.length > 0) || (dataType === 'mileage' && filteredMileage.length > 0)}\n\t\t\t\t\t\t<button class=\"btn-select-all\" on:click={toggleSelectAll}>\n\t\t\t\t\t\t\t{selectAll ? 'Deselect All' : 'Select All'}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Search Input -->\n\t\t\t\t<div class=\"search-container\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tbind:value={searchQuery}\n\t\t\t\t\t\tplaceholder=\"Search {dataType === 'trips'\n\t\t\t\t\t\t\t? 'trips'\n\t\t\t\t\t\t\t: dataType === 'expenses'\n\t\t\t\t\t\t\t\t? 'expenses'\n\t\t\t\t\t\t\t\t: 'mileage logs'}...\"\n\t\t\t\t\t\tclass=\"search-input\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t{#if dataType === 'trips'}\n\t\t\t\t\t{#if filteredTrips.length > 0}\n\t\t\t\t\t\t<div class=\"trips-list\">\n\t\t\t\t\t\t\t{#each displayedTrips as trip}\n\t\t\t\t\t\t\t\t{@const tripAny = trip as any}\n\n\t\t\t\t\t\t\t\t{@const earnings =\n\t\t\t\t\t\t\t\t\ttripAny.stops?.reduce(\n\t\t\t\t\t\t\t\t\t\t(sum: number, stop: any) => sum + (stop.earnings || 0),\n\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t) || 0}\n\t\t\t\t\t\t\t\t{@const costs =\n\t\t\t\t\t\t\t\t\t(tripAny['fuelCost'] || 0) +\n\t\t\t\t\t\t\t\t\t(tripAny['maintenanceCost'] || 0) +\n\t\t\t\t\t\t\t\t\t(tripAny['suppliesCost'] || 0)}\n\t\t\t\t\t\t\t\t{@const profit = earnings - costs}\n\t\t\t\t\t\t\t\t{@const lastStop =\n\t\t\t\t\t\t\t\t\ttrip.stops && trip.stops.length > 0\n\t\t\t\t\t\t\t\t\t\t? trip.stops[trip.stops.length - 1]\n\t\t\t\t\t\t\t\t\t\t: undefined}\n\t\t\t\t\t\t\t\t{@const destination =\n\t\t\t\t\t\t\t\t\ttypeof lastStop?.address === 'string'\n\t\t\t\t\t\t\t\t\t\t? lastStop.address.split(',')[0]\n\t\t\t\t\t\t\t\t\t\t: trip.endAddress || 'Multiple stops'}\n\t\t\t\t\t\t\t\t<label class=\"trip-checkbox\">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\t\tchecked={selectedTrips.has(trip.id)}\n\t\t\t\t\t\t\t\t\t\ton:change={() => toggleTrip(trip.id)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<div class=\"trip-info\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"trip-header\">\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"trip-date\">{formatDate(trip.date || '')}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"trip-profit\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass:positive={profit >= 0}\n\t\t\t\t\t\t\t\t\t\t\t\tclass:negative={profit < 0}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(profit)}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"trip-route\">\n\t\t\t\t\t\t\t\t\t\t\t{typeof trip.startAddress === 'string'\n\t\t\t\t\t\t\t\t\t\t\t\t? trip.startAddress.split(',')[0]\n\t\t\t\t\t\t\t\t\t\t\t\t: 'Unknown'} → {destination}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"trip-meta\">\n\t\t\t\t\t\t\t\t\t\t\t{(Number((trip as any).totalMiles) || 0).toFixed(1) || '0.0'} mi • {trip.stops\n\t\t\t\t\t\t\t\t\t\t\t\t?.length || 0} stops\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#if displayedTrips.length < filteredTrips.length}\n\t\t\t\t\t\t\t<button class=\"btn-load-more\" on:click={loadMoreTrips}>\n\t\t\t\t\t\t\t\tLoad More ({filteredTrips.length - displayedTrips.length} remaining)\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\"empty-state\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"48\"\n\t\t\t\t\t\t\t\theight=\"48\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 48 48\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M40 18L24 4L8 18V38C8 38.5304 8.21071 39.0391 8.58579 39.4142C8.96086 39.7893 9.46957 40 10 40H38C38.5304 40 39.0391 39.7893 39.4142 39.4142C39.7893 39.0391 40 38.5304 40 38V18Z\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<p>No trips found in selected date range</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t{:else if dataType === 'expenses'}\n\t\t\t\t\t{#if filteredExpenses.length > 0}\n\t\t\t\t\t\t<div class=\"trips-list\">\n\t\t\t\t\t\t\t{#each displayedExpenses as expense}\n\t\t\t\t\t\t\t\t<label class=\"trip-checkbox\">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\t\tchecked={selectedExpenses.has(expense.id)}\n\t\t\t\t\t\t\t\t\t\ton:change={() => toggleExpense(expense.id)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<div class=\"trip-info\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"trip-header\">\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"trip-date\">{formatDate(expense.date)}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"trip-profit negative\">\n\t\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(expense.amount)}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"trip-route\">\n\t\t\t\t\t\t\t\t\t\t\t{expense.category}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#if expense.description}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"trip-meta\">\n\t\t\t\t\t\t\t\t\t\t\t\t{expense.description}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#if displayedExpenses.length < filteredExpenses.length}\n\t\t\t\t\t\t\t<button class=\"btn-load-more\" on:click={loadMoreExpenses}>\n\t\t\t\t\t\t\t\tLoad More ({filteredExpenses.length - displayedExpenses.length} remaining)\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\"empty-state\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"48\"\n\t\t\t\t\t\t\t\theight=\"48\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<rect x=\"2\" y=\"7\" width=\"20\" height=\"15\" rx=\"2\" ry=\"2\"></rect>\n\t\t\t\t\t\t\t\t<path d=\"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16\"></path>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<p>No expenses found in selected date range</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t{:else if dataType === 'mileage'}\n\t\t\t\t\t{#if filteredMileage.length > 0}\n\t\t\t\t\t\t<div class=\"trips-list\">\n\t\t\t\t\t\t\t{#each displayedMileage as mileageLog}\n\t\t\t\t\t\t\t\t<label class=\"trip-checkbox\">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\t\tchecked={selectedMileage.has(mileageLog.id)}\n\t\t\t\t\t\t\t\t\t\ton:change={() => toggleMileage(mileageLog.id)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<div class=\"trip-info\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"trip-header\">\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"trip-date\">{formatDate(mileageLog.date || '')}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"trip-profit positive\">\n\t\t\t\t\t\t\t\t\t\t\t\t{mileageLog.miles.toFixed(1)} mi\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"trip-route\">\n\t\t\t\t\t\t\t\t\t\t\t{getVehicleDisplayName(mileageLog.vehicle, $userSettings.vehicles)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"trip-meta\">\n\t\t\t\t\t\t\t\t\t\t\t{mileageLog.startOdometer} → {mileageLog.endOdometer} • {mileageLog[\n\t\t\t\t\t\t\t\t\t\t\t\t'purpose'\n\t\t\t\t\t\t\t\t\t\t\t] || 'Business'}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#if mileageLog.notes}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"trip-meta\">\n\t\t\t\t\t\t\t\t\t\t\t\t{mileageLog.notes}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#if displayedMileage.length < filteredMileage.length}\n\t\t\t\t\t\t\t<button class=\"btn-load-more\" on:click={loadMoreMileage}>\n\t\t\t\t\t\t\t\tLoad More ({filteredMileage.length - displayedMileage.length} remaining)\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\"empty-state\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"48\"\n\t\t\t\t\t\t\t\theight=\"48\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n\t\t\t\t\t\t\t\t<polyline points=\"12 6 12 12 16 14\"></polyline>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<p>No mileage logs found in selected date range</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<!-- Import Data Card -->\n\t\t<div class=\"options-card\">\n\t\t\t<h2 class=\"card-title\">Import Data</h2>\n\t\t\t<p class=\"card-desc\">Import trips, expenses, or mileage from a CSV file</p>\n\n\t\t\t<fieldset class=\"option-group\">\n\t\t\t\t<legend class=\"option-label\">Import Type</legend>\n\t\t\t\t<select id=\"import-type-select\" bind:value={importType} class=\"select-input\">\n\t\t\t\t\t<option value=\"trips\">Trips</option>\n\t\t\t\t\t<option value=\"expenses\">Expenses</option>\n\t\t\t\t\t<option value=\"mileage\">Mileage</option>\n\t\t\t\t</select>\n\t\t\t</fieldset>\n\n\t\t\t<label class=\"btn-import\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\taccept=\".csv\"\n\t\t\t\t\ton:change={handleImportFile}\n\t\t\t\t\tbind:files={importFile}\n\t\t\t\t\tstyle=\"display: none;\"\n\t\t\t\t/>\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t>\n\t\t\t\t\t<path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n\t\t\t\t\t<polyline points=\"17 8 12 3 7 8\"></polyline>\n\t\t\t\t\t<line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"></line>\n\t\t\t\t</svg>\n\t\t\t\tChoose CSV File\n\t\t\t</label>\n\n\t\t\t{#if showImportPreview}\n\t\t\t\t<div class=\"import-preview\">\n\t\t\t\t\t<p class=\"preview-label\">Preview (first 10 rows):</p>\n\t\t\t\t\t<div class=\"preview-table\">\n\t\t\t\t\t\t{#each importPreview as row}\n\t\t\t\t\t\t\t<div class=\"preview-row\">\n\t\t\t\t\t\t\t\t{JSON.stringify(row)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"btn-export\" on:click={confirmImport}>Confirm Import</button>\n\t\t\t\t\t<button class=\"btn-export secondary\" on:click={() => (showImportPreview = false)}\n\t\t\t\t\t\t>Cancel</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<!-- Backup & Restore (under Export Options) -->\n\t\t<div class=\"options-card\">\n\t\t\t<h2 class=\"card-title\">Backup & Restore</h2>\n\t\t\t<p class=\"card-desc\">Backup all your data or restore from a previous backup</p>\n\n\t\t\t<div class=\"option-group\">\n\t\t\t\t<button class=\"export-btn full-width\" on:click={backupFullData}>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path d=\"M7 10L12 15L17 10\" />\n\t\t\t\t\t\t<path d=\"M12 15V3\" />\n\t\t\t\t\t</svg>\n\t\t\t\t\tBackup Full Data (JSON)\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div class=\"option-group\">\n\t\t\t\t<label class=\"export-btn secondary full-width\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\taccept=\".json\"\n\t\t\t\t\t\ton:change={handleRestoreFile}\n\t\t\t\t\t\tbind:files={restoreFile}\n\t\t\t\t\t\tstyle=\"display: none;\"\n\t\t\t\t\t/>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<path d=\"M17 8L12 3L7 8\" />\n\t\t\t\t\t\t<path d=\"M12 3V15\" />\n\t\t\t\t\t</svg>\n\t\t\t\t\tRestore from Backup\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Clear Local Data (under Import Data) -->\n\t\t<div class=\"options-card danger-card\">\n\t\t\t<h2 class=\"card-title\">Clear Local Data</h2>\n\t\t\t<p class=\"card-desc\">\n\t\t\t\t⚠️ This will permanently delete all your local trips, expenses, and mileage data. This\n\t\t\t\tcannot be undone.\n\t\t\t</p>\n\n\t\t\t<div class=\"option-group\">\n\t\t\t\t<button class=\"export-btn danger full-width\" on:click={confirmClearData}>\n\t\t\t\t\tClear All Local Data\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t{#if showClearConfirm}\n\t\t\t\t<div class=\"confirm-modal\">\n\t\t\t\t\t<div class=\"modal-content\">\n\t\t\t\t\t\t<h3>Are you absolutely sure?</h3>\n\t\t\t\t\t\t<p>This will delete ALL your data from this device. This action cannot be undone.</p>\n\t\t\t\t\t\t<p><strong>Make sure you have a backup before proceeding!</strong></p>\n\t\t\t\t\t\t<div class=\"modal-actions\">\n\t\t\t\t\t\t\t<button class=\"export-btn danger\" on:click={clearLocalData}\n\t\t\t\t\t\t\t\t>Yes, Delete Everything</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button class=\"export-btn secondary\" on:click={() => (showClearConfirm = false)}\n\t\t\t\t\t\t\t\t>Cancel</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.export-page {\n\t\tmax-width: 1200px;\n\t}\n\n\t.page-header {\n\t\tmargin-bottom: 32px;\n\t}\n\n\t.page-title {\n\t\tfont-size: 32px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t}\n\n\t.page-subtitle {\n\t\tfont-size: 16px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.export-grid {\n\t\tdisplay: grid;\n\t\t/* Wider left column on desktop so option cards can take up more space */\n\t\tgrid-template-columns: 640px 1fr;\n\t\tgap: 24px;\n\t}\n\n\t.options-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 28px;\n\t\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n\t\tmargin-bottom: 24px;\n\t\twidth: 100%;\n\t\tmax-width: none; /* allow the grid column to control width */\n\t\tbox-sizing: border-box;\n\t}\n\n\t.card-title {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.option-group {\n\t\tmargin-bottom: 16px;\n\t}\n\n\t.option-label {\n\t\tdisplay: block;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 12px;\n\t}\n\n\t.data-type-buttons {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t}\n\n\t.type-btn {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding: 16px;\n\t\tbackground: #f9fafb;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\ttext-align: left;\n\t\tfont-family: inherit;\n\t}\n\n\t.type-btn:hover {\n\t\tborder-color: var(--orange);\n\t\tbackground: white;\n\t}\n\n\t.type-btn.active {\n\t\tborder-color: var(--orange);\n\t\tbackground: rgba(255, 127, 80, 0.05);\n\t}\n\n\t.type-btn.tax-bundle.active {\n\t\tbackground: linear-gradient(135deg, rgba(255, 127, 80, 0.1) 0%, rgba(255, 106, 61, 0.1) 100%);\n\t}\n\n\t.type-btn svg {\n\t\tcolor: #6b7280;\n\t\tflex-shrink: 0;\n\t}\n\n\t.type-btn.active svg {\n\t\tcolor: var(--orange);\n\t}\n\n\t.type-name {\n\t\tfont-size: 14px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 2px;\n\t}\n\n\t.type-desc {\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.format-buttons {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 12px;\n\t}\n\n\t.format-btn {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding: 16px;\n\t\tbackground: #f9fafb;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\ttext-align: left;\n\t\tfont-family: inherit;\n\t}\n\n\t.format-btn:hover {\n\t\tborder-color: var(--orange);\n\t\tbackground: white;\n\t}\n\n\t.format-btn.active {\n\t\tborder-color: var(--orange);\n\t\tbackground: rgba(255, 127, 80, 0.05);\n\t}\n\n\t.format-btn svg {\n\t\tcolor: #6b7280;\n\t\tflex-shrink: 0;\n\t}\n\n\t.format-btn.active svg {\n\t\tcolor: var(--orange);\n\t}\n\n\t.format-name {\n\t\tfont-size: 14px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 2px;\n\t}\n\n\t.format-desc {\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.btn-export {\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 8px;\n\t\tpadding: 16px;\n\t\tbackground: linear-gradient(135deg, var(--orange) 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 12px;\n\t\tfont-weight: 600;\n\t\tfont-size: 15px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tfont-family: inherit;\n\t\tmargin-bottom: 24px;\n\t}\n\n\t.btn-export:hover:not(:disabled) {\n\t\ttransform: translateY(-2px);\n\t\tbox-shadow: 0 8px 16px rgba(255, 127, 80, 0.3);\n\t}\n\n\t.btn-export:disabled {\n\t\topacity: 0.5;\n\t\tcursor: not-allowed;\n\t}\n\n\t.btn-import {\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 8px;\n\t\tpadding: 16px;\n\t\tbackground: linear-gradient(135deg, var(--orange) 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 12px;\n\t\tfont-weight: 600;\n\t\tfont-size: 15px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tfont-family: inherit;\n\t}\n\n\t.btn-import:hover {\n\t\ttransform: translateY(-2px);\n\t\tbox-shadow: 0 8px 16px rgba(255, 127, 80, 0.3);\n\t}\n\n\t.import-preview {\n\t\tmargin-top: 20px;\n\t\tpadding: 16px;\n\t\tbackground: #f9fafb;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t}\n\n\t.preview-label {\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 12px;\n\t}\n\n\t.preview-table {\n\t\tmax-height: 300px;\n\t\toverflow-y: auto;\n\t\tmargin-bottom: 16px;\n\t}\n\n\t.preview-row {\n\t\tpadding: 8px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 6px;\n\t\tmargin-bottom: 8px;\n\t\tfont-size: 12px;\n\t\tfont-family: monospace;\n\t\tcolor: #374151;\n\t\tword-break: break-all;\n\t}\n\n\t.selection-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 20px;\n\t}\n\n\t.btn-select-all {\n\t\tpadding: 8px 16px;\n\t\tbackground: white;\n\t\tcolor: var(--orange);\n\t\tborder: 2px solid var(--orange);\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 13px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tfont-family: inherit;\n\t}\n\n\t.btn-select-all:hover {\n\t\tbackground: var(--orange);\n\t\tcolor: white;\n\t}\n\n\t.search-container {\n\t\tmargin: 24px 0;\n\t\tpadding-top: 8px;\n\t}\n\n\t.search-input {\n\t\twidth: 100%;\n\t\tpadding: 12px 16px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-size: 14px;\n\t\tfont-family: inherit;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.search-input:focus {\n\t\toutline: none;\n\t\tborder-color: var(--orange);\n\t\tbox-shadow: 0 0 0 3px rgba(246, 138, 46, 0.1);\n\t}\n\n\t.btn-load-more {\n\t\twidth: 100%;\n\t\tpadding: 12px 24px;\n\t\tmargin-top: 16px;\n\t\tbackground: white;\n\t\tcolor: var(--orange);\n\t\tborder: 2px solid var(--orange);\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tfont-family: inherit;\n\t}\n\n\t.btn-load-more:hover {\n\t\tbackground: var(--orange);\n\t\tcolor: white;\n\t}\n\n\t.bundle-preview {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\n\t.preview-section {\n\t\tmargin-top: 20px; /* small buffer to ensure consistent spacing under the year selector */\n\t}\n\n\t.year-selector {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding: 16px 20px;\n\t\tbackground: #f9fafb;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t}\n\n\t.year-label {\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\n\t.year-select {\n\t\tpadding: 8px 12px;\n\t\tborder: 1px solid #d1d5db;\n\t\tborder-radius: 8px;\n\t\tfont-size: 14px;\n\t\tfont-weight: 500;\n\t\tcolor: #111827;\n\t\tbackground: white;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s ease;\n\t}\n\n\t.year-select:hover {\n\t\tborder-color: var(--orange);\n\t}\n\n\t.year-select:focus {\n\t\toutline: none;\n\t\tborder-color: var(--orange);\n\t\tbox-shadow: 0 0 0 3px rgba(246, 138, 46, 0.1);\n\t}\n\n\t.preview-section {\n\t\tpadding: 20px;\n\t\tbackground: #f9fafb;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t}\n\n\t.preview-section.highlight {\n\t\tbackground: linear-gradient(135deg, rgba(255, 127, 80, 0.05) 0%, rgba(255, 106, 61, 0.05) 100%);\n\t\tborder-color: var(--orange);\n\t}\n\n\t.preview-header {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-size: 15px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 16px;\n\t}\n\n\t.preview-header svg {\n\t\tcolor: #6b7280;\n\t}\n\n\t.preview-stats {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 16px;\n\t}\n\n\t.stat {\n\t\ttext-align: center;\n\t}\n\n\t.stat-value {\n\t\tfont-size: 24px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t}\n\n\t.stat-label {\n\t\tfont-size: 13px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.preview-deduction {\n\t\ttext-align: center;\n\t}\n\n\t.deduction-label {\n\t\tfont-size: 13px;\n\t\tcolor: #6b7280;\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.deduction-value {\n\t\tfont-size: 32px;\n\t\tfont-weight: 800;\n\t\tcolor: var(--orange);\n\t}\n\n\t.trips-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t\tmax-height: 600px;\n\t\toverflow-y: auto;\n\t\tpadding-right: 8px;\n\t}\n\n\t.trip-checkbox {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tpadding: 16px;\n\t\tbackground: #f9fafb;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.trip-checkbox:hover {\n\t\tborder-color: var(--orange);\n\t\tbackground: white;\n\t}\n\n\t.trip-checkbox input[type='checkbox'] {\n\t\twidth: 20px;\n\t\theight: 20px;\n\t\tcursor: pointer;\n\t\tflex-shrink: 0;\n\t\tmargin-top: 2px;\n\t}\n\n\t.trip-info {\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t}\n\n\t.trip-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 6px;\n\t}\n\n\t.trip-date {\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #111827;\n\t}\n\n\t.trip-profit {\n\t\tfont-size: 15px;\n\t\tfont-weight: 700;\n\t}\n\n\t.trip-profit.positive {\n\t\tcolor: var(--green);\n\t}\n\n\t.trip-profit.negative {\n\t\tcolor: #dc2626;\n\t}\n\n\t.trip-route {\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 4px;\n\t}\n\n\t.trip-meta {\n\t\tfont-size: 13px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.empty-state {\n\t\tpadding: 60px 20px;\n\t\ttext-align: center;\n\t}\n\n\t.empty-state svg {\n\t\tcolor: #d1d5db;\n\t\tmargin: 0 auto 16px;\n\t}\n\n\t.empty-state p {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.trips-list::-webkit-scrollbar {\n\t\twidth: 6px;\n\t}\n\n\t.trips-list::-webkit-scrollbar-track {\n\t\tbackground: #f3f4f6;\n\t\tborder-radius: 3px;\n\t}\n\n\t.trips-list::-webkit-scrollbar-thumb {\n\t\tbackground: #d1d5db;\n\t\tborder-radius: 3px;\n\t}\n\n\t.trips-list::-webkit-scrollbar-thumb:hover {\n\t\tbackground: #9ca3af;\n\t}\n\n\t@media (max-width: 1024px) {\n\t\t.export-grid {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.format-buttons {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\n\t\t.preview-stats {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\t}\n\n\t/* ============ New Styles for Import/Backup/Restore ============ */\n\t.card-desc {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tmargin-top: 8px;\n\t\tmargin-bottom: 24px;\n\t\tline-height: 1.5;\n\t}\n\n\t.export-btn {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 10px;\n\t\tpadding: 14px 24px;\n\t\tbackground: var(--orange, #ff7f50);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 600;\n\t\tfont-size: 15px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tbox-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n\t\tfont-family: inherit;\n\t}\n\n\t.export-btn:hover {\n\t\tbackground: #ff6a3d;\n\t\ttransform: translateY(-1px);\n\t\tbox-shadow: 0 4px 8px rgba(255, 127, 80, 0.3);\n\t}\n\n\t.select-input {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-size: 14px;\n\t\tbackground: white;\n\t\tcursor: pointer;\n\t}\n\n\t.export-btn.full-width {\n\t\twidth: 100%;\n\t}\n\n\t.export-btn.secondary {\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t\tborder: 2px solid #e5e7eb;\n\t\tbox-shadow: none;\n\t}\n\n\t.export-btn.secondary:hover {\n\t\tbackground: #f9fafb;\n\t\tborder-color: var(--orange, #ff7f50);\n\t\tcolor: var(--orange, #ff7f50);\n\t\tbox-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);\n\t}\n\n\t.export-btn.danger {\n\t\tbackground: #ef4444;\n\t\tcolor: white;\n\t}\n\n\t.export-btn.danger:hover {\n\t\tbackground: #dc2626;\n\t\tbox-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);\n\t}\n\n\t.danger-card {\n\t\tborder: 2px solid #fee2e2;\n\t\tbackground: #fef2f2;\n\t}\n\n\t.danger-card .card-title {\n\t\tcolor: #dc2626;\n\t}\n\n\t.confirm-modal {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tz-index: 1000;\n\t}\n\n\t.modal-content {\n\t\tbackground: white;\n\t\tpadding: 32px;\n\t\tborder-radius: 16px;\n\t\tmax-width: 500px;\n\t\tmargin: 16px;\n\t\tbox-shadow:\n\t\t\t0 20px 25px -5px rgba(0, 0, 0, 0.1),\n\t\t\t0 10px 10px -5px rgba(0, 0, 0, 0.04);\n\t}\n\n\t.modal-content h3 {\n\t\tfont-size: 24px;\n\t\tfont-weight: 700;\n\t\tcolor: #ef4444;\n\t\tmargin-bottom: 16px;\n\t}\n\n\t.modal-content p {\n\t\tfont-size: 15px;\n\t\tcolor: #6b7280;\n\t\tmargin-bottom: 12px;\n\t\tline-height: 1.6;\n\t}\n\n\t.modal-actions {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tmargin-top: 24px;\n\t\tflex-wrap: wrap;\n\t}\n\n\t.modal-actions button {\n\t\tflex: 1;\n\t\tmin-width: 120px;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\data-management\\lib\\mileage-export.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 4,
				"column": 18,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 4,
				"endColumn": 21,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [113, 116], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [113, 116], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 49,
				"column": 51,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 49,
				"endColumn": 54,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1256, 1259], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1256, 1259], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 2,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// Mileage export utility functions for data-management page\n\nexport function exportMileageCSV(\n\tmileageRecords: any[],\n\tselectedIds: Set<string>,\n\tincludeSummary: boolean,\n\tformatDate: (date: string) => string,\n\tformatCurrency: (amount: number) => string\n): string {\n\tconst mileageToExport = mileageRecords.filter((m) => selectedIds.has(m.id));\n\n\tif (mileageToExport.length === 0) {\n\t\tthrow new Error('Please select at least one mileage log to export');\n\t}\n\n\tlet csv = 'Date,Vehicle,Start Odometer,End Odometer,Miles,Purpose,Notes\\n';\n\n\tlet totalMiles = 0;\n\n\tmileageToExport.forEach((m) => {\n\t\tconst miles = Number(m.miles || 0);\n\t\ttotalMiles += miles;\n\n\t\tconst row = [\n\t\t\tformatDate(m.date || ''),\n\t\t\t`\"${m.vehicle || 'Default'}\"`,\n\t\t\tm.startOdometer || '',\n\t\t\tm.endOdometer || '',\n\t\t\tmiles.toFixed(2),\n\t\t\t`\"${m.purpose || 'Business'}\"`,\n\t\t\t`\"${m.notes || ''}\"`\n\t\t];\n\n\t\tcsv += row.join(',') + '\\n';\n\t});\n\n\tif (includeSummary) {\n\t\tcsv += '\\n';\n\t\tcsv += 'SUMMARY\\n';\n\t\tcsv += `Total Logs,${mileageToExport.length}\\n`;\n\t\tcsv += `Total Miles,${totalMiles.toFixed(2)}\\n`;\n\t\tcsv += `Standard Mileage Rate (2026),$0.725\\n`;\n\t\tcsv += `Est. Deduction,${formatCurrency(totalMiles * 0.725)}\\n`;\n\t}\n\n\treturn csv;\n}\n\nexport function parseMileageCSV(csvText: string): any[] {\n\tconst lines = csvText.split('\\n').filter((line) => line.trim());\n\n\tif (lines.length < 2) {\n\t\tthrow new Error('CSV file must have header and at least one data row');\n\t}\n\n\tconst mileageLogs = lines.slice(1).map((line, idx) => {\n\t\tconst [date, vehicle, startOdometer, endOdometer, miles, purpose, notes] = line.split(',');\n\t\treturn {\n\t\t\tid: `import-${Date.now()}-${idx}`,\n\t\t\tdate: date?.trim() || new Date().toISOString().split('T')[0],\n\t\t\tvehicle: vehicle?.replace(/\"/g, '').trim() || 'Default',\n\t\t\tstartOdometer: Number(startOdometer?.trim()) || 0,\n\t\t\tendOdometer: Number(endOdometer?.trim()) || 0,\n\t\t\tmiles: Number(miles?.trim()) || 0,\n\t\t\tpurpose: purpose?.replace(/\"/g, '').trim() || 'Business',\n\t\t\tnotes: notes?.replace(/\"/g, '').trim() || ''\n\t\t};\n\t});\n\n\treturn mileageLogs;\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\data-management\\lib\\pdf-export.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 113,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 113,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2859, 2862], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2859, 2862], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 115,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 115,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2973, 2976], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2973, 2976], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 116,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 116,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3008, 3011], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3008, 3011], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 117,
				"column": 14,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 117,
				"endColumn": 17,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3050, 3053], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3050, 3053], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 122,
				"column": 25,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 122,
				"endColumn": 28,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3202, 3205], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3202, 3205], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 123,
				"column": 32,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 123,
				"endColumn": 35,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3253, 3256], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3253, 3256], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 124,
				"column": 29,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 124,
				"endColumn": 32,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3308, 3311], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3308, 3311], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 132,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 132,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3525, 3528], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3525, 3528], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 135,
				"column": 28,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 135,
				"endColumn": 31,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3644, 3647], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3644, 3647], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 136,
				"column": 28,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 136,
				"endColumn": 31,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3692, 3695], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3692, 3695], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 137,
				"column": 28,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 137,
				"endColumn": 31,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3747, 3750], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3747, 3750], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 238,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 238,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6016, 6019], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6016, 6019], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 378,
				"column": 25,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 378,
				"endColumn": 28,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [9191, 9194], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [9191, 9194], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 451,
				"column": 13,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 451,
				"endColumn": 16,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [11136, 11139], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [11136, 11139], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 454,
				"column": 31,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 454,
				"endColumn": 34,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [11324, 11327], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [11324, 11327], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 523,
				"column": 36,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 523,
				"endColumn": 39,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [13546, 13549], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [13546, 13549], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 621,
				"column": 26,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 621,
				"endColumn": 29,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16410, 16413], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16410, 16413], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 663,
				"column": 26,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 663,
				"endColumn": 29,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [17409, 17412], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [17409, 17412], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 18,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/dashboard/data-management/lib/pdf-export.ts\nimport { jsPDF } from 'jspdf';\nimport autoTable from 'jspdf-autotable';\nimport type { Trip, Stop } from '$lib/types';\nimport type { ExpenseRecord } from '$lib/db/types';\nimport type { MileageRecord } from '$lib/db/types';\nimport { getVehicleDisplayName } from '$lib/utils/vehicle';\n\ntype Vehicle = { id?: string; name?: string };\n\n// Brand colors from design system\nconst ORANGE = [246, 138, 46] as [number, number, number]; // #F68A2E\nconst BLUE = [44, 80, 123] as [number, number, number]; // #2C507B\n\n/**\n * Format currency for display\n */\nfunction formatCurrency(amount: number): string {\n\treturn new Intl.NumberFormat('en-US', {\n\t\tstyle: 'currency',\n\t\tcurrency: 'USD',\n\t\tminimumFractionDigits: 2\n\t}).format(amount);\n}\n\n/**\n * Format date for display\n */\nfunction formatDate(dateString: string): string {\n\treturn new Date(dateString).toLocaleDateString('en-US', {\n\t\tyear: 'numeric',\n\t\tmonth: 'short',\n\t\tday: 'numeric'\n\t});\n}\n\n// Logo as base64 (120x120 PNG)\nconst LOGO_BASE64 =\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAACEFBMVEVMaXEtUXtbeHnbjFY4VIrNlVcrUX2Vg0/ijks1U4oxU3ks';\n\n/**\n * Add header to PDF page\n */\nfunction addHeader(doc: jsPDF, title: string, subtitle?: string) {\n\tdoc.setFillColor(...ORANGE);\n\tdoc.rect(0, 0, doc.internal.pageSize.width, 35, 'F');\n\n\t// Add logo if available\n\ttry {\n\t\tdoc.addImage(LOGO_BASE64, 'PNG', doc.internal.pageSize.width - 40, 5, 25, 25);\n\t} catch {\n\t\t// Silently fail if logo can't be added\n\t}\n\n\tdoc.setTextColor(255, 255, 255);\n\tdoc.setFontSize(20);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text(title, 14, 15);\n\n\tif (subtitle) {\n\t\tdoc.setFontSize(11);\n\t\tdoc.setFont('helvetica', 'normal');\n\t\tdoc.text(subtitle, 14, 24);\n\t}\n\n\tdoc.setTextColor(0, 0, 0);\n\treturn 40; // Return Y position for content start\n}\n\n/**\n * Add footer to PDF page\n */\nfunction addFooter(doc: jsPDF, pageNum: number) {\n\tconst pageHeight = doc.internal.pageSize.height;\n\tdoc.setFontSize(9);\n\tdoc.setTextColor(128, 128, 128);\n\tdoc.text(\n\t\t`Page ${pageNum} • Generated by Go Route Yourself • ${new Date().toLocaleDateString()}`,\n\t\t14,\n\t\tpageHeight - 10\n\t);\n}\n\n/**\n * Export trips to PDF\n */\nexport function exportTripsPDF(trips: Trip[], dateFrom?: string, dateTo?: string): Blob {\n\tconst doc = new jsPDF({ orientation: 'landscape' });\n\n\t// Header\n\tconst period =\n\t\tdateFrom && dateTo\n\t\t\t? `${formatDate(dateFrom)} to ${formatDate(dateTo)}`\n\t\t\t: dateFrom\n\t\t\t\t? `From ${formatDate(dateFrom)}`\n\t\t\t\t: dateTo\n\t\t\t\t\t? `Through ${formatDate(dateTo)}`\n\t\t\t\t\t: 'All Records';\n\n\taddHeader(doc, 'Trip Log', period);\n\n\t// Calculate totals\n\tlet totalMiles = 0;\n\tlet totalEarnings = 0;\n\tlet totalFuel = 0;\n\tlet totalMaintenance = 0;\n\tlet totalSupplies = 0;\n\tlet totalProfit = 0;\n\n\t// Prepare table data\n\tconst tableData = trips.map((trip) => {\n\t\tconst earnings =\n\t\t\t(trip as any).stops?.reduce((sum: number, stop: Stop) => sum + (stop.earnings || 0), 0) || 0;\n\t\tconst costs =\n\t\t\t((trip as any).fuelCost || 0) +\n\t\t\t((trip as any).maintenanceCost || 0) +\n\t\t\t((trip as any).suppliesCost || 0);\n\t\tconst profit = earnings - costs;\n\n\t\ttotalMiles += trip.totalMiles || 0;\n\t\ttotalEarnings += earnings;\n\t\ttotalFuel += (trip as any).fuelCost || 0;\n\t\ttotalMaintenance += (trip as any).maintenanceCost || 0;\n\t\ttotalSupplies += (trip as any).suppliesCost || 0;\n\t\ttotalProfit += profit;\n\n\t\treturn [\n\t\t\tformatDate(trip.date || ''),\n\t\t\ttrip.startTime || '-',\n\t\t\ttrip.endTime || '-',\n\t\t\t(trip.startAddress || 'Unknown').substring(0, 30) + '...',\n\t\t\t(trip as any).stops?.length || 0,\n\t\t\t(trip.totalMiles || 0).toFixed(2),\n\t\t\tformatCurrency(earnings),\n\t\t\tformatCurrency((trip as any).fuelCost || 0),\n\t\t\tformatCurrency((trip as any).maintenanceCost || 0),\n\t\t\tformatCurrency((trip as any).suppliesCost || 0),\n\t\t\tformatCurrency(costs),\n\t\t\tformatCurrency(profit)\n\t\t];\n\t});\n\n\t// Add summary row\n\ttableData.push([\n\t\t{ content: 'TOTALS', styles: { fontStyle: 'bold' } },\n\t\t'',\n\t\t'',\n\t\t'',\n\t\ttrips.length.toString(),\n\t\t{ content: totalMiles.toFixed(2), styles: { fontStyle: 'bold' } },\n\t\t{ content: formatCurrency(totalEarnings), styles: { fontStyle: 'bold' } },\n\t\t{ content: formatCurrency(totalFuel), styles: { fontStyle: 'bold' } },\n\t\t{ content: formatCurrency(totalMaintenance), styles: { fontStyle: 'bold' } },\n\t\t{ content: formatCurrency(totalSupplies), styles: { fontStyle: 'bold' } },\n\t\t{\n\t\t\tcontent: formatCurrency(totalFuel + totalMaintenance + totalSupplies),\n\t\t\tstyles: { fontStyle: 'bold' }\n\t\t},\n\t\t{ content: formatCurrency(totalProfit), styles: { fontStyle: 'bold' } }\n\t]);\n\n\t// Create table\n\tautoTable(doc, {\n\t\tstartY: 45,\n\t\thead: [\n\t\t\t[\n\t\t\t\t'Date',\n\t\t\t\t'Start',\n\t\t\t\t'End',\n\t\t\t\t'Start Address',\n\t\t\t\t'Stops',\n\t\t\t\t'Miles',\n\t\t\t\t'Earnings',\n\t\t\t\t'Fuel',\n\t\t\t\t'Maint.',\n\t\t\t\t'Supplies',\n\t\t\t\t'Total Cost',\n\t\t\t\t'Net Profit'\n\t\t\t]\n\t\t],\n\t\tbody: tableData,\n\t\theadStyles: {\n\t\t\tfillColor: ORANGE,\n\t\t\ttextColor: [255, 255, 255],\n\t\t\tfontStyle: 'bold',\n\t\t\tfontSize: 9\n\t\t},\n\t\ttheme: 'striped',\n\t\tstyles: { fontSize: 8, cellPadding: 2 },\n\t\tcolumnStyles: {\n\t\t\t3: { cellWidth: 40 },\n\t\t\t6: { halign: 'right' },\n\t\t\t7: { halign: 'right' },\n\t\t\t8: { halign: 'right' },\n\t\t\t9: { halign: 'right' },\n\t\t\t10: { halign: 'right' },\n\t\t\t11: { halign: 'right' }\n\t\t}\n\t});\n\n\taddFooter(doc, 1);\n\n\treturn doc.output('blob');\n}\n\n/**\n * Export expenses to PDF\n */\nexport function exportExpensesPDF(\n\texpenses: ExpenseRecord[],\n\tdateFrom?: string,\n\tdateTo?: string\n): Blob {\n\tconst doc = new jsPDF();\n\n\t// Header\n\tconst period =\n\t\tdateFrom && dateTo\n\t\t\t? `${formatDate(dateFrom)} to ${formatDate(dateTo)}`\n\t\t\t: dateFrom\n\t\t\t\t? `From ${formatDate(dateFrom)}`\n\t\t\t\t: dateTo\n\t\t\t\t\t? `Through ${formatDate(dateTo)}`\n\t\t\t\t\t: 'All Records';\n\n\taddHeader(doc, 'Expense Log', period);\n\n\t// Calculate totals by category\n\tconst totalByCategory: Record<string, number> = {};\n\tlet grandTotal = 0;\n\n\texpenses.forEach((expense) => {\n\t\ttotalByCategory[expense.category] = (totalByCategory[expense.category] || 0) + expense.amount;\n\t\tgrandTotal += expense.amount;\n\t});\n\n\t// Prepare table data\n\tconst tableData: any[] = expenses.map((expense) => [\n\t\tformatDate(expense.date),\n\t\texpense.category,\n\t\tformatCurrency(expense.amount),\n\t\texpense.description || '-'\n\t]);\n\n\t// Add category totals\n\ttableData.push(['', '', '', '']);\n\ttableData.push([\n\t\t{ content: 'CATEGORY TOTALS', colSpan: 2, styles: { fontStyle: 'bold' } },\n\t\t'',\n\t\t'',\n\t\t''\n\t]);\n\n\tObject.entries(totalByCategory).forEach(([category, total]) => {\n\t\ttableData.push([\n\t\t\t'',\n\t\t\tcategory,\n\t\t\t{ content: formatCurrency(total), styles: { fontStyle: 'bold' } },\n\t\t\t''\n\t\t]);\n\t});\n\n\t// Add grand total\n\ttableData.push(['', '', '', '']);\n\ttableData.push([\n\t\t{\n\t\t\tcontent: 'GRAND TOTAL',\n\t\t\tcolSpan: 2,\n\t\t\tstyles: { fontStyle: 'bold', fillColor: ORANGE, textColor: [255, 255, 255] }\n\t\t},\n\t\t'',\n\t\t{\n\t\t\tcontent: formatCurrency(grandTotal),\n\t\t\tstyles: { fontStyle: 'bold', fillColor: ORANGE, textColor: [255, 255, 255] }\n\t\t},\n\t\t''\n\t]);\n\n\t// Create table\n\tautoTable(doc, {\n\t\tstartY: 45,\n\t\thead: [['Date', 'Category', 'Amount', 'Description']],\n\t\tbody: tableData,\n\t\theadStyles: {\n\t\t\tfillColor: ORANGE,\n\t\t\ttextColor: [255, 255, 255],\n\t\t\tfontStyle: 'bold'\n\t\t},\n\t\ttheme: 'striped',\n\t\tstyles: { fontSize: 10 },\n\t\tcolumnStyles: {\n\t\t\t0: { cellWidth: 30 },\n\t\t\t1: { cellWidth: 35 },\n\t\t\t2: { cellWidth: 30, halign: 'right' },\n\t\t\t3: { cellWidth: 'auto' }\n\t\t}\n\t});\n\n\taddFooter(doc, 1);\n\n\treturn doc.output('blob');\n}\n\n/**\n * Export mileage to PDF (IRS-compliant format)\n */\nexport function exportMileagePDF(\n\tmileageLogs: MileageRecord[],\n\tvehicles?: Vehicle[],\n\tdateFrom?: string,\n\tdateTo?: string\n): Blob {\n\tconst doc = new jsPDF();\n\n\t// Header\n\tconst period =\n\t\tdateFrom && dateTo\n\t\t\t? `${formatDate(dateFrom)} to ${formatDate(dateTo)}`\n\t\t\t: dateFrom\n\t\t\t\t? `From ${formatDate(dateFrom)}`\n\t\t\t\t: dateTo\n\t\t\t\t\t? `Through ${formatDate(dateTo)}`\n\t\t\t\t\t: 'All Records';\n\n\taddHeader(doc, 'Mileage Log - IRS Compliant', period);\n\n\t// Calculate totals\n\tconst totalMiles = mileageLogs.reduce((sum, log) => sum + log.miles, 0);\n\tconst mileageRate = 0.725; // 2026 IRS standard rate\n\tconst estimatedDeduction = totalMiles * mileageRate;\n\n\t// Prepare table data\n\tconst tableData = mileageLogs.map((log) => [\n\t\tformatDate(log.date || ''),\n\t\tgetVehicleDisplayName(log.vehicle, vehicles),\n\t\t(log.startOdometer || 0).toLocaleString(),\n\t\t(log.endOdometer || 0).toLocaleString(),\n\t\tlog.miles.toFixed(2),\n\t\tlog['purpose'] || 'Business',\n\t\tlog.notes || '-'\n\t]);\n\n\t// Add summary row\n\ttableData.push([\n\t\t{ content: 'TOTALS', colSpan: 4, styles: { fontStyle: 'bold' } },\n\t\t'',\n\t\t'',\n\t\t'',\n\t\t{ content: totalMiles.toFixed(2), styles: { fontStyle: 'bold' } },\n\t\t'',\n\t\t''\n\t]);\n\n\t// Create table\n\tautoTable(doc, {\n\t\tstartY: 45,\n\t\thead: [['Date', 'Vehicle', 'Start Odo', 'End Odo', 'Miles', 'Purpose', 'Notes']],\n\t\tbody: tableData,\n\t\theadStyles: {\n\t\t\tfillColor: ORANGE,\n\t\t\ttextColor: [255, 255, 255],\n\t\t\tfontStyle: 'bold'\n\t\t},\n\t\ttheme: 'striped',\n\t\tstyles: { fontSize: 9 },\n\t\tcolumnStyles: {\n\t\t\t0: { cellWidth: 25 },\n\t\t\t1: { cellWidth: 25 },\n\t\t\t2: { cellWidth: 25, halign: 'right' },\n\t\t\t3: { cellWidth: 25, halign: 'right' },\n\t\t\t4: { cellWidth: 20, halign: 'right' },\n\t\t\t5: { cellWidth: 25 },\n\t\t\t6: { cellWidth: 'auto' }\n\t\t}\n\t});\n\n\t// Add summary section\n\tconst finalY = (doc as any).lastAutoTable.finalY || 45;\n\n\tdoc.setFillColor(...BLUE);\n\tdoc.rect(14, finalY + 10, doc.internal.pageSize.width - 28, 30, 'F');\n\n\tdoc.setTextColor(255, 255, 255);\n\tdoc.setFontSize(12);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('IRS Standard Mileage Deduction (2026)', 20, finalY + 20);\n\n\tdoc.setFontSize(10);\n\tdoc.setFont('helvetica', 'normal');\n\tdoc.text(`Total Business Miles: ${totalMiles.toFixed(2)}`, 20, finalY + 28);\n\tdoc.text(`Standard Rate: $${mileageRate.toFixed(3)}/mile`, 20, finalY + 35);\n\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text(`Estimated Deduction: ${formatCurrency(estimatedDeduction)}`, 120, finalY + 35);\n\n\tdoc.setTextColor(0, 0, 0);\n\n\taddFooter(doc, 1);\n\n\treturn doc.output('blob');\n}\n\n/**\n * Export comprehensive tax bundle as PDF\n */\nexport function exportTaxBundlePDF(\n\ttrips: Trip[],\n\texpenses: ExpenseRecord[],\n\tmileageLogs: MileageRecord[],\n\tvehicles?: Vehicle[],\n\tdateFrom?: string,\n\tdateTo?: string\n): Blob {\n\tconst doc = new jsPDF();\n\n\tconst period =\n\t\tdateFrom && dateTo\n\t\t\t? `${formatDate(dateFrom)} to ${formatDate(dateTo)}`\n\t\t\t: dateFrom\n\t\t\t\t? `From ${formatDate(dateFrom)}`\n\t\t\t\t: dateTo\n\t\t\t\t\t? `Through ${formatDate(dateTo)}`\n\t\t\t\t\t: 'All Records';\n\n\t// ============= PAGE 1: TAX SUMMARY =============\n\taddHeader(doc, 'Tax Summary Report', period);\n\n\tdoc.setFontSize(10);\n\tdoc.setTextColor(100, 100, 100);\n\tdoc.text(`Generated: ${new Date().toLocaleString('en-US')}`, 14, 50);\n\tdoc.setTextColor(0, 0, 0);\n\n\tlet yPos = 60;\n\n\t// Income Section (using pay dates)\n\tdoc.setFillColor(...BLUE);\n\tdoc.rect(14, yPos, doc.internal.pageSize.width - 28, 10, 'F');\n\tdoc.setTextColor(255, 255, 255);\n\tdoc.setFontSize(14);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('INCOME (By Pay Date)', 20, yPos + 7);\n\tdoc.setTextColor(0, 0, 0);\n\tyPos += 15;\n\n\t// Calculate income by pay date\n\tconst incomeByMonth: Record<string, number> = {};\n\tlet totalIncome = 0;\n\n\ttrips.forEach((trip) => {\n\t\tconst earnings =\n\t\t\t(trip as any).stops?.reduce((sum: number, stop: Stop) => sum + (stop.earnings || 0), 0) || 0;\n\t\tif (earnings > 0) {\n\t\t\t// Use payDate if available, otherwise use date\n\t\t\tconst dateToUse = (trip as any).payDate || trip.date;\n\t\t\tif (dateToUse) {\n\t\t\t\tconst month = new Date(dateToUse).toLocaleDateString('en-US', {\n\t\t\t\t\tyear: 'numeric',\n\t\t\t\t\tmonth: 'long'\n\t\t\t\t});\n\t\t\t\tincomeByMonth[month] = (incomeByMonth[month] || 0) + earnings;\n\t\t\t\ttotalIncome += earnings;\n\t\t\t}\n\t\t}\n\t});\n\n\tdoc.setFontSize(10);\n\tObject.entries(incomeByMonth)\n\t\t.sort((a, b) => new Date(a[0]).getTime() - new Date(b[0]).getTime())\n\t\t.forEach(([month, amount]) => {\n\t\t\tdoc.text(month, 20, yPos);\n\t\t\tdoc.text(formatCurrency(amount), 150, yPos, { align: 'right' });\n\t\t\tyPos += 7;\n\t\t});\n\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Total Income', 20, yPos + 3);\n\tdoc.text(formatCurrency(totalIncome), 150, yPos + 3, { align: 'right' });\n\tdoc.setFont('helvetica', 'normal');\n\tyPos += 15;\n\n\t// Mileage Deduction Section\n\tdoc.setFillColor(...BLUE);\n\tdoc.rect(14, yPos, doc.internal.pageSize.width - 28, 10, 'F');\n\tdoc.setTextColor(255, 255, 255);\n\tdoc.setFontSize(14);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('MILEAGE DEDUCTION', 20, yPos + 7);\n\tdoc.setTextColor(0, 0, 0);\n\tyPos += 15;\n\n\tconst totalMiles = mileageLogs.reduce((sum, log) => sum + log.miles, 0);\n\tconst mileageRate = 0.725;\n\tconst mileageDeduction = totalMiles * mileageRate;\n\n\tdoc.setFontSize(10);\n\tdoc.text(`Total Business Miles: ${totalMiles.toFixed(2)} miles`, 20, yPos);\n\tyPos += 7;\n\tdoc.text(`Standard Mileage Rate (2026): $${mileageRate.toFixed(3)}/mile`, 20, yPos);\n\tyPos += 7;\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Estimated Deduction:', 20, yPos);\n\tdoc.text(formatCurrency(mileageDeduction), 150, yPos, { align: 'right' });\n\tdoc.setFont('helvetica', 'normal');\n\tyPos += 15;\n\n\t// Business Expenses Section\n\tdoc.setFillColor(...BLUE);\n\tdoc.rect(14, yPos, doc.internal.pageSize.width - 28, 10, 'F');\n\tdoc.setTextColor(255, 255, 255);\n\tdoc.setFontSize(14);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('BUSINESS EXPENSES', 20, yPos + 7);\n\tdoc.setTextColor(0, 0, 0);\n\tyPos += 15;\n\n\t// Separate deductible and non-deductible expenses\n\tconst deductibleByCategory: Record<string, number> = {};\n\tconst nonDeductibleByCategory: Record<string, number> = {};\n\tlet totalDeductible = 0;\n\tlet totalNonDeductible = 0;\n\n\texpenses.forEach((expense) => {\n\t\tconst isDeductible = (expense as any).taxDeductible !== false; // default to true if not specified\n\t\tif (isDeductible) {\n\t\t\tdeductibleByCategory[expense.category] =\n\t\t\t\t(deductibleByCategory[expense.category] || 0) + expense.amount;\n\t\t\ttotalDeductible += expense.amount;\n\t\t} else {\n\t\t\tnonDeductibleByCategory[expense.category] =\n\t\t\t\t(nonDeductibleByCategory[expense.category] || 0) + expense.amount;\n\t\t\ttotalNonDeductible += expense.amount;\n\t\t}\n\t});\n\n\tdoc.setFontSize(10);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Tax Deductible:', 20, yPos);\n\tyPos += 7;\n\tdoc.setFont('helvetica', 'normal');\n\n\tObject.entries(deductibleByCategory).forEach(([category, total]) => {\n\t\tdoc.text(category, 25, yPos);\n\t\tdoc.text(formatCurrency(total), 150, yPos, { align: 'right' });\n\t\tyPos += 7;\n\t});\n\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Deductible Subtotal:', 25, yPos);\n\tdoc.text(formatCurrency(totalDeductible), 150, yPos, { align: 'right' });\n\tyPos += 10;\n\n\tif (Object.keys(nonDeductibleByCategory).length > 0) {\n\t\tdoc.text('Non-Deductible:', 20, yPos);\n\t\tyPos += 7;\n\t\tdoc.setFont('helvetica', 'normal');\n\n\t\tObject.entries(nonDeductibleByCategory).forEach(([category, total]) => {\n\t\t\tdoc.text(category, 25, yPos);\n\t\t\tdoc.text(formatCurrency(total), 150, yPos, { align: 'right' });\n\t\t\tyPos += 7;\n\t\t});\n\n\t\tdoc.setFont('helvetica', 'bold');\n\t\tdoc.text('Non-Deductible Subtotal:', 25, yPos);\n\t\tdoc.text(formatCurrency(totalNonDeductible), 150, yPos, { align: 'right' });\n\t\tyPos += 10;\n\t}\n\n\tconst totalExpenses = totalDeductible + totalNonDeductible;\n\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Total Expenses', 20, yPos + 3);\n\tdoc.text(formatCurrency(totalExpenses), 150, yPos + 3, { align: 'right' });\n\tdoc.setFont('helvetica', 'normal');\n\tyPos += 15;\n\n\t// Total Deductions Summary\n\tdoc.setFillColor(...ORANGE);\n\tdoc.rect(14, yPos, doc.internal.pageSize.width - 28, 25, 'F');\n\tdoc.setTextColor(255, 255, 255);\n\tdoc.setFontSize(16);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('TOTAL TAX DEDUCTIONS', 20, yPos + 10);\n\tdoc.setFontSize(20);\n\tdoc.text(\n\t\tformatCurrency(mileageDeduction + totalExpenses),\n\t\tdoc.internal.pageSize.width - 20,\n\t\tyPos + 18,\n\t\t{ align: 'right' }\n\t);\n\tdoc.setTextColor(0, 0, 0);\n\tyPos += 35;\n\n\t// Important Notes\n\tdoc.setFontSize(9);\n\tdoc.setTextColor(100, 100, 100);\n\tconst notes = [\n\t\t'NOTES:',\n\t\t'• Income reported by pay date for accurate tax reporting',\n\t\t'• This report is for informational purposes only',\n\t\t'• Consult with a tax professional for specific advice',\n\t\t'• Keep all receipts and documentation for 7 years',\n\t\t'• Standard mileage rate may change annually'\n\t];\n\n\tnotes.forEach((note) => {\n\t\tif (yPos > 270) {\n\t\t\tdoc.addPage();\n\t\t\tyPos = 20;\n\t\t}\n\t\tdoc.text(note, 20, yPos);\n\t\tyPos += 5;\n\t});\n\n\taddFooter(doc, 1);\n\n\t// ============= PAGE 2: MILEAGE LOG =============\n\tdoc.addPage();\n\taddHeader(doc, 'Detailed Mileage Log', period);\n\n\tconst mileageTableData: any[] = mileageLogs.map((log) => [\n\t\tformatDate(log.date || ''),\n\t\tgetVehicleDisplayName(log.vehicle, vehicles),\n\t\t(log.startOdometer || 0).toLocaleString(),\n\t\t(log.endOdometer || 0).toLocaleString(),\n\t\tlog.miles.toFixed(2),\n\t\tlog['purpose'] || 'Business'\n\t]);\n\n\tmileageTableData.push([\n\t\t{ content: 'TOTAL', colSpan: 4, styles: { fontStyle: 'bold' } },\n\t\t'',\n\t\t'',\n\t\t'',\n\t\t{ content: totalMiles.toFixed(2), styles: { fontStyle: 'bold' } },\n\t\t''\n\t]);\n\n\tautoTable(doc, {\n\t\tstartY: 45,\n\t\thead: [['Date', 'Vehicle', 'Start Odo', 'End Odo', 'Miles', 'Purpose']],\n\t\tbody: mileageTableData,\n\t\theadStyles: {\n\t\t\tfillColor: ORANGE,\n\t\t\ttextColor: [255, 255, 255],\n\t\t\tfontStyle: 'bold'\n\t\t},\n\t\ttheme: 'striped',\n\t\tstyles: { fontSize: 9 },\n\t\tcolumnStyles: {\n\t\t\t2: { halign: 'right' },\n\t\t\t3: { halign: 'right' },\n\t\t\t4: { halign: 'right' }\n\t\t}\n\t});\n\n\taddFooter(doc, 2);\n\n\t// ============= PAGE 3: EXPENSE LOG =============\n\tdoc.addPage();\n\taddHeader(doc, 'Detailed Expense Log', period);\n\n\tconst expenseTableData: any[] = expenses.map((expense) => [\n\t\tformatDate(expense.date),\n\t\texpense.category,\n\t\tformatCurrency(expense.amount),\n\t\texpense.description || '-'\n\t]);\n\n\texpenseTableData.push([\n\t\t{ content: 'TOTAL', colSpan: 2, styles: { fontStyle: 'bold' } },\n\t\t'',\n\t\t{ content: formatCurrency(totalExpenses), styles: { fontStyle: 'bold' } },\n\t\t''\n\t]);\n\n\tautoTable(doc, {\n\t\tstartY: 45,\n\t\thead: [['Date', 'Category', 'Amount', 'Description']],\n\t\tbody: expenseTableData,\n\t\theadStyles: {\n\t\t\tfillColor: ORANGE,\n\t\t\ttextColor: [255, 255, 255],\n\t\t\tfontStyle: 'bold'\n\t\t},\n\t\ttheme: 'striped',\n\t\tstyles: { fontSize: 10 },\n\t\tcolumnStyles: {\n\t\t\t2: { halign: 'right' }\n\t\t}\n\t});\n\n\taddFooter(doc, 3);\n\n\treturn doc.output('blob');\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\data\\+page.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\expenses\\+page.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\expenses\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 50,
				"column": 25,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 50,
				"endColumn": 42
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Date class. Use SvelteDate instead.",
				"line": 191,
				"column": 22,
				"nodeType": "NewExpression",
				"messageId": "mutableDateUsed",
				"endLine": 191,
				"endColumn": 41
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Date class. Use SvelteDate instead.",
				"line": 195,
				"column": 20,
				"nodeType": "NewExpression",
				"messageId": "mutableDateUsed",
				"endLine": 195,
				"endColumn": 39
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Date class. Use SvelteDate instead.",
				"line": 200,
				"column": 18,
				"nodeType": "NewExpression",
				"messageId": "mutableDateUsed",
				"endLine": 200,
				"endColumn": 35
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 226,
				"column": 8,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 226,
				"endColumn": 33
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 231,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 231,
				"endColumn": 48
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 233,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 233,
				"endColumn": 49
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 537,
				"column": 26,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 537,
				"endColumn": 58
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 681,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 683,
				"endColumn": 12
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 742,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 752,
				"endColumn": 11
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 969,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 993,
				"endColumn": 11
			}
		],
		"suppressedMessages": [
			{
				"ruleId": "svelte/require-store-reactive-access",
				"severity": 2,
				"message": "Use the $ prefix or the get function to access reactive values instead of accessing the raw store.",
				"line": 23,
				"column": 33,
				"nodeType": "Identifier",
				"messageId": "usingRawStoreInText",
				"endLine": 23,
				"endColumn": 41,
				"fix": { "range": [952, 952], "text": "$" },
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 7,
		"fatalErrorCount": 0,
		"warningCount": 4,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { expenses, isLoading as expensesLoading } from '$lib/stores/expenses';\n\timport { trips, isLoading as tripsLoading } from '$lib/stores/trips';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { user } from '$lib/stores/auth';\n\timport { toasts } from '$lib/stores/toast';\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport Skeleton from '$lib/components/ui/Skeleton.svelte';\n\timport { goto, invalidateAll } from '$app/navigation';\n\timport { page } from '$app/stores';\n\timport { onDestroy } from 'svelte';\n\timport type { PageData } from './$types';\n\n\texport let data: PageData;\n\n\t// [!code fix] HYDRATION\n\t$: if (data.expenses) {\n\t\tconst normalize = (records: any[]) =>\n\t\t\trecords.map((r) => ({ ...r, syncStatus: (r as any).syncStatus ?? 'synced' }));\n\t\tconst normalized = normalize(data.expenses);\n\n\t\t// eslint-disable-next-line svelte/require-store-reactive-access\n\t\tif ($user?.id && 'hydrate' in expenses) {\n\t\t\texpenses.hydrate(normalized, $user.id);\n\t\t} else {\n\t\t\texpenses.set(normalized);\n\t\t}\n\t}\n\n\t// --- STATE ---\n\tlet searchQuery = '';\n\tlet sortBy = 'date';\n\tlet sortOrder = 'desc';\n\tlet filterCategory = 'all';\n\n\tconst _now = new Date();\n\tfunction _fmtInput(d: Date) {\n\t\treturn d.toISOString().slice(0, 10);\n\t}\n\tlet startDate = _fmtInput(new Date(_now.getFullYear(), _now.getMonth(), 1));\n\tlet endDate = _fmtInput(new Date(_now.getFullYear(), _now.getMonth() + 1, 0));\n\n\tlet lastHadSelections = false;\n\n\t// Pagination\n\tlet currentPage = 1;\n\tconst itemsPerPage = 20;\n\n\t// Selection State\n\tlet selectedExpenses = new Set<string>();\n\n\t// Pagination state\n\tlet visibleExpenses: any[] = [];\n\t$: totalPages = Math.ceil(filteredExpenses.length / itemsPerPage);\n\t$: visibleExpenses = filteredExpenses.slice(\n\t\t(currentPage - 1) * itemsPerPage,\n\t\tcurrentPage * itemsPerPage\n\t);\n\n\t$: if (typeof document !== 'undefined') {\n\t\tconst hasSelections = selectedExpenses.size > 0;\n\t\tif (hasSelections !== lastHadSelections) {\n\t\t\tif (hasSelections) {\n\t\t\t\tdocument.body.classList.add('has-selections');\n\t\t\t} else {\n\t\t\t\tdocument.body.classList.remove('has-selections');\n\t\t\t}\n\t\t\tlastHadSelections = hasSelections;\n\t\t}\n\t}\n\n\t// Clean up body class when component is destroyed\n\tonDestroy(() => {\n\t\tif (typeof document !== 'undefined') {\n\t\t\tdocument.body.classList.remove('has-selections');\n\t\t}\n\t});\n\n\t// Use categories from settings, default to basic if empty\n\t$: categories =\n\t\t$userSettings.expenseCategories?.length > 0\n\t\t\t? $userSettings.expenseCategories\n\t\t\t: ['maintenance', 'insurance', 'supplies', 'other'];\n\n\t// Which sub-category tab is active in the modal\n\tlet activeCategoryType: 'maintenance' | 'supplies' | 'expenses' = 'expenses';\n\n\t// Derive the active list depending on the selected tab\n\t$: activeCategories =\n\t\tactiveCategoryType === 'maintenance'\n\t\t\t? $userSettings.maintenanceCategories || ['oil change', 'repair']\n\t\t\t: activeCategoryType === 'supplies'\n\t\t\t\t? $userSettings.supplyCategories || ['water', 'snacks']\n\t\t\t\t: $userSettings.expenseCategories || ['maintenance', 'insurance', 'supplies', 'other'];\n\n\t// --- MODAL STATE (Only for Categories now) ---\n\tlet isManageCategoriesOpen = false;\n\tlet newCategoryName = '';\n\n\t// --- DERIVE TRIP EXPENSES ---\n\t$: tripExpenses = $trips.flatMap((trip) => {\n\t\tconst items = [];\n\t\tconst date =\n\t\t\ttrip.date || (typeof trip.createdAt === 'string' ? trip.createdAt.split('T')[0] : '');\n\n\t\t// 1. Fuel\n\t\tif (trip.fuelCost && trip.fuelCost > 0) {\n\t\t\titems.push({\n\t\t\t\tid: `trip-fuel-${trip.id}`,\n\t\t\t\tdate: date,\n\t\t\t\tcategory: 'fuel',\n\t\t\t\tamount: trip.fuelCost,\n\t\t\t\tdescription: 'Fuel',\n\t\t\t\ttaxDeductible: !!(trip as any).fuelTaxDeductible,\n\t\t\t\tsource: 'trip',\n\t\t\t\ttripId: trip.id\n\t\t\t});\n\t\t}\n\n\t\t// 2. Maintenance Items\n\t\tconst maint = (trip as any).maintenanceItems || [];\n\t\tif (maint.length) {\n\t\t\tmaint.forEach((item: any, i: number) => {\n\t\t\t\titems.push({\n\t\t\t\t\tid: `trip-maint-${trip.id}-${i}`,\n\t\t\t\t\tdate: date,\n\t\t\t\t\tcategory: 'maintenance',\n\t\t\t\t\tamount: item.cost,\n\t\t\t\t\tdescription: `${item.type}`,\n\t\t\t\t\ttaxDeductible: !!item.taxDeductible,\n\t\t\t\t\tsource: 'trip',\n\t\t\t\t\ttripId: trip.id\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t// 3. Supply Items\n\t\tconst supplies = (trip as any).supplyItems || (trip as any).suppliesItems || [];\n\t\tif (supplies.length) {\n\t\t\tsupplies.forEach((item: any, i: number) => {\n\t\t\t\titems.push({\n\t\t\t\t\tid: `trip-supply-${trip.id}-${i}`,\n\t\t\t\t\tdate: date,\n\t\t\t\t\tcategory: 'supplies',\n\t\t\t\t\tamount: item.cost,\n\t\t\t\t\tdescription: `${item.type}`,\n\t\t\t\t\ttaxDeductible: !!item.taxDeductible,\n\t\t\t\t\tsource: 'trip',\n\t\t\t\t\ttripId: trip.id\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn items;\n\t});\n\n\t// --- COMBINE & FILTER ---\n\t$: allExpenses = [...$expenses, ...tripExpenses];\n\n\t// Reset selection when filters change\n\t$: if (searchQuery || sortBy || sortOrder || filterCategory || startDate || endDate) {\n\t\tselectedExpenses = new Set();\n\t\tcurrentPage = 1;\n\t}\n\n\t$: filteredExpenses = allExpenses\n\t\t.filter((item) => {\n\t\t\t// Search\n\t\t\tconst query = searchQuery.toLowerCase();\n\t\t\tconst matchesSearch =\n\t\t\t\t!query ||\n\t\t\t\t(item.description && item.description.toLowerCase().includes(query)) ||\n\t\t\t\titem.amount.toString().includes(query) ||\n\t\t\t\t((item as any).source === 'trip' && 'trip'.includes(query)) ||\n\t\t\t\t(item.category && item.category.toLowerCase().includes(query)) ||\n\t\t\t\t((item as any).tags &&\n\t\t\t\t\tArray.isArray((item as any).tags) &&\n\t\t\t\t\t(item as any).tags.some((tag: string) => tag.toLowerCase().includes(query))) ||\n\t\t\t\t((item as any).taxDeductible &&\n\t\t\t\t\t('tax deductible'.includes(query) ||\n\t\t\t\t\t\t'deductible'.includes(query) ||\n\t\t\t\t\t\t'tax'.includes(query)));\n\n\t\t\tif (!matchesSearch) return false;\n\n\t\t\t// Category\n\t\t\tif (filterCategory !== 'all' && item.category !== filterCategory) return false;\n\n\t\t\t// Date Range\n\t\t\tif (item.date) {\n\t\t\t\tconst itemDate = new Date(item.date);\n\t\t\t\titemDate.setHours(0, 0, 0, 0);\n\n\t\t\t\tif (startDate) {\n\t\t\t\t\tconst start = new Date(startDate);\n\t\t\t\t\tstart.setHours(0, 0, 0, 0);\n\t\t\t\t\tif (itemDate < start) return false;\n\t\t\t\t}\n\t\t\t\tif (endDate) {\n\t\t\t\t\tconst end = new Date(endDate);\n\t\t\t\t\tend.setHours(0, 0, 0, 0);\n\t\t\t\t\tif (itemDate > end) return false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t})\n\t\t.sort((a, b) => {\n\t\t\tlet aVal, bVal;\n\t\t\tif (sortBy === 'date') {\n\t\t\t\taVal = new Date(a.date || 0).getTime();\n\t\t\t\tbVal = new Date(b.date || 0).getTime();\n\t\t\t} else {\n\t\t\t\taVal = a.amount;\n\t\t\t\tbVal = b.amount;\n\t\t\t}\n\t\t\treturn sortOrder === 'asc' ? aVal - bVal : bVal - aVal;\n\t\t});\n\n\t$: totalAmount = filteredExpenses.reduce((sum, item) => sum + (item.amount || 0), 0);\n\t$: loading = $expensesLoading || $tripsLoading;\n\t$: allSelected = filteredExpenses.length > 0 && selectedExpenses.size === filteredExpenses.length;\n\n\t// --- ACTIONS ---\n\tfunction goToAdd() {\n\t\tgoto('/dashboard/expenses/new');\n\t}\n\n\tfunction editExpense(expense: any) {\n\t\tif ((expense as any).source === 'trip') {\n\t\t\tgoto(`/dashboard/trips?id=${expense.tripId}`);\n\t\t} else {\n\t\t\tgoto(`/dashboard/expenses/edit/${expense.id}`);\n\t\t}\n\t}\n\n\tasync function deleteExpense(id: string, e?: MouseEvent) {\n\t\tif (e) e.stopPropagation();\n\t\tif (!confirm('Move this expense to trash? You can restore it later.')) return;\n\n\t\t// Check if it's a trip log\n\t\tif (id.startsWith('trip-')) {\n\t\t\ttoasts.error('Cannot delete Trips here. Delete the Trip instead.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUser = $page.data['user'] || $user;\n\t\t// [!code fix] Strictly use ID.\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id');\n\n\t\tif (userId) {\n\t\t\ttry {\n\t\t\t\tawait expenses.deleteExpense(id, userId);\n\t\t\t\ttoasts.success('Expense moved to trash');\n\t\t\t\tif (selectedExpenses.has(id)) {\n\t\t\t\t\tselectedExpenses.delete(id);\n\t\t\t\t\tselectedExpenses = selectedExpenses;\n\t\t\t\t}\n\t\t\t\t// [!code fix] Refresh page data to ensure server sync\n\t\t\t\tawait invalidateAll();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\ttoasts.error('Failed to move to trash');\n\t\t\t}\n\t\t}\n\t}\n\n\t// --- SELECTION LOGIC ---\n\tfunction toggleSelection(id: string) {\n\t\tif (selectedExpenses.has(id)) selectedExpenses.delete(id);\n\t\telse selectedExpenses.add(id);\n\t\tselectedExpenses = selectedExpenses;\n\t}\n\n\tfunction toggleSelectAll() {\n\t\tif (allSelected) selectedExpenses = new Set();\n\t\telse selectedExpenses = new Set(filteredExpenses.map((e) => e.id));\n\t}\n\n\tfunction changePage(newPage: number) {\n\t\tif (newPage >= 1 && newPage <= totalPages) {\n\t\t\tcurrentPage = newPage;\n\t\t}\n\t}\n\n\tasync function deleteSelected() {\n\t\tconst ids = Array.from(selectedExpenses);\n\t\tconst manualExpenses = ids.filter((id) => !id.startsWith('trip-'));\n\t\tconst tripLogs = ids.length - manualExpenses.length;\n\n\t\tif (manualExpenses.length === 0 && tripLogs > 0) {\n\t\t\ttoasts.error(`Cannot delete ${tripLogs} Trip Logs. Edit them in Trips.`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!confirm(\n\t\t\t\t`Move ${manualExpenses.length} expenses to trash? ${tripLogs > 0 ? `(${tripLogs} trips will be skipped)` : ''}`\n\t\t\t)\n\t\t)\n\t\t\treturn;\n\n\t\tconst currentUser = $page.data['user'] || $user;\n\t\t// [!code fix] Strictly use ID.\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id');\n\n\t\tif (!userId) return;\n\n\t\tlet successCount = 0;\n\t\tfor (const id of manualExpenses) {\n\t\t\ttry {\n\t\t\t\tawait expenses.deleteExpense(id, userId);\n\t\t\t\tsuccessCount++;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(`Failed to delete ${id}`, err);\n\t\t\t}\n\t\t}\n\n\t\ttoasts.success(`Moved ${successCount} expenses to trash.`);\n\t\tselectedExpenses = new Set();\n\t\t// [!code fix] Refresh page data to ensure server sync\n\t\tawait invalidateAll();\n\t}\n\n\tfunction isTripSource(item: any): boolean {\n\t\treturn (item as any)?.source === 'trip';\n\t}\n\n\tfunction exportSelected() {\n\t\tconst selectedData = filteredExpenses.filter((e) => selectedExpenses.has(e.id));\n\t\tif (selectedData.length === 0) return;\n\n\t\tconst headers = ['Date', 'Category', 'Amount', 'Description', 'Source'];\n\t\tconst rows = selectedData.map((e) =>\n\t\t\t[\n\t\t\t\te.date,\n\t\t\t\te.category,\n\t\t\t\te.amount,\n\t\t\t\t`\"${(e.description || '').replace(/\"/g, '\"\"')}\"`,\n\t\t\t\tisTripSource(e) ? 'Trip' : 'Manual'\n\t\t\t].join(',')\n\t\t);\n\n\t\tconst csvContent = [headers.join(','), ...rows].join('\\n');\n\t\tconst blob = new Blob([csvContent], { type: 'text/csv' });\n\t\tconst url = window.URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `expenses_export_${new Date().toISOString().split('T')[0]}.csv`;\n\t\ta.click();\n\n\t\ttoasts.success(`Exported ${selectedData.length} items.`);\n\t\tselectedExpenses = new Set();\n\t}\n\n\t// --- CATEGORY MANAGEMENT ---\n\tasync function updateCategories(newCategories: string[]) {\n\t\tconst updateData: any = {};\n\t\tif (activeCategoryType === 'maintenance') {\n\t\t\tuserSettings.update((s) => ({ ...s, maintenanceCategories: newCategories }));\n\t\t\tupdateData.maintenanceCategories = newCategories;\n\t\t} else if (activeCategoryType === 'supplies') {\n\t\t\tuserSettings.update((s) => ({ ...s, supplyCategories: newCategories }));\n\t\t\tupdateData.supplyCategories = newCategories;\n\t\t} else {\n\t\t\tuserSettings.update((s) => ({ ...s, expenseCategories: newCategories }));\n\t\t\tupdateData.expenseCategories = newCategories;\n\t\t}\n\n\t\ttry {\n\t\t\tconst { saveSettings } = await import('../settings/lib/save-settings');\n\t\t\tconst result = await saveSettings(updateData);\n\t\t\tif (!result.ok) throw new Error(result.error);\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to sync settings', e);\n\t\t\ttoasts.error('Saved locally, but sync failed');\n\t\t}\n\t}\n\n\tasync function addCategory() {\n\t\tif (!newCategoryName.trim()) return;\n\t\tconst val = newCategoryName.trim().toLowerCase();\n\t\tif (activeCategories.includes(val)) {\n\t\t\ttoasts.error('Category already exists');\n\t\t\treturn;\n\t\t}\n\t\tconst updated = [...activeCategories, val];\n\t\tawait updateCategories(updated);\n\t\tnewCategoryName = '';\n\t\ttoasts.success('Category added');\n\t}\n\n\tasync function removeCategory(cat: string) {\n\t\tif (!confirm(`Delete \"${cat}\" category? Existing expenses will keep this category.`)) return;\n\t\tconst updated = activeCategories.filter((c) => c !== cat);\n\t\tawait updateCategories(updated);\n\t\ttoasts.success('Category removed');\n\t}\n\n\t// --- HELPERS ---\n\tfunction formatCurrency(amount: number) {\n\t\treturn new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);\n\t}\n\n\tfunction formatDate(dateStr: string) {\n\t\tif (!dateStr) return '';\n\t\treturn new Date(dateStr).toLocaleDateString('en-US', {\n\t\t\tmonth: 'short',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric',\n\t\t\ttimeZone: 'UTC'\n\t\t});\n\t}\n\n\tfunction getCategoryLabel(cat: string) {\n\t\treturn cat.charAt(0).toUpperCase() + cat.slice(1);\n\t}\n\n\tfunction getCategoryColor(cat: string) {\n\t\tif (cat === 'fuel') return 'text-red-600 bg-red-50 border-red-200';\n\t\tconst colors = [\n\t\t\t'text-blue-600 bg-blue-50 border-blue-200',\n\t\t\t'text-purple-600 bg-purple-50 border-purple-200',\n\t\t\t'text-orange-600 bg-orange-50 border-orange-200',\n\t\t\t'text-green-600 bg-green-50 border-green-200',\n\t\t\t'text-pink-600 bg-pink-50 border-pink-200',\n\t\t\t'text-indigo-600 bg-indigo-50 border-indigo-200'\n\t\t];\n\t\tif (cat === 'maintenance') return colors[0];\n\t\tif (cat === 'insurance') return colors[1];\n\t\tif (cat === 'supplies') return colors[2];\n\t\tconst sum = cat.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n\t\treturn colors[sum % colors.length];\n\t}\n\n\t// When an expense description is empty, show a parent category label (Maintenance/Supplies/etc.)\n\tfunction getFallbackLabel(expense: any) {\n\t\tconst cat = (expense.category || '').toString().toLowerCase();\n\t\t// maintenance categories from settings or defaults\n\t\tconst maintenance = (\n\t\t\t$userSettings.maintenanceCategories || [\n\t\t\t\t'oil change',\n\t\t\t\t'tire rotation',\n\t\t\t\t'brake service',\n\t\t\t\t'filter replacement'\n\t\t\t]\n\t\t).map((s) => s.toLowerCase());\n\t\tif (maintenance.includes(cat)) return 'Maintenance';\n\n\t\tconst supplies = (\n\t\t\t$userSettings.supplyCategories || ['concrete', 'poles', 'wire', 'tools', 'equipment rental']\n\t\t).map((s) => s.toLowerCase());\n\t\tif (supplies.includes(cat)) return 'Supplies';\n\n\t\tif (cat === 'fuel') return 'Fuel';\n\n\t\t// If the category is one of the top-level expense categories, show it capitalized\n\t\tconst expCats = (\n\t\t\t$userSettings.expenseCategories || ['maintenance', 'insurance', 'supplies', 'other']\n\t\t).map((s) => s.toLowerCase());\n\t\tif (expCats.includes(cat)) return getCategoryLabel(cat);\n\n\t\t// default fallback: capitalized category (or 'Expenses')\n\t\treturn getCategoryLabel(expense.category || 'expenses');\n\t}\n\n\t// Swipe Action\n\tfunction swipeable(\n\t\tnode: HTMLElement,\n\t\t{\n\t\t\tonEdit,\n\t\t\tonDelete,\n\t\t\tisReadOnly\n\t\t}: { onEdit: () => void; onDelete: (e: any) => void; isReadOnly: boolean }\n\t) {\n\t\tif (isReadOnly) return;\n\t\tlet startX = 0;\n\t\tlet x = 0;\n\t\tlet swiping = false;\n\n\t\tfunction handleTouchStart(e: TouchEvent) {\n\t\t\tconst touch = e.touches?.[0];\n\t\t\tif (!touch) return;\n\t\t\tstartX = touch.clientX;\n\t\t\tx = 0;\n\t\t\tnode.style.transition = 'none';\n\t\t}\n\n\t\tfunction handleTouchMove(e: TouchEvent) {\n\t\t\tconst touch = e.touches?.[0];\n\t\t\tif (!touch) return;\n\t\t\tconst dx = touch.clientX - startX;\n\t\t\tswiping = true;\n\t\t\tif (dx < -120) x = -120;\n\t\t\telse if (dx > 120) x = 120;\n\t\t\telse x = dx;\n\t\t\tnode.style.transform = `translateX(${x}px)`;\n\t\t\tif (Math.abs(x) > 10) e.preventDefault();\n\t\t}\n\n\t\tfunction handleTouchEnd() {\n\t\t\tif (!swiping) return;\n\t\t\tswiping = false;\n\t\t\tnode.style.transition = 'transform 0.2s ease-out';\n\t\t\tif (x < -80) onDelete({ stopPropagation: () => {} });\n\t\t\telse if (x > 80) onEdit();\n\t\t\tnode.style.transform = 'translateX(0)';\n\t\t}\n\n\t\tnode.addEventListener('touchstart', handleTouchStart, { passive: false });\n\t\tnode.addEventListener('touchmove', handleTouchMove, { passive: false });\n\t\tnode.addEventListener('touchend', handleTouchEnd);\n\t\treturn {\n\t\t\tdestroy() {\n\t\t\t\tnode.removeEventListener('touchstart', handleTouchStart);\n\t\t\t\tnode.removeEventListener('touchmove', handleTouchMove);\n\t\t\t\tnode.removeEventListener('touchend', handleTouchEnd);\n\t\t\t}\n\t\t};\n\t}\n</script>\n\n<svelte:head>\n\t<title>Expenses - Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"page-container\">\n\t<div class=\"page-header\">\n\t\t<div class=\"header-text\">\n\t\t\t<h1 class=\"page-title\">Expenses</h1>\n\t\t\t<p class=\"page-subtitle\">Track maintenance, supplies, and other costs</p>\n\t\t</div>\n\n\t\t<div class=\"header-actions\">\n\t\t\t<button\n\t\t\t\tclass=\"btn-secondary\"\n\t\t\t\ton:click={() => goto('/dashboard/trash?type=expenses')}\n\t\t\t\taria-label=\"View Trash\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t>\n\t\t\t\t\t<polyline points=\"3 6 5 6 21 6\"></polyline>\n\t\t\t\t\t<path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"\n\t\t\t\t\t></path>\n\t\t\t\t</svg>\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tclass=\"btn-secondary\"\n\t\t\t\ton:click={() => (isManageCategoriesOpen = true)}\n\t\t\t\taria-label=\"Expense Settings\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t><path\n\t\t\t\t\t\td=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"\n\t\t\t\t\t/><circle cx=\"12\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t>\n\t\t\t</button>\n\n\t\t\t<button class=\"btn-primary\" on:click={goToAdd}>\n\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M10 4V16M4 10H16\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\tNew Expense\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\n\t<div class=\"stats-summary\">\n\t\t<div class=\"summary-card\">\n\t\t\t<div class=\"summary-label\">Total Expenses</div>\n\t\t\t<div class=\"summary-value\">{filteredExpenses.length}</div>\n\t\t</div>\n\n\t\t<div class=\"summary-card\">\n\t\t\t<div class=\"summary-label\">Total Cost</div>\n\t\t\t<div class=\"summary-value\">\n\t\t\t\t{formatCurrency(totalAmount)}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"summary-card\">\n\t\t\t<div class=\"summary-label\">Tax Deductions</div>\n\t\t\t<div class=\"summary-value\">\n\t\t\t\t{formatCurrency(\n\t\t\t\t\tfilteredExpenses.filter((e) => e.taxDeductible === true).reduce((s, e) => s + e.amount, 0)\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"summary-card\">\n\t\t\t<div class=\"summary-label\">Non Tax Deductions</div>\n\t\t\t<div class=\"summary-value\">\n\t\t\t\t{formatCurrency(\n\t\t\t\t\tfilteredExpenses\n\t\t\t\t\t\t.filter((e) => !(e.taxDeductible === true))\n\t\t\t\t\t\t.reduce((s, e) => s + e.amount, 0)\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"filters-bar\">\n\t\t<div class=\"search-box\">\n\t\t\t<svg class=\"search-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t<path\n\t\t\t\t\td=\"M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td=\"M19 19L14.65 14.65\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t\t<input\n\t\t\t\tid=\"search-expenses\"\n\t\t\t\tname=\"searchQuery\"\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder=\"Search expenses...\"\n\t\t\t\tbind:value={searchQuery}\n\t\t\t/>\n\t\t</div>\n\n\t\t<div class=\"filter-group date-group\">\n\t\t\t<input\n\t\t\t\tid=\"start-date\"\n\t\t\t\tname=\"startDate\"\n\t\t\t\ttype=\"date\"\n\t\t\t\tbind:value={startDate}\n\t\t\t\tclass=\"date-input\"\n\t\t\t\taria-label=\"Start Date\"\n\t\t\t/>\n\t\t\t<span class=\"date-sep\">-</span>\n\t\t\t<input\n\t\t\t\tid=\"end-date\"\n\t\t\t\tname=\"endDate\"\n\t\t\t\ttype=\"date\"\n\t\t\t\tbind:value={endDate}\n\t\t\t\tclass=\"date-input\"\n\t\t\t\taria-label=\"End Date\"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div class=\"filter-group\">\n\t\t\t<select\n\t\t\t\tid=\"filter-category\"\n\t\t\t\tname=\"filterCategory\"\n\t\t\t\tbind:value={filterCategory}\n\t\t\t\tclass=\"filter-select\"\n\t\t\t\taria-label=\"Filter by category\"\n\t\t\t>\n\t\t\t\t<option value=\"all\">All Categories</option>\n\t\t\t\t{#each categories as cat}\n\t\t\t\t\t<option value={cat}>{getCategoryLabel(cat)}</option>\n\t\t\t\t{/each}\n\t\t\t\t<option value=\"fuel\">Fuel (Trips)</option>\n\t\t\t</select>\n\n\t\t\t<select\n\t\t\t\tid=\"sort-by\"\n\t\t\t\tname=\"sortBy\"\n\t\t\t\tbind:value={sortBy}\n\t\t\t\tclass=\"filter-select\"\n\t\t\t\taria-label=\"Sort results\"\n\t\t\t>\n\t\t\t\t<option value=\"date\">By Date</option>\n\t\t\t\t<option value=\"amount\">By Cost</option>\n\t\t\t</select>\n\n\t\t\t<button\n\t\t\t\tclass=\"sort-btn\"\n\t\t\t\taria-label=\"Toggle sort order\"\n\t\t\t\ton:click={() => (sortOrder = sortOrder === 'asc' ? 'desc' : 'asc')}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstyle=\"transform: rotate({sortOrder === 'asc' ? '180deg' : '0deg'})\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M10 3V17M10 17L4 11M10 17L16 11\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\n\t{#if filteredExpenses.length > 0}\n\t\t<div class=\"batch-header\" class:visible={filteredExpenses.length > 0}>\n\t\t\t<label class=\"checkbox-container\">\n\t\t\t\t<input\n\t\t\t\t\tid=\"select-all\"\n\t\t\t\t\tname=\"selectAll\"\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tchecked={allSelected}\n\t\t\t\t\ton:change={toggleSelectAll}\n\t\t\t\t/>\n\t\t\t\t<span class=\"checkmark\"></span>\n\t\t\t\tSelect All ({filteredExpenses.length})\n\t\t\t</label>\n\n\t\t\t<span class=\"page-info\">Showing {visibleExpenses.length} of {filteredExpenses.length}</span>\n\t\t</div>\n\t{/if}\n\n\t{#if loading}\n\t\t<div class=\"expense-list-cards\">\n\t\t\t{#each Array(3) as _}\n\t\t\t\t<div class=\"expense-card\">\n\t\t\t\t\t<div class=\"card-top\">\n\t\t\t\t\t\t<div style=\"flex: 1\">\n\t\t\t\t\t\t\t<Skeleton height=\"16px\" width=\"30%\" className=\"mb-2\" />\n\t\t\t\t\t\t\t<Skeleton height=\"20px\" width=\"60%\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Skeleton height=\"24px\" width=\"60px\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\t{:else if filteredExpenses.length > 0}\n\t\t<div class=\"expense-list-cards\">\n\t\t\t{#each visibleExpenses as expense (expense.id)}\n\t\t\t\t{@const isSelected = selectedExpenses.has(expense.id)}\n\t\t\t\t<div class=\"card-wrapper\">\n\t\t\t\t\t{#if !isTripSource(expense)}\n\t\t\t\t\t\t<div class=\"swipe-bg\">\n\t\t\t\t\t\t\t<div class=\"swipe-action edit\"><span>Edit</span></div>\n\t\t\t\t\t\t\t<div class=\"swipe-action delete\"><span>Trash</span></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"expense-card\"\n\t\t\t\t\t\tclass:read-only={isTripSource(expense)}\n\t\t\t\t\t\tclass:selected={isSelected}\n\t\t\t\t\t\ton:click={() => editExpense(expense)}\n\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\ton:keypress={(e) => e.key === 'Enter' && editExpense(expense)}\n\t\t\t\t\t\tuse:swipeable={{\n\t\t\t\t\t\t\tonEdit: () => editExpense(expense),\n\t\t\t\t\t\t\tonDelete: (e) => deleteExpense(expense.id, e),\n\t\t\t\t\t\t\tisReadOnly: isTripSource(expense)\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"card-top\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"selection-box\"\n\t\t\t\t\t\t\t\ton:click|stopPropagation\n\t\t\t\t\t\t\t\ton:keydown|stopPropagation\n\t\t\t\t\t\t\t\trole=\"none\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<label class=\"checkbox-container\">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\t\tid={'expense-' + expense.id + '-checkbox'}\n\t\t\t\t\t\t\t\t\t\tname=\"selectedExpense\"\n\t\t\t\t\t\t\t\t\t\tvalue={expense.id}\n\t\t\t\t\t\t\t\t\t\taria-labelledby={'expense-' + expense.id + '-title'}\n\t\t\t\t\t\t\t\t\t\tchecked={isSelected}\n\t\t\t\t\t\t\t\t\t\ton:change={() => toggleSelection(expense.id)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<span class=\"checkmark\"></span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"expense-main-info\">\n\t\t\t\t\t\t\t\t<span class=\"expense-date-display\">\n\t\t\t\t\t\t\t\t\t{formatDate(expense.date || '')}\n\t\t\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t\t\t<h2 class=\"expense-desc-title\" id={'expense-' + expense.id + '-title'}>\n\t\t\t\t\t\t\t\t\t{expense.description || getFallbackLabel(expense)}\n\t\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass=\"expense-amount-display\"\n\t\t\t\t\t\t\t\taria-label={`Amount: ${formatCurrency(expense.amount || 0)}`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{formatCurrency(expense.amount || 0)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<svg class=\"nav-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M9 18L15 12L9 6\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"card-stats\">\n\t\t\t\t\t\t\t<div class=\"stat-badge-container\">\n\t\t\t\t\t\t\t\t<span class={`category-badge ${getCategoryColor(expense.category)}`}>\n\t\t\t\t\t\t\t\t\t{getCategoryLabel(expense.category)}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t{#if isTripSource(expense)}\n\t\t\t\t\t\t\t\t\t<span class=\"source-badge\">Trip</span>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{#if expense.taxDeductible}\n\t\t\t\t\t\t\t\t\t<span class=\"category-badge tax-pill\" title=\"Tax deductible\">Tax Deductible</span>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\n\t\t{#if totalPages > 1}\n\t\t\t<div class=\"pagination-container\">\n\t\t\t\t<div class=\"pagination\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"pagination-btn\"\n\t\t\t\t\t\tdisabled={currentPage === 1}\n\t\t\t\t\t\ton:click={() => changePage(currentPage - 1)}>← Prev</button\n\t\t\t\t\t>\n\t\t\t\t\t<span class=\"page-status\">Page {currentPage} of {totalPages}</span>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"pagination-btn\"\n\t\t\t\t\t\tdisabled={currentPage === totalPages}\n\t\t\t\t\t\ton:click={() => changePage(currentPage + 1)}>Next →</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t{:else}\n\t\t<div class=\"empty-state\">\n\t\t\t<p>No expenses found matching your filters.</p>\n\t\t</div>\n\t{/if}\n</div>\n\n{#if selectedExpenses.size > 0}\n\t<div class=\"action-bar-container\" data-has-selections=\"true\">\n\t\t<div class=\"action-bar\">\n\t\t\t<div class=\"action-bar-left\">\n\t\t\t\t<div class=\"selection-indicator\">\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<polyline points=\"20 6 9 17 4 12\"></polyline>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"selected-count\"\n\t\t\t\t\t\t>{selectedExpenses.size}\n\t\t\t\t\t\t{selectedExpenses.size === 1 ? 'expense' : 'expenses'} selected</span\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"action-bar-right\">\n\t\t\t\t<button class=\"action-pill secondary\" on:click={() => (selectedExpenses = new Set())}>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n\t\t\t\t\t\t<line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"action-text\">Cancel</span>\n\t\t\t\t</button>\n\n\t\t\t\t<button class=\"action-pill export\" on:click={exportSelected}>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n\t\t\t\t\t\t<polyline points=\"7 10 12 15 17 10\"></polyline>\n\t\t\t\t\t\t<line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"action-text\">Export</span>\n\t\t\t\t</button>\n\n\t\t\t\t<button class=\"action-pill danger\" on:click={deleteSelected}>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<polyline points=\"3 6 5 6 21 6\"></polyline>\n\t\t\t\t\t\t<path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"\n\t\t\t\t\t\t></path>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"action-text\">Delete</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n<Modal bind:open={isManageCategoriesOpen} title=\"Expense Settings\">\n\t<div class=\"categories-manager\">\n\t\t<div class=\"tabs sub-tabs\">\n\t\t\t<button\n\t\t\t\tclass=\"tab-btn\"\n\t\t\t\tclass:active={activeCategoryType === 'maintenance'}\n\t\t\t\ton:click={() => (activeCategoryType = 'maintenance')}>Maintenance</button\n\t\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"tab-btn\"\n\t\t\t\tclass:active={activeCategoryType === 'supplies'}\n\t\t\t\ton:click={() => (activeCategoryType = 'supplies')}>Supplies</button\n\t\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"tab-btn\"\n\t\t\t\tclass:active={activeCategoryType === 'expenses'}\n\t\t\t\ton:click={() => (activeCategoryType = 'expenses')}>Expenses</button\n\t\t\t>\n\t\t</div>\n\n\t\t<p class=\"text-sm text-gray-500 mb-4\">\n\t\t\tManage {activeCategoryType} options.\n\t\t</p>\n\n\t\t<div class=\"cat-list\">\n\t\t\t{#each activeCategories as cat}\n\t\t\t\t<div class=\"cat-item\">\n\t\t\t\t\t<span class={`cat-badge ${getCategoryColor(cat)}`}>{getCategoryLabel(cat)}</span>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"cat-delete\"\n\t\t\t\t\t\ton:click={() => removeCategory(cat)}\n\t\t\t\t\t\taria-label=\"Delete Category\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"\n\t\t\t\t\t\t\t></line></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"text-sm text-gray-400 italic text-center py-4\">No categories defined.</div>\n\t\t\t{/each}\n\t\t</div>\n\n\t\t<div class=\"add-cat-form\">\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tbind:value={newCategoryName}\n\t\t\t\tplaceholder=\"New category...\"\n\t\t\t\tclass=\"input-field\"\n\t\t\t\ton:keydown={(e) => e.key === 'Enter' && addCategory()}\n\t\t\t/>\n\t\t\t<button class=\"btn-secondary\" on:click={addCategory}>Add</button>\n\t\t</div>\n\n\t\t<div class=\"modal-actions mt-6\">\n\t\t\t<button class=\"btn-cancel w-full\" on:click={() => (isManageCategoriesOpen = false)}\n\t\t\t\t>Done</button\n\t\t\t>\n\t\t</div>\n\t</div>\n</Modal>\n\n<style>\n\t* {\n\t\tbox-sizing: border-box;\n\t}\n\n\t:global(body) {\n\t\toverflow-x: hidden;\n\t}\n\n\t.page-container {\n\t\tmax-width: 1400px;\n\t\tmargin: 0 auto;\n\t\tpadding: 16px;\n\t\tpadding-bottom: 80px;\n\t\toverflow-x: hidden;\n\t}\n\n\t/* Page Headers & Actions */\n\t.page-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 24px;\n\t}\n\t.page-title {\n\t\tfont-size: 24px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tmargin: 0;\n\t}\n\t.header-actions {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n\t}\n\n\t.btn-primary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tpadding: 10px 16px;\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcursor: pointer;\n\t\tbox-shadow: 0 2px 8px rgba(255, 127, 80, 0.3);\n\t\ttransition: transform 0.1s;\n\t\ttext-decoration: none;\n\t}\n\t.btn-primary:active {\n\t\ttransform: translateY(1px);\n\t}\n\n\t.btn-secondary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 10px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcursor: pointer;\n\t\ttransition: background 0.2s;\n\t}\n\n\t@media (hover: hover) {\n\t\t.btn-secondary:hover {\n\t\t\tbackground: #f9fafb;\n\t\t}\n\t\t.cat-delete:hover {\n\t\t\tbackground: #ef4444;\n\t\t\tcolor: white;\n\t\t}\n\t}\n\n\t/* Stats Summary */\n\t.stats-summary {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(2, 1fr);\n\t\tgap: 12px;\n\t\tmargin-bottom: 24px;\n\t}\n\t.summary-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tpadding: 16px;\n\t\ttext-align: center;\n\t}\n\t.summary-label {\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 0.5px;\n\t\tmargin-bottom: 4px;\n\t}\n\t.summary-value {\n\t\tfont-size: 20px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t}\n\n\t/* Filter Bar */\n\t.filters-bar {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t\tmargin-bottom: 20px;\n\t}\n\n\t.search-box {\n\t\tposition: relative;\n\t\twidth: 100%;\n\t}\n\t.search-icon {\n\t\tposition: absolute;\n\t\tleft: 14px;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\tcolor: #9ca3af;\n\t\tpointer-events: none;\n\t}\n\t.search-box input {\n\t\twidth: 100%;\n\t\tpadding: 12px 16px 12px 42px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 15px;\n\t\tbackground: white;\n\t\tbox-sizing: border-box;\n\t}\n\t.date-group {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n\t}\n\t.date-input {\n\t\tflex: 1;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 14px;\n\t\tbackground: white;\n\t\tmin-width: 0;\n\t}\n\t.date-sep {\n\t\tcolor: #9ca3af;\n\t\tfont-weight: bold;\n\t}\n\t.filter-group {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tgap: 8px;\n\t\twidth: 100%;\n\t}\n\t.filter-select {\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 14px;\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t}\n\t.sort-btn {\n\t\tflex: 0 0 48px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tbackground: white;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t}\n\n\t/* Batch Header */\n\t.batch-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 12px;\n\t\tpadding: 0 4px;\n\t\tcolor: #6b7280;\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t}\n\t.page-info {\n\t\tfont-size: 13px;\n\t}\n\n\t/* CHECKBOX STYLES */\n\t.checkbox-container {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tcursor: pointer;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #4b5563;\n\t\tposition: relative;\n\t\tpadding-left: 28px;\n\t\tuser-select: none;\n\t}\n\t.checkbox-container input {\n\t\tposition: absolute;\n\t\topacity: 0;\n\t\tcursor: pointer;\n\t\theight: 0;\n\t\twidth: 0;\n\t}\n\t.checkmark {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\theight: 20px;\n\t\twidth: 20px;\n\t\tbackground-color: white;\n\t\tborder: 2px solid #d1d5db;\n\t\tborder-radius: 6px;\n\t\ttransition: all 0.2s;\n\t}\n\n\t@media (hover: hover) {\n\t\t.checkbox-container:hover input ~ .checkmark {\n\t\t\tborder-color: #9ca3af;\n\t\t}\n\t}\n\n\t.checkbox-container input:checked ~ .checkmark {\n\t\tbackground-color: #ff7f50;\n\t\tborder-color: #ff7f50;\n\t}\n\t.checkmark:after {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tdisplay: none;\n\t}\n\t.checkbox-container input:checked ~ .checkmark:after {\n\t\tdisplay: block;\n\t}\n\t.checkbox-container .checkmark:after {\n\t\tleft: 6px;\n\t\ttop: 2px;\n\t\twidth: 5px;\n\t\theight: 10px;\n\t\tborder: solid white;\n\t\tborder-width: 0 2px 2px 0;\n\t\ttransform: rotate(45deg);\n\t}\n\n\t/* Expense List & Cards (Styled like Trips) */\n\t.expense-list-cards {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t\tmax-width: 100%;\n\t}\n\t.card-wrapper {\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t\tborder-radius: 12px;\n\t\tbackground: #f3f4f6;\n\t\tmax-width: 100%;\n\t}\n\n\t.swipe-bg {\n\t\tposition: absolute;\n\t\tinset: 0;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 0 20px;\n\t\tz-index: 0;\n\t}\n\t.swipe-action {\n\t\tfont-weight: 700;\n\t\tfont-size: 14px;\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 1px;\n\t}\n\t.swipe-action.edit {\n\t\tcolor: #2563eb;\n\t}\n\t.swipe-action.delete {\n\t\tcolor: #dc2626;\n\t}\n\n\t.expense-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tpadding: 16px;\n\t\tposition: relative;\n\t\tz-index: 1;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tmax-width: 100%;\n\t}\n\t.expense-card:active {\n\t\tbackground-color: #f9fafb;\n\t}\n\t.expense-card.read-only {\n\t\tborder-left: 4px solid #3b82f6;\n\t\tbackground: #fafafa;\n\t}\n\t.expense-card.selected {\n\t\tbackground-color: #fff7ed;\n\t\tborder-color: #ff7f50;\n\t}\n\n\t.card-top {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: auto 1fr auto auto;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding-bottom: 12px;\n\t\tmargin-bottom: 12px;\n\t\tborder-bottom: 1px solid #f3f4f6;\n\t\tmax-width: 100%;\n\t}\n\n\t.selection-box {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding-right: 4px;\n\t}\n\n\t.expense-main-info {\n\t\toverflow: hidden;\n\t\tmin-width: 0;\n\t}\n\t.expense-date-display {\n\t\tdisplay: block;\n\t\tfont-size: 12px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\tmargin-bottom: 4px;\n\t}\n\t.expense-desc-title {\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t.expense-amount-display {\n\t\tfont-size: 18px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\twhite-space: nowrap;\n\t\ttext-align: right;\n\t\tmin-width: 72px;\n\t}\n\n\t.nav-icon {\n\t\tcolor: #9ca3af;\n\t\tflex-shrink: 0;\n\t}\n\n\t.card-stats {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tmax-width: 100%;\n\t\toverflow-x: auto;\n\t}\n\t.stat-badge-container {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\tflex-wrap: wrap;\n\t}\n\n\t.category-badge {\n\t\tfont-size: 12px;\n\t\tfont-weight: 600;\n\t\tpadding: 4px 10px;\n\t\tborder-radius: 100px;\n\t\ttext-transform: capitalize;\n\t\tborder: 1px solid;\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\twhite-space: nowrap;\n\t}\n\n\t.source-badge {\n\t\tfont-size: 11px;\n\t\tfont-weight: 700;\n\t\tcolor: #3b82f6;\n\t\tbackground: #eff6ff;\n\t\tpadding: 4px 8px;\n\t\tborder-radius: 6px;\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 0.5px;\n\t\twhite-space: nowrap;\n\t}\n\n\t/* Tax pill that visually matches category badges */\n\t.tax-pill {\n\t\tfont-size: 12px;\n\t\tfont-weight: 600;\n\t\tcolor: #166534;\n\t\tbackground: #ecfdf5;\n\t\tpadding: 4px 10px;\n\t\tborder-radius: 100px;\n\t\tborder: 1px solid #bbf7d0;\n\t\ttext-transform: capitalize;\n\t\twhite-space: nowrap;\n\t}\n\n\t.empty-state {\n\t\ttext-align: center;\n\t\tpadding: 40px;\n\t\tcolor: #6b7280;\n\t\tfont-size: 15px;\n\t}\n\n\t/* Hide footer when selections are active - using body class */\n\t:global(body.has-selections .mobile-footer),\n\t:global(body.has-selections footer),\n\t:global(body.has-selections nav[class*='mobile']),\n\t:global(body.has-selections .bottom-nav) {\n\t\tdisplay: none !important;\n\t}\n\n\t/* ACTION BAR STYLES - REPLACES FOOTER ON MOBILE */\n\t.action-bar-container {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tz-index: 1000;\n\t\tpadding: 0;\n\t\tanimation: slideUpFade 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n\t\tpointer-events: none;\n\t}\n\n\t.action-bar {\n\t\tbackground: white;\n\t\tpadding: 12px 16px;\n\t\tborder-radius: 0;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t\tbox-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);\n\t\tmax-width: 100%;\n\t\twidth: 100%;\n\t\tpointer-events: auto;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\n\t.action-bar-left {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\n\t.selection-indicator {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tcolor: #ff7f50;\n\t\tfont-weight: 700;\n\t\tfont-size: 13px;\n\t\tpadding: 6px 12px;\n\t\tbackground: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);\n\t\tborder-radius: 10px;\n\t\tborder: 1px solid #fed7aa;\n\t}\n\n\t.selection-indicator svg {\n\t\tflex-shrink: 0;\n\t\twidth: 16px;\n\t\theight: 16px;\n\t}\n\n\t.selected-count {\n\t\tcolor: #c2410c;\n\t\twhite-space: nowrap;\n\t}\n\n\t.action-bar-right {\n\t\tdisplay: flex;\n\t\tgap: 6px;\n\t\tjustify-content: center;\n\t}\n\n\t.action-pill {\n\t\tborder: 2px solid transparent;\n\t\tpadding: 10px 12px;\n\t\tborder-radius: 10px;\n\t\tfont-size: 13px;\n\t\tfont-weight: 700;\n\t\tcursor: pointer;\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 6px;\n\t\ttransition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n\t\tfont-family: inherit;\n\t\twhite-space: nowrap;\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n\t}\n\n\t.action-pill svg {\n\t\tflex-shrink: 0;\n\t\twidth: 16px;\n\t\theight: 16px;\n\t}\n\n\t/* Hide text on very small screens */\n\t.action-text {\n\t\tdisplay: none;\n\t}\n\n\t.action-pill.secondary {\n\t\tbackground: white;\n\t\tcolor: #6b7280;\n\t\tborder-color: #e5e7eb;\n\t}\n\n\t.action-pill.export {\n\t\tbackground: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);\n\t\tcolor: #c2410c;\n\t\tborder-color: #fed7aa;\n\t}\n\n\t.action-pill.danger {\n\t\tbackground: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);\n\t\tcolor: #dc2626;\n\t\tborder-color: #fca5a5;\n\t}\n\n\t.action-pill:active {\n\t\ttransform: scale(0.95);\n\t}\n\n\t@media (hover: hover) {\n\t\t.action-pill.secondary:hover {\n\t\t\tbackground: #f9fafb;\n\t\t\tborder-color: #d1d5db;\n\t\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\t\t}\n\n\t\t.action-pill.export:hover {\n\t\t\tbackground: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);\n\t\t\tborder-color: #fdba74;\n\t\t\tbox-shadow: 0 2px 4px rgba(251, 146, 60, 0.15);\n\t\t}\n\n\t\t.action-pill.danger:hover {\n\t\t\tbackground: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);\n\t\t\tborder-color: #f87171;\n\t\t\tbox-shadow: 0 2px 4px rgba(220, 38, 38, 0.15);\n\t\t}\n\t}\n\n\t@keyframes slideUpFade {\n\t\tfrom {\n\t\t\ttransform: translateY(100%);\n\t\t\topacity: 0;\n\t\t}\n\t\tto {\n\t\t\ttransform: translateY(0);\n\t\t\topacity: 1;\n\t\t}\n\t}\n\n\t/* Show text on slightly larger mobile screens */\n\t@media (min-width: 380px) {\n\t\t.action-text {\n\t\t\tdisplay: inline;\n\t\t}\n\n\t\t.action-pill {\n\t\t\tpadding: 10px 14px;\n\t\t}\n\t}\n\n\t@media (min-width: 640px) {\n\t\t.action-bar-container {\n\t\t\tbottom: 30px;\n\t\t\tpadding: 0 16px;\n\t\t}\n\n\t\t.action-bar {\n\t\t\tflex-direction: row;\n\t\t\talign-items: center;\n\t\t\tjustify-content: space-between;\n\t\t\tpadding: 14px 20px;\n\t\t\tmax-width: 700px;\n\t\t\twidth: auto; /* CHANGED: from inheriting 100% to auto */\n\t\t\tgap: 16px;\n\t\t\tborder-radius: 16px;\n\t\t\tborder: 1px solid #e5e7eb;\n\t\t\tbox-shadow:\n\t\t\t\t0 0 0 1px rgba(0, 0, 0, 0.05),\n\t\t\t\t0 10px 25px -5px rgba(0, 0, 0, 0.1),\n\t\t\t\t0 8px 10px -6px rgba(0, 0, 0, 0.1);\n\t\t}\n\n\t\t.action-bar-left {\n\t\t\tjustify-content: flex-start;\n\t\t}\n\n\t\t.selection-indicator {\n\t\t\tfont-size: 14px;\n\t\t\tpadding: 8px 14px;\n\t\t}\n\n\t\t.action-bar-right {\n\t\t\tgap: 8px;\n\t\t}\n\n\t\t.action-pill {\n\t\t\tflex: 0 0 auto;\n\t\t\tmin-width: auto;\n\t\t\tpadding: 10px 18px;\n\t\t\tfont-size: 14px;\n\t\t}\n\n\t\t.action-text {\n\t\t\tdisplay: inline;\n\t\t}\n\t}\n\n\t/* Desktop */\n\t@media (min-width: 1024px) {\n\t\t.action-bar {\n\t\t\tmax-width: 800px;\n\t\t\tpadding: 16px 24px;\n\t\t}\n\n\t\t.selection-indicator {\n\t\t\tfont-size: 15px;\n\t\t\tpadding: 8px 16px;\n\t\t}\n\n\t\t.action-pill {\n\t\t\tpadding: 12px 24px;\n\t\t\tfont-size: 15px;\n\t\t}\n\t}\n\n\t/* Categories Manager Modal Styles */\n\t.categories-manager {\n\t\tpadding: 4px;\n\t}\n\t.sub-tabs {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\tmargin-bottom: 16px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t}\n\t.tab-btn {\n\t\tpadding: 8px 16px;\n\t\tbackground: none;\n\t\tborder: none;\n\t\tborder-bottom: 2px solid transparent;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\t.tab-btn.active {\n\t\tcolor: #ff7f50;\n\t\tborder-bottom-color: #ff7f50;\n\t}\n\t.cat-list {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgap: 8px;\n\t\tmargin-bottom: 20px;\n\t\tmax-height: 200px;\n\t\toverflow-y: auto;\n\t}\n\t.cat-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 4px;\n\t\tbackground: #f3f4f6;\n\t\tpadding: 4px 4px 4px 10px;\n\t\tborder-radius: 20px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.cat-badge {\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t\ttext-transform: capitalize;\n\t\tpadding: 0 4px;\n\t\tborder: none;\n\t\tbackground: transparent;\n\t}\n\t.cat-delete {\n\t\tborder: none;\n\t\tbackground: #e5e7eb;\n\t\tcolor: #6b7280;\n\t\tborder-radius: 50%;\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.add-cat-form {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t}\n\t.add-cat-form .input-field {\n\t\tflex: 1;\n\t\tpadding: 10px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t}\n\t.add-cat-form .btn-secondary {\n\t\tpadding: 10px 16px;\n\t}\n\t.modal-actions .btn-cancel {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\twidth: 100%;\n\t}\n\n\t@media (min-width: 640px) {\n\t\t.filters-bar {\n\t\t\tflex-direction: row;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\t\t}\n\t\t.search-box {\n\t\t\tmax-width: 300px;\n\t\t}\n\t\t.date-group {\n\t\t\twidth: auto;\n\t\t}\n\t\t.filter-group {\n\t\t\twidth: auto;\n\t\t\tflex-wrap: nowrap;\n\t\t}\n\t\t.filter-select {\n\t\t\twidth: 140px;\n\t\t\tflex: none;\n\t\t}\n\t\t.stats-summary {\n\t\t\tgrid-template-columns: repeat(4, 1fr);\n\t\t}\n\t\t.hidden-mobile {\n\t\t\tdisplay: block;\n\t\t}\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.page-container {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\n\t\t.expense-list-cards {\n\t\t\tgap: 8px;\n\t\t}\n\n\t\t/* Reduce extra space above pagination on mobile */\n\t\t.pagination-controls {\n\t\t\tmargin-top: 16px;\n\t\t}\n\n\t\t/* Compact empty-state padding on mobile */\n\t\t.empty-state {\n\t\t\tpadding: 24px 12px;\n\t\t}\n\n\t\t.hidden-mobile {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n\n\t/* Pagination Controls */\n\t.pagination-container {\n\t\tmargin-top: 32px;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t}\n\n\t.pagination {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tgap: 16px;\n\t}\n\n\t.pagination-btn {\n\t\tpadding: 8px 16px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tfont-family: inherit;\n\t}\n\n\t.pagination-btn:hover:not(:disabled) {\n\t\tborder-color: var(--orange);\n\t\tcolor: var(--orange);\n\t}\n\n\t.pagination-btn:disabled {\n\t\topacity: 0.5;\n\t\tcursor: not-allowed;\n\t}\n\n\t.page-status {\n\t\tfont-size: 14px;\n\t\tcolor: #4b5563;\n\t\tfont-weight: 500;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\expenses\\edit\\[id]\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 103,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 103,
				"endColumn": 30
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 128,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 128,
				"endColumn": 30
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 142,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 142,
				"endColumn": 31
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 202,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 204,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 259,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 261,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 316,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 318,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 382,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 382,
				"endColumn": 32
			}
		],
		"suppressedMessages": [],
		"errorCount": 3,
		"fatalErrorCount": 0,
		"warningCount": 4,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { expenses } from '$lib/stores/expenses';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { user } from '$lib/stores/auth';\n\timport { toasts } from '$lib/stores/toast';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\timport { onMount } from 'svelte';\n\n\tconst expenseId = $page.params.id;\n\n\timport SettingsModal from '../../../trips/components/SettingsModal.svelte';\n\n\t// Category options derived from user settings (grouped)\n\t$: maintenanceOptions =\n\t\t$userSettings.maintenanceCategories?.length > 0\n\t\t\t? $userSettings.maintenanceCategories\n\t\t\t: ['Oil Change', 'Tire Rotation', 'Brake Service', 'Filter Replacement'];\n\t$: suppliesOptions =\n\t\t$userSettings.supplyCategories?.length > 0\n\t\t\t? $userSettings.supplyCategories\n\t\t\t: ['Concrete', 'Poles', 'Wire', 'Tools', 'Equipment Rental'];\n\t$: expenseOptions =\n\t\t$userSettings.expenseCategories?.length > 0\n\t\t\t? $userSettings.expenseCategories\n\t\t\t: ['maintenance', 'insurance', 'supplies', 'other'];\n\n\tlet selectedMaintenance = '';\n\tlet selectedSupply = '';\n\tlet selectedExpense = '';\n\n\tlet isManageCategoriesOpen = false;\n\tlet activeCategoryType: 'maintenance' | 'supplies' | 'expenses' = 'maintenance';\n\n\t// Keep selected values in sync with form data\n\t$: if (formData.category) {\n\t\tif (maintenanceOptions.includes(formData.category)) {\n\t\t\tselectedMaintenance = formData.category;\n\t\t\tselectedSupply = '';\n\t\t\tselectedExpense = '';\n\t\t} else if (suppliesOptions.includes(formData.category)) {\n\t\t\tselectedSupply = formData.category;\n\t\t\tselectedMaintenance = '';\n\t\t\tselectedExpense = '';\n\t\t} else if (expenseOptions.includes(formData.category)) {\n\t\t\tselectedExpense = formData.category;\n\t\t\tselectedMaintenance = '';\n\t\t\tselectedSupply = '';\n\t\t} else {\n\t\t\tselectedMaintenance = '';\n\t\t\tselectedSupply = '';\n\t\t\tselectedExpense = '';\n\t\t}\n\t}\n\n\tfunction openSettings(type: 'maintenance' | 'supplies' | 'expenses') {\n\t\tactiveCategoryType = type;\n\t\tisManageCategoriesOpen = true;\n\t}\n\n\tfunction selectMaintenance() {\n\t\tif (!selectedMaintenance) return;\n\t\tformData.category = selectedMaintenance;\n\t\tselectedSupply = '';\n\t\tselectedExpense = '';\n\t}\n\n\tfunction selectSupply() {\n\t\tif (!selectedSupply) return;\n\t\tformData.category = selectedSupply;\n\t\tselectedMaintenance = '';\n\t\tselectedExpense = '';\n\t}\n\n\tfunction selectExpense() {\n\t\tif (!selectedExpense) return;\n\t\tformData.category = selectedExpense;\n\t\tselectedMaintenance = '';\n\t\tselectedSupply = '';\n\t}\n\n\tlet formData = {\n\t\tdate: '',\n\t\tcategory: '',\n\t\tamount: '',\n\t\tdescription: '',\n\t\ttaxDeductible: false\n\t};\n\n\tonMount(() => {\n\t\t// Find expense in store\n\t\tconst expense = $expenses.find((e) => e.id === expenseId);\n\t\tif (expense) {\n\t\t\tformData = {\n\t\t\t\tdate: expense.date,\n\t\t\t\tcategory: expense.category,\n\t\t\t\tamount: expense.amount.toString(),\n\t\t\t\tdescription: expense.description || '',\n\t\t\t\ttaxDeductible: !!expense.taxDeductible\n\t\t\t};\n\t\t} else {\n\t\t\ttoasts.error('Expense not found.');\n\t\t\tgoto('/dashboard/expenses');\n\t\t}\n\t});\n\n\tasync function saveExpense() {\n\t\tif (!formData.amount || !formData.date || !formData.category) {\n\t\t\ttoasts.error('Please fill in required fields.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUser = ($page.data as any)['user'] || $user;\n\t\tconst userId = (currentUser as any)?.id || localStorage.getItem('offline_user_id');\n\t\tif (!userId) {\n\t\t\ttoasts.error('User not identified. Cannot save.');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst payload = {\n\t\t\t\t...formData,\n\t\t\t\tamount: parseFloat(formData.amount)\n\t\t\t};\n\n\t\t\tawait expenses.updateExpense(String(expenseId), payload, String(userId));\n\t\t\ttoasts.success('Expense updated');\n\t\t\tgoto('/dashboard/expenses');\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t\ttoasts.error('Failed to update expense');\n\t\t}\n\t}\n</script>\n\n<div class=\"expense-form-page\">\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">Edit Expense</h1>\n\t\t\t<p class=\"page-subtitle\">Update cost details</p>\n\t\t</div>\n\t\t<a href=\"/dashboard/expenses\" class=\"btn-back\">\n\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 20 20\" fill=\"none\"\n\t\t\t\t><path\n\t\t\t\t\td=\"M12 4L6 10L12 16\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/></svg\n\t\t\t> Back\n\t\t</a>\n\t</div>\n\n\t<div class=\"form-card\">\n\t\t<div class=\"card-header\">\n\t\t\t<h2 class=\"card-title\">Expense Details</h2>\n\t\t</div>\n\n\t\t<div class=\"form-grid\">\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"expense-date\">Date</label>\n\t\t\t\t<input id=\"expense-date\" type=\"date\" bind:value={formData.date} required />\n\t\t\t</div>\n\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<div class=\"section-group\">\n\t\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t\t<h3>Maintenance</h3>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\t\ton:click={() => openSettings('maintenance')}\n\t\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tid=\"maintenance-select\"\n\t\t\t\t\t\t\tname=\"maintenance\"\n\t\t\t\t\t\t\tbind:value={selectedMaintenance}\n\t\t\t\t\t\t\ton:change={selectMaintenance}\n\t\t\t\t\t\t\tclass=\"select-input\"\n\t\t\t\t\t\t\taria-label=\"Maintenance type\"\n\t\t\t\t\t\t\tdisabled={!!formData.category && !maintenanceOptions.includes(formData.category)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"\" disabled selected>Select Item...</option>\n\t\t\t\t\t\t\t{#each maintenanceOptions as option}\n\t\t\t\t\t\t\t\t<option value={option}>{option}</option>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t\t{#if maintenanceOptions.includes(formData.category)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small neutral\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tformData.category = '';\n\t\t\t\t\t\t\t\t\tselectedMaintenance = '';\n\t\t\t\t\t\t\t\t}}>Clear</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\t\t\t\ton:click={() => (formData.category = selectedMaintenance)}\n\t\t\t\t\t\t\t\tdisabled={!selectedMaintenance}>Choose</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"section-group\">\n\t\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t\t<h3>Supplies</h3>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\t\ton:click={() => openSettings('supplies')}\n\t\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tid=\"supplies-select\"\n\t\t\t\t\t\t\tname=\"supplies\"\n\t\t\t\t\t\t\tbind:value={selectedSupply}\n\t\t\t\t\t\t\ton:change={selectSupply}\n\t\t\t\t\t\t\tclass=\"select-input\"\n\t\t\t\t\t\t\taria-label=\"Supply type\"\n\t\t\t\t\t\t\tdisabled={!!formData.category && !suppliesOptions.includes(formData.category)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"\" disabled selected>Select Item...</option>\n\t\t\t\t\t\t\t{#each suppliesOptions as option}\n\t\t\t\t\t\t\t\t<option value={option}>{option}</option>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t\t{#if suppliesOptions.includes(formData.category)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small neutral\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tformData.category = '';\n\t\t\t\t\t\t\t\t\tselectedSupply = '';\n\t\t\t\t\t\t\t\t}}>Clear</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\t\t\t\ton:click={() => (formData.category = selectedSupply)}\n\t\t\t\t\t\t\t\tdisabled={!selectedSupply}>Choose</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"section-group\">\n\t\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t\t<h3>Expenses</h3>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\t\ton:click={() => openSettings('expenses')}\n\t\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tid=\"expense-select\"\n\t\t\t\t\t\t\tname=\"expenseCategory\"\n\t\t\t\t\t\t\tbind:value={selectedExpense}\n\t\t\t\t\t\t\ton:change={selectExpense}\n\t\t\t\t\t\t\tclass=\"select-input\"\n\t\t\t\t\t\t\taria-label=\"Expense category\"\n\t\t\t\t\t\t\tdisabled={!!formData.category && !expenseOptions.includes(formData.category)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"\" disabled selected>Select Item...</option>\n\t\t\t\t\t\t\t{#each expenseOptions as option}\n\t\t\t\t\t\t\t\t<option value={option}>{option}</option>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t\t{#if expenseOptions.includes(formData.category)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small neutral\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tformData.category = '';\n\t\t\t\t\t\t\t\t\tselectedExpense = '';\n\t\t\t\t\t\t\t\t}}>Clear</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\t\t\t\ton:click={() => (formData.category = selectedExpense)}\n\t\t\t\t\t\t\t\tdisabled={!selectedExpense}>Choose</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"amount\">Amount</label>\n\t\t\t\t\t<div class=\"input-money-wrapper\">\n\t\t\t\t\t\t<span class=\"symbol\">$</span>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"amount\"\n\t\t\t\t\t\t\tname=\"amount\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\tbind:value={formData.amount}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"description\">Description</label>\n\t\t\t\t<textarea\n\t\t\t\t\tid=\"description\"\n\t\t\t\t\tname=\"description\"\n\t\t\t\t\tbind:value={formData.description}\n\t\t\t\t\trows=\"3\"\n\t\t\t\t\tplaceholder=\"e.g., Oil Change at Jiffy Lube\"\n\t\t\t\t></textarea>\n\t\t\t</div>\n\n\t\t\t<div class=\"form-group checkbox-group\">\n\t\t\t\t<label for=\"tax-deductible\" class=\"inline-label\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"tax-deductible\"\n\t\t\t\t\t\tname=\"taxDeductible\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tbind:checked={formData.taxDeductible}\n\t\t\t\t\t/>\n\t\t\t\t\t<span>Tax deductible</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Settings modal (manage maintenance/supplies/expenses categories) -->\n\t\t<SettingsModal bind:open={isManageCategoriesOpen} bind:activeCategoryType />\n\n\t\t<div class=\"form-actions\">\n\t\t\t<a href=\"/dashboard/expenses\" class=\"btn-secondary\">Cancel</a>\n\t\t\t<button class=\"btn-primary\" on:click={saveExpense}>Save Changes</button>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t/* MATCHING STYLES FROM TRIPS/NEW */\n\t.expense-form-page {\n\t\tmax-width: 800px;\n\t\tmargin: 0 auto;\n\t\tpadding: 4px;\n\t\tpadding-bottom: 90px;\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.expense-form-page {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\t}\n\n\t.page-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 26px;\n\t\tpadding: 0 8px;\n\t}\n\t.page-title {\n\t\tfont-size: 28px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tdisplay: none;\n\t\tmargin: 0;\n\t}\n\n\t.btn-back {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\ttext-decoration: none;\n\t\tfont-size: 14px;\n\t}\n\n\t.form-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 18px;\n\t\tpadding: 16px;\n\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\t}\n\t.card-header {\n\t\tmargin-bottom: 26px;\n\t}\n\t.card-title {\n\t\tfont-size: 22px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\n\t.form-grid {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24px;\n\t}\n\t.form-row {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 20px;\n\t}\n\t.form-group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\n\tlabel {\n\t\tfont-size: 16px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\n\tinput,\n\ttextarea,\n\tselect {\n\t\twidth: 100%;\n\t\tpadding: 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tfont-size: 18px;\n\t\tbackground: white;\n\t\tbox-sizing: border-box;\n\t}\n\tinput:focus,\n\ttextarea:focus,\n\tselect:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t}\n\n\t.input-money-wrapper {\n\t\tposition: relative;\n\t\twidth: 100%;\n\t}\n\t.input-money-wrapper .symbol {\n\t\tposition: absolute;\n\t\tleft: 16px;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\tcolor: #6b7280;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t}\n\t.input-money-wrapper input {\n\t\tpadding-left: 36px;\n\t}\n\n\t.section-group {\n\t\tmargin-bottom: 24px;\n\t}\n\t.section-top {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 12px;\n\t\talign-items: center;\n\t}\n\t.section-top h3 {\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tmargin: 0;\n\t}\n\t.add-row {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tmargin-bottom: 12px;\n\t}\n\t.select-input {\n\t\tflex: 1;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 16px;\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t}\n\t.btn-icon.gear {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t\tpadding: 6px;\n\t\tcolor: #6b7280;\n\t}\n\t.btn-small.primary {\n\t\tpadding: 8px 12px;\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder-radius: 8px;\n\t\tborder: none;\n\t\tfont-weight: 600;\n\t}\n\t.btn-small.neutral {\n\t\tpadding: 8px 12px;\n\t\tbackground: white;\n\t\tborder-radius: 8px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tfont-weight: 600;\n\t}\n\n\t.form-group.checkbox-group .inline-label {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\t.form-group.checkbox-group input[type='checkbox'] {\n\t\twidth: 18px;\n\t\theight: 18px;\n\t\taccent-color: #ff7f50;\n\t}\n\n\t.form-actions {\n\t\tdisplay: flex;\n\t\tgap: 18px;\n\t\tmargin-top: 36px;\n\t\tpadding-top: 26px;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\t.btn-primary,\n\t.btn-secondary {\n\t\tflex: 1;\n\t\tpadding: 18px;\n\t\tborder-radius: 12px;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t\tcursor: pointer;\n\t\tborder: none;\n\t\ttext-align: center;\n\t\ttext-decoration: none;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\t.btn-primary {\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t}\n\t.btn-secondary {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t}\n\n\t@media (min-width: 768px) {\n\t\t.page-subtitle {\n\t\t\tdisplay: block;\n\t\t}\n\t\t.form-card {\n\t\t\tpadding: 48px;\n\t\t}\n\t\t.form-actions {\n\t\t\tjustify-content: flex-end;\n\t\t}\n\t\t.btn-primary,\n\t\t.btn-secondary {\n\t\t\tflex: 0 0 auto;\n\t\t\twidth: auto;\n\t\t\tmin-width: 160px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\expenses\\new\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 139,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 139,
				"endColumn": 30
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 153,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 153,
				"endColumn": 31
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 213,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 215,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 270,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 272,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 327,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 329,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 394,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 394,
				"endColumn": 32
			}
		],
		"suppressedMessages": [
			{
				"ruleId": "svelte/no-reactive-reassign",
				"severity": 2,
				"message": "Assignment to reactive value 'expenseOptions'.",
				"line": 107,
				"column": 5,
				"nodeType": "AssignmentExpression",
				"messageId": "assignmentToReactiveValue",
				"endLine": 107,
				"endColumn": 44,
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 3,
		"fatalErrorCount": 0,
		"warningCount": 3,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { expenses } from '$lib/stores/expenses';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { user } from '$lib/stores/auth';\n\timport { toasts } from '$lib/stores/toast';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\n\t// --- HELPER: Get Local Date (YYYY-MM-DD) ---\n\tfunction getLocalDate() {\n\t\tconst now = new Date();\n\t\treturn new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().split('T')[0];\n\t}\n\n\timport SettingsModal from '../../trips/components/SettingsModal.svelte';\n\n\t// Category options derived from user settings (grouped)\n\t$: maintenanceOptions =\n\t\t$userSettings.maintenanceCategories?.length > 0\n\t\t\t? $userSettings.maintenanceCategories\n\t\t\t: ['Oil Change', 'Tire Rotation', 'Brake Service', 'Filter Replacement'];\n\t$: suppliesOptions =\n\t\t$userSettings.supplyCategories?.length > 0\n\t\t\t? $userSettings.supplyCategories\n\t\t\t: ['Concrete', 'Poles', 'Wire', 'Tools', 'Equipment Rental'];\n\t$: expenseOptions =\n\t\t$userSettings.expenseCategories?.length > 0\n\t\t\t? $userSettings.expenseCategories\n\t\t\t: ['maintenance', 'insurance', 'supplies', 'other'];\n\n\tlet selectedMaintenance = '';\n\tlet selectedSupply = '';\n\tlet selectedExpense = '';\n\n\tlet isManageCategoriesOpen = false;\n\tlet activeCategoryType: 'maintenance' | 'supplies' | 'expenses' = 'maintenance';\n\n\t// Keep the selectedX in sync with formData.category\n\t$: if (formData.category) {\n\t\tif (maintenanceOptions.includes(formData.category)) {\n\t\t\tselectedMaintenance = formData.category;\n\t\t\tselectedSupply = '';\n\t\t\tselectedExpense = '';\n\t\t} else if (suppliesOptions.includes(formData.category)) {\n\t\t\tselectedSupply = formData.category;\n\t\t\tselectedMaintenance = '';\n\t\t\tselectedExpense = '';\n\t\t} else if (expenseOptions.includes(formData.category)) {\n\t\t\tselectedExpense = formData.category;\n\t\t\tselectedMaintenance = '';\n\t\t\tselectedSupply = '';\n\t\t} else {\n\t\t\tselectedMaintenance = '';\n\t\t\tselectedSupply = '';\n\t\t\tselectedExpense = '';\n\t\t}\n\t}\n\n\tfunction openSettings(type: 'maintenance' | 'supplies' | 'expenses') {\n\t\tactiveCategoryType = type;\n\t\tisManageCategoriesOpen = true;\n\t}\n\n\tfunction selectMaintenance() {\n\t\tif (!selectedMaintenance) return;\n\t\tformData.category = selectedMaintenance;\n\t\t// clear other selections\n\t\tselectedSupply = '';\n\t\tselectedExpense = '';\n\t}\n\n\tfunction selectSupply() {\n\t\tif (!selectedSupply) return;\n\t\tformData.category = selectedSupply;\n\t\tselectedMaintenance = '';\n\t\tselectedExpense = '';\n\t}\n\n\tfunction selectExpense() {\n\t\tif (!selectedExpense) return;\n\t\tformData.category = selectedExpense;\n\t\tselectedMaintenance = '';\n\t\tselectedSupply = '';\n\t}\n\n\tconst formData = {\n\t\tdate: getLocalDate(),\n\t\tcategory: '',\n\t\tamount: '',\n\t\tdescription: '',\n\t\ttaxDeductible: false\n\t};\n\n\t// Reference to amount input so quick-action can focus it\n\tlet amountInput: HTMLInputElement | null = null;\n\t// Prefill category from the URL query parameter (e.g., ?category=fuel)\n\t$: {\n\t\tconst q = $page.url.searchParams.get('category');\n\t\tif (q) {\n\t\t\t// ensure the queried category appears in the available options (preferring expenseOptions)\n\t\t\tif (\n\t\t\t\t!maintenanceOptions.includes(q) &&\n\t\t\t\t!suppliesOptions.includes(q) &&\n\t\t\t\t!expenseOptions.includes(q)\n\t\t\t) {\n\t\t\t\t// eslint-disable-next-line svelte/no-reactive-reassign\n\t\t\t\texpenseOptions = [q, ...expenseOptions];\n\t\t\t}\n\t\t\tformData.category = q;\n\t\t\t// if arrived via quick action, focus the amount input for quick logging\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\tsetTimeout(() => amountInput?.focus(), 60);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function saveExpense() {\n\t\tif (!formData.amount || !formData.date || !formData.category) {\n\t\t\ttoasts.error('Please fill in required fields.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUser = $page.data['user'] || $user;\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id');\n\n\t\tif (!userId) {\n\t\t\ttoasts.error('User not identified. Cannot save.');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst payload = {\n\t\t\t\t...formData,\n\t\t\t\tamount: parseFloat(formData.amount)\n\t\t\t};\n\n\t\t\tawait expenses.create(payload, userId);\n\t\t\ttoasts.success('Expense created');\n\t\t\tgoto('/dashboard/expenses');\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t\ttoasts.error('Failed to save expense');\n\t\t}\n\t}\n</script>\n\n<div class=\"expense-form-page\">\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">New Expense</h1>\n\t\t\t<p class=\"page-subtitle\">Log a new cost</p>\n\t\t</div>\n\t\t<a href=\"/dashboard/expenses\" class=\"btn-back\">\n\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 20 20\" fill=\"none\"\n\t\t\t\t><path\n\t\t\t\t\td=\"M12 4L6 10L12 16\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/></svg\n\t\t\t> Back\n\t\t</a>\n\t</div>\n\n\t<div class=\"form-card\">\n\t\t<div class=\"card-header\">\n\t\t\t<h2 class=\"card-title\">Expense Details</h2>\n\t\t</div>\n\n\t\t<div class=\"form-grid\">\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"expense-date\">Date</label>\n\t\t\t\t<input id=\"expense-date\" type=\"date\" bind:value={formData.date} required />\n\t\t\t</div>\n\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<div class=\"section-group\">\n\t\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t\t<h3>Maintenance</h3>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\t\ton:click={() => openSettings('maintenance')}\n\t\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tid=\"maintenance-select\"\n\t\t\t\t\t\t\tname=\"maintenance\"\n\t\t\t\t\t\t\tbind:value={selectedMaintenance}\n\t\t\t\t\t\t\ton:change={selectMaintenance}\n\t\t\t\t\t\t\tclass=\"select-input\"\n\t\t\t\t\t\t\taria-label=\"Maintenance type\"\n\t\t\t\t\t\t\tdisabled={!!formData.category && !maintenanceOptions.includes(formData.category)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"\" disabled selected>Select Item...</option>\n\t\t\t\t\t\t\t{#each maintenanceOptions as option}\n\t\t\t\t\t\t\t\t<option value={option}>{option}</option>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t\t{#if maintenanceOptions.includes(formData.category)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small neutral\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tformData.category = '';\n\t\t\t\t\t\t\t\t\tselectedMaintenance = '';\n\t\t\t\t\t\t\t\t}}>Clear</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\t\t\t\ton:click={() => (formData.category = selectedMaintenance)}\n\t\t\t\t\t\t\t\tdisabled={!selectedMaintenance}>Choose</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"section-group\">\n\t\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t\t<h3>Supplies</h3>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\t\ton:click={() => openSettings('supplies')}\n\t\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tid=\"supplies-select\"\n\t\t\t\t\t\t\tname=\"supplies\"\n\t\t\t\t\t\t\tbind:value={selectedSupply}\n\t\t\t\t\t\t\ton:change={selectSupply}\n\t\t\t\t\t\t\tclass=\"select-input\"\n\t\t\t\t\t\t\taria-label=\"Supply type\"\n\t\t\t\t\t\t\tdisabled={!!formData.category && !suppliesOptions.includes(formData.category)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"\" disabled selected>Select Item...</option>\n\t\t\t\t\t\t\t{#each suppliesOptions as option}\n\t\t\t\t\t\t\t\t<option value={option}>{option}</option>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t\t{#if suppliesOptions.includes(formData.category)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small neutral\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tformData.category = '';\n\t\t\t\t\t\t\t\t\tselectedSupply = '';\n\t\t\t\t\t\t\t\t}}>Clear</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\t\t\t\ton:click={() => (formData.category = selectedSupply)}\n\t\t\t\t\t\t\t\tdisabled={!selectedSupply}>Choose</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"section-group\">\n\t\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t\t<h3>Expenses</h3>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\t\ton:click={() => openSettings('expenses')}\n\t\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tid=\"expense-select\"\n\t\t\t\t\t\t\tname=\"expenseCategory\"\n\t\t\t\t\t\t\tbind:value={selectedExpense}\n\t\t\t\t\t\t\ton:change={selectExpense}\n\t\t\t\t\t\t\tclass=\"select-input\"\n\t\t\t\t\t\t\taria-label=\"Expense category\"\n\t\t\t\t\t\t\tdisabled={!!formData.category && !expenseOptions.includes(formData.category)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"\" disabled selected>Select Item...</option>\n\t\t\t\t\t\t\t{#each expenseOptions as option}\n\t\t\t\t\t\t\t\t<option value={option}>{option}</option>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t\t{#if expenseOptions.includes(formData.category)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small neutral\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tformData.category = '';\n\t\t\t\t\t\t\t\t\tselectedExpense = '';\n\t\t\t\t\t\t\t\t}}>Clear</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\t\t\t\ton:click={() => (formData.category = selectedExpense)}\n\t\t\t\t\t\t\t\tdisabled={!selectedExpense}>Choose</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"amount\">Amount</label>\n\t\t\t\t\t<div class=\"input-money-wrapper\">\n\t\t\t\t\t\t<span class=\"symbol\">$</span>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"amount\"\n\t\t\t\t\t\t\tname=\"amount\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\tbind:value={formData.amount}\n\t\t\t\t\t\t\tbind:this={amountInput}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"description\">Description</label>\n\t\t\t\t<textarea\n\t\t\t\t\tid=\"description\"\n\t\t\t\t\tname=\"description\"\n\t\t\t\t\tbind:value={formData.description}\n\t\t\t\t\trows=\"3\"\n\t\t\t\t\tplaceholder=\"e.g., Oil Change at Jiffy Lube\"\n\t\t\t\t></textarea>\n\t\t\t</div>\n\n\t\t\t<div class=\"form-group checkbox-group\">\n\t\t\t\t<label for=\"tax-deductible\" class=\"inline-label\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"tax-deductible\"\n\t\t\t\t\t\tname=\"taxDeductible\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tbind:checked={formData.taxDeductible}\n\t\t\t\t\t/>\n\t\t\t\t\t<span>Tax Deductible</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Settings modal (manage maintenance/supplies/expenses categories) -->\n\t\t<SettingsModal bind:open={isManageCategoriesOpen} bind:activeCategoryType />\n\n\t\t<div class=\"form-actions\">\n\t\t\t<a href=\"/dashboard/expenses\" class=\"btn-secondary\">Cancel</a>\n\t\t\t<button class=\"btn-primary\" on:click={saveExpense}>Save Expense</button>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t/* MATCHING STYLES FROM TRIPS/NEW */\n\t.expense-form-page {\n\t\tmax-width: 800px;\n\t\tmargin: 0 auto;\n\t\tpadding: 4px;\n\t\tpadding-bottom: 90px;\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.expense-form-page {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\t}\n\n\t.page-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 26px;\n\t\tpadding: 0 8px;\n\t}\n\t.page-title {\n\t\tfont-size: 28px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tdisplay: none;\n\t\tmargin: 0;\n\t}\n\n\t.btn-back {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\ttext-decoration: none;\n\t\tfont-size: 14px;\n\t}\n\n\t.form-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 18px;\n\t\tpadding: 16px;\n\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\t}\n\t.card-header {\n\t\tmargin-bottom: 26px;\n\t}\n\t.card-title {\n\t\tfont-size: 22px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\n\t.form-grid {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24px;\n\t}\n\t.form-row {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 20px;\n\t}\n\t.form-group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\n\tlabel {\n\t\tfont-size: 16px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\n\tinput,\n\ttextarea,\n\tselect {\n\t\twidth: 100%;\n\t\tpadding: 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tfont-size: 18px;\n\t\tbackground: white;\n\t\tbox-sizing: border-box;\n\t}\n\tinput:focus,\n\ttextarea:focus,\n\tselect:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t}\n\n\t.input-money-wrapper {\n\t\tposition: relative;\n\t\twidth: 100%;\n\t}\n\t.input-money-wrapper .symbol {\n\t\tposition: absolute;\n\t\tleft: 16px;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\tcolor: #6b7280;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t}\n\t.input-money-wrapper input {\n\t\tpadding-left: 36px;\n\t}\n\n\t.section-group {\n\t\tmargin-bottom: 24px;\n\t}\n\t.section-top {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 12px;\n\t\talign-items: center;\n\t}\n\t.section-top h3 {\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tmargin: 0;\n\t}\n\t.add-row {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tmargin-bottom: 12px;\n\t}\n\t.select-input {\n\t\tflex: 1;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 16px;\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t}\n\t.btn-icon.gear {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t\tpadding: 6px;\n\t\tcolor: #6b7280;\n\t}\n\t.btn-small.primary {\n\t\tpadding: 8px 12px;\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder-radius: 8px;\n\t\tborder: none;\n\t\tfont-weight: 600;\n\t}\n\t.btn-small.neutral {\n\t\tpadding: 8px 12px;\n\t\tbackground: white;\n\t\tborder-radius: 8px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tfont-weight: 600;\n\t}\n\n\t.form-group.checkbox-group .inline-label {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\t.form-group.checkbox-group input[type='checkbox'] {\n\t\twidth: 18px;\n\t\theight: 18px;\n\t\taccent-color: #ff7f50;\n\t}\n\n\t.form-actions {\n\t\tdisplay: flex;\n\t\tgap: 18px;\n\t\tmargin-top: 36px;\n\t\tpadding-top: 26px;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\t.btn-primary,\n\t.btn-secondary {\n\t\tflex: 1;\n\t\tpadding: 18px;\n\t\tborder-radius: 12px;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t\tcursor: pointer;\n\t\tborder: none;\n\t\ttext-align: center;\n\t\ttext-decoration: none;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\t.btn-primary {\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t}\n\t.btn-secondary {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t}\n\n\t@media (min-width: 768px) {\n\t\t.page-subtitle {\n\t\t\tdisplay: block;\n\t\t}\n\t\t.form-card {\n\t\t\tpadding: 48px;\n\t\t}\n\t\t.form-actions {\n\t\t\tjustify-content: flex-end;\n\t\t}\n\t\t.btn-primary,\n\t\t.btn-secondary {\n\t\t\tflex: 0 0 auto;\n\t\t\twidth: auto;\n\t\t\tmin-width: 160px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\hughesnet\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 57,
				"column": 39,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 57,
				"endColumn": 48
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 919,
				"column": 6,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 951,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 973,
				"column": 6,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 980,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1011,
				"column": 6,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1092,
				"endColumn": 13
			}
		],
		"suppressedMessages": [],
		"errorCount": 4,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { slide } from 'svelte/transition';\n\timport { trips } from '$lib/stores/trips';\n\timport { trash } from '$lib/stores/trash';\n\timport { user } from '$lib/stores/auth';\n\timport { page } from '$app/stores';\n\timport { csrfFetch } from '$lib/utils/csrf';\n\timport SettingsModal from '../trips/components/SettingsModal.svelte';\n\tlet showTripSettings = false;\n\t// Access via bracket notation because `page.data` exposes properties through an index signature\n\t$: API_KEY = $page.data?.['googleMapsApiKey'];\n\n\tlet username = '';\n\tlet password = '';\n\tlet loading = false;\n\tlet orders: any[] = [];\n\tlet isConnected = false;\n\tlet logs: string[] = [];\n\n\t// Console Visibility State\n\tlet showConsole = false;\n\n\t// Configuration State\n\tlet installPay: number = 0;\n\tlet repairPay: number = 0;\n\tlet upgradePay: number = 0;\n\tlet wifiExtenderPay: number = 0;\n\tlet voipPay: number = 0;\n\tlet driveTimeBonus: number = 0;\n\n\t// Supply Costs\n\tlet poleCost: number = 0;\n\tlet concreteCost: number = 0;\n\tlet poleCharge: number = 0;\n\n\t// Times (Default to standard times)\n\tlet installTime: number = 90;\n\tlet repairTime: number = 60;\n\n\tlet overrideTimes = false;\n\n\tlet showSuccess = false;\n\tlet successMessage = '';\n\tlet statusMessage = 'Sync Now';\n\n\t// Track batch for progress visualization\n\tlet currentBatch = 0;\n\n\t// Config Sync State\n\tlet isConfigLoaded = false;\n\tlet saveTimeout: any;\n\tlet isSaving = false;\n\n\t// Conflict Management State\n\tlet conflictTrips: any[] = [];\n\tlet selectedConflicts: Set<string> = new Set(); // Track which trips to overwrite\n\tlet showConflictModal = false;\n\tlet conflictTimer = 60;\n\tlet conflictInterval: any;\n\n\tfunction showSuccessMsg(msg: string) {\n\t\tsuccessMessage = msg;\n\t\tshowSuccess = true;\n\t\tsetTimeout(() => (showSuccess = false), 3000);\n\t}\n\n\tfunction addLog(msg: string) {\n\t\tlogs = [`[${new Date().toLocaleTimeString()}] ${msg}`, ...logs];\n\t}\n\n\tfunction processServerLogs(serverLogs?: string[]) {\n\t\tif (serverLogs && Array.isArray(serverLogs)) {\n\t\t\tserverLogs.forEach((log) => {\n\t\t\t\tlogs = [`[Server] ${log}`, ...logs];\n\t\t\t});\n\t\t}\n\t}\n\n\t// Load Settings from Server (KV)\n\tasync function loadSettings() {\n\t\ttry {\n\t\t\tconst res = await csrfFetch('/api/hughesnet', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify({ action: 'get_settings' })\n\t\t\t});\n\t\t\tconst data: any = await res.json();\n\n\t\t\tif (data.settings) {\n\t\t\t\tinstallPay = data.settings.installPay ?? 0;\n\t\t\t\trepairPay = data.settings.repairPay ?? 0;\n\t\t\t\tupgradePay = data.settings.upgradePay ?? 0;\n\t\t\t\twifiExtenderPay = data.settings.wifiExtenderPay ?? 0;\n\t\t\t\tvoipPay = data.settings.voipPay ?? 0;\n\t\t\t\tdriveTimeBonus = data.settings.driveTimeBonus ?? 0;\n\t\t\t\tpoleCost = data.settings.poleCost ?? 0;\n\t\t\t\tconcreteCost = data.settings.concreteCost ?? 0;\n\t\t\t\tpoleCharge = data.settings.poleCharge ?? 0;\n\t\t\t\tinstallTime = data.settings.installTime ?? 90;\n\t\t\t\trepairTime = data.settings.repairTime ?? 60;\n\t\t\t\toverrideTimes = data.settings.overrideTimes ?? false;\n\n\t\t\t\taddLog('Settings loaded from cloud.');\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to load settings', e);\n\t\t\taddLog('Error loading settings.');\n\t\t} finally {\n\t\t\tisConfigLoaded = true;\n\t\t}\n\t}\n\n\t// Save Settings to Server (KV)\n\tasync function saveSettings() {\n\t\tif (!isConfigLoaded) return;\n\t\tisSaving = true;\n\n\t\tconst settings = {\n\t\t\tinstallPay,\n\t\t\trepairPay,\n\t\t\tupgradePay,\n\t\t\twifiExtenderPay,\n\t\t\tvoipPay,\n\t\t\tdriveTimeBonus,\n\t\t\tpoleCost,\n\t\t\tconcreteCost,\n\t\t\tpoleCharge,\n\t\t\tinstallTime,\n\t\t\trepairTime,\n\t\t\toverrideTimes\n\t\t};\n\n\t\ttry {\n\t\t\tconst res = await csrfFetch('/api/hughesnet', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\taction: 'save_settings',\n\t\t\t\t\tsettings\n\t\t\t\t})\n\t\t\t});\n\t\t\tconst data: any = await res.json();\n\t\t\tif (!data.success) {\n\t\t\t\tconsole.error('Save failed:', data.error);\n\t\t\t\taddLog(`Save Error: ${data.error}`);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to auto-save settings', e);\n\t\t\taddLog('Failed to auto-save settings.');\n\t\t} finally {\n\t\t\tisSaving = false;\n\t\t}\n\t}\n\n\t// Reactive Watcher\n\t$: if (isConfigLoaded) {\n\t\t// Tickle reactivity by referencing variables; avoid creating unused bindings\n\t\tvoid [\n\t\t\tinstallPay,\n\t\t\trepairPay,\n\t\t\tupgradePay,\n\t\t\twifiExtenderPay,\n\t\t\tvoipPay,\n\t\t\tdriveTimeBonus,\n\t\t\tpoleCost,\n\t\t\tconcreteCost,\n\t\t\tpoleCharge,\n\t\t\tinstallTime,\n\t\t\trepairTime,\n\t\t\toverrideTimes\n\t\t];\n\t\tif (saveTimeout) clearTimeout(saveTimeout);\n\t\tsaveTimeout = setTimeout(() => {\n\t\t\tsaveSettings();\n\t\t}, 1000);\n\t}\n\n\tasync function loadOrders() {\n\t\taddLog('Checking cache for existing orders...');\n\t\ttry {\n\t\t\tconst res = await fetch(`/api/hughesnet`);\n\t\t\tconst data: any = await res.json();\n\t\t\tif (data.orders) {\n\t\t\t\torders = Object.values(data.orders);\n\t\t\t\tif (orders.length > 0) {\n\t\t\t\t\tisConnected = true;\n\t\t\t\t\taddLog(`Found ${orders.length} cached orders.`);\n\t\t\t\t} else {\n\t\t\t\t\taddLog('No cached orders found.');\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\taddLog('Error checking cache: ' + e);\n\t\t}\n\t}\n\n\tasync function handleConnect() {\n\t\tif (!username || !password) {\n\t\t\talert('Please enter username and password');\n\t\t\treturn;\n\t\t}\n\n\t\tloading = true;\n\t\tstatusMessage = 'Connecting...';\n\t\taddLog('Connecting...');\n\t\ttry {\n\t\t\tconst res = await csrfFetch('/api/hughesnet', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify({ action: 'connect', username, password })\n\t\t\t});\n\t\t\tconst data: any = await res.json();\n\t\t\tprocessServerLogs(data.logs);\n\n\t\t\tif (data.success) {\n\t\t\t\tisConnected = true;\n\t\t\t\taddLog('Connected! Ready to sync.');\n\t\t\t\tshowSuccessMsg('Connected successfully!');\n\t\t\t} else {\n\t\t\t\taddLog('Login Failed: ' + (data.error || 'Unknown error'));\n\t\t\t\talert('Login Failed: ' + (data.error || 'Check logs'));\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\taddLog('Network Error: ' + e.message);\n\t\t} finally {\n\t\t\tloading = false;\n\t\t\tstatusMessage = 'Sync Now';\n\t\t}\n\t}\n\n\tasync function handleDisconnect() {\n\t\tif (!confirm('Disconnect from HughesNet?')) return;\n\t\tloading = true;\n\t\taddLog('Disconnecting...');\n\t\ttry {\n\t\t\tconst res = await csrfFetch('/api/hughesnet', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify({ action: 'disconnect' })\n\t\t\t});\n\t\t\tconst data: any = await res.json();\n\t\t\tprocessServerLogs(data.logs);\n\n\t\t\tif (data.success) {\n\t\t\t\tisConnected = false;\n\t\t\t\torders = [];\n\t\t\t\taddLog('Disconnected.');\n\t\t\t\tshowSuccessMsg('Disconnected.');\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\taddLog('Error: ' + e.message);\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\tasync function handleSync(batchCount = 1, recentOnly = false, forceOverrideDates: string[] = []) {\n\t\tloading = true;\n\t\tcurrentBatch = batchCount;\n\t\tstatusMessage = `Syncing Batch ${batchCount}...`;\n\n\t\t// Reset conflicts on first batch if not a force run\n\t\tif (batchCount === 1 && forceOverrideDates.length === 0) {\n\t\t\tconflictTrips = [];\n\t\t}\n\n\t\tconst skipScan = batchCount > 1;\n\t\tlet data: any = null;\n\t\tif (batchCount === 1) {\n\t\t\taddLog(\n\t\t\t\trecentOnly ? `🚀 Starting Quick Sync (Last 7 Days)...` : `📡 Starting Full History Scan...`\n\t\t\t);\n\t\t\tshowConsole = true;\n\n\t\t\t// CRITICAL: Sync local changes to cloud BEFORE HughesNet sync\n\t\t\t// This ensures any manual edits are uploaded so conflict detection works\n\t\t\tconst userId = $user?.id;\n\t\t\tif (userId) {\n\t\t\t\taddLog('⬆️ Uploading local changes first...');\n\t\t\t\ttry {\n\t\t\t\t\t// Force sync any pending local changes to cloud\n\t\t\t\t\tconst result = await trips.syncPendingToCloud(userId);\n\t\t\t\t\tif (result.synced > 0) {\n\t\t\t\t\t\taddLog(`✅ Uploaded ${result.synced} local change(s) to cloud`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddLog('✅ No pending local changes');\n\t\t\t\t\t}\n\t\t\t\t\tif (result.failed > 0) {\n\t\t\t\t\t\taddLog(`⚠️ Warning: ${result.failed} change(s) failed to upload`);\n\t\t\t\t\t}\n\t\t\t\t} catch (e: any) {\n\t\t\t\t\taddLog('⚠️ Warning: Could not sync local changes - ' + e.message);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\taddLog(`📦 Continuing Sync (Batch ${batchCount})...`);\n\t\t}\n\n\t\ttry {\n\t\t\tconst res = await csrfFetch('/api/hughesnet', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\taction: 'sync',\n\t\t\t\t\tinstallPay: installPay || 0,\n\t\t\t\t\trepairPay: repairPay || 0,\n\t\t\t\t\tupgradePay: upgradePay || 0,\n\t\t\t\t\twifiExtenderPay: wifiExtenderPay || 0,\n\t\t\t\t\tvoipPay: voipPay || 0,\n\t\t\t\t\tdriveTimeBonus: driveTimeBonus || 0,\n\t\t\t\t\tpoleCost: poleCost || 0,\n\t\t\t\t\tconcreteCost: concreteCost || 0,\n\t\t\t\t\tpoleCharge: poleCharge || 0,\n\t\t\t\t\tinstallTime: installTime || 0,\n\t\t\t\t\trepairTime: repairTime || 0,\n\t\t\t\t\toverrideTimes,\n\t\t\t\t\tskipScan,\n\t\t\t\t\trecentOnly,\n\t\t\t\t\tforceDates: forceOverrideDates\n\t\t\t\t})\n\t\t\t});\n\t\t\tconst contentType = res.headers.get('content-type');\n\t\t\tif (!contentType || !contentType.includes('application/json')) {\n\t\t\t\taddLog(`❌ Server returned HTML instead of JSON (Batch ${batchCount})`);\n\t\t\t\taddLog(`This usually means the session expired or there was a server error.`);\n\t\t\t\taddLog(`Please disconnect and reconnect, then try syncing again.`);\n\t\t\t\talert('Session expired or server error. Please disconnect and reconnect.');\n\t\t\t\tloading = false;\n\t\t\t\tstatusMessage = 'Sync Failed';\n\t\t\t\tcurrentBatch = 0;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdata = await res.json();\n\t\t\tprocessServerLogs(data.logs);\n\t\t\tif (data.success) {\n\t\t\t\tconst newOrders = data.orders || [];\n\t\t\t\torders = newOrders;\n\t\t\t\tisConnected = true;\n\n\t\t\t\t// Collect conflicts\n\t\t\t\tif (data.conflicts && Array.isArray(data.conflicts)) {\n\t\t\t\t\t// Merge unique conflicts by date\n\t\t\t\t\tconst existingDates = new Set(conflictTrips.map((c: any) => c.date));\n\t\t\t\t\tconst newConflicts = data.conflicts.filter((c: any) => !existingDates.has(c.date));\n\t\t\t\t\tconflictTrips = [...conflictTrips, ...newConflicts];\n\t\t\t\t}\n\n\t\t\t\tif (data.incomplete) {\n\t\t\t\t\taddLog(`✓ Batch ${batchCount} complete. Starting next batch...`);\n\t\t\t\t\tawait new Promise((r) => setTimeout(r, 1500));\n\t\t\t\t\tawait handleSync(batchCount + 1, recentOnly, forceOverrideDates);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Check for conflicts AFTER all batches complete\n\t\t\t\tif (conflictTrips.length > 0 && forceOverrideDates.length === 0) {\n\t\t\t\t\taddLog(`⚠️ Found ${conflictTrips.length} user-modified trip(s) - awaiting decision...`);\n\t\t\t\t\tstartConflictTimer();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\taddLog(`✅ Sync Complete! Processed ${newOrders.length} orders total.`);\n\t\t\t\tshowSuccessMsg(`Synced ${newOrders.length} orders!`);\n\t\t\t\tstatusMessage = 'Sync Complete';\n\t\t\t\tcurrentBatch = 0;\n\n\t\t\t\tconst userId = $user?.id;\n\t\t\t\tif (userId) {\n\t\t\t\t\taddLog('⬇️ Downloading generated trips...');\n\t\t\t\t\tawait trips.syncFromCloud(userId);\n\t\t\t\t\taddLog('✅ Trips updated locally.');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\taddLog('❌ Sync Failed: ' + data.error);\n\t\t\t\tif (\n\t\t\t\t\tdata.error &&\n\t\t\t\t\t(data.error.includes('login') || data.error.includes('Session expired'))\n\t\t\t\t) {\n\t\t\t\t\taddLog('⚠️ Session expired. Please disconnect and reconnect.');\n\t\t\t\t\talert('Your HughesNet session expired. Please disconnect and reconnect.');\n\t\t\t\t}\n\t\t\t\tloading = false;\n\t\t\t\tstatusMessage = 'Sync Failed';\n\t\t\t\tcurrentBatch = 0;\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\taddLog('❌ Sync Error: ' + e.message);\n\t\t\tif (e.message.includes('JSON')) {\n\t\t\t\taddLog('❌ Server returned invalid response. Session may have expired.');\n\t\t\t\talert('Session error. Please disconnect and reconnect.');\n\t\t\t}\n\t\t\tloading = false;\n\t\t\tstatusMessage = 'Sync Failed';\n\t\t\tcurrentBatch = 0;\n\t\t} finally {\n\t\t\tif (!data || (!data.incomplete && !showConflictModal)) {\n\t\t\t\tloading = false;\n\t\t\t\tstatusMessage = 'Sync Now';\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function handleClear() {\n\t\tif (!confirm('Are you sure you want to delete ALL HughesNet trips? This cannot be undone.'))\n\t\t\treturn;\n\t\tloading = true;\n\t\tstatusMessage = 'Clearing...';\n\t\taddLog('🗑️ Clearing HNS trips...');\n\t\ttry {\n\t\t\tconst res = await csrfFetch('/api/hughesnet', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify({ action: 'clear' })\n\t\t\t});\n\t\t\tconst data: any = await res.json();\n\t\t\tprocessServerLogs(data.logs);\n\n\t\t\taddLog(`✅ Cleared ${data.count} trips.`);\n\t\t\tshowSuccessMsg(`Cleared ${data.count} trips.`);\n\n\t\t\tconst userId = $user?.id;\n\t\t\tif (userId) {\n\t\t\t\taddLog('🔄 Syncing removal with local database...');\n\t\t\t\tawait trash.syncFromCloud(userId);\n\t\t\t\taddLog('✅ Local trips cleaned up.');\n\t\t\t}\n\n\t\t\tawait loadOrders();\n\t\t} catch (e: any) {\n\t\t\taddLog('❌ Clear Error: ' + e.message);\n\t\t} finally {\n\t\t\tloading = false;\n\t\t\tstatusMessage = 'Sync Now';\n\t\t}\n\t}\n\n\t// Conflict Logic\n\tfunction startConflictTimer() {\n\t\tshowConflictModal = true;\n\t\tconflictTimer = 60;\n\t\tselectedConflicts = new Set(); // Reset selection\n\t\tif (conflictInterval) clearInterval(conflictInterval);\n\n\t\tconflictInterval = setInterval(() => {\n\t\t\tconflictTimer--;\n\t\t\tif (conflictTimer <= 0) {\n\t\t\t\t// Default action is SKIP (preserve all user edits)\n\t\t\t\tcancelOverride();\n\t\t\t}\n\t\t}, 1000);\n\t}\n\n\tfunction toggleConflict(date: string) {\n\t\tif (selectedConflicts.has(date)) {\n\t\t\tselectedConflicts.delete(date);\n\t\t} else {\n\t\t\tselectedConflicts.add(date);\n\t\t}\n\t\tselectedConflicts = selectedConflicts; // Trigger reactivity\n\t}\n\n\tfunction selectAll() {\n\t\tselectedConflicts = new Set(conflictTrips.map((c) => c.date));\n\t}\n\n\tfunction selectNone() {\n\t\tselectedConflicts = new Set();\n\t}\n\n\tfunction confirmOverride() {\n\t\tstopConflictTimer();\n\n\t\tif (selectedConflicts.size === 0) {\n\t\t\t// No trips selected, keep all edits\n\t\t\taddLog(`✅ No trips selected - preserved all user edits`);\n\t\t\tconflictTrips = [];\n\t\t\tloading = false;\n\t\t\tstatusMessage = 'Sync Complete';\n\t\t\treturn;\n\t\t}\n\n\t\tconst forceDates = Array.from(selectedConflicts);\n\t\tconst keepCount = conflictTrips.length - selectedConflicts.size;\n\n\t\taddLog(\n\t\t\t`🔄 Overwriting ${selectedConflicts.size} trip(s), keeping ${keepCount} user edit(s)...`\n\t\t);\n\t\thandleSync(1, true, forceDates);\n\t}\n\n\tfunction cancelOverride() {\n\t\tstopConflictTimer();\n\t\taddLog(`✅ Preserved ${conflictTrips.length} user-modified trip(s) (skipped HNS updates)`);\n\t\tconflictTrips = [];\n\t\tselectedConflicts = new Set();\n\t\tloading = false;\n\t\tstatusMessage = 'Sync Complete';\n\t}\n\n\tfunction stopConflictTimer() {\n\t\tif (conflictInterval) clearInterval(conflictInterval);\n\t\tshowConflictModal = false;\n\t}\n\n\timport ArchivedRestore from '$lib/components/hughesnet/ArchivedRestore.svelte';\n\n\t// Track session timeout - force relogin after 15 minutes of inactivity\n\tconst SESSION_TIMEOUT_MS = 15 * 60 * 1000; // 15 minutes\n\tconst LAST_VISIT_KEY = 'hughesnet_last_visit';\n\n\tfunction checkSessionTimeout() {\n\t\tconst lastVisit = localStorage.getItem(LAST_VISIT_KEY);\n\t\tif (lastVisit && isConnected) {\n\t\t\tconst elapsed = Date.now() - parseInt(lastVisit, 10);\n\t\t\tif (elapsed > SESSION_TIMEOUT_MS) {\n\t\t\t\taddLog('⚠️ Session expired (15+ minutes inactive). Please reconnect.');\n\t\t\t\talert('Your HughesNet session has expired due to inactivity. Please reconnect.');\n\t\t\t\thandleDisconnect();\n\t\t\t}\n\t\t}\n\t\t// Update last visit time\n\t\tlocalStorage.setItem(LAST_VISIT_KEY, Date.now().toString());\n\t}\n\n\tonMount(() => {\n\t\tloadSettings();\n\t\tloadOrders();\n\t\tcheckSessionTimeout();\n\t});\n\n\tonDestroy(() => {\n\t\tif (saveTimeout) clearTimeout(saveTimeout);\n\t\tif (conflictInterval) clearInterval(conflictInterval);\n\t});\n</script>\n\n<div class=\"settings\">\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">HughesNet Integration</h1>\n\t\t\t<p class=\"page-subtitle\">Sync your orders, automate trip creation, and calculate pay.</p>\n\t\t</div>\n\t</div>\n\n\t{#if showSuccess}\n\t\t<div class=\"alert success\">\n\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t<path\n\t\t\t\t\td=\"M16.6 5L7.5 14L3.4 10\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t\t{successMessage}\n\t\t</div>\n\t{/if}\n\n\t<!-- Trip Settings Modal (open from warning link/button) -->\n\t<SettingsModal bind:open={showTripSettings} {API_KEY} />\n\n\t<div class=\"settings-grid\">\n\t\t<div class=\"settings-card\">\n\t\t\t<div class=\"card-header\">\n\t\t\t\t<div class=\"card-icon blue\">\n\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M10 2C13.97 2 18 6.03 18 11C18 15.97 13.97 20 9 20H2V13C2 8.03 6.03 4 11 4H18V11C18 6.03 13.97 2 9 2Z\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<h2 class=\"card-title\">Connection</h2>\n\t\t\t\t\t<p class=\"card-subtitle\">\n\t\t\t\t\t\t{isConnected ? 'Connected to HughesNet' : 'Link your account'}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if !isConnected && orders.length === 0}\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"hn-username\">Username</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"hn-username\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tbind:value={username}\n\t\t\t\t\t\tplaceholder=\"HughesNet Username\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"hn-password\">Password</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"hn-password\"\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tbind:value={password}\n\t\t\t\t\t\tplaceholder=\"HughesNet Password\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<button class=\"btn-primary\" on:click={handleConnect} disabled={loading}>\n\t\t\t\t\t{statusMessage === 'Sync Now' ? 'Connect' : statusMessage}\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<div class=\"success-state\">\n\t\t\t\t\t<div class=\"status-indicator\">\n\t\t\t\t\t\t<span class=\"dot\"></span> Connected\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class=\"last-sync\">Found {orders.length} active orders in cache.</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"warning-box\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\t⚠️ <strong>Important:</strong> Before syncing, ensure your Start/End addresses, MPG, and\n\t\t\t\t\t\tGas Price defaults are updated in\n\t\t\t\t\t\t<button type=\"button\" class=\"btn-link\" on:click={() => (showTripSettings = true)}>\n\t\t\t\t\t\t\tTrip Settings\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t{#if loading && currentBatch > 0}\n\t\t\t\t\t<div class=\"sync-progress-container\">\n\t\t\t\t\t\t<div class=\"progress-info\">\n\t\t\t\t\t\t\t<span class=\"progress-label\">Syncing Batch {currentBatch}</span>\n\t\t\t\t\t\t\t<span class=\"progress-sub\">Fetching orders...</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"progress-bar\">\n\t\t\t\t\t\t\t<div class=\"progress-fill indeterminate\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<div class=\"button-group mt-4\">\n\t\t\t\t\t\t<button class=\"btn-primary\" on:click={() => handleSync(1, true)} disabled={loading}>\n\t\t\t\t\t\t\t<svg class=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t><path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\td=\"M13 10V3L4 14h7v7l9-11h-7z\"\n\t\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\tQuick Sync (New Only)\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<button class=\"btn-secondary\" on:click={() => handleSync(1, false)} disabled={loading}>\n\t\t\t\t\t\t\t<svg class=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t><path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\td=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\n\t\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\tFull History Scan\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-secondary danger-hover\"\n\t\t\t\t\t\t\ton:click={handleDisconnect}\n\t\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tDisconnect\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<button class=\"btn-secondary danger-hover\" on:click={handleClear} disabled={loading}>\n\t\t\t\t\t\t\tDelete HNS Trips\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"settings-card\">\n\t\t\t<div class=\"card-header\">\n\t\t\t\t<div class=\"card-icon green\">\n\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M5 10.5L8.5 14L15 7.5\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<h2 class=\"card-title\">Archived Orders</h2>\n\t\t\t\t\t<p class=\"card-subtitle\">Restore previously synced HughesNet orders</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div style=\"padding:12px;\">\n\t\t\t\t<ArchivedRestore\n\t\t\t\t\ton:restored={(e: CustomEvent) => {\n\t\t\t\t\t\tif (e.detail?.imported) {\n\t\t\t\t\t\t\taddLog(`Imported ${e.detail.imported.length} archived orders`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\ton:restoreAndSync={(e: CustomEvent) => {\n\t\t\t\t\t\tif (e.detail?.dates) {\n\t\t\t\t\t\t\taddLog(`Imported orders for ${e.detail.dates.join(', ')}, syncing...`);\n\t\t\t\t\t\t\thandleSync(1, true, e.detail.dates);\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if isConnected}\n\t\t\t<div class=\"settings-card\">\n\t\t\t\t<div class=\"card-header\">\n\t\t\t\t\t<div class=\"card-icon orange\">\n\t\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M10 12C11.1046 12 12 11.1046 12 10C12 8.89543 11.1046 8 10 8C8.89543 8 8 8.89543 8 10C8 11.1046 8.89543 12 10 12Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M16.2 12C16.1 12.5 16.3 13 16.7 13.3L16.8 13.4C17.1 13.7 17.3 14.1 17.3 14.5C17.3 14.9 17.1 15.3 16.8 15.6C16.5 15.9 16.1 16.1 15.7 16.1C15.3 16.1 14.9 15.9 14.6 15.6L14.5 15.5C14.2 15.1 13.7 14.9 13.2 15C12.7 15.1 12.4 15.5 12.3 16V16.2C12.3 17.1 11.6 17.8 10.7 17.8C9.8 17.8 9.1 17.1 9.1 16.2V16.1C9 15.5 8.6 15.1 8 15C7.5 15 7 15.2 6.7 15.6L6.6 15.7C6.3 16 5.9 16.2 5.5 16.2C5.1 16.2 4.7 16 4.4 15.7C4.1 15.4 3.9 15 3.9 14.6C3.9 14.2 4.1 13.8 4.4 13.5L4.5 13.4C4.9 13.1 5.1 12.6 5 12.1C4.9 11.6 4.5 11.3 4 11.2H3.8C2.9 11.2 2.2 10.5 2.2 9.6C2.2 8.7 2.9 8 3.8 8H3.9C4.5 7.9 4.9 7.5 5 6.9C5 6.4 4.8 5.9 4.4 5.6L4.3 5.5C4 5.2 3.8 4.8 3.8 4.4C3.8 4 4 3.6 4.3 3.3C4.6 3 5 2.8 5.4 2.8C5.8 2.8 6.2 3 6.5 3.3L6.6 3.4C7 3.8 7.5 4 8 3.9C8.5 3.9 8.8 3.4 8.9 2.9V2.7C8.9 1.8 9.6 1.1 10.5 1.1C11.4 1.1 12.1 1.8 12.1 2.7V2.8C12.1 3.4 12.5 3.8 13.1 3.9C13.6 4 14.1 3.8 14.4 3.4L14.5 3.3C14.8 3 15.2 2.8 15.6 2.8C16 2.8 16.4 3 16.7 3.3C17 3.6 17.2 4 17.2 4.4C17.2 4.8 17 5.2 16.7 5.5L16.6 5.6C16.2 5.9 16 6.4 16.1 6.9C16.2 7.4 16.6 7.7 17.1 7.8H17.3C18.2 7.8 18.9 8.5 18.9 9.4C18.9 10.3 18.2 11 17.3 11H17.2C16.6 11.1 16.2 11.5 16.1 12.1L16.2 12Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h2 class=\"card-title\">Configuration</h2>\n\t\t\t\t\t\t<p class=\"card-subtitle\">Pay rates and supply costs</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<h3 class=\"section-label\">Pay Rates</h3>\n\t\t\t\t<div class=\"config-grid\">\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"install-pay\">Install Pay ($)</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"install-pay\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={installPay}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"repair-pay\">Repair Pay ($)</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"repair-pay\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={repairPay}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"upgrade-pay\">Upgrade Pay ($)</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"upgrade-pay\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={upgradePay}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"wifi-pay\">WIFI Extender Pay ($)</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"wifi-pay\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={wifiExtenderPay}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"voip-pay\">Phone Pay ($)</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"voip-pay\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={voipPay}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if $user?.id?.toLowerCase() === 'james'}\n\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t<label for=\"drive-time-bonus\">Drive Time Bonus ($)</label>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"drive-time-bonus\"\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tbind:value={driveTimeBonus}\n\t\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<span class=\"help-text\">Added to EACH order if total drive > 5.5h</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<h3 class=\"section-label text-red\">Supply Costs & Extras</h3>\n\t\t\t\t<div class=\"config-grid\">\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"pole-cost\" class=\"text-red\">Pole Cost ($)</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"pole-cost\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={poleCost}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\tclass=\"border-red\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class=\"help-text\">Deducted if Pole detected</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"conc-cost\" class=\"text-red\">Concrete Cost ($)</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"conc-cost\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={concreteCost}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\tclass=\"border-red\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class=\"help-text\">Deducted if Pole detected</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"pole-charge\" class=\"text-green\">Pole Charge Amount ($)</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"pole-charge\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={poleCharge}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\tclass=\"border-green\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class=\"help-text\">Added to pay if Pole detected</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"separator\"></div>\n\n\t\t\t\t<div class=\"config-grid\">\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"install-time\">Install Time (min)</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"install-time\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={installTime}\n\t\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\t\tmin=\"1\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"repair-time\">Repair Time (min)</label>\n\t\t\t\t\t\t<input id=\"repair-time\" type=\"number\" bind:value={repairTime} placeholder=\"0\" min=\"1\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"checkbox-wrapper\">\n\t\t\t\t\t<label class=\"checkbox-label\">\n\t\t\t\t\t\t<input type=\"checkbox\" bind:checked={overrideTimes} />\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span class=\"cb-title\">Override Calculated Times</span>\n\t\t\t\t\t\t\t<span class=\"cb-desc\">Ignore system logs and force the durations above</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"tip-text\">\n\t\t\t\t\t{isSaving ? 'Saving...' : 'Changes are saved to the cloud automatically.'}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#if isConnected && orders.length > 0}\n\t\t\t<div class=\"settings-card full-width\">\n\t\t\t\t<div class=\"card-header\">\n\t\t\t\t\t<div class=\"card-icon navy\">\n\t\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M17 2H3C2.46957 2 1.96086 2.21071 1.58579 2.58579C1.21071 2.96086 1 3.46957 1 4V16C1 16.5304 1.21071 17.0391 1.58579 17.4142C1.96086 17.7893 2.46957 18 3 18H17C17.5304 18 18.0391 17.7893 18.4142 17.4142C18.7893 17.0391 19 16.5304 19 16V4C19 3.46957 18.7893 2.96086 18.4142 2.58579C18.0391 2.21071 17.5304 2 17 2Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M1 8H19M6 1V3M14 1V3\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h2 class=\"card-title\">Cached Orders</h2>\n\t\t\t\t\t\t<p class=\"card-subtitle\">Orders currently stored in your session</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"orders-list\">\n\t\t\t\t\t{#each orders as order}\n\t\t\t\t\t\t<div class=\"order-item\">\n\t\t\t\t\t\t\t<div class=\"order-main\">\n\t\t\t\t\t\t\t\t<span class=\"order-id\">#{order.id}</span>\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass=\"order-badge {order.type === 'Install' || order.type === 'Re-Install'\n\t\t\t\t\t\t\t\t\t\t? 'blue'\n\t\t\t\t\t\t\t\t\t\t: order.type === 'Upgrade'\n\t\t\t\t\t\t\t\t\t\t\t? 'green'\n\t\t\t\t\t\t\t\t\t\t\t: 'purple'}\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{order.type || 'Unknown'}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t{#if order.hasPoleMount}\n\t\t\t\t\t\t\t\t\t<span class=\"order-badge pole\">Pole</span>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{#if order.hasWifiExtender}\n\t\t\t\t\t\t\t\t\t<span class=\"order-badge wifi\">Wifi</span>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{#if order.hasVoip}\n\t\t\t\t\t\t\t\t\t<span class=\"order-badge voip\">Phone</span>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"order-details\">\n\t\t\t\t\t\t\t\t<div class=\"order-addr\">{order.address}</div>\n\t\t\t\t\t\t\t\t<div class=\"order-meta\">{order.city}, {order.state}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"order-time\">\n\t\t\t\t\t\t\t\t<div class=\"date\">{order.confirmScheduleDate}</div>\n\t\t\t\t\t\t\t\t<div class=\"time\">{order.beginTime}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"settings-card full-width bg-dark\">\n\t\t\t<div\n\t\t\t\tclass=\"console-header\"\n\t\t\t\ton:click={() => (showConsole = !showConsole)}\n\t\t\t\ton:keydown={() => {}}\n\t\t\t\trole=\"button\"\n\t\t\t\ttabindex=\"0\"\n\t\t\t>\n\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t<span>Debug Console</span>\n\t\t\t\t\t<span class=\"console-count\">({logs.length})</span>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"toggle-icon\" class:rotated={showConsole}>▶</span>\n\t\t\t</div>\n\n\t\t\t{#if showConsole}\n\t\t\t\t<div class=\"console-body\" transition:slide>\n\t\t\t\t\t{#each logs as log}\n\t\t\t\t\t\t<div class=\"log-line\">\n\t\t\t\t\t\t\t<span class=\"log-time\"\n\t\t\t\t\t\t\t\t>{log.includes('[') ? '' : '[' + new Date().toLocaleTimeString() + ']'}</span\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class=\"log-msg\" class:server={log.includes('[Server]')}>{log}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t\t{#if logs.length === 0}\n\t\t\t\t\t\t<div class=\"log-line muted\">System ready...</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n\n{#if showConflictModal}\n\t<div class=\"modal-overlay\">\n\t\t<div class=\"modal-content\">\n\t\t\t<div class=\"modal-header\">\n\t\t\t\t<h3>⚠️ User Modifications Detected</h3>\n\t\t\t</div>\n\t\t\t<div class=\"modal-body\">\n\t\t\t\t<p>\n\t\t\t\t\tFound <strong>{conflictTrips.length}</strong> trip(s) you manually edited in the last 7 days.\n\t\t\t\t</p>\n\t\t\t\t<p class=\"modal-instruction\">Select which trips to overwrite with HughesNet data:</p>\n\n\t\t\t\t<div class=\"selection-controls\">\n\t\t\t\t\t<button class=\"select-btn\" on:click={selectAll}>Select All</button>\n\t\t\t\t\t<button class=\"select-btn\" on:click={selectNone}>Select None</button>\n\t\t\t\t\t<span class=\"selected-count\"\n\t\t\t\t\t\t>{selectedConflicts.size} of {conflictTrips.length} selected</span\n\t\t\t\t\t>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"conflicts-list\">\n\t\t\t\t\t{#each conflictTrips as conflict}\n\t\t\t\t\t\t<div class=\"conflict-card\" class:selected={selectedConflicts.has(conflict.date)}>\n\t\t\t\t\t\t\t<label class=\"conflict-checkbox-label\">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\tchecked={selectedConflicts.has(conflict.date)}\n\t\t\t\t\t\t\t\t\ton:change={() => toggleConflict(conflict.date)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<div class=\"conflict-content\">\n\t\t\t\t\t\t\t\t\t<div class=\"conflict-header\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"conflict-date\">{conflict.date}</span>\n\t\t\t\t\t\t\t\t\t\t<span class=\"conflict-modified\"\n\t\t\t\t\t\t\t\t\t\t\t>Edited: {new Date(conflict.lastModified).toLocaleString()}</span\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"conflict-comparison\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"comparison-side your-version\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"comparison-label\">Your Version</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"comparison-details\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"detail-row\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-label\">Stops:</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-value\">{conflict.stops}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"detail-row\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-label\">Earnings:</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-value earnings\">${conflict.earnings.toFixed(2)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"detail-row address-row\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-label\">Address:</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-value address\">{conflict.address}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\"comparison-arrow\">→</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\"comparison-side hns-version\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"comparison-label\">HughesNet Data</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"comparison-details\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"detail-row\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass:changed={conflict.stops !== conflict.hnsStops}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-label\">Stops:</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-value\">{conflict.hnsStops}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if conflict.stops !== conflict.hnsStops}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"diff-badge\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>{conflict.hnsStops - conflict.stops > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? '+'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}{conflict.hnsStops - conflict.stops}</span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"detail-row\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass:changed={conflict.earnings !== conflict.hnsEarnings}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-label\">Earnings:</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-value earnings\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>${conflict.hnsEarnings.toFixed(2)}</span\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if conflict.earnings !== conflict.hnsEarnings}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"diff-badge\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>${(conflict.hnsEarnings - conflict.earnings).toFixed(2)}</span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"detail-row address-row\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass:changed={conflict.address !== conflict.hnsAddress}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-label\">Address:</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"detail-value address\">{conflict.hnsAddress}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\n\t\t\t\t<p class=\"conflict-question\">\n\t\t\t\t\t{#if selectedConflicts.size === 0}\n\t\t\t\t\t\tClick \"Keep All My Edits\" to preserve all changes, or select trips to overwrite.\n\t\t\t\t\t{:else if selectedConflicts.size === conflictTrips.length}\n\t\t\t\t\t\tAll trips selected - will overwrite all with HughesNet data.\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t{selectedConflicts.size} trip(s) selected - will overwrite selected, keep others.\n\t\t\t\t\t{/if}\n\t\t\t\t</p>\n\n\t\t\t\t<div class=\"timer-bar\">\n\t\t\t\t\t<div class=\"timer-fill\" style=\"width: {(conflictTimer / 60) * 100}%\"></div>\n\t\t\t\t</div>\n\t\t\t\t<p class=\"timer-text\">\n\t\t\t\t\t{#if conflictTimer > 0}\n\t\t\t\t\t\tAuto-keeping all edits in <strong>{conflictTimer}s</strong>...\n\t\t\t\t\t{:else}\n\t\t\t\t\t\tKeeping your edits...\n\t\t\t\t\t{/if}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class=\"modal-actions\">\n\t\t\t\t<button class=\"btn-primary safe\" on:click={cancelOverride}>\n\t\t\t\t\t<svg class=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"\n\t\t\t\t\t\t><path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\td=\"M5 13l4 4L19 7\"\n\t\t\t\t\t\t></path></svg\n\t\t\t\t\t>\n\t\t\t\t\tKeep All My Edits\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"btn-secondary danger\"\n\t\t\t\t\ton:click={confirmOverride}\n\t\t\t\t\tdisabled={selectedConflicts.size === 0}\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"\n\t\t\t\t\t\t><path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\td=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\n\t\t\t\t\t\t></path></svg\n\t\t\t\t\t>\n\t\t\t\t\t{selectedConflicts.size === 0\n\t\t\t\t\t\t? 'Select Trips to Overwrite'\n\t\t\t\t\t\t: `Overwrite ${selectedConflicts.size} Selected`}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n<style>\n\t/* Mobile First Container */\n\t.settings {\n\t\tmax-width: 1200px;\n\t\tmargin: 0 auto;\n\t\tpadding: 16px;\n\t}\n\n\t.page-header {\n\t\tmargin-bottom: 32px;\n\t}\n\n\t.page-title {\n\t\tfont-size: 24px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t}\n\n\t.page-subtitle {\n\t\tfont-size: 16px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.alert {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding: 14px 20px;\n\t\tborder-radius: 12px;\n\t\tfont-size: 14px;\n\t\tfont-weight: 500;\n\t\tmargin-bottom: 24px;\n\t}\n\t.alert.success {\n\t\tbackground: #f0fdf4;\n\t\tcolor: #166534;\n\t\tborder: 1px solid #bbf7d0;\n\t}\n\n\t/* Mobile First Grid System */\n\t.settings-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr; /* Default to 1 column */\n\t\tgap: 16px;\n\t}\n\n\t.settings-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 16px;\n\t\tpadding: 16px;\n\t}\n\n\t.settings-card.full-width {\n\t\tgrid-column: span 1;\n\t}\n\n\t/* Desktop Overrides */\n\t@media (min-width: 1024px) {\n\t\t.settings {\n\t\t\tpadding: 20px;\n\t\t}\n\t\t.page-title {\n\t\t\tfont-size: 32px;\n\t\t}\n\n\t\t.settings-grid {\n\t\t\tgrid-template-columns: repeat(2, 1fr);\n\t\t\tgap: 24px;\n\t\t}\n\t\t.settings-card {\n\t\t\tpadding: 24px;\n\t\t}\n\t\t.settings-card.full-width {\n\t\t\tgrid-column: span 2;\n\t\t}\n\t}\n\n\t.card-header {\n\t\tdisplay: flex;\n\t\tgap: 16px;\n\t\tmargin-bottom: 24px;\n\t\tpadding-bottom: 20px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t}\n\t.card-icon {\n\t\twidth: 48px;\n\t\theight: 48px;\n\t\tborder-radius: 12px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcolor: white;\n\t\tflex-shrink: 0;\n\t}\n\t.card-icon.blue {\n\t\tbackground: linear-gradient(135deg, var(--blue) 0%, #1e9bcf 100%);\n\t}\n\t.card-icon.orange {\n\t\tbackground: linear-gradient(135deg, var(--orange) 0%, #ff6a3d 100%);\n\t}\n\t.card-icon.navy {\n\t\tbackground: linear-gradient(135deg, var(--navy) 0%, #1a3a5c 100%);\n\t}\n\n\t.card-title {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t}\n\t.card-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.form-group {\n\t\tmargin-bottom: 20px;\n\t}\n\t.form-group label {\n\t\tdisplay: block;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 8px;\n\t}\n\t.form-group label.text-red {\n\t\tcolor: #dc2626;\n\t}\n\t.form-group label.text-green {\n\t\tcolor: #166534;\n\t}\n\n\t.form-group input {\n\t\twidth: 100%;\n\t\tpadding: 12px 16px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 15px;\n\t\tbackground: white;\n\t\ttransition: all 0.2s;\n\t\tbox-sizing: border-box;\n\t}\n\t.form-group input:focus {\n\t\toutline: none;\n\t\tborder-color: var(--orange);\n\t\tbox-shadow: 0 0 0 3px rgba(255, 127, 80, 0.1);\n\t}\n\n\t.form-group input.border-red {\n\t\tborder-color: #fecaca;\n\t\tbackground: #fef2f2;\n\t}\n\t.form-group input.border-red:focus {\n\t\tborder-color: #dc2626;\n\t\tbox-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);\n\t}\n\n\t.form-group input.border-green {\n\t\tborder-color: #bbf7d0;\n\t\tbackground: #f0fdf4;\n\t}\n\t.form-group input.border-green:focus {\n\t\tborder-color: #166534;\n\t\tbox-shadow: 0 0 0 3px rgba(22, 101, 52, 0.1);\n\t}\n\n\t.help-text {\n\t\tfont-size: 11px;\n\t\tcolor: #9ca3af;\n\t\tmargin-top: 4px;\n\t\tdisplay: block;\n\t}\n\n\t/* Mobile First Config Grid */\n\t.config-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr; /* Stack vertically on mobile */\n\t\tgap: 16px;\n\t}\n\n\t@media (min-width: 640px) {\n\t\t.config-grid {\n\t\t\tgrid-template-columns: 1fr 1fr;\n\t\t\tgap: 20px;\n\t\t}\n\t}\n\n\t.section-label {\n\t\tfont-size: 12px;\n\t\tfont-weight: 700;\n\t\ttext-transform: uppercase;\n\t\tcolor: #9ca3af;\n\t\tmargin-bottom: 12px;\n\t\tletter-spacing: 0.05em;\n\t\tmargin-top: 8px;\n\t}\n\t.section-label.text-red {\n\t\tcolor: #ef4444;\n\t}\n\n\t.separator {\n\t\theight: 1px;\n\t\tbackground: #e5e7eb;\n\t\tmargin: 24px 0;\n\t}\n\n\t.btn-primary,\n\t.btn-secondary {\n\t\twidth: 100%;\n\t\tpadding: 14px;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tfont-size: 15px;\n\t}\n\t.btn-primary {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbackground: linear-gradient(135deg, var(--orange) 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t}\n\t.btn-primary:hover {\n\t\ttransform: translateY(-2px);\n\t\tbox-shadow: 0 8px 16px rgba(255, 127, 80, 0.3);\n\t}\n\t.btn-primary:disabled {\n\t\topacity: 0.7;\n\t\tcursor: not-allowed;\n\t\ttransform: none;\n\t\tbox-shadow: none;\n\t}\n\n\t.btn-secondary {\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t\tborder: 2px solid #e5e7eb;\n\t}\n\t.btn-secondary:hover {\n\t\tborder-color: var(--orange);\n\t\tcolor: var(--orange);\n\t}\n\t.btn-secondary.danger-hover:hover {\n\t\tborder-color: #dc2626;\n\t\tcolor: #dc2626;\n\t}\n\n\t/* Mobile First Button Group */\n\t.button-group {\n\t\tdisplay: flex;\n\t\tflex-direction: column; /* Stack buttons on mobile */\n\t\tgap: 12px;\n\t}\n\n\t@media (min-width: 640px) {\n\t\t.button-group {\n\t\t\tflex-direction: row;\n\t\t}\n\t}\n\n\t.mt-4 {\n\t\tmargin-top: 16px;\n\t}\n\n\t/* SYNC PROGRESS STYLES */\n\t.sync-progress-container {\n\t\tbackground: #fff7ed;\n\t\tborder: 1px solid #fed7aa;\n\t\tborder-radius: 12px;\n\t\tpadding: 16px;\n\t\ttext-align: center;\n\t\tmargin-top: 16px;\n\t}\n\t.progress-info {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: baseline;\n\t\tmargin-bottom: 8px;\n\t}\n\t.progress-label {\n\t\tfont-weight: 700;\n\t\tcolor: #9a3412;\n\t\tfont-size: 14px;\n\t}\n\t.progress-sub {\n\t\tcolor: #c2410c;\n\t\tfont-size: 12px;\n\t}\n\t.progress-bar {\n\t\theight: 8px;\n\t\tbackground: #ffedd5;\n\t\tborder-radius: 4px;\n\t\toverflow: hidden;\n\t\tposition: relative;\n\t}\n\t.progress-fill {\n\t\theight: 100%;\n\t\tbackground: linear-gradient(90deg, #f97316, #ea580c);\n\t\tborder-radius: 4px;\n\t\twidth: 30%;\n\t}\n\t.progress-fill.indeterminate {\n\t\twidth: 50%;\n\t\tanimation: pulse-progress 1.5s infinite ease-in-out;\n\t}\n\n\t@keyframes pulse-progress {\n\t\t0% {\n\t\t\ttransform: translateX(-100%);\n\t\t}\n\t\t100% {\n\t\t\ttransform: translateX(200%);\n\t\t}\n\t}\n\n\t.success-state {\n\t\tpadding: 20px;\n\t\tbackground: #f0fdf4;\n\t\tborder: 1px solid #bbf7d0;\n\t\tborder-radius: 12px;\n\t\ttext-align: center;\n\t}\n\t.status-indicator {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-weight: 700;\n\t\tcolor: #166534;\n\t\tfont-size: 16px;\n\t}\n\t.dot {\n\t\twidth: 8px;\n\t\theight: 8px;\n\t\tbackground: #166534;\n\t\tborder-radius: 50%;\n\t\tdisplay: inline-block;\n\t}\n\t.last-sync {\n\t\tcolor: #15803d;\n\t\tfont-size: 14px;\n\t\tmargin-top: 4px;\n\t}\n\n\t.warning-box {\n\t\tmargin: 16px 0;\n\t\tpadding: 12px;\n\t\tbackground: #fff7ed;\n\t\tborder: 1px solid #fed7aa;\n\t\tborder-radius: 8px;\n\t\tfont-size: 13px;\n\t\tcolor: #9a3412;\n\t}\n\t.warning-box .btn-link {\n\t\tcolor: #c2410c;\n\t\ttext-decoration: underline;\n\t\tfont-weight: 600;\n\t}\n\n\t.checkbox-wrapper {\n\t\tmargin: 20px 0;\n\t\tpadding: 16px;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 10px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.checkbox-label {\n\t\tdisplay: flex;\n\t\talign-items: flex-start;\n\t\tgap: 12px;\n\t\tcursor: pointer;\n\t}\n\t.checkbox-label input {\n\t\tmargin-top: 4px;\n\t\twidth: 16px;\n\t\theight: 16px;\n\t\tcursor: pointer;\n\t\taccent-color: var(--orange);\n\t}\n\t.cb-title {\n\t\tdisplay: block;\n\t\tfont-weight: 600;\n\t\tcolor: #111827;\n\t\tfont-size: 14px;\n\t}\n\t.cb-desc {\n\t\tdisplay: block;\n\t\tcolor: #6b7280;\n\t\tfont-size: 13px;\n\t\tmargin-top: 2px;\n\t}\n\n\t.tip-text {\n\t\tfont-size: 13px;\n\t\tcolor: #6b7280;\n\t\tfont-style: italic;\n\t\tmargin-top: 10px;\n\t}\n\n\t.orders-list {\n\t\tdisplay: grid;\n\t\tgap: 12px;\n\t\tmax-height: 400px;\n\t\toverflow-y: auto;\n\t}\n\n\t/* Mobile First Order Item */\n\t.order-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column; /* Stack content vertically */\n\t\talign-items: flex-start;\n\t\tpadding: 12px 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tbackground: #f9fafb;\n\t\tgap: 8px;\n\t}\n\n\t.order-main {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 10px;\n\t\tflex-wrap: wrap;\n\t}\n\t.order-id {\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t}\n\t.order-badge {\n\t\tpadding: 2px 8px;\n\t\tborder-radius: 12px;\n\t\tfont-size: 11px;\n\t\tfont-weight: 700;\n\t\ttext-transform: uppercase;\n\t}\n\t.order-badge.blue {\n\t\tbackground: #dbeafe;\n\t\tcolor: #1e40af;\n\t}\n\t.order-badge.purple {\n\t\tbackground: #f3e8ff;\n\t\tcolor: #6b21a8;\n\t}\n\t.order-badge.green {\n\t\tbackground: #dcfce7;\n\t\tcolor: #15803d;\n\t}\n\t.order-badge.pole {\n\t\tbackground: #fee2e2;\n\t\tcolor: #991b1b;\n\t\tborder: 1px solid #fca5a5;\n\t}\n\t.order-badge.wifi {\n\t\tbackground: #d1fae5;\n\t\tcolor: #065f46;\n\t\tborder: 1px solid #6ee7b7;\n\t}\n\t.order-badge.voip {\n\t\tbackground: #fef3c7;\n\t\tcolor: #92400e;\n\t\tborder: 1px solid #fcd34d;\n\t}\n\n\t.order-details {\n\t\tflex: 1;\n\t\tmargin: 0;\n\t\twidth: 100%;\n\t}\n\t.order-addr {\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tfont-weight: 500;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t.order-meta {\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.order-time {\n\t\ttext-align: left; /* Left align on mobile */\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t}\n\n\t/* Desktop overrides for Order List */\n\t@media (min-width: 640px) {\n\t\t.order-item {\n\t\t\tflex-direction: row;\n\t\t\talign-items: center;\n\t\t\tgap: 0;\n\t\t}\n\t\t.order-details {\n\t\t\tmargin: 0 16px;\n\t\t\twidth: auto;\n\t\t}\n\t\t.order-time {\n\t\t\ttext-align: right;\n\t\t\tdisplay: block;\n\t\t}\n\t}\n\n\t.date {\n\t\tfont-weight: 700;\n\t\tcolor: #059669;\n\t\tfont-size: 13px;\n\t}\n\t.time {\n\t\tcolor: #6b7280;\n\t\tfont-size: 12px;\n\t}\n\n\t.bg-dark {\n\t\tbackground: #111827;\n\t\tborder-color: #374151;\n\t\tpadding: 0;\n\t\toverflow: hidden;\n\t}\n\t.console-header {\n\t\tbackground: #1f2937;\n\t\tpadding: 12px 24px;\n\t\tcolor: #9ca3af;\n\t\tfont-size: 12px;\n\t\tfont-weight: 700;\n\t\ttext-transform: uppercase;\n\t\tborder-bottom: 1px solid #374151;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tcursor: pointer;\n\t\tuser-select: none;\n\t}\n\t.console-header:hover {\n\t\tcolor: #e5e7eb;\n\t\tbackground: #374151;\n\t}\n\t.console-count {\n\t\tcolor: #6b7280;\n\t\tfont-weight: 400;\n\t\tfont-size: 11px;\n\t\tmargin-left: 4px;\n\t}\n\t.toggle-icon {\n\t\ttransition: transform 0.2s;\n\t\tfont-size: 10px;\n\t}\n\t.toggle-icon.rotated {\n\t\ttransform: rotate(90deg);\n\t}\n\n\t.console-body {\n\t\tpadding: 16px 24px;\n\t\theight: 200px;\n\t\toverflow-y: auto;\n\t\tfont-family: monospace;\n\t\tfont-size: 12px;\n\t\tdisplay: flex;\n\t\tflex-direction: column-reverse;\n\t\tborder-top: 1px solid #374151;\n\t}\n\t.log-line {\n\t\tmargin-bottom: 6px;\n\t}\n\t.log-time {\n\t\tcolor: #6b7280;\n\t\tmargin-right: 8px;\n\t}\n\t.log-msg {\n\t\tcolor: #34d399;\n\t}\n\t.log-msg.server {\n\t\tcolor: #60a5fa;\n\t}\n\t.log-line.muted {\n\t\tcolor: #4b5563;\n\t\tfont-style: italic;\n\t}\n\n\t.w-4 {\n\t\twidth: 16px;\n\t}\n\t.h-4 {\n\t\theight: 16px;\n\t}\n\t.mr-2 {\n\t\tmargin-right: 8px;\n\t}\n\n\t/* Modal Styles */\n\t.modal-overlay {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tbackground: rgba(0, 0, 0, 0.6);\n\t\tz-index: 9999;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbackdrop-filter: blur(4px);\n\t\tpadding: 16px;\n\t}\n\t.modal-content {\n\t\tbackground: white;\n\t\twidth: 100%;\n\t\tmax-width: 800px;\n\t\tborder-radius: 16px;\n\t\tpadding: 24px;\n\t\tbox-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);\n\t\tmax-height: 90vh;\n\t\toverflow-y: auto;\n\t}\n\t.modal-header h3 {\n\t\tfont-size: 20px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0 0 16px 0;\n\t}\n\t.modal-body p {\n\t\tfont-size: 14px;\n\t\tcolor: #4b5563;\n\t\tmargin-bottom: 12px;\n\t\tline-height: 1.5;\n\t}\n\n\t.modal-instruction {\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 16px !important;\n\t}\n\n\t.selection-controls {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tmargin-bottom: 16px;\n\t\tpadding: 12px;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 8px;\n\t}\n\n\t.select-btn {\n\t\tpadding: 6px 12px;\n\t\tbackground: white;\n\t\tborder: 1px solid #d1d5db;\n\t\tborder-radius: 6px;\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t\tcolor: #374151;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.select-btn:hover {\n\t\tborder-color: #f97316;\n\t\tcolor: #f97316;\n\t}\n\n\t.selected-count {\n\t\tmargin-left: auto;\n\t\tfont-size: 13px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t}\n\n\t.conflicts-list {\n\t\tbackground: #f9fafb;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tpadding: 16px;\n\t\tmargin: 16px 0;\n\t\tmax-height: 400px;\n\t\toverflow-y: auto;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t}\n\n\t.conflict-card {\n\t\tbackground: white;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.conflict-card.selected {\n\t\tborder-color: #f97316;\n\t\tbackground: #fff7ed;\n\t}\n\n\t.conflict-checkbox-label {\n\t\tdisplay: block;\n\t\tcursor: pointer;\n\t\tpadding: 16px;\n\t}\n\n\t.conflict-checkbox-label input[type='checkbox'] {\n\t\twidth: 20px;\n\t\theight: 20px;\n\t\tmargin-right: 12px;\n\t\tcursor: pointer;\n\t\taccent-color: #f97316;\n\t\tfloat: left;\n\t\tmargin-top: 4px;\n\t}\n\n\t.conflict-content {\n\t\toverflow: hidden;\n\t}\n\n\t.conflict-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 16px;\n\t}\n\n\t.conflict-date {\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tfont-size: 16px;\n\t}\n\n\t.conflict-modified {\n\t\tcolor: #9ca3af;\n\t\tfont-size: 12px;\n\t\tfont-style: italic;\n\t}\n\n\t.conflict-comparison {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr auto 1fr;\n\t\tgap: 16px;\n\t\talign-items: center;\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.conflict-comparison {\n\t\t\tgrid-template-columns: 1fr;\n\t\t\tgap: 12px;\n\t\t}\n\t\t.comparison-arrow {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n\n\t.comparison-side {\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 6px;\n\t\tpadding: 12px;\n\t}\n\n\t.comparison-side.your-version {\n\t\tborder: 2px solid #10b981;\n\t}\n\n\t.comparison-side.hns-version {\n\t\tborder: 2px solid #3b82f6;\n\t}\n\n\t.comparison-label {\n\t\tfont-size: 11px;\n\t\tfont-weight: 700;\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 0.05em;\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.your-version .comparison-label {\n\t\tcolor: #10b981;\n\t}\n\n\t.hns-version .comparison-label {\n\t\tcolor: #3b82f6;\n\t}\n\n\t.comparison-arrow {\n\t\tfont-size: 24px;\n\t\tcolor: #9ca3af;\n\t\ttext-align: center;\n\t}\n\n\t.comparison-details {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 6px;\n\t}\n\n\t.detail-row {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tfont-size: 13px;\n\t\tposition: relative;\n\t}\n\n\t.detail-row.changed {\n\t\tbackground: #fef3c7;\n\t\tpadding: 4px 6px;\n\t\tborder-radius: 4px;\n\t\tmargin: -2px -6px;\n\t}\n\n\t.detail-row.address-row {\n\t\tflex-direction: column;\n\t\talign-items: flex-start;\n\t\tgap: 4px;\n\t}\n\n\t.detail-label {\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t}\n\n\t.detail-value {\n\t\tcolor: #111827;\n\t\tfont-weight: 500;\n\t}\n\n\t.detail-value.earnings {\n\t\tcolor: #059669;\n\t\tfont-weight: 700;\n\t}\n\n\t.detail-value.address {\n\t\tcolor: #4b5563;\n\t\tfont-size: 12px;\n\t\tword-break: break-word;\n\t}\n\n\t.diff-badge {\n\t\tbackground: #fee2e2;\n\t\tcolor: #991b1b;\n\t\tfont-size: 10px;\n\t\tfont-weight: 700;\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 10px;\n\t\tmargin-left: 6px;\n\t}\n\n\t.conflict-question {\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-top: 16px;\n\t\tfont-size: 14px;\n\t\ttext-align: center;\n\t\tpadding: 12px;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 8px;\n\t}\n\t.timer-text {\n\t\tfont-size: 13px;\n\t\tcolor: #ea580c;\n\t\tfont-weight: 600;\n\t\tmargin-top: 8px;\n\t\ttext-align: center;\n\t}\n\t.timer-bar {\n\t\twidth: 100%;\n\t\theight: 6px;\n\t\tbackground: #fed7aa;\n\t\tborder-radius: 3px;\n\t\toverflow: hidden;\n\t\tmargin: 12px 0;\n\t}\n\t.timer-fill {\n\t\theight: 100%;\n\t\tbackground: linear-gradient(90deg, #ea580c, #dc2626);\n\t\ttransition: width 1s linear;\n\t}\n\t.modal-actions {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tmargin-top: 24px;\n\t\tflex-direction: column;\n\t}\n\n\t@media (min-width: 640px) {\n\t\t.modal-actions {\n\t\t\tflex-direction: row;\n\t\t}\n\t}\n\n\t.btn-primary.safe {\n\t\tbackground: linear-gradient(135deg, #059669 0%, #047857 100%);\n\t}\n\t.btn-primary.safe:hover {\n\t\tbox-shadow: 0 8px 16px rgba(5, 150, 105, 0.3);\n\t}\n\n\t/* Small link-style button used for inline hints */\n\t.btn-link {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcolor: var(--accent-blue, #1fa8db);\n\t\tcursor: pointer;\n\t\tpadding: 0;\n\t\tfont-weight: 700;\n\t\ttext-decoration: underline;\n\t}\n\t.btn-link:focus {\n\t\toutline: 2px solid rgba(31, 168, 219, 0.25);\n\t\toutline-offset: 2px;\n\t}\n\n\t.btn-secondary.danger {\n\t\tborder-color: #dc2626;\n\t\tcolor: #dc2626;\n\t}\n\t.btn-secondary.danger:hover:not(:disabled) {\n\t\tbackground: #dc2626;\n\t\tcolor: white;\n\t}\n\t.btn-secondary.danger:disabled {\n\t\topacity: 0.5;\n\t\tcursor: not-allowed;\n\t}\n\n\t.flex {\n\t\tdisplay: flex;\n\t}\n\t.items-center {\n\t\talign-items: center;\n\t}\n\t.gap-2 {\n\t\tgap: 8px;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\mileage\\+page.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\mileage\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 57,
				"column": 25,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 57,
				"endColumn": 42
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Date class. Use SvelteDate instead.",
				"line": 156,
				"column": 20,
				"nodeType": "NewExpression",
				"messageId": "mutableDateUsed",
				"endLine": 156,
				"endColumn": 39
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Date class. Use SvelteDate instead.",
				"line": 161,
				"column": 18,
				"nodeType": "NewExpression",
				"messageId": "mutableDateUsed",
				"endLine": 161,
				"endColumn": 35
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 198,
				"column": 8,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 198,
				"endColumn": 32
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 203,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 203,
				"endColumn": 48
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 205,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 205,
				"endColumn": 48
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 457,
				"column": 26,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 457,
				"endColumn": 57
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 611,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 613,
				"endColumn": 12
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 673,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 683,
				"endColumn": 11
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 899,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 925,
				"endColumn": 11
			}
		],
		"suppressedMessages": [
			{
				"ruleId": "svelte/require-store-reactive-access",
				"severity": 2,
				"message": "Use the $ prefix or the get function to access reactive values instead of accessing the raw store.",
				"line": 26,
				"column": 33,
				"nodeType": "Identifier",
				"messageId": "usingRawStoreInText",
				"endLine": 26,
				"endColumn": 40,
				"fix": { "range": [1118, 1118], "text": "$" },
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 6,
		"fatalErrorCount": 0,
		"warningCount": 4,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { mileage, isLoading as mileageLoading } from '$lib/stores/mileage';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { getVehicleDisplayName } from '$lib/utils/vehicle';\n\timport SettingsModal from './components/SettingsModal.svelte';\n\timport { user } from '$lib/stores/auth';\n\timport { toasts } from '$lib/stores/toast';\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport Skeleton from '$lib/components/ui/Skeleton.svelte';\n\timport { goto, invalidateAll } from '$app/navigation';\n\timport { page } from '$app/stores';\n\timport { onDestroy } from 'svelte';\n\timport { browser } from '$app/environment'; // [!code fix] Import browser check\n\n\timport type { PageData } from './$types';\n\n\texport let data: PageData;\n\n\t// [!code fix] Only run hydration in the browser\n\t$: if (browser && data.mileage) {\n\t\tconst normalize = (records: any[]) =>\n\t\t\trecords.map((r) => ({ ...r, syncStatus: (r as any).syncStatus ?? 'synced' }));\n\t\tconst normalized = normalize(data.mileage);\n\n\t\t// eslint-disable-next-line svelte/require-store-reactive-access\n\t\tif ($user?.id && 'hydrate' in mileage) {\n\t\t\tmileage.hydrate(normalized, $user.id);\n\t\t} else {\n\t\t\tmileage.set(normalized);\n\t\t}\n\t}\n\n\tlet isMileageSettingsOpen = false;\n\n\t// Derived totals - use pre-computed values\n\t$: totalMiles = filteredExpenses.reduce((s, e) => s + (Number((e as any).miles) || 0), 0);\n\t// PERFORMANCE: Use pre-computed reimbursement\n\t$: totalMileageDeduction = filteredExpenses.reduce(\n\t\t(s, e) => s + ((e as any)._reimbursement || 0),\n\t\t0\n\t);\n\n\t// --- STATE ---\n\tlet searchQuery = '';\n\tlet sortBy = 'date';\n\tlet sortOrder = 'desc';\n\tlet filterCategory = 'all';\n\tlet allExpenses: any[] = [];\n\tlet filteredExpenses: any[] = [];\n\tconst _now = new Date();\n\tfunction _fmtInput(d: Date) {\n\t\treturn d.toISOString().slice(0, 10);\n\t}\n\tlet startDate = _fmtInput(new Date(_now.getFullYear(), _now.getMonth(), 1));\n\tlet endDate = _fmtInput(new Date(_now.getFullYear(), _now.getMonth() + 1, 0));\n\tlet lastHadSelections = false;\n\tlet selectedExpenses = new Set<string>();\n\n\t// Pagination\n\tlet currentPage = 1;\n\tconst itemsPerPage = 20;\n\tlet visibleExpenses: any[] = [];\n\n\t// Loading is only true when both store is loading AND we have no server data to show\n\t$: loading = $mileageLoading && (!data.mileage || data.mileage.length === 0);\n\n\t// REMOVED: automatic expansion to full list size was causing severe rendering hits\n\t// Instead, we just use a reasonable visible limit or implement a Load More button\n\n\t$: if (typeof document !== 'undefined') {\n\t\tconst hasSelections = selectedExpenses.size > 0;\n\t\tif (hasSelections !== lastHadSelections) {\n\t\t\tif (hasSelections) {\n\t\t\t\tdocument.body.classList.add('has-selections');\n\t\t\t} else {\n\t\t\t\tdocument.body.classList.remove('has-selections');\n\t\t\t}\n\t\t\tlastHadSelections = hasSelections;\n\t\t}\n\t}\n\n\tonDestroy(() => {\n\t\tif (typeof document !== 'undefined') {\n\t\t\tdocument.body.classList.remove('has-selections');\n\t\t}\n\t});\n\n\tconst categories: string[] = [];\n\tlet isManageCategoriesOpen = false;\n\tlet newCategoryName = '';\n\n\t// Use store data, but fallback to server data during initial hydration to prevent flicker\n\t$: {\n\t\tconst source = $mileage.length > 0 ? $mileage : data.mileage || [];\n\t\t// PERFORMANCE: Pre-calculate all values once to avoid repeated computations\n\t\tallExpenses = source\n\t\t\t.filter(\n\t\t\t\t(r: any) =>\n\t\t\t\t\ttypeof r.miles === 'number' ||\n\t\t\t\t\ttypeof r.startOdometer === 'number' ||\n\t\t\t\t\ttypeof r.endOdometer === 'number'\n\t\t\t)\n\t\t\t.map((r: any) => {\n\t\t\t\tconst dateVal = new Date(r.date || 0).getTime();\n\t\t\t\tconst amtVal = Number(r.amount || 0);\n\t\t\t\t// Pre-compute reimbursement if not stored\n\t\t\t\tconst reimbursement =\n\t\t\t\t\ttypeof r.reimbursement === 'number'\n\t\t\t\t\t\t? r.reimbursement\n\t\t\t\t\t\t: Number(r.miles || 0) *\n\t\t\t\t\t\t\t(Number(r.mileageRate) || Number($userSettings?.mileageRate) || 0);\n\n\t\t\t\treturn {\n\t\t\t\t\t...r,\n\t\t\t\t\t_dateVal: dateVal,\n\t\t\t\t\t_amtVal: amtVal,\n\t\t\t\t\t_reimbursement: reimbursement\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\t$: filteredExpenses = allExpenses\n\t\t.filter((item) => {\n\t\t\tconst query = searchQuery.toLowerCase();\n\t\t\tconst matchesSearch =\n\t\t\t\t!query ||\n\t\t\t\t((item as any).description && (item as any).description.toLowerCase().includes(query)) ||\n\t\t\t\tString((item as any).amount || '').includes(query) ||\n\t\t\t\tString((item as any).miles || '').includes(query) ||\n\t\t\t\t((item as any).vehicle &&\n\t\t\t\t\tString((item as any).vehicle)\n\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t.includes(query)) ||\n\t\t\t\t((item as any).source === 'trip' && 'trip'.includes(query));\n\n\t\t\tif (!matchesSearch) return false;\n\n\t\t\t// Category filtering (manual vs auto vs specific category)\n\t\t\tif (filterCategory !== 'all') {\n\t\t\t\tif (filterCategory === 'manual') {\n\t\t\t\t\t// Show only mileage logs NOT created from trips (no tripId)\n\t\t\t\t\tif ((item as any).tripId) return false;\n\t\t\t\t} else if (filterCategory === 'auto') {\n\t\t\t\t\t// Show only mileage logs created from trips (has tripId)\n\t\t\t\t\tif (!(item as any).tripId) return false;\n\t\t\t\t} else if (item.category !== filterCategory) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Date filtering\n\t\t\tif (startDate || endDate) {\n\t\t\t\tconst itemDateValue = (item as any)._dateVal;\n\n\t\t\t\tif (startDate) {\n\t\t\t\t\tconst start = new Date(startDate);\n\t\t\t\t\tstart.setHours(0, 0, 0, 0);\n\t\t\t\t\tif (itemDateValue < start.getTime()) return false;\n\t\t\t\t}\n\t\t\t\tif (endDate) {\n\t\t\t\t\tconst end = new Date(endDate);\n\t\t\t\t\tend.setHours(0, 0, 0, 0);\n\t\t\t\t\tif (itemDateValue > end.getTime()) return false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t})\n\t\t.sort((a, b) => {\n\t\t\tlet aVal: number = 0,\n\t\t\t\tbVal: number = 0;\n\t\t\tif (sortBy === 'date') {\n\t\t\t\taVal = (a as any)._dateVal;\n\t\t\t\tbVal = (b as any)._dateVal;\n\t\t\t} else if (sortBy === 'amount') {\n\t\t\t\t// Sort by reimbursement/cost value\n\t\t\t\taVal = (a as any)._reimbursement || 0;\n\t\t\t\tbVal = (b as any)._reimbursement || 0;\n\t\t\t}\n\t\t\treturn sortOrder === 'asc' ? aVal - bVal : bVal - aVal;\n\t\t});\n\n\t$: totalPages = Math.ceil(filteredExpenses.length / itemsPerPage);\n\t$: visibleExpenses = filteredExpenses.slice(\n\t\t(currentPage - 1) * itemsPerPage,\n\t\tcurrentPage * itemsPerPage\n\t);\n\n\t// Reset selection and pagination when filters change\n\t$: if (searchQuery || sortBy || sortOrder || filterCategory || startDate || endDate) {\n\t\tselectedExpenses = new Set();\n\t\tcurrentPage = 1;\n\t}\n\n\t$: allSelected = filteredExpenses.length > 0 && selectedExpenses.size === filteredExpenses.length;\n\n\tfunction goToAdd() {\n\t\tgoto('/dashboard/mileage/new');\n\t}\n\n\tfunction editExpense(expense: any) {\n\t\tif ((expense as any).source === 'trip') {\n\t\t\tgoto(`/dashboard/trips?id=${expense.tripId}`);\n\t\t} else {\n\t\t\tgoto(`/dashboard/mileage/edit/${expense.id}`);\n\t\t}\n\t}\n\n\tasync function deleteExpense(id: string, e?: MouseEvent) {\n\t\tif (e) e.stopPropagation();\n\t\tif (!confirm('Move this mileage log to trash? You can restore it later.')) return;\n\t\tif (id.startsWith('trip-')) {\n\t\t\ttoasts.error('Cannot delete Trips here. Delete the Trip instead.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUser = $page.data['user'] || $user;\n\t\t// [!code fix] Strictly use ID.\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id');\n\n\t\tif (userId) {\n\t\t\ttry {\n\t\t\t\tawait mileage.deleteMileage(id, String(userId));\n\t\t\t\ttoasts.success('Log moved to trash');\n\t\t\t\tif (selectedExpenses.has(id)) {\n\t\t\t\t\tselectedExpenses.delete(id);\n\t\t\t\t\tselectedExpenses = selectedExpenses;\n\t\t\t\t}\n\t\t\t\tawait invalidateAll();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\ttoasts.error('Failed to move to trash');\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction toggleSelection(id: string) {\n\t\tif (selectedExpenses.has(id)) selectedExpenses.delete(id);\n\t\telse selectedExpenses.add(id);\n\t\tselectedExpenses = selectedExpenses;\n\t}\n\n\tfunction toggleSelectAll() {\n\t\tif (allSelected) selectedExpenses = new Set();\n\t\telse selectedExpenses = new Set(filteredExpenses.map((e) => e.id));\n\t}\n\n\tfunction changePage(newPage: number) {\n\t\tif (newPage >= 1 && newPage <= totalPages) {\n\t\t\tcurrentPage = newPage;\n\t\t}\n\t}\n\n\tasync function deleteSelected() {\n\t\tconst ids = Array.from(selectedExpenses);\n\t\tconst manualExpenses = ids.filter((id) => !id.startsWith('trip-'));\n\t\tconst tripLogs = ids.length - manualExpenses.length;\n\t\tif (manualExpenses.length === 0 && tripLogs > 0) {\n\t\t\ttoasts.error(`Cannot delete ${tripLogs} Trip Logs. Edit them in Trips.`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!confirm(\n\t\t\t\t`Move ${manualExpenses.length} mileage logs to trash? ${tripLogs > 0 ? `(${tripLogs} trips will be skipped)` : ''}`\n\t\t\t)\n\t\t)\n\t\t\treturn;\n\t\tconst currentUser = $page.data['user'] || $user;\n\t\t// [!code fix] Strictly use ID.\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id');\n\n\t\tif (!userId) return;\n\n\t\tlet successCount = 0;\n\t\tfor (const id of manualExpenses) {\n\t\t\ttry {\n\t\t\t\tawait mileage.deleteMileage(id, String(userId));\n\t\t\t\tsuccessCount++;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(`Failed to delete ${id}`, err);\n\t\t\t}\n\t\t}\n\n\t\ttoasts.success(`Moved ${successCount} logs to trash.`);\n\t\tselectedExpenses = new Set();\n\t\tawait invalidateAll();\n\t}\n\n\tfunction isTripSource(item: any): boolean {\n\t\treturn (item as any)?.source === 'trip';\n\t}\n\n\tfunction exportSelected() {\n\t\tconst selectedData = filteredExpenses.filter((e) => selectedExpenses.has(e.id));\n\t\tif (selectedData.length === 0) return;\n\t\tconst headers = ['Date', 'Miles', 'Reimbursement', 'Notes', 'Source'];\n\t\tconst rows = selectedData.map((e) =>\n\t\t\t[\n\t\t\t\t(e as any).date || '',\n\t\t\t\t((e as any).miles ?? 0).toFixed(2),\n\t\t\t\t((e as any).reimbursement || '').toString(),\n\t\t\t\t`\"${(((e as any).notes || '') as string).replace(/\"/g, '\"\"')}\"`,\n\t\t\t\tisTripSource(e) ? 'Trip' : 'Manual'\n\t\t\t].join(',')\n\t\t);\n\n\t\tconst csvContent = [headers.join(','), ...rows].join('\\n');\n\t\tconst blob = new Blob([csvContent], { type: 'text/csv' });\n\t\tconst url = window.URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `expenses_export_${new Date().toISOString().split('T')[0]}.csv`;\n\t\ta.click();\n\n\t\ttoasts.success(`Exported ${selectedData.length} items.`);\n\t\tselectedExpenses = new Set();\n\t}\n\n\tasync function updateCategories(newCategories: string[]) {\n\t\tuserSettings.update((s) => ({ ...s, expenseCategories: newCategories }));\n\t\ttry {\n\t\t\tconst { saveSettings } = await import('../settings/lib/save-settings');\n\t\t\tconst result = await saveSettings({ expenseCategories: newCategories });\n\t\t\tif (!result.ok) throw new Error(result.error);\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to sync settings', e);\n\t\t\ttoasts.error('Saved locally, but sync failed');\n\t\t}\n\t}\n\n\tasync function addCategory() {\n\t\tif (!newCategoryName.trim()) return;\n\t\tconst val = newCategoryName.trim().toLowerCase();\n\t\tif (categories.includes(val)) {\n\t\t\ttoasts.error('Category already exists');\n\t\t\treturn;\n\t\t}\n\t\tconst updated = [...categories, val];\n\t\tawait updateCategories(updated);\n\t\tnewCategoryName = '';\n\t\ttoasts.success('Category added');\n\t}\n\n\tasync function removeCategory(cat: string) {\n\t\tif (!confirm(`Delete \"${cat}\" category? Existing expenses will keep this category.`)) return;\n\t\tconst updated = categories.filter((c) => c !== cat);\n\t\tawait updateCategories(updated);\n\t\ttoasts.success('Category removed');\n\t}\n\n\tfunction formatCurrency(amount: number) {\n\t\treturn new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);\n\t}\n\n\tfunction formatDate(dateStr: string) {\n\t\tif (!dateStr) return '';\n\t\treturn new Date(dateStr).toLocaleDateString('en-US', {\n\t\t\tmonth: 'short',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric',\n\t\t\ttimeZone: 'UTC'\n\t\t});\n\t}\n\n\tfunction getCategoryLabel(cat: string) {\n\t\tif (!cat) return '';\n\t\treturn cat.charAt(0).toUpperCase() + cat.slice(1);\n\t}\n\n\tfunction getCategoryColor(cat?: string) {\n\t\tif (!cat) return 'text-gray-600 bg-gray-50 border-gray-200';\n\n\t\tif (cat === 'fuel') return 'text-red-600 bg-red-50 border-red-200';\n\t\tconst colors = [\n\t\t\t'text-blue-600 bg-blue-50 border-blue-200',\n\t\t\t'text-purple-600 bg-purple-50 border-purple-200',\n\t\t\t'text-orange-600 bg-orange-50 border-orange-200',\n\t\t\t'text-green-600 bg-green-50 border-green-200',\n\t\t\t'text-pink-600 bg-pink-50 border-pink-200',\n\t\t\t'text-indigo-600 bg-indigo-50 border-indigo-200'\n\t\t];\n\t\tif (cat === 'supplies') return colors[2];\n\t\tconst sum = cat.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n\t\treturn colors[sum % colors.length];\n\t}\n\n\tfunction swipeable(\n\t\tnode: HTMLElement,\n\t\t{\n\t\t\tonEdit,\n\t\t\tonDelete,\n\t\t\tisReadOnly\n\t\t}: { onEdit: () => void; onDelete: (e: any) => void; isReadOnly: boolean }\n\t) {\n\t\tif (isReadOnly) return;\n\t\tlet startX = 0;\n\t\tlet x = 0;\n\t\tlet swiping = false;\n\n\t\tfunction handleTouchStart(e: TouchEvent) {\n\t\t\tconst touch = e.touches?.[0];\n\t\t\tif (!touch) return;\n\t\t\tstartX = touch.clientX;\n\t\t\tx = 0;\n\t\t\tnode.style.transition = 'none';\n\t\t}\n\n\t\tfunction handleTouchMove(e: TouchEvent) {\n\t\t\tconst touch = e.touches?.[0];\n\t\t\tif (!touch) return;\n\t\t\tconst dx = touch.clientX - startX;\n\t\t\tswiping = true;\n\t\t\tif (dx < -120) x = -120;\n\t\t\telse if (dx > 120) x = 120;\n\t\t\telse x = dx;\n\t\t\tnode.style.transform = `translateX(${x}px)`;\n\t\t\tif (Math.abs(x) > 10) e.preventDefault();\n\t\t}\n\n\t\tfunction handleTouchEnd() {\n\t\t\tif (!swiping) return;\n\t\t\tswiping = false;\n\t\t\tnode.style.transition = 'transform 0.2s ease-out';\n\t\t\tif (x < -80) onDelete({ stopPropagation: () => {} });\n\t\t\telse if (x > 80) onEdit();\n\t\t\tnode.style.transform = 'translateX(0)';\n\t\t}\n\n\t\tnode.addEventListener('touchstart', handleTouchStart, { passive: false });\n\t\tnode.addEventListener('touchmove', handleTouchMove, { passive: false });\n\t\tnode.addEventListener('touchend', handleTouchEnd);\n\t\treturn {\n\t\t\tdestroy() {\n\t\t\t\tnode.removeEventListener('touchstart', handleTouchStart);\n\t\t\t\tnode.removeEventListener('touchmove', handleTouchMove);\n\t\t\t\tnode.removeEventListener('touchend', handleTouchEnd);\n\t\t\t}\n\t\t};\n\t}\n</script>\n\n<svelte:head>\n\t<title>Mileage - Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"page-container\">\n\t<div class=\"page-header\">\n\t\t<div class=\"header-text\">\n\t\t\t<h1 class=\"page-title\">Mileage</h1>\n\t\t\t<p class=\"page-subtitle\">Log odometer readings and miles</p>\n\t\t</div>\n\n\t\t<div class=\"header-actions\">\n\t\t\t<button\n\t\t\t\tclass=\"btn-secondary\"\n\t\t\t\ton:click={() => goto('/dashboard/trash?type=mileage')}\n\t\t\t\taria-label=\"View Trash\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t>\n\t\t\t\t\t<polyline points=\"3 6 5 6 21 6\"></polyline>\n\t\t\t\t\t<path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"\n\t\t\t\t\t></path>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tclass=\"btn-secondary\"\n\t\t\t\ton:click={() => (isMileageSettingsOpen = true)}\n\t\t\t\taria-label=\"Mileage Settings\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"\n\t\t\t\t\t></path>\n\t\t\t\t\t<circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t\t<SettingsModal bind:open={isMileageSettingsOpen} />\n\n\t\t\t<button class=\"btn-primary\" on:click={goToAdd}>\n\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M10 4V16M4 10H16\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\tNew Mileage\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\n\t<div class=\"stats-summary\">\n\t\t<div class=\"summary-card\">\n\t\t\t<div class=\"summary-label\">Total</div>\n\t\t\t<div class=\"summary-value\">{filteredExpenses.length}</div>\n\t\t</div>\n\n\t\t<div class=\"summary-card\">\n\t\t\t<div class=\"summary-label\">Total Miles</div>\n\t\t\t<div class=\"summary-value\">{totalMiles.toFixed(2)}</div>\n\t\t</div>\n\n\t\t<div class=\"summary-card\">\n\t\t\t<div class=\"summary-label\">Mileage Deduction</div>\n\t\t\t<div class=\"summary-value\">{formatCurrency(totalMileageDeduction)}</div>\n\t\t</div>\n\n\t\t{#if categories[0]}\n\t\t\t<div class=\"summary-card hidden-mobile\">\n\t\t\t\t<div class=\"summary-label\">{getCategoryLabel(categories[0])}</div>\n\t\t\t\t<div class=\"summary-value\">\n\t\t\t\t\t{formatCurrency(\n\t\t\t\t\t\tfilteredExpenses\n\t\t\t\t\t\t\t.filter((e) => e.category === categories[0])\n\t\t\t\t\t\t\t.reduce((s, e) => s + e.amount, 0)\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t\t{#if categories[1]}\n\t\t\t<div class=\"summary-card hidden-mobile\">\n\t\t\t\t<div class=\"summary-label\">{getCategoryLabel(categories[1])}</div>\n\t\t\t\t<div class=\"summary-value\">\n\t\t\t\t\t{formatCurrency(\n\t\t\t\t\t\tfilteredExpenses\n\t\t\t\t\t\t\t.filter((e) => e.category === categories[1])\n\t\t\t\t\t\t\t.reduce((s, e) => s + e.amount, 0)\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n\n\t<div class=\"filters-bar\">\n\t\t<div class=\"search-box\">\n\t\t\t<svg class=\"search-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t<path\n\t\t\t\t\td=\"M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td=\"M19 19L14.65 14.65\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t\t<input\n\t\t\t\tid=\"search-expenses\"\n\t\t\t\tname=\"searchQuery\"\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder=\"Search mileage...\"\n\t\t\t\tbind:value={searchQuery}\n\t\t\t/>\n\t\t</div>\n\n\t\t<div class=\"filter-group date-group\">\n\t\t\t<input\n\t\t\t\tid=\"start-date\"\n\t\t\t\tname=\"startDate\"\n\t\t\t\ttype=\"date\"\n\t\t\t\tbind:value={startDate}\n\t\t\t\tclass=\"date-input\"\n\t\t\t\taria-label=\"Start Date\"\n\t\t\t/>\n\t\t\t<span class=\"date-sep\">-</span>\n\t\t\t<input\n\t\t\t\tid=\"end-date\"\n\t\t\t\tname=\"endDate\"\n\t\t\t\ttype=\"date\"\n\t\t\t\tbind:value={endDate}\n\t\t\t\tclass=\"date-input\"\n\t\t\t\taria-label=\"End Date\"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div class=\"filter-group\">\n\t\t\t<select\n\t\t\t\tid=\"filter-category\"\n\t\t\t\tname=\"filterCategory\"\n\t\t\t\tbind:value={filterCategory}\n\t\t\t\tclass=\"filter-select\"\n\t\t\t\taria-label=\"Filter by category\"\n\t\t\t>\n\t\t\t\t<option value=\"all\">All Categories</option>\n\t\t\t\t{#each categories as cat}\n\t\t\t\t\t<option value={cat}>{getCategoryLabel(cat)}</option>\n\t\t\t\t{/each}\n\t\t\t\t<option value=\"manual\">Manual Trips</option>\n\t\t\t\t<option value=\"auto\">Auto Trips</option>\n\t\t\t</select>\n\n\t\t\t<select\n\t\t\t\tid=\"sort-by\"\n\t\t\t\tname=\"sortBy\"\n\t\t\t\tbind:value={sortBy}\n\t\t\t\tclass=\"filter-select\"\n\t\t\t\taria-label=\"Sort results\"\n\t\t\t>\n\t\t\t\t<option value=\"date\">By Date</option>\n\t\t\t\t<option value=\"amount\">By Cost</option>\n\t\t\t</select>\n\n\t\t\t<button\n\t\t\t\tclass=\"sort-btn\"\n\t\t\t\taria-label=\"Toggle sort order\"\n\t\t\t\ton:click={() => (sortOrder = sortOrder === 'asc' ? 'desc' : 'asc')}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"20\"\n\t\t\t\t\theight=\"20\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstyle=\"transform: rotate({sortOrder === 'asc' ? '180deg' : '0deg'})\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M10 3V17M10 17L4 11M10 17L16 11\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\n\t{#if filteredExpenses.length > 0}\n\t\t<div class=\"batch-header\" class:visible={filteredExpenses.length > 0}>\n\t\t\t<label class=\"checkbox-container\">\n\t\t\t\t<input\n\t\t\t\t\tid=\"select-all\"\n\t\t\t\t\tname=\"selectAll\"\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tchecked={allSelected}\n\t\t\t\t\ton:change={toggleSelectAll}\n\t\t\t\t/>\n\t\t\t\t<span class=\"checkmark\"></span>\n\t\t\t\tSelect All ({filteredExpenses.length})\n\t\t\t</label>\n\n\t\t\t<span class=\"page-info\">Showing {visibleExpenses.length} of {filteredExpenses.length}</span>\n\t\t</div>\n\t{/if}\n\n\t{#if loading}\n\t\t<div class=\"expense-list-cards\">\n\t\t\t{#each Array(3) as _}\n\t\t\t\t<div class=\"expense-card\">\n\t\t\t\t\t<div class=\"card-top\">\n\t\t\t\t\t\t<div style=\"flex: 1\">\n\t\t\t\t\t\t\t<Skeleton height=\"16px\" width=\"30%\" className=\"mb-2\" />\n\t\t\t\t\t\t\t<Skeleton height=\"20px\" width=\"60%\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Skeleton height=\"24px\" width=\"60px\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\t{:else if filteredExpenses.length > 0}\n\t\t<div class=\"expense-list-cards\">\n\t\t\t{#each visibleExpenses as expense (expense.id)}\n\t\t\t\t{@const isSelected = selectedExpenses.has(expense.id)}\n\t\t\t\t<div class=\"card-wrapper\">\n\t\t\t\t\t{#if !isTripSource(expense)}\n\t\t\t\t\t\t<div class=\"swipe-bg\">\n\t\t\t\t\t\t\t<div class=\"swipe-action edit\"><span>Edit</span></div>\n\t\t\t\t\t\t\t<div class=\"swipe-action delete\"><span>Trash</span></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"expense-card\"\n\t\t\t\t\t\tclass:read-only={isTripSource(expense)}\n\t\t\t\t\t\tclass:selected={isSelected}\n\t\t\t\t\t\ton:click={() => editExpense(expense)}\n\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\ton:keypress={(e) => e.key === 'Enter' && editExpense(expense)}\n\t\t\t\t\t\tuse:swipeable={{\n\t\t\t\t\t\t\tonEdit: () => editExpense(expense),\n\t\t\t\t\t\t\tonDelete: (e) => deleteExpense(expense.id, e),\n\t\t\t\t\t\t\tisReadOnly: isTripSource(expense)\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"card-top\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"selection-box\"\n\t\t\t\t\t\t\t\ton:click|stopPropagation\n\t\t\t\t\t\t\t\ton:keydown|stopPropagation\n\t\t\t\t\t\t\t\trole=\"none\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<label class=\"checkbox-container\">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\t\tid={'expense-' + expense.id + '-checkbox'}\n\t\t\t\t\t\t\t\t\t\tname=\"selectedExpense\"\n\t\t\t\t\t\t\t\t\t\tvalue={expense.id}\n\t\t\t\t\t\t\t\t\t\taria-labelledby={'expense-' + expense.id + '-title'}\n\t\t\t\t\t\t\t\t\t\tchecked={isSelected}\n\t\t\t\t\t\t\t\t\t\ton:change={() => toggleSelection(expense.id)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<span class=\"checkmark\"></span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"expense-main-info\">\n\t\t\t\t\t\t\t\t<span class=\"expense-date-display\">\n\t\t\t\t\t\t\t\t\t{formatDate(expense.date || '')}\n\t\t\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t\t\t<h2 class=\"expense-desc-title\" id={'expense-' + expense.id + '-title'}>\n\t\t\t\t\t\t\t\t\t{expense.notes ||\n\t\t\t\t\t\t\t\t\t\texpense.description ||\n\t\t\t\t\t\t\t\t\t\t`${expense.startOdometer} → ${expense.endOdometer}`}\n\t\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{#if typeof expense.reimbursement === 'number' && expense.reimbursement > 0}\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass=\"expense-amount-display\"\n\t\t\t\t\t\t\t\t\taria-label={`Reimbursement: ${formatCurrency(expense.reimbursement)}`}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{formatCurrency(expense.reimbursement)}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t<svg class=\"nav-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M9 18L15 12L9 6\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"card-stats\">\n\t\t\t\t\t\t\t<div class=\"stat-item\">\n\t\t\t\t\t\t\t\t<span class=\"stat-label\">Miles</span>\n\t\t\t\t\t\t\t\t<span class=\"stat-value\">{(expense.miles ?? 0).toFixed(2)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"stat-item\">\n\t\t\t\t\t\t\t\t<span class=\"stat-label\">Vehicle</span>\n\t\t\t\t\t\t\t\t<span class=\"stat-value\"\n\t\t\t\t\t\t\t\t\t>{getVehicleDisplayName(expense.vehicle, $userSettings?.vehicles)}</span\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"stat-item\">\n\t\t\t\t\t\t\t\t<span class=\"stat-label\">Rate</span>\n\t\t\t\t\t\t\t\t<span class=\"stat-value\"\n\t\t\t\t\t\t\t\t\t>{expense.mileageRate != null\n\t\t\t\t\t\t\t\t\t\t? `$${Number(expense.mileageRate).toFixed(3)}/mi`\n\t\t\t\t\t\t\t\t\t\t: '-'}</span\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"stat-item\">\n\t\t\t\t\t\t\t\t<span class=\"stat-label\">Odometer</span>\n\t\t\t\t\t\t\t\t<span class=\"stat-value\"\n\t\t\t\t\t\t\t\t\t>{expense.startOdometer ?? '-'} → {expense.endOdometer ?? '-'}</span\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\n\t\t{#if totalPages > 1}\n\t\t\t<div class=\"pagination-container\">\n\t\t\t\t<div class=\"pagination\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"pagination-btn\"\n\t\t\t\t\t\tdisabled={currentPage === 1}\n\t\t\t\t\t\ton:click={() => changePage(currentPage - 1)}>← Prev</button\n\t\t\t\t\t>\n\t\t\t\t\t<span class=\"page-status\">Page {currentPage} of {totalPages}</span>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"pagination-btn\"\n\t\t\t\t\t\tdisabled={currentPage === totalPages}\n\t\t\t\t\t\ton:click={() => changePage(currentPage + 1)}>Next →</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t{:else}\n\t\t<div class=\"empty-state\">\n\t\t\t<p>No mileage logs found matching your filters.</p>\n\t\t</div>\n\t{/if}\n</div>\n\n{#if selectedExpenses.size > 0}\n\t<div class=\"action-bar-container\" data-has-selections=\"true\">\n\t\t<div class=\"action-bar\">\n\t\t\t<div class=\"action-bar-left\">\n\t\t\t\t<div class=\"selection-indicator\">\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<polyline points=\"20 6 9 17 4 12\"></polyline>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"selected-count\"\n\t\t\t\t\t\t>{selectedExpenses.size}\n\t\t\t\t\t\t{selectedExpenses.size === 1 ? 'expense' : 'expenses'} selected</span\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"action-bar-right\">\n\t\t\t\t<button class=\"action-pill secondary\" on:click={() => (selectedExpenses = new Set())}>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n\t\t\t\t\t\t<line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"action-text\">Cancel</span>\n\t\t\t\t</button>\n\n\t\t\t\t<button class=\"action-pill export\" on:click={exportSelected}>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n\t\t\t\t\t\t<polyline points=\"7 10 12 15 17 10\"></polyline>\n\t\t\t\t\t\t<line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"action-text\">Export</span>\n\t\t\t\t</button>\n\n\t\t\t\t<button class=\"action-pill danger\" on:click={deleteSelected}>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<polyline points=\"3 6 5 6 21 6\"></polyline>\n\t\t\t\t\t\t<path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"\n\t\t\t\t\t\t></path>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"action-text\">Delete</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n<Modal bind:open={isManageCategoriesOpen} title=\"Manage Categories\">\n\t<div class=\"categories-manager\">\n\t\t<p class=\"text-sm text-gray-500 mb-4\">\n\t\t\tAdd or remove expense categories. These are saved to your settings.\n\t\t</p>\n\n\t\t<div class=\"cat-list\">\n\t\t\t{#each categories as cat}\n\t\t\t\t<div class=\"cat-item\">\n\t\t\t\t\t<span class={`cat-badge ${getCategoryColor(cat)}`}>{getCategoryLabel(cat)}</span>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"cat-delete\"\n\t\t\t\t\t\ton:click={() => removeCategory(cat)}\n\t\t\t\t\t\taria-label=\"Delete Category\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"\n\t\t\t\t\t\t\t></line></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"text-sm text-gray-400 italic text-center py-4\">\n\t\t\t\t\tNo categories. Add one below.\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\n\t\t<div class=\"add-cat-form\">\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tid=\"new-category-name\"\n\t\t\t\tname=\"newCategoryName\"\n\t\t\t\tclass=\"input-field\"\n\t\t\t\ton:keydown={(e) => e.key === 'Enter' && addCategory()}\n\t\t\t/>\n\t\t\t<button class=\"btn-secondary\" on:click={addCategory}>Add</button>\n\t\t</div>\n\n\t\t<div class=\"modal-actions mt-6\">\n\t\t\t<button class=\"btn-cancel w-full\" on:click={() => (isManageCategoriesOpen = false)}\n\t\t\t\t>Done</button\n\t\t\t>\n\t\t</div>\n\t</div>\n</Modal>\n\n<style>\n\t* {\n\t\tbox-sizing: border-box;\n\t}\n\n\t:global(body) {\n\t\toverflow-x: hidden;\n\t}\n\n\t.page-container {\n\t\tmax-width: 1400px;\n\t\tmargin: 0 auto;\n\t\tpadding: 16px;\n\t\tpadding-bottom: 80px;\n\t\toverflow-x: hidden;\n\t}\n\n\t/* Page Headers & Actions */\n\t.page-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 24px;\n\t}\n\t.page-title {\n\t\tfont-size: 24px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tmargin: 0;\n\t}\n\t.header-actions {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n\t}\n\n\t.btn-primary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tpadding: 10px 16px;\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcursor: pointer;\n\t\tbox-shadow: 0 2px 8px rgba(255, 127, 80, 0.3);\n\t\ttransition: transform 0.1s;\n\t\ttext-decoration: none;\n\t}\n\t.btn-primary:active {\n\t\ttransform: translateY(1px);\n\t}\n\n\t.btn-secondary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 10px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcursor: pointer;\n\t\ttransition: background 0.2s;\n\t}\n\n\t@media (hover: hover) {\n\t\t.btn-secondary:hover {\n\t\t\tbackground: #f9fafb;\n\t\t}\n\t\t.cat-delete:hover {\n\t\t\tbackground: #ef4444;\n\t\t\tcolor: white;\n\t\t}\n\t}\n\n\t/* Stats Summary */\n\t.stats-summary {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(2, 1fr);\n\t\tgap: 12px;\n\t\tmargin-bottom: 24px;\n\t}\n\t.summary-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tpadding: 16px;\n\t\ttext-align: center;\n\t}\n\t.summary-label {\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 0.5px;\n\t\tmargin-bottom: 4px;\n\t}\n\t.summary-value {\n\t\tfont-size: 20px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t}\n\n\t/* Filter Bar */\n\t.filters-bar {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t\tmargin-bottom: 20px;\n\t}\n\n\t.search-box {\n\t\tposition: relative;\n\t\twidth: 100%;\n\t}\n\t.search-icon {\n\t\tposition: absolute;\n\t\tleft: 14px;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\tcolor: #9ca3af;\n\t\tpointer-events: none;\n\t}\n\t.search-box input {\n\t\twidth: 100%;\n\t\tpadding: 12px 16px 12px 42px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 15px;\n\t\tbackground: white;\n\t\tbox-sizing: border-box;\n\t}\n\t.date-group {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n\t}\n\t.date-input {\n\t\tflex: 1;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 14px;\n\t\tbackground: white;\n\t\tmin-width: 0;\n\t}\n\t.date-sep {\n\t\tcolor: #9ca3af;\n\t\tfont-weight: bold;\n\t}\n\t.filter-group {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tgap: 8px;\n\t\twidth: 100%;\n\t}\n\t.filter-select {\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 14px;\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t}\n\t.sort-btn {\n\t\tflex: 0 0 48px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tbackground: white;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t}\n\n\t/* Batch Header */\n\t.batch-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 12px;\n\t\tpadding: 0 4px;\n\t\tcolor: #6b7280;\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t}\n\t.page-info {\n\t\tfont-size: 13px;\n\t}\n\n\t/* CHECKBOX STYLES */\n\t.checkbox-container {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tcursor: pointer;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #4b5563;\n\t\tposition: relative;\n\t\tpadding-left: 28px;\n\t\tuser-select: none;\n\t}\n\t.checkbox-container input {\n\t\tposition: absolute;\n\t\topacity: 0;\n\t\tcursor: pointer;\n\t\theight: 0;\n\t\twidth: 0;\n\t}\n\t.checkmark {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\theight: 20px;\n\t\twidth: 20px;\n\t\tbackground-color: white;\n\t\tborder: 2px solid #d1d5db;\n\t\tborder-radius: 6px;\n\t\ttransition: all 0.2s;\n\t}\n\n\t@media (hover: hover) {\n\t\t.checkbox-container:hover input ~ .checkmark {\n\t\t\tborder-color: #9ca3af;\n\t\t}\n\t}\n\n\t.checkbox-container input:checked ~ .checkmark {\n\t\tbackground-color: #ff7f50;\n\t\tborder-color: #ff7f50;\n\t}\n\t.checkmark:after {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tdisplay: none;\n\t}\n\t.checkbox-container input:checked ~ .checkmark:after {\n\t\tdisplay: block;\n\t}\n\t.checkbox-container .checkmark:after {\n\t\tleft: 6px;\n\t\ttop: 2px;\n\t\twidth: 5px;\n\t\theight: 10px;\n\t\tborder: solid white;\n\t\tborder-width: 0 2px 2px 0;\n\t\ttransform: rotate(45deg);\n\t}\n\n\t/* Expense List & Cards (Styled like Trips) */\n\t.expense-list-cards {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t\tmax-width: 100%;\n\t}\n\t.card-wrapper {\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t\tborder-radius: 12px;\n\t\tbackground: #f3f4f6;\n\t\tmax-width: 100%;\n\t}\n\n\t.swipe-bg {\n\t\tposition: absolute;\n\t\tinset: 0;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 0 20px;\n\t\tz-index: 0;\n\t}\n\t.swipe-action {\n\t\tfont-weight: 700;\n\t\tfont-size: 14px;\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 1px;\n\t}\n\t.swipe-action.edit {\n\t\tcolor: #2563eb;\n\t}\n\t.swipe-action.delete {\n\t\tcolor: #dc2626;\n\t}\n\n\t.expense-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tpadding: 16px;\n\t\tposition: relative;\n\t\tz-index: 1;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tmax-width: 100%;\n\t}\n\t.expense-card:active {\n\t\tbackground-color: #f9fafb;\n\t}\n\t.expense-card.read-only {\n\t\tborder-left: 4px solid #3b82f6;\n\t\tbackground: #fafafa;\n\t}\n\t.expense-card.selected {\n\t\tbackground-color: #fff7ed;\n\t\tborder-color: #ff7f50;\n\t}\n\n\t.card-top {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: auto 1fr auto auto;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding-bottom: 12px;\n\t\tmargin-bottom: 12px;\n\t\tborder-bottom: 1px solid #f3f4f6;\n\t\tmax-width: 100%;\n\t}\n\n\t.selection-box {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding-right: 4px;\n\t}\n\n\t.expense-main-info {\n\t\toverflow: hidden;\n\t\tmin-width: 0;\n\t}\n\t.expense-date-display {\n\t\tdisplay: block;\n\t\tfont-size: 12px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\tmargin-bottom: 4px;\n\t}\n\t.expense-desc-title {\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t.expense-amount-display {\n\t\tfont-size: 18px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\twhite-space: nowrap;\n\t\ttext-align: right;\n\t\tmin-width: 72px;\n\t}\n\n\t.nav-icon {\n\t\tcolor: #9ca3af;\n\t\tflex-shrink: 0;\n\t}\n\n\t.card-stats {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(2, 1fr);\n\t\tgap: 12px;\n\t}\n\t.stat-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t}\n\t.stat-label {\n\t\tfont-size: 11px;\n\t\tcolor: #9ca3af;\n\t\ttext-transform: uppercase;\n\t}\n\t.stat-value {\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #4b5563;\n\t}\n\n\t.stat-badge-container {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\tflex-wrap: wrap;\n\t}\n\n\t.category-badge {\n\t\tfont-size: 12px;\n\t\tfont-weight: 600;\n\t\tpadding: 4px 10px;\n\t\tborder-radius: 100px;\n\t\ttext-transform: capitalize;\n\t\tborder: 1px solid;\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\twhite-space: nowrap;\n\t}\n\n\t.source-badge {\n\t\tfont-size: 11px;\n\t\tfont-weight: 700;\n\t\tcolor: #3b82f6;\n\t\tbackground: #eff6ff;\n\t\tpadding: 4px 8px;\n\t\tborder-radius: 6px;\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 0.5px;\n\t\twhite-space: nowrap;\n\t}\n\n\t/* Tax pill that visually matches category badges */\n\t.tax-pill {\n\t\tfont-size: 12px;\n\t\tfont-weight: 600;\n\t\tcolor: #166534;\n\t\tbackground: #ecfdf5;\n\t\tpadding: 4px 10px;\n\t\tborder-radius: 100px;\n\t\tborder: 1px solid #bbf7d0;\n\t\ttext-transform: capitalize;\n\t\twhite-space: nowrap;\n\t}\n\n\t.empty-state {\n\t\ttext-align: center;\n\t\tpadding: 40px;\n\t\tcolor: #6b7280;\n\t\tfont-size: 15px;\n\t}\n\n\t/* Hide footer when selections are active - using body class */\n\t:global(body.has-selections .mobile-footer),\n\t:global(body.has-selections footer),\n\t:global(body.has-selections nav[class*='mobile']),\n\t:global(body.has-selections .bottom-nav) {\n\t\tdisplay: none !important;\n\t}\n\n\t/* ACTION BAR STYLES - REPLACES FOOTER ON MOBILE */\n\t.action-bar-container {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tz-index: 1000;\n\t\tpadding: 0;\n\t\tanimation: slideUpFade 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n\t\tpointer-events: none;\n\t}\n\n\t.action-bar {\n\t\tbackground: white;\n\t\tpadding: 12px 16px;\n\t\tborder-radius: 0;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t\tbox-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);\n\t\tmax-width: 100%;\n\t\twidth: 100%;\n\t\tpointer-events: auto;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\n\t.action-bar-left {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\n\t.selection-indicator {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tcolor: #ff7f50;\n\t\tfont-weight: 700;\n\t\tfont-size: 13px;\n\t\tpadding: 6px 12px;\n\t\tbackground: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);\n\t\tborder-radius: 10px;\n\t\tborder: 1px solid #fed7aa;\n\t}\n\n\t.selection-indicator svg {\n\t\tflex-shrink: 0;\n\t\twidth: 16px;\n\t\theight: 16px;\n\t}\n\n\t.selected-count {\n\t\tcolor: #c2410c;\n\t\twhite-space: nowrap;\n\t}\n\n\t.action-bar-right {\n\t\tdisplay: flex;\n\t\tgap: 6px;\n\t\tjustify-content: center;\n\t}\n\n\t.action-pill {\n\t\tborder: 2px solid transparent;\n\t\tpadding: 10px 12px;\n\t\tborder-radius: 10px;\n\t\tfont-size: 13px;\n\t\tfont-weight: 700;\n\t\tcursor: pointer;\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 6px;\n\t\ttransition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n\t\tfont-family: inherit;\n\t\twhite-space: nowrap;\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n\t}\n\n\t.action-pill svg {\n\t\tflex-shrink: 0;\n\t\twidth: 16px;\n\t\theight: 16px;\n\t}\n\n\t/* Hide text on very small screens */\n\t.action-text {\n\t\tdisplay: none;\n\t}\n\n\t.action-pill.secondary {\n\t\tbackground: white;\n\t\tcolor: #6b7280;\n\t\tborder-color: #e5e7eb;\n\t}\n\n\t.action-pill.export {\n\t\tbackground: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);\n\t\tcolor: #c2410c;\n\t\tborder-color: #fed7aa;\n\t}\n\n\t.action-pill.danger {\n\t\tbackground: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);\n\t\tcolor: #dc2626;\n\t\tborder-color: #fca5a5;\n\t}\n\n\t.action-pill:active {\n\t\ttransform: scale(0.95);\n\t}\n\n\t@media (hover: hover) {\n\t\t.action-pill.secondary:hover {\n\t\t\tbackground: #f9fafb;\n\t\t\tborder-color: #d1d5db;\n\t\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\t\t}\n\n\t\t.action-pill.export:hover {\n\t\t\tbackground: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);\n\t\t\tborder-color: #fdba74;\n\t\t\tbox-shadow: 0 2px 4px rgba(251, 146, 60, 0.15);\n\t\t}\n\n\t\t.action-pill.danger:hover {\n\t\t\tbackground: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);\n\t\t\tborder-color: #f87171;\n\t\t\tbox-shadow: 0 2px 4px rgba(220, 38, 38, 0.15);\n\t\t}\n\t}\n\n\t@keyframes slideUpFade {\n\t\tfrom {\n\t\t\ttransform: translateY(100%);\n\t\t\topacity: 0;\n\t\t}\n\t\tto {\n\t\t\ttransform: translateY(0);\n\t\t\topacity: 1;\n\t\t}\n\t}\n\n\t/* Show text on slightly larger mobile screens */\n\t@media (min-width: 380px) {\n\t\t.action-text {\n\t\t\tdisplay: inline;\n\t\t}\n\n\t\t.action-pill {\n\t\t\tpadding: 10px 14px;\n\t\t}\n\t}\n\n\t@media (min-width: 640px) {\n\t\t.action-bar-container {\n\t\t\tbottom: 30px;\n\t\t\tpadding: 0 16px;\n\t\t}\n\n\t\t.action-bar {\n\t\t\tflex-direction: row;\n\t\t\talign-items: center;\n\t\t\tjustify-content: space-between;\n\t\t\tpadding: 14px 20px;\n\t\t\tmax-width: 700px;\n\t\t\twidth: auto; /* CHANGED: from inheriting 100% to auto */\n\t\t\tgap: 16px;\n\t\t\tborder-radius: 16px;\n\t\t\tborder: 1px solid #e5e7eb;\n\t\t\tbox-shadow:\n\t\t\t\t0 0 0 1px rgba(0, 0, 0, 0.05),\n\t\t\t\t0 10px 25px -5px rgba(0, 0, 0, 0.1),\n\t\t\t\t0 8px 10px -6px rgba(0, 0, 0, 0.1);\n\t\t}\n\n\t\t.action-bar-left {\n\t\t\tjustify-content: flex-start;\n\t\t}\n\n\t\t.selection-indicator {\n\t\t\tfont-size: 14px;\n\t\t\tpadding: 8px 14px;\n\t\t}\n\n\t\t.action-bar-right {\n\t\t\tgap: 8px;\n\t\t}\n\n\t\t.action-pill {\n\t\t\tflex: 0 0 auto;\n\t\t\tmin-width: auto;\n\t\t\tpadding: 10px 18px;\n\t\t\tfont-size: 14px;\n\t\t}\n\n\t\t.action-text {\n\t\t\tdisplay: inline;\n\t\t}\n\t}\n\n\t/* Desktop */\n\t@media (min-width: 1024px) {\n\t\t.action-bar {\n\t\t\tmax-width: 800px;\n\t\t\tpadding: 16px 24px;\n\t\t}\n\n\t\t.selection-indicator {\n\t\t\tfont-size: 15px;\n\t\t\tpadding: 8px 16px;\n\t\t}\n\n\t\t.action-pill {\n\t\t\tpadding: 12px 24px;\n\t\t\tfont-size: 15px;\n\t\t}\n\t}\n\n\t/* Categories Manager Modal Styles */\n\t.categories-manager {\n\t\tpadding: 4px;\n\t}\n\t.cat-list {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgap: 8px;\n\t\tmargin-bottom: 20px;\n\t\tmax-height: 200px;\n\t\toverflow-y: auto;\n\t}\n\t.cat-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 4px;\n\t\tbackground: #f3f4f6;\n\t\tpadding: 4px 4px 4px 10px;\n\t\tborder-radius: 20px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.cat-badge {\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t\ttext-transform: capitalize;\n\t\tpadding: 0 4px;\n\t\tborder: none;\n\t\tbackground: transparent;\n\t}\n\t.cat-delete {\n\t\tborder: none;\n\t\tbackground: #e5e7eb;\n\t\tcolor: #6b7280;\n\t\tborder-radius: 50%;\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.add-cat-form {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t}\n\t.add-cat-form .input-field {\n\t\tflex: 1;\n\t\tpadding: 10px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t}\n\t.add-cat-form .btn-secondary {\n\t\tpadding: 10px 16px;\n\t}\n\t.modal-actions .btn-cancel {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\twidth: 100%;\n\t}\n\n\t@media (min-width: 640px) {\n\t\t.filters-bar {\n\t\t\tflex-direction: row;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\t\t}\n\t\t.search-box {\n\t\t\tmax-width: 300px;\n\t\t}\n\t\t.date-group {\n\t\t\twidth: auto;\n\t\t}\n\t\t.filter-group {\n\t\t\twidth: auto;\n\t\t\tflex-wrap: nowrap;\n\t\t}\n\t\t.filter-select {\n\t\t\twidth: 140px;\n\t\t\tflex: none;\n\t\t}\n\t\t.stats-summary {\n\t\t\tgrid-template-columns: repeat(4, 1fr);\n\t\t}\n\t\t.hidden-mobile {\n\t\t\tdisplay: block;\n\t\t}\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.page-container {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\n\t\t.expense-list-cards,\n\t\t.mileage-list-cards {\n\t\t\tgap: 8px;\n\t\t}\n\n\t\t.pagination-controls,\n\t\t.pagination-container {\n\t\t\tmargin-top: 16px;\n\t\t}\n\n\t\t.empty-state {\n\t\t\tpadding: 24px 12px;\n\t\t}\n\n\t\t.hidden-mobile {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n\n\t/* Pagination Controls */\n\t.pagination-container {\n\t\tmargin-top: 32px;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t}\n\n\t.pagination {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tgap: 16px;\n\t}\n\n\t.pagination-btn {\n\t\tpadding: 8px 16px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tfont-family: inherit;\n\t}\n\n\t.pagination-btn:hover:not(:disabled) {\n\t\tborder-color: var(--orange);\n\t\tcolor: var(--orange);\n\t}\n\n\t.pagination-btn:disabled {\n\t\topacity: 0.5;\n\t\tcursor: not-allowed;\n\t}\n\n\t.page-status {\n\t\tfont-size: 14px;\n\t\tcolor: #4b5563;\n\t\tfont-weight: 500;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\mileage\\components\\SettingsModal.svelte",
		"messages": [
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 122,
				"column": 6,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 127,
				"endColumn": 13
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { toasts } from '$lib/stores/toast';\n\timport { createEventDispatcher } from 'svelte';\n\timport { saveSettings } from '../../settings/lib/save-settings';\n\n\texport let open = false;\n\tconst dispatch = createEventDispatcher();\n\n\tlet settings: any = { ...$userSettings };\n\tlet settingsTab: 'defaults' | 'vehicles' = 'defaults';\n\tlet newVehicleName = '';\n\n\t$: if (open) {\n\t\tsettings = { ...$userSettings };\n\t}\n\n\tasync function saveDefaultSettings() {\n\t\ttry {\n\t\t\tconst rate = Number(settings.mileageRate || 0);\n\t\t\tsettings.mileageRate = Number(isNaN(rate) ? 0 : Number(rate.toFixed(3)));\n\t\t\tuserSettings.set(settings);\n\t\t\tconst result = await saveSettings({ mileageRate: settings.mileageRate });\n\t\t\tif (!result.ok) throw new Error(result.error);\n\t\t\ttoasts.success('Mileage defaults saved');\n\t\t\tdispatch('success');\n\t\t\topen = false;\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to save mileage defaults', e);\n\t\t\ttoasts.error('Saved locally, but cloud sync failed');\n\t\t}\n\t}\n\n\tasync function updateVehicles(newVehicles: any[]) {\n\t\tuserSettings.update((s) => ({ ...s, vehicles: newVehicles }));\n\t\ttry {\n\t\t\tconst result = await saveSettings({ vehicles: newVehicles });\n\t\t\tif (!result.ok) throw new Error(result.error);\n\t\t\ttoasts.success('Vehicles saved');\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to sync vehicles', e);\n\t\t\ttoasts.error('Saved locally, but cloud sync failed');\n\t\t}\n\t}\n\n\tfunction addVehicle() {\n\t\tif (!newVehicleName.trim()) return;\n\t\tconst v = { id: crypto.randomUUID(), name: newVehicleName.trim() };\n\t\tconst list = settings.vehicles ? [...settings.vehicles, v] : [v];\n\t\tsettings.vehicles = list;\n\t\tupdateVehicles(list);\n\t\tnewVehicleName = '';\n\t}\n\n\tfunction removeVehicle(id: string) {\n\t\tif (!confirm('Remove this vehicle?')) return;\n\t\tconst list = (settings.vehicles || []).filter((v: any) => v.id !== id);\n\t\tsettings.vehicles = list;\n\t\tupdateVehicles(list);\n\t}\n</script>\n\n<Modal bind:open title=\"Mileage Settings\">\n\t<div class=\"settings-modal-content\">\n\t\t<div class=\"top-tabs\">\n\t\t\t<button\n\t\t\t\tclass=\"top-tab-btn\"\n\t\t\t\tclass:active={settingsTab === 'defaults'}\n\t\t\t\ton:click={() => (settingsTab = 'defaults')}>Defaults</button\n\t\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"top-tab-btn\"\n\t\t\t\tclass:active={settingsTab === 'vehicles'}\n\t\t\t\ton:click={() => (settingsTab = 'vehicles')}>Vehicles</button\n\t\t\t>\n\t\t</div>\n\n\t\t{#if settingsTab === 'defaults'}\n\t\t\t<div class=\"settings-form space-y-4\">\n\t\t\t\t<p class=\"text-sm text-gray-500 mb-2\">Pre-fill new mileage logs with these values.</p>\n\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"default-mileage\" class=\"block text-sm font-medium text-gray-700 mb-1\"\n\t\t\t\t\t\t>Mileage Rate (per mile)</label\n\t\t\t\t\t>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"default-mileage\"\n\t\t\t\t\t\tstep=\"0.001\"\n\t\t\t\t\t\tbind:value={settings.mileageRate}\n\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\tclass=\"w-full p-2 border rounded-lg\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"modal-actions pt-4\">\n\t\t\t\t\t<button class=\"btn-primary w-full save-btn\" on:click={saveDefaultSettings}\n\t\t\t\t\t\t>Save Defaults</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"vehicles-list\">\n\t\t\t\t<p class=\"text-sm text-gray-500 mb-2\">Add vehicles to associate with mileage logs.</p>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"new-vehicle\" class=\"block text-sm font-medium text-gray-700 mb-1\"\n\t\t\t\t\t\t>Add Vehicle</label\n\t\t\t\t\t>\n\t\t\t\t\t<div style=\"display:flex;gap:8px;\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"new-vehicle\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tbind:value={newVehicleName}\n\t\t\t\t\t\t\tplaceholder=\"e.g., 2019 Ford F-150\"\n\t\t\t\t\t\t\tclass=\"w-full p-2 border rounded-lg\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button class=\"btn-primary\" on:click={addVehicle}>Add</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<ul class=\"space-y-2 mt-4\">\n\t\t\t\t\t{#each settings.vehicles || [] as v}\n\t\t\t\t\t\t<li class=\"flex justify-between items-center p-2 border rounded-lg\">\n\t\t\t\t\t\t\t<div>{v.name}</div>\n\t\t\t\t\t\t\t<button class=\"btn-small neutral\" on:click={() => removeVehicle(v.id)}>Remove</button>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t{/each}\n\t\t\t\t\t{#if !(settings.vehicles && settings.vehicles.length)}\n\t\t\t\t\t\t<li class=\"text-sm text-gray-500\">No vehicles added yet.</li>\n\t\t\t\t\t{/if}\n\t\t\t\t</ul>\n\n\t\t\t\t<div class=\"modal-actions mt-6\">\n\t\t\t\t\t<button class=\"btn-cancel w-full\" on:click={() => (open = false)}>Done</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</Modal>\n\n<style>\n\t.top-tabs {\n\t\tdisplay: flex;\n\t\tborder-bottom: 2px solid #e5e7eb;\n\t\tmargin-bottom: 20px;\n\t}\n\t.top-tab-btn {\n\t\tflex: 1;\n\t\tpadding: 12px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\tborder: none;\n\t\tbackground: none;\n\t\tcursor: pointer;\n\t\tborder-bottom: 2px solid transparent;\n\t\tmargin-bottom: -2px;\n\t}\n\t.top-tab-btn.active {\n\t\tcolor: #ff7f50;\n\t\tborder-bottom-color: #ff7f50;\n\t}\n\t.settings-form .form-group {\n\t\tmargin-bottom: 12px;\n\t}\n\t.settings-form input:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t\tbox-shadow: 0 0 0 4px rgba(255, 127, 80, 0.08);\n\t}\n\n\t.btn-primary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tpadding: 10px 16px;\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\ttext-decoration: none;\n\t\tbox-shadow: 0 2px 8px rgba(255, 127, 80, 0.3);\n\t\ttransition: transform 0.1s;\n\t\tcursor: pointer;\n\t}\n\t.modal-actions .btn-cancel {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\twidth: 100%;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\mileage\\edit\\[id]\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 64,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 64,
				"endColumn": 29
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 120,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 120,
				"endColumn": 29
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 134,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 134,
				"endColumn": 30
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 240,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 240,
				"endColumn": 32
			}
		],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 4,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { mileage } from '$lib/stores/mileage';\n\timport { user } from '$lib/stores/auth';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { toasts } from '$lib/stores/toast';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\timport SelectMobile from '$lib/components/ui/SelectMobile.svelte';\n\tconst expenseId = $page.params.id;\n\n\t// Settings modal removed for Mileage edit page\n\n\t// Category options are not applicable for Mileage edit\n\n\t// Category selection state removed for Mileage edit\n\n\t// Category sync removed for Mileage edit\n\n\t// Category helper functions removed for Mileage edit\n\n\tlet formData = {\n\t\tdate: '',\n\t\tstartOdometer: '',\n\t\tendOdometer: '',\n\t\tmiles: '',\n\t\tvehicle: '',\n\t\tmileageRate: '',\n\t\tnotes: '',\n\t\tcategory: ''\n\t};\n\n\t// Whether the user manually edited the miles input; when true we stop auto-updating miles from odometers\n\tlet milesManual = false;\n\n\t// default mileageRate from settings if editing and none present\n\t$: if ($userSettings && formData.mileageRate === '' && $userSettings.mileageRate != null) {\n\t\tformData.mileageRate = String($userSettings.mileageRate);\n\t}\n\n\t// Default vehicle selection if available and none selected\n\t$: if ($userSettings?.vehicles?.length > 0 && !formData.vehicle) {\n\t\tconst v0 = $userSettings.vehicles[0];\n\t\tformData.vehicle = v0?.id ?? v0?.name ?? '';\n\t}\n\n\t// Find and prefill mileage record when store or page params load\n\t$: {\n\t\tconst id = $page.params.id;\n\t\tconst rec = $mileage.find((e) => e.id === id);\n\t\tif (rec && !formData.date) {\n\t\t\tconst r: any = rec as any;\n\t\t\tformData = {\n\t\t\t\tdate: r.date || '',\n\t\t\t\tstartOdometer: String(r.startOdometer || ''),\n\t\t\t\tendOdometer: String(r.endOdometer || ''),\n\t\t\t\tmiles: typeof r.miles === 'number' ? String(r.miles) : '',\n\t\t\t\tvehicle: r.vehicle || '',\n\t\t\t\tmileageRate: typeof r.mileageRate === 'number' ? String(r.mileageRate) : '',\n\t\t\t\tnotes: r.notes || '',\n\t\t\t\tcategory: r.category || ''\n\t\t\t};\n\t\t} else if ($mileage && $mileage.length > 0 && !rec) {\n\t\t\ttoasts.error('Mileage log not found.');\n\t\t\tgoto('/dashboard/mileage');\n\t\t}\n\t}\n\n\t// Auto-calc miles from odometer readings unless the user has manually edited miles\n\t$: if (!milesManual) {\n\t\tif (formData.startOdometer !== '' && formData.endOdometer !== '') {\n\t\t\tconst s = Number(formData.startOdometer) || 0;\n\t\t\tconst e = Number(formData.endOdometer) || 0;\n\t\t\tformData.miles = Number(Math.max(0, e - s).toFixed(2)).toString();\n\t\t}\n\t}\n\n\tasync function saveExpense() {\n\t\tif (\n\t\t\tformData.startOdometer === '' || formData.endOdometer === ''\n\t\t\t\t? formData.miles !== ''\n\t\t\t\t: !formData.date\n\t\t) {\n\t\t\t// Ensure either start & end are present or miles is provided\n\t\t\tif (\n\t\t\t\t!formData.date ||\n\t\t\t\t((formData.startOdometer === '' || formData.endOdometer === '') && formData.miles === '')\n\t\t\t) {\n\t\t\t\ttoasts.error('Please fill in required fields (either start & end odometer or miles).');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst currentUser = ($page.data as any)['user'] || $user;\n\t\tconst userId = (currentUser as any)?.id || localStorage.getItem('offline_user_id');\n\t\tif (!userId) {\n\t\t\ttoasts.error('User not identified. Cannot save.');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst start = Number(formData.startOdometer) || 0;\n\t\t\tconst end = Number(formData.endOdometer) || 0;\n\t\t\tlet miles =\n\t\t\t\tformData.miles !== '' && !isNaN(Number(formData.miles))\n\t\t\t\t\t? Number(formData.miles)\n\t\t\t\t\t: Math.max(0, end - start);\n\t\t\tmiles = Number(miles.toFixed(2));\n\n\t\t\tconst payload = {\n\t\t\t\t...formData,\n\t\t\t\tstartOdometer: start,\n\t\t\t\tendOdometer: end,\n\t\t\t\tmiles,\n\t\t\t\tmileageRate: formData.mileageRate !== '' ? Number(formData.mileageRate) : undefined,\n\t\t\t\tvehicle: formData.vehicle || undefined\n\t\t\t};\n\n\t\t\tawait mileage.updateMileage(String(expenseId), payload as any, String(userId));\n\t\t\ttoasts.success('Mileage log updated');\n\t\t\tgoto('/dashboard/mileage');\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t\ttoasts.error('Failed to update mileage log');\n\t\t}\n\t}\n</script>\n\n<div class=\"expense-form-page\">\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">Edit Mileage Log</h1>\n\t\t\t<p class=\"page-subtitle\">Update odometer readings and miles</p>\n\t\t</div>\n\t\t<a href=\"/dashboard/mileage\" class=\"btn-back\">\n\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 20 20\" fill=\"none\"\n\t\t\t\t><path\n\t\t\t\t\td=\"M12 4L6 10L12 16\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/></svg\n\t\t\t> Back\n\t\t</a>\n\t</div>\n\n\t<div class=\"form-card\">\n\t\t<div class=\"card-header\">\n\t\t\t<h2 class=\"card-title\">Mileage Details</h2>\n\t\t</div>\n\n\t\t<div class=\"form-grid\">\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"mileage-date\">Date</label>\n\t\t\t\t<input id=\"mileage-date\" type=\"date\" bind:value={formData.date} required />\n\t\t\t</div>\n\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<!-- Maintenance, Supplies, and Expenses options removed for Mileage logs -->\n\t\t\t\t<div class=\"form-group grid-3\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"start-odo\">Start Odometer</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"start-odo\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tinputmode=\"decimal\"\n\t\t\t\t\t\t\tbind:value={formData.startOdometer}\n\t\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"end-odo\">End Odometer</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"end-odo\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tinputmode=\"decimal\"\n\t\t\t\t\t\t\tbind:value={formData.endOdometer}\n\t\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"miles\">Miles</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"miles\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\tinputmode=\"decimal\"\n\t\t\t\t\t\t\tbind:value={formData.miles}\n\t\t\t\t\t\t\tplaceholder=\"0.0\"\n\t\t\t\t\t\t\ton:input={(e) => (milesManual = (e.target as HTMLInputElement).value !== '')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"notes\">Notes</label>\n\t\t\t\t<textarea\n\t\t\t\t\tid=\"notes\"\n\t\t\t\t\tname=\"notes\"\n\t\t\t\t\tbind:value={formData.notes}\n\t\t\t\t\trows=\"3\"\n\t\t\t\t\tplaceholder=\"e.g., Trip to client site\"\n\t\t\t\t></textarea>\n\n\t\t\t\t<!-- tax deductible removed -->\n\t\t\t</div>\n\n\t\t\t<!-- Settings modal removed for Mileage edit -->\n\n\t\t\t<div class=\"form-row vehicle-rate-row\">\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"vehicle-mobile\">Vehicle</label>\n\t\t\t\t\t<SelectMobile\n\t\t\t\t\t\tclassName=\"mobile-select\"\n\t\t\t\t\t\tid=\"vehicle-mobile\"\n\t\t\t\t\t\tplaceholder={$userSettings.vehicles && $userSettings.vehicles.length > 0\n\t\t\t\t\t\t\t? 'Select vehicle'\n\t\t\t\t\t\t\t: 'No vehicles (open Mileage Settings)'}\n\t\t\t\t\t\toptions={$userSettings.vehicles\n\t\t\t\t\t\t\t? $userSettings.vehicles.map((v) => ({ value: v.id || v.name, label: v.name }))\n\t\t\t\t\t\t\t: [{ value: '', label: 'No vehicles (open Mileage Settings)' }]}\n\t\t\t\t\t\tbind:value={formData.vehicle}\n\t\t\t\t\t\tonchange={(e) => (formData.vehicle = e.value)}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"mileage-rate\">Mileage Rate (per mile)</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"mileage-rate\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tstep=\"0.001\"\n\t\t\t\t\t\tbind:value={formData.mileageRate}\n\t\t\t\t\t\tplaceholder=\"0.655\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"form-actions\">\n\t\t\t\t<a href=\"/dashboard/mileage\" class=\"btn-secondary\">Cancel</a>\n\t\t\t\t<button class=\"btn-primary\" on:click={saveExpense}>Save Log</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t/* MATCHING STYLES FROM TRIPS/NEW */\n\t.expense-form-page {\n\t\tmax-width: 800px;\n\t\tmargin: 0 auto;\n\t\tpadding: 4px;\n\t\tpadding-bottom: 90px;\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.expense-form-page {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\t}\n\n\t.page-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 26px;\n\t\tpadding: 0 8px;\n\t}\n\t.page-title {\n\t\tfont-size: 28px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tdisplay: none;\n\t\tmargin: 0;\n\t}\n\n\t.btn-back {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\ttext-decoration: none;\n\t\tfont-size: 14px;\n\t}\n\n\t.form-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 18px;\n\t\tpadding: 16px;\n\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\t}\n\t.card-header {\n\t\tmargin-bottom: 26px;\n\t}\n\t.card-title {\n\t\tfont-size: 22px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\n\t.form-grid {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24px;\n\t}\n\t.form-row {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 20px;\n\t}\n\t/* Make the start/end/miles group span the full width (match Date input) */\n\t.form-row .grid-3 {\n\t\tgrid-column: 1 / -1;\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(3, 1fr);\n\t\tgap: 16px;\n\t}\n\t@media (max-width: 767px) {\n\t\t.form-row .grid-3 {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\t}\n\t.form-group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\n\tlabel {\n\t\tfont-size: 16px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\n\tinput,\n\ttextarea {\n\t\twidth: 100%;\n\t\tpadding: 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tfont-size: 18px;\n\t\tbackground: white;\n\t\tbox-sizing: border-box;\n\t}\n\tinput:focus,\n\ttextarea:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t}\n\n\t.form-actions {\n\t\tdisplay: flex;\n\t\tgap: 18px;\n\t\tmargin-top: 36px;\n\t\tpadding-top: 26px;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\t.btn-primary,\n\t.btn-secondary {\n\t\tflex: 1;\n\t\tpadding: 18px;\n\t\tborder-radius: 12px;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t\tcursor: pointer;\n\t\tborder: none;\n\t\ttext-align: center;\n\t\ttext-decoration: none;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\t.btn-primary {\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t}\n\t.btn-secondary {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t}\n\n\t@media (min-width: 768px) {\n\t\t.page-subtitle {\n\t\t\tdisplay: block;\n\t\t}\n\t\t.form-card {\n\t\t\tpadding: 48px;\n\t\t}\n\t\t.form-actions {\n\t\t\tjustify-content: flex-end;\n\t\t}\n\t\t.btn-primary,\n\t\t.btn-secondary {\n\t\t\tflex: 0 0 auto;\n\t\t\twidth: auto;\n\t\t\tmin-width: 160px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\mileage\\new\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 106,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 106,
				"endColumn": 29
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 120,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 120,
				"endColumn": 30
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 228,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 228,
				"endColumn": 32
			}
		],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 3,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { mileage } from '$lib/stores/mileage';\n\n\timport { user } from '$lib/stores/auth';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { toasts } from '$lib/stores/toast';\n\timport { goto, invalidateAll } from '$app/navigation';\n\timport { page } from '$app/stores';\n\timport SelectMobile from '$lib/components/ui/SelectMobile.svelte';\n\n\t// --- HELPER: Get Local Date (YYYY-MM-DD) ---\n\tfunction getLocalDate() {\n\t\tconst now = new Date();\n\t\treturn new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().split('T')[0];\n\t}\n\n\t// Settings modal removed for Mileage logs\n\n\tconst formData = {\n\t\tdate: getLocalDate(),\n\t\tstartOdometer: '',\n\t\tendOdometer: '',\n\t\tmiles: '',\n\t\tvehicle: '',\n\t\tmileageRate: '',\n\t\tnotes: '',\n\t\tcategory: ''\n\t};\n\n\t// Reference to miles input so quick-action can focus it\n\tlet amountInput: HTMLInputElement | null = null;\n\t// Whether the user manually edited the miles input; when true we stop auto-updating miles from odometers\n\tlet milesManual = false;\n\n\t// default mileageRate from user settings for new logs (only set if field empty)\n\t$: if ($userSettings && formData.mileageRate === '') {\n\t\tformData.mileageRate =\n\t\t\t$userSettings.mileageRate != null ? String($userSettings.mileageRate) : '';\n\t}\n\n\t// Default vehicle selection if available and none selected\n\t$: if ($userSettings?.vehicles?.length > 0 && !formData.vehicle) {\n\t\tconst v0 = $userSettings.vehicles[0];\n\t\tformData.vehicle = v0?.id ?? v0?.name ?? '';\n\t}\n\n\t// Prefill category from the URL query parameter (e.g., ?category=fuel)\n\t$: {\n\t\tconst q = $page.url.searchParams.get('category');\n\t\tif (q) {\n\t\t\tformData.category = q;\n\t\t\t// if arrived via quick action, focus the miles input for quick logging\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\tsetTimeout(() => (amountInput as any)?.focus(), 60);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Auto-calc miles from odometer readings unless the user has manually edited miles\n\t$: if (!milesManual) {\n\t\tif (formData.startOdometer !== '' && formData.endOdometer !== '') {\n\t\t\tconst s = Number(formData.startOdometer) || 0;\n\t\t\tconst e = Number(formData.endOdometer) || 0;\n\t\t\tformData.miles = Number(Math.max(0, e - s).toFixed(2)).toString();\n\t\t}\n\t}\n\n\tasync function saveExpense() {\n\t\tif (\n\t\t\t!formData.date ||\n\t\t\t((formData.startOdometer === '' || formData.endOdometer === '') && formData.miles === '')\n\t\t) {\n\t\t\ttoasts.error('Please fill in required fields (either start & end odometer or miles).');\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUser = $page.data['user'] || $user;\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id');\n\n\t\tif (!userId) {\n\t\t\ttoasts.error('User not identified. Cannot save.');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst start = Number(formData.startOdometer) || 0;\n\t\t\tconst end = Number(formData.endOdometer) || 0;\n\t\t\tlet miles =\n\t\t\t\tformData.miles !== '' && !isNaN(Number(formData.miles))\n\t\t\t\t\t? Number(formData.miles)\n\t\t\t\t\t: Math.max(0, end - start);\n\t\t\tmiles = Number(miles.toFixed(2));\n\n\t\t\tconst payload = {\n\t\t\t\t...formData,\n\t\t\t\tstartOdometer: start,\n\t\t\t\tendOdometer: end,\n\t\t\t\tmiles,\n\t\t\t\tmileageRate: formData.mileageRate !== '' ? Number(formData.mileageRate) : undefined,\n\t\t\t\tvehicle: formData.vehicle || undefined\n\t\t\t};\n\n\t\t\tawait mileage.create(payload as any, userId);\n\t\t\ttoasts.success('Mileage log created');\n\t\t\tawait invalidateAll();\n\t\t\tgoto('/dashboard/mileage');\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t\ttoasts.error('Failed to save mileage log');\n\t\t}\n\t}\n</script>\n\n<div class=\"expense-form-page\">\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">New Mileage Log</h1>\n\t\t\t<p class=\"page-subtitle\">Record start/end odometer and miles</p>\n\t\t</div>\n\t\t<a href=\"/dashboard/mileage\" class=\"btn-back\">\n\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 20 20\" fill=\"none\"\n\t\t\t\t><path\n\t\t\t\t\td=\"M12 4L6 10L12 16\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/></svg\n\t\t\t> Back\n\t\t</a>\n\t</div>\n\n\t<div class=\"form-card\">\n\t\t<div class=\"card-header\">\n\t\t\t<h2 class=\"card-title\">Mileage Details</h2>\n\t\t</div>\n\n\t\t<div class=\"form-grid\">\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"mileage-date\">Date</label>\n\t\t\t\t<input id=\"mileage-date\" type=\"date\" bind:value={formData.date} required />\n\t\t\t</div>\n\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<!-- Maintenance, Supplies, and Expenses options removed for Mileage logs -->\n\n\t\t\t\t<div class=\"form-group grid-3\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"start-odo\">Start Odometer</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"start-odo\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tinputmode=\"decimal\"\n\t\t\t\t\t\t\tbind:value={formData.startOdometer}\n\t\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"end-odo\">End Odometer</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"end-odo\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tinputmode=\"decimal\"\n\t\t\t\t\t\t\tbind:value={formData.endOdometer}\n\t\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"miles\">Miles</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"miles\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\tinputmode=\"decimal\"\n\t\t\t\t\t\t\tbind:this={amountInput}\n\t\t\t\t\t\t\tbind:value={formData.miles}\n\t\t\t\t\t\t\tplaceholder=\"0.0\"\n\t\t\t\t\t\t\ton:input={(e) => (milesManual = (e.target as HTMLInputElement).value !== '')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"notes\">Notes</label>\n\t\t\t\t<textarea\n\t\t\t\t\tid=\"notes\"\n\t\t\t\t\tname=\"notes\"\n\t\t\t\t\tbind:value={formData.notes}\n\t\t\t\t\trows=\"3\"\n\t\t\t\t\tplaceholder=\"e.g., Trip to client site\"\n\t\t\t\t></textarea>\n\n\t\t\t\t<!-- tax deductible removed -->\n\t\t\t</div>\n\n\t\t\t<!-- Settings modal removed for Mileage logs -->\n\n\t\t\t<div class=\"form-row vehicle-rate-row\">\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"vehicle-mobile\">Vehicle</label>\n\t\t\t\t\t<SelectMobile\n\t\t\t\t\t\tclassName=\"mobile-select\"\n\t\t\t\t\t\tid=\"vehicle-mobile\"\n\t\t\t\t\t\tplaceholder={$userSettings.vehicles && $userSettings.vehicles.length > 0\n\t\t\t\t\t\t\t? 'Select vehicle'\n\t\t\t\t\t\t\t: 'No vehicles (open Mileage Settings)'}\n\t\t\t\t\t\toptions={$userSettings.vehicles\n\t\t\t\t\t\t\t? $userSettings.vehicles.map((v) => ({ value: v.id || v.name, label: v.name }))\n\t\t\t\t\t\t\t: [{ value: '', label: 'No vehicles (open Mileage Settings)' }]}\n\t\t\t\t\t\tbind:value={formData.vehicle}\n\t\t\t\t\t\tonchange={(e) => (formData.vehicle = e.value)}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"mileage-rate\">Mileage Rate (per mile)</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"mileage-rate\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tstep=\"0.001\"\n\t\t\t\t\t\tbind:value={formData.mileageRate}\n\t\t\t\t\t\tplaceholder=\"0.655\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"form-actions\">\n\t\t\t\t<a href=\"/dashboard/mileage\" class=\"btn-secondary\">Cancel</a>\n\t\t\t\t<button class=\"btn-primary\" on:click={saveExpense}>Save Log</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t/* MATCHING STYLES FROM TRIPS/NEW */\n\t.expense-form-page {\n\t\tmax-width: 800px;\n\t\tmargin: 0 auto;\n\t\tpadding: 4px;\n\t\tpadding-bottom: 90px;\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.expense-form-page {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\t}\n\n\t.page-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 26px;\n\t\tpadding: 0 8px;\n\t}\n\t.page-title {\n\t\tfont-size: 28px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tdisplay: none;\n\t\tmargin: 0;\n\t}\n\n\t.btn-back {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\ttext-decoration: none;\n\t\tfont-size: 14px;\n\t}\n\n\t.form-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 18px;\n\t\tpadding: 16px;\n\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\t}\n\t.card-header {\n\t\tmargin-bottom: 26px;\n\t}\n\t.card-title {\n\t\tfont-size: 22px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\n\t.form-grid {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24px;\n\t}\n\t.form-row {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 20px;\n\t}\n\t/* Make the start/end/miles group span the full width (match Date input) */\n\t.form-row .grid-3 {\n\t\tgrid-column: 1 / -1;\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(3, 1fr);\n\t\tgap: 16px;\n\t}\n\t@media (max-width: 767px) {\n\t\t.form-row .grid-3 {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\t}\n\n\t/* Force mileage rate below vehicle on small screens <= 711px */\n\t@media (max-width: 711px) {\n\t\t.vehicle-rate-row {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\t}\n\n\t.form-group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\n\tlabel {\n\t\tfont-size: 16px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\n\tinput,\n\ttextarea {\n\t\twidth: 100%;\n\t\tpadding: 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tfont-size: 18px;\n\t\tbackground: white;\n\t\tbox-sizing: border-box;\n\t}\n\n\tinput:focus,\n\ttextarea:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t}\n\n\t.form-actions {\n\t\tdisplay: flex;\n\t\tgap: 18px;\n\t\tmargin-top: 36px;\n\t\tpadding-top: 26px;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\t.btn-primary,\n\t.btn-secondary {\n\t\tflex: 1;\n\t\tpadding: 18px;\n\t\tborder-radius: 12px;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t\tcursor: pointer;\n\t\tborder: none;\n\t\ttext-align: center;\n\t\ttext-decoration: none;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\t.btn-primary {\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t}\n\t.btn-secondary {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t}\n\n\t@media (min-width: 768px) {\n\t\t.page-subtitle {\n\t\t\tdisplay: block;\n\t\t}\n\t\t.form-card {\n\t\t\tpadding: 48px;\n\t\t}\n\t\t.form-actions {\n\t\t\tjustify-content: flex-end;\n\t\t}\n\t\t.btn-primary,\n\t\t.btn-secondary {\n\t\t\tflex: 0 0 auto;\n\t\t\twidth: auto;\n\t\t\tmin-width: 160px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\profile\\+page.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\profile\\+page.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\+page.server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 17,
				"column": 57,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 17,
				"endColumn": 60,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [630, 633], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [630, 633], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/dashboard/settings/+page.server.ts\nimport type { PageServerLoad } from './$types';\nimport { log } from '$lib/server/log';\n\nexport const load: PageServerLoad = async ({ locals, platform, parent }) => {\n\tconst parentData = await parent();\n\n\tlet settingsData = {};\n\n\tif (locals.user) {\n\t\ttry {\n\t\t\tconst { getEnv, safeKV } = await import('$lib/server/env');\n\t\t\tconst env = getEnv(platform);\n\t\t\tconst kv = safeKV(env, 'BETA_USER_SETTINGS_KV');\n\t\t\tif (!kv) throw new Error('settings KV missing');\n\t\t\t// [!code fix] Use 'settings:' prefix to match the API write path\n\t\t\tconst raw = await kv.get(`settings:${(locals.user as any).id}`);\n\t\t\tif (raw) {\n\t\t\t\tsettingsData = JSON.parse(raw);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlog.error('Failed to load remote settings:', e);\n\t\t}\n\t}\n\n\treturn {\n\t\t...parentData,\n\t\t// [!code fix] Wrap in 'settings' property to match frontend expectation (data.remoteSettings.settings)\n\t\tremoteSettings: {\n\t\t\tsettings: settingsData\n\t\t}\n\t};\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 201,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 201,
				"endColumn": 33
			}
		],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { auth, user } from '$lib/stores/auth';\n\timport { trips } from '$lib/stores/trips';\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport Button from '$lib/components/ui/Button.svelte';\n\timport ProfileCard from './components/ProfileCard.svelte';\n\timport SecurityCard from './components/SecurityCard.svelte';\n\timport ExportModal from './components/ExportModal.svelte';\n\timport MaintenanceCard from './components/MaintenanceCard.svelte';\n\timport SettingsLayout from './SettingsLayout.svelte';\n\timport CollapsibleCard from '$lib/components/ui/CollapsibleCard.svelte';\n\timport { csrfFetch } from '$lib/utils/csrf';\n\n\texport let data: any;\n\n\t// --- REMOTE SYNC LOGIC ---\n\t$: if (data?.remoteSettings?.settings) {\n\t\tconst merged = { ...$userSettings, ...data.remoteSettings.settings };\n\t\tuserSettings.set(merged);\n\t}\n\n\tlet profile = { name: '', email: '' };\n\t$: if ($user || data.remoteSettings?.profile) {\n\t\tconst remote = data.remoteSettings?.profile || {};\n\t\tif (!profile.name) profile.name = remote.name || $user?.id || '';\n\t\tif (!profile.email) profile.email = remote.email || $user?.email || '';\n\t}\n\n\t$: monthlyUsage = $trips.filter((t) => {\n\t\tif (!t.date) return false;\n\t\tconst tripDate = new Date(t.date);\n\t\tconst now = new Date();\n\t\treturn tripDate.getMonth() === now.getMonth() && tripDate.getFullYear() === now.getFullYear();\n\t}).length;\n\n\tlet showSuccess = false;\n\tlet successMessage = '';\n\n\tfunction showSuccessMsg(msg: string) {\n\t\tsuccessMessage = msg;\n\t\tshowSuccess = true;\n\t\tsetTimeout(() => (showSuccess = false), 3000);\n\t}\n\n\t// Upgrade/Pro Logic\n\t$: isPro = ['pro', 'business', 'premium', 'enterprise'].includes($auth.user?.plan || '');\n\tlet isUpgradeModalOpen = false;\n\tlet upgradeSource: 'generic' | 'export' | 'advanced-export' = 'generic';\n\tlet isCheckingOut = false;\n\tlet isOpeningPortal = false;\n\n\tasync function handleCheckout() {\n\t\tif (isCheckingOut) return;\n\t\tisCheckingOut = true;\n\t\ttry {\n\t\t\tconst res = await csrfFetch('/api/stripe/checkout', { method: 'POST' });\n\t\t\tconst json: any = await res.json();\n\t\t\tif (!res.ok) throw new Error(json?.message || 'Checkout failed');\n\t\t\tif (json?.url) window.location.href = json.url;\n\t\t} catch (e) {\n\t\t\tconsole.error('Checkout error:', e);\n\t\t\talert('Failed to start checkout. Please try again.');\n\t\t\tisCheckingOut = false;\n\t\t}\n\t}\n\n\tasync function handlePortal() {\n\t\tif (isOpeningPortal) return;\n\t\tisOpeningPortal = true;\n\t\ttry {\n\t\t\tconst res = await csrfFetch('/api/stripe/portal', { method: 'POST' });\n\t\t\tconst json: any = await res.json();\n\t\t\tif (!res.ok) throw new Error(json?.message || 'Failed to open portal');\n\t\t\tif (json?.url) window.location.href = json.url;\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\talert('Could not open billing portal. If you recently upgraded, try refreshing the page.');\n\t\t\tisOpeningPortal = false;\n\t\t}\n\t}\n\n\tlet showAdvancedExport = false;\n\n\t// Handle events from child components\n\tfunction handleExportTaxBundle(e: CustomEvent) {\n\t\t// Because tax bundle logic is complex (CSV generation + PDF text),\n\t\t// you can implement it here or import `exportTaxBundle` from export-utils if refactored there.\n\t\t// For this refactor, I assume the logic resides in the modal or utility.\n\t\t// If the logic was kept here, call it.\n\t\tconsole.log('Export tax bundle requested', e.detail);\n\t\tshowSuccessMsg('Tax bundle exported!');\n\t}\n</script>\n\n<svelte:head>\n\t<title>Settings - Go Route Yourself</title>\n\t<style>\n\t\t.pac-container {\n\t\t\tz-index: 10000 !important;\n\t\t\tpointer-events: auto !important;\n\t\t}\n\t\t:root {\n\t\t\t--orange: #ff6a3d;\n\t\t\t--green: #22c55e;\n\t\t\t--navy: #1a3a5c;\n\t\t\t--purple: #764a89;\n\t\t}\n\t</style>\n</svelte:head>\n\n<div class=\"settings\">\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">Settings</h1>\n\t\t\t<p class=\"page-subtitle\">Manage your account and preferences</p>\n\t\t</div>\n\t</div>\n\n\t{#if showSuccess}\n\t\t<div class=\"alert success\">\n\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t<path\n\t\t\t\t\td=\"M16.6 5L7.5 14L3.4 10\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t\t{successMessage}\n\t\t</div>\n\t{/if}\n\n\t<SettingsLayout>\n\t\t<section id=\"profile\" class=\"settings-section\">\n\t\t\t<ProfileCard\n\t\t\t\tbind:profile\n\t\t\t\t{monthlyUsage}\n\t\t\t\t{isPro}\n\t\t\t\t{isCheckingOut}\n\t\t\t\t{isOpeningPortal}\n\t\t\t\ton:success={(e) => showSuccessMsg(e.detail)}\n\t\t\t\ton:portal={handlePortal}\n\t\t\t\ton:upgrade={(e) => {\n\t\t\t\t\tupgradeSource = e.detail;\n\t\t\t\t\tisUpgradeModalOpen = true;\n\t\t\t\t}}\n\t\t\t/>\n\t\t</section>\n\n\t\t<section id=\"maintenance\" class=\"settings-section\">\n\t\t\t<MaintenanceCard on:success={(e) => showSuccessMsg(e.detail)} />\n\t\t</section>\n\n\t\t<section id=\"integrations\" class=\"settings-section\">\n\t\t\t<CollapsibleCard\n\t\t\t\ttitle=\"Integrations\"\n\t\t\t\tsubtitle=\"Connect external services\"\n\t\t\t\tstorageKey=\"settings:integrations\"\n\t\t\t>\n\t\t\t\t{#snippet icon()}\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M10 12C11.1046 12 12 11.1046 12 10C12 8.89543 11.1046 8 10 8C8.89543 8 8 8.89543 8 10C8 11.1046 8.89543 12 10 12Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M16.2 12C16.1 12.5 16.3 13 16.7 13.3L16.8 13.4C17.1 13.7 17.3 14.1 17.3 14.5C17.3 14.9 17.1 15.3 16.8 15.6C16.5 15.9 16.1 16.1 15.7 16.1C15.3 16.1 14.9 15.9 14.6 15.6L14.5 15.5C14.2 15.1 13.7 14.9 13.2 15C12.7 15.1 12.4 15.5 12.3 16V16.2C12.3 17.1 11.6 17.8 10.7 17.8C9.8 17.8 9.1 17.1 9.1 16.2V16.1C9 15.5 8.6 15.1 8 15C7.5 15 7 15.2 6.7 15.6L6.6 15.7C6.3 16 5.9 16.2 5.5 16.2C5.1 16.2 4.7 16 4.4 15.7C4.1 15.4 3.9 15 3.9 14.6C3.9 14.2 4.1 13.8 4.4 13.5L4.5 13.4C4.9 13.1 5.1 12.6 5 12.1C4.9 11.6 4.5 11.3 4 11.2H3.8C2.9 11.2 2.2 10.5 2.2 9.6C2.2 8.7 2.9 8 3.8 8H3.9C4.5 7.9 4.9 7.5 5 6.9C5 6.4 4.8 5.9 4.4 5.6L4.3 5.5C4 5.2 3.8 4.8 3.8 4.4C3.8 4 4 3.6 4.3 3.3C4.6 3 5 2.8 5.4 2.8C5.8 2.8 6.2 3 6.5 3.3L6.6 3.4C7 3.8 7.5 4 8 3.9C8.5 3.9 8.8 3.4 8.9 2.9V2.7C8.9 1.8 9.6 1.1 10.5 1.1C11.4 1.1 12.1 1.8 12.1 2.7V2.8C12.1 3.4 12.5 3.8 13.1 3.9C13.6 4 14.1 3.8 14.4 3.4L14.5 3.3C14.8 3 15.2 2.8 15.6 2.8C16 2.8 16.4 3 16.7 3.3C17 3.6 17.2 4 17.2 4.4C17.2 4.8 17 5.2 16.7 5.5L16.6 5.6C16.2 5.9 16 6.4 16.1 6.9C16.2 7.4 16.6 7.7 17.1 7.8H17.3C18.2 7.8 18.9 8.5 18.9 9.4C18.9 10.3 18.2 11 17.3 11H17.2C16.6 11.1 16.2 11.5 16.1 12.1L16.2 12Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</span>\n\t\t\t\t{/snippet}\n\t\t\t\t<div class=\"card-header\">\n\t\t\t\t\t<div class=\"card-icon green\">\n\t\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M10 12C11.1046 12 12 11.1046 12 10C12 8.89543 11.1046 8 10 8C8.89543 8 8 8.89543 8 10C8 11.1046 8.89543 12 10 12Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M16.2 12C16.1 12.5 16.3 13 16.7 13.3L16.8 13.4C17.1 13.7 17.3 14.1 17.3 14.5C17.3 14.9 17.1 15.3 16.8 15.6C16.5 15.9 16.1 16.1 15.7 16.1C15.3 16.1 14.9 15.9 14.6 15.6L14.5 15.5C14.2 15.1 13.7 14.9 13.2 15C12.7 15.1 12.4 15.5 12.3 16V16.2C12.3 17.1 11.6 17.8 10.7 17.8C9.8 17.8 9.1 17.1 9.1 16.2V16.1C9 15.5 8.6 15.1 8 15C7.5 15 7 15.2 6.7 15.6L6.6 15.7C6.3 16 5.9 16.2 5.5 16.2C5.1 16.2 4.7 16 4.4 15.7C4.1 15.4 3.9 15 3.9 14.6C3.9 14.2 4.1 13.8 4.4 13.5L4.5 13.4C4.9 13.1 5.1 12.6 5 12.1C4.9 11.6 4.5 11.3 4 11.2H3.8C2.9 11.2 2.2 10.5 2.2 9.6C2.2 8.7 2.9 8 3.8 8H3.9C4.5 7.9 4.9 7.5 5 6.9C5 6.4 4.8 5.9 4.4 5.6L4.3 5.5C4 5.2 3.8 4.8 3.8 4.4C3.8 4 4 3.6 4.3 3.3C4.6 3 5 2.8 5.4 2.8C5.8 2.8 6.2 3 6.5 3.3L6.6 3.4C7 3.8 7.5 4 8 3.9C8.5 3.9 8.8 3.4 8.9 2.9V2.7C8.9 1.8 9.6 1.1 10.5 1.1C11.4 1.1 12.1 1.8 12.1 2.7V2.8C12.1 3.4 12.5 3.8 13.1 3.9C13.6 4 14.1 3.8 14.4 3.4L14.5 3.3C14.8 3 15.2 2.8 15.6 2.8C16 2.8 16.4 3 16.7 3.3C17 3.6 17.2 4 17.2 4.4C17.2 4.8 17 5.2 16.7 5.5L16.6 5.6C16.2 5.9 16 6.4 16.1 6.9C16.2 7.4 16.6 7.7 17.1 7.8H17.3C18.2 7.8 18.9 8.5 18.9 9.4C18.9 10.3 18.2 11 17.3 11H17.2C16.6 11.1 16.2 11.5 16.1 12.1L16.2 12Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h2 class=\"card-title\">Integrations</h2>\n\t\t\t\t\t\t<p class=\"card-subtitle\">Connect external services</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"data-actions\">\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"/dashboard/hughesnet\"\n\t\t\t\t\t\tclass=\"action-btn\"\n\t\t\t\t\t\tstyle=\"text-decoration: none; color: inherit; display:flex; align-items:center; gap:16px; padding:16px; background:#F9FAFB; border:2px solid #E5E7EB; border-radius:12px;\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div style=\"display: flex; align-items: center; gap: 12px; width: 100%;\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"24\"\n\t\t\t\t\t\t\t\theight=\"24\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\tstyle=\"color: #0D9488;\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n\t\t\t\t\t\t\t\t<path d=\"M2 12h20\"></path>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"\n\t\t\t\t\t\t\t\t></path>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"action-title\" style=\"font-weight:600; font-size:15px;\">HughesNet</div>\n\t\t\t\t\t\t\t\t<div class=\"action-subtitle\" style=\"color:#6B7280; font-size:13px;\">\n\t\t\t\t\t\t\t\t\tConfigure satellite integration\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style=\"margin-left: auto;\">\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tstroke=\"#9CA3AF\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<polyline points=\"9 18 15 12 9 6\"></polyline>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</CollapsibleCard>\n\t\t</section>\n\n\t\t<section id=\"security\" class=\"settings-section\">\n\t\t\t<SecurityCard on:success={(e) => showSuccessMsg(e.detail)} />\n\t\t</section>\n\t</SettingsLayout>\n</div>\n\n<ExportModal\n\tbind:showAdvancedExport\n\ton:success={(e) => showSuccessMsg(e.detail)}\n\ton:exportTaxBundle={handleExportTaxBundle}\n/>\n\n<Modal bind:open={isUpgradeModalOpen} title=\"Upgrade to Pro\">\n\t<div class=\"space-y-6 text-center py-4\">\n\t\t<div class=\"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4\">\n\t\t\t<span class=\"text-3xl\">🚀</span>\n\t\t</div>\n\n\t\t<h3 class=\"text-xl font-bold text-gray-900\">\n\t\t\t{#if upgradeSource === 'export' || upgradeSource === 'advanced-export'}\n\t\t\t\tUnlock Advanced Exports\n\t\t\t{:else}\n\t\t\t\tUnlock Pro Features\n\t\t\t{/if}\n\t\t</h3>\n\n\t\t<p class=\"text-gray-600 text-base leading-relaxed\">\n\t\t\t{#if upgradeSource === 'export' || upgradeSource === 'advanced-export'}\n\t\t\t\tAdvanced export features including tax bundles, PDF exports, and comprehensive expense\n\t\t\t\ttracking are Pro features. Upgrade now to unlock professional-grade data exports!\n\t\t\t{:else}\n\t\t\t\tTake your business to the next level. Get unlimited trips, powerful route optimization, and\n\t\t\t\ttax-ready data exports.\n\t\t\t{/if}\n\t\t</p>\n\n\t\t<div class=\"bg-gray-50 p-4 rounded-lg text-left text-sm space-y-2 border border-gray-100\">\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Unlimited Stops per Trip</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">One-Click Route Optimization</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Unlimited Monthly Trips</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Advanced Exports (CSV/PDF)</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Tax Bundle Generation</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex gap-3 justify-center pt-2\">\n\t\t\t<Button variant=\"outline\" on:click={() => (isUpgradeModalOpen = false)}>Maybe Later</Button>\n\t\t\t<Button\n\t\t\t\tvariant=\"primary\"\n\t\t\t\tclassName=\"px-6 py-2.5 text-sm\"\n\t\t\t\ton:click={handleCheckout}\n\t\t\t\tdisabled={isCheckingOut}>{isCheckingOut ? 'Loading...' : 'Upgrade Now'}</Button\n\t\t\t>\n\t\t</div>\n\t</div>\n</Modal>\n\n<style>\n\t.settings {\n\t\tmax-width: 1400px;\n\t\tmargin: 0 auto;\n\t\tpadding: 16px;\n\t\tpadding-bottom: 80px;\n\t}\n\t.page-header {\n\t\tmargin-bottom: 32px;\n\t}\n\t.page-title {\n\t\tfont-size: 32px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 16px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.alert {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding: 14px 20px;\n\t\tborder-radius: 12px;\n\t\tfont-size: 14px;\n\t\tfont-weight: 500;\n\t\tmargin-bottom: 24px;\n\t}\n\t.alert.success {\n\t\tbackground: #f0fdf4;\n\t\tcolor: #166534;\n\t\tborder: 1px solid #bbf7d0;\n\t}\n\n\t/* Section spacing when using the SettingsLayout */\n\t.settings-section {\n\t\tmargin-bottom: 24px;\n\t}\n\n\t@media (max-width: 1024px) {\n\t\t/* On narrow screens, sections stack naturally and nav becomes horizontal */\n\t\t.settings-section {\n\t\t\tmargin-bottom: 18px;\n\t\t}\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.settings {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\SettingsLayout.svelte",
		"messages": [
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 45,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 55,
				"endColumn": 11
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\texport let sections: string[] = ['profile', 'maintenance', 'integrations', 'security'];\n\n\t// Ensure `active` is a string even if sections is empty\n\tlet active: string = sections?.[0] ?? '';\n\tlet observer: IntersectionObserver | null = null;\n\n\tonMount(() => {\n\t\tconst opts = { root: null, rootMargin: '0px 0px -55%', threshold: 0.1 };\n\t\tobserver = new IntersectionObserver((entries) => {\n\t\t\t// Pick the most visible section\n\t\t\tconst visible = entries\n\t\t\t\t.filter((e) => e.isIntersecting)\n\t\t\t\t.sort((a, b) => (b.intersectionRatio || 0) - (a.intersectionRatio || 0));\n\t\t\tconst entry = visible[0];\n\t\t\tif (entry && entry.target) {\n\t\t\t\tconst id = (entry.target as HTMLElement).id;\n\t\t\t\tif (id) active = id;\n\t\t\t}\n\t\t}, opts);\n\n\t\tsections.forEach((id) => {\n\t\t\tconst el = document.getElementById(id);\n\t\t\tif (el && observer) observer.observe(el);\n\t\t});\n\t});\n\n\tonDestroy(() => {\n\t\tif (observer) observer.disconnect();\n\t});\n\n\tfunction scrollTo(id: string) {\n\t\tif (typeof document === 'undefined') return;\n\t\tconst el = document.getElementById(id);\n\t\t// Set the active tab immediately for instant feedback while we smooth-scroll\n\t\tif (id) active = id;\n\t\tif (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });\n\t}\n</script>\n\n<div class=\"settings-wrap\">\n\t<nav class=\"side-nav\" aria-label=\"Settings navigation\">\n\t\t<ul>\n\t\t\t{#each sections as s}\n\t\t\t\t<li class:active={active === s}>\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\ton:click={() => scrollTo(s)}\n\t\t\t\t\t\taria-current={active === s ? 'true' : 'false'}\n\t\t\t\t\t>\n\t\t\t\t\t\t{s ? s[0]?.toUpperCase() + s.slice(1) : ''}\n\t\t\t\t\t</button>\n\t\t\t\t</li>\n\t\t\t{/each}\n\t\t</ul>\n\t</nav>\n\n\t<main class=\"settings-main\">\n\t\t<slot />\n\t</main>\n</div>\n\n<style>\n\t.settings-wrap {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 220px 1fr;\n\t\tgap: 24px;\n\t\talign-items: start;\n\t}\n\n\t.side-nav {\n\t\tposition: sticky;\n\t\ttop: 20px;\n\t\theight: calc(100vh - 40px);\n\t\toverflow: auto;\n\t\tpadding: 12px 0;\n\t}\n\t.side-nav ul {\n\t\tlist-style: none;\n\t\tpadding: 0;\n\t\tmargin: 0;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\t.side-nav li button {\n\t\tbackground: transparent;\n\t\tborder: none;\n\t\tpadding: 10px 12px;\n\t\ttext-align: left;\n\t\twidth: 100%;\n\t\tborder-radius: 8px;\n\t\tcursor: pointer;\n\t\tcolor: #374151;\n\t\tfont-weight: 600;\n\t}\n\t.side-nav li button:hover {\n\t\tbackground: rgba(255, 127, 80, 0.06);\n\t\tcolor: var(--orange, #ff6a3d);\n\t}\n\t.side-nav li.active button {\n\t\tbackground: linear-gradient(90deg, rgba(255, 127, 80, 0.12), rgba(255, 127, 80, 0.02));\n\t\tcolor: var(--orange, #ff6a3d);\n\t\tbox-shadow: inset 0 0 0 1px rgba(255, 127, 80, 0.06);\n\t}\n\n\t.settings-main {\n\t\tmin-width: 0;\n\t}\n\n\t/* Shared save button styling for settings (global so children can use it) */\n\t:global(.save-btn) {\n\t\tdisplay: block;\n\t\twidth: 100%;\n\t\tbox-sizing: border-box;\n\t\tmin-width: 120px;\n\t\tpadding: 12px 16px;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 700;\n\t\tmargin-top: 8px;\n\t\ttext-align: center;\n\t}\n\t:global(.save-btn:focus-visible) {\n\t\toutline: 3px solid rgba(255, 127, 80, 0.18);\n\t\toutline-offset: 3px;\n\t}\n\n\t/* Global highlight styles for Save buttons */\n\t:global(.btn-secondary.highlight),\n\t:global(.btn-primary.highlight) {\n\t\tborder-color: var(--orange, #ff6a3d);\n\t\tcolor: var(--orange, #ff6a3d);\n\t\tbox-shadow: 0 8px 22px rgba(255, 127, 80, 0.16);\n\t\ttransform: translateY(-1px);\n\t\ttransition:\n\t\t\tbox-shadow 0.18s ease,\n\t\t\tborder-color 0.18s ease,\n\t\t\ttransform 0.12s ease;\n\t}\n\n\t/* Ensure consistent icon/title sizing for all settings cards */\n\t:global(.settings .card-icon) {\n\t\twidth: 48px;\n\t\theight: 48px;\n\t\tborder-radius: 12px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcolor: white;\n\t\tflex-shrink: 0;\n\t\tfont-size: 20px;\n\t}\n\t:global(.settings .card-title) {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t}\n\t:global(.settings .card-subtitle) {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t}\n\n\t/* Responsive: move nav to top as scrollable horizontal row */\n\t@media (max-width: 1024px) {\n\t\t.settings-wrap {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\t\t.side-nav {\n\t\t\tposition: relative;\n\t\t\ttop: 0;\n\t\t\theight: auto;\n\t\t\toverflow-x: auto;\n\t\t\toverflow-y: hidden;\n\t\t\tpadding: 8px 0 12px;\n\t\t\t-webkit-overflow-scrolling: touch;\n\t\t}\n\t\t.side-nav ul {\n\t\t\tflex-direction: row;\n\t\t\tgap: 6px;\n\t\t\tpadding-left: 6px;\n\t\t\tpadding-right: 6px;\n\t\t}\n\t\t.side-nav li button {\n\t\t\tpadding: 8px 14px;\n\t\t\twhite-space: nowrap;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\components\\DataCard.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\components\\ExportModal.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\components\\MaintenanceCard.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\components\\ProfileCard.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\components\\SecurityCard.svelte",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 61,
				"column": 13,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 61,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 98,
				"column": 10,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 98,
				"endColumn": 13
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'err' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 103,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 103,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 113,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 113,
				"endColumn": 17
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 155,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 155,
				"endColumn": 17
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 171,
				"column": 15,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 171,
				"endColumn": 16
			},
			{
				"ruleId": "no-empty",
				"severity": 2,
				"message": "Empty block statement.",
				"line": 171,
				"column": 18,
				"nodeType": "BlockStatement",
				"messageId": "unexpected",
				"endLine": 171,
				"endColumn": 20,
				"suggestions": [
					{
						"messageId": "suggestComment",
						"data": { "type": "block" },
						"fix": { "range": [4853, 4853], "text": " /* empty */ " },
						"desc": "Add comment inside empty block statement."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 185,
				"column": 13,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 185,
				"endColumn": 14
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 260,
				"column": 13,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 260,
				"endColumn": 14
			},
			{
				"ruleId": "no-empty",
				"severity": 2,
				"message": "Empty block statement.",
				"line": 260,
				"column": 16,
				"nodeType": "BlockStatement",
				"messageId": "unexpected",
				"endLine": 260,
				"endColumn": 18,
				"suggestions": [
					{
						"messageId": "suggestComment",
						"data": { "type": "block" },
						"fix": { "range": [7440, 7440], "text": " /* empty */ " },
						"desc": "Add comment inside empty block statement."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 298,
				"column": 13,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 298,
				"endColumn": 14
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 357,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 357,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 436,
				"column": 19,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 436,
				"endColumn": 26
			}
		],
		"suppressedMessages": [],
		"errorCount": 10,
		"fatalErrorCount": 0,
		"warningCount": 3,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport CollapsibleCard from '$lib/components/ui/CollapsibleCard.svelte';\n\timport { auth, user } from '$lib/stores/auth';\n\timport { goto } from '$app/navigation';\n\timport { toasts } from '$lib/stores/toast';\n\timport { startRegistration } from '@simplewebauthn/browser';\n\timport { onMount, createEventDispatcher } from 'svelte';\n\timport { csrfFetch } from '$lib/utils/csrf';\n\n\tconst dispatch = createEventDispatcher();\n\n\t// Password State\n\tlet showPasswordChange = false;\n\tlet passwordData = { current: '', new: '', confirm: '' };\n\tlet passwordError = '';\n\n\t// Delete State\n\tlet showDeleteConfirm = false;\n\tlet deletePassword = '';\n\tlet deleteError = '';\n\tlet isDeleting = false;\n\n\t// WebAuthn State\n\tlet registering = false;\n\tlet authenticatorsList: Array<any> = [];\n\tlet deviceRegistered = false;\n\tlet deviceCredentialID: string | null = null;\n\tlet deviceName = '';\n\tlet unregistering = false;\n\tlet sessionExpired = false;\n\tlet rememberThisDevice = false;\n\n\t// Passkey Removal State (Sudo Mode)\n\tlet showPasskeyRemoveConfirm = false;\n\tlet passkeyRemovePassword = '';\n\tlet passkeyRemoveError = '';\n\tlet pendingRemoveCredentialID: string | null = null;\n\n\tasync function changePassword() {\n\t\tif (passwordData.new !== passwordData.confirm) {\n\t\t\tpasswordError = 'Passwords do not match';\n\t\t\treturn;\n\t\t}\n\t\tif (passwordData.new.length < 8) {\n\t\t\tpasswordError = 'Password must be at least 8 characters';\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await csrfFetch('/api/change-password', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tcurrentPassword: passwordData.current,\n\t\t\t\t\tnewPassword: passwordData.new\n\t\t\t\t})\n\t\t\t});\n\t\t\tlet result: any = {};\n\t\t\ttry {\n\t\t\t\tresult = await response.json();\n\t\t\t} catch (e) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\tif (!response.ok) {\n\t\t\t\tpasswordError = result?.message || 'Failed to update password';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpasswordError = '';\n\t\t\tshowPasswordChange = false;\n\t\t\tpasswordData = { current: '', new: '', confirm: '' };\n\t\t\tdispatch('success', 'Password changed successfully');\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tpasswordError = 'An unexpected network error occurred.';\n\t\t}\n\t}\n\n\tasync function handleDeleteAccount() {\n\t\tif (!deletePassword) {\n\t\t\tdeleteError = 'Please enter your password to confirm.';\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!confirm(\n\t\t\t\t'FINAL WARNING: This will permanently delete your account and all data. This cannot be undone.'\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tisDeleting = true;\n\t\ttry {\n\t\t\tconst result = await auth.deleteAccount($user?.id || '', deletePassword);\n\t\t\tif (result.success) {\n\t\t\t\tgoto('/');\n\t\t\t} else {\n\t\t\t\tdeleteError = result.error || 'Failed to delete account';\n\t\t\t\tisDeleting = false;\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tdeleteError = 'An unexpected error occurred';\n\t\t\tisDeleting = false;\n\t\t}\n\t}\n\n\tasync function handleLogout() {\n\t\tif (confirm('Are you sure you want to logout?')) {\n\t\t\tawait csrfFetch('/api/logout', { method: 'POST' });\n\t\t\tauth.logout();\n\t\t\tgoto('/login');\n\t\t}\n\t}\n\n\t// --- WebAuthn Logic ---\n\n\tfunction getDeviceName() {\n\t\tconst uaData = (navigator as any).userAgentData;\n\t\tif (uaData && uaData.platform) {\n\t\t\tconst brand = (uaData.brands && uaData.brands[0] && uaData.brands[0].brand) || 'Browser';\n\t\t\treturn `${brand} on ${uaData.platform}`;\n\t\t}\n\t\tconst ua = navigator.userAgent || '';\n\t\tif (/Android/i.test(ua)) return 'Android device';\n\t\tif (/Windows/i.test(ua)) return 'Windows device';\n\t\tif (/Mac|Macintosh/i.test(ua)) return 'Mac device';\n\t\tif (/iPhone|iPad/i.test(ua)) return 'iOS device';\n\t\treturn 'Unknown device';\n\t}\n\n\tasync function loadAuthenticators(opts: { silent?: boolean } = { silent: false }) {\n\t\tconst silent = !!opts.silent;\n\t\tconst maxAttempts = 5;\n\t\tlet attempt = 0;\n\n\t\tconst attemptFetch = async (): Promise<boolean> => {\n\t\t\tattempt += 1;\n\t\t\ttry {\n\t\t\t\tconst res = await fetch('/api/auth/webauthn/list', { credentials: 'same-origin' });\n\t\t\t\tif (res.ok) {\n\t\t\t\t\tconst json: any = await res.json();\n\t\t\t\t\tconst auths = json?.authenticators || [];\n\t\t\t\t\tauthenticatorsList = auths;\n\t\t\t\t\tconst match = auths.find((a: any) => a.name === deviceName);\n\t\t\t\t\tif (match) {\n\t\t\t\t\t\tdeviceRegistered = true;\n\t\t\t\t\t\tdeviceCredentialID = match.credentialID;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst raw = localStorage.getItem('passkey:preferred');\n\t\t\t\t\t\t\trememberThisDevice = raw\n\t\t\t\t\t\t\t\t? JSON.parse(raw).credentialID === deviceCredentialID\n\t\t\t\t\t\t\t\t: false;\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\trememberThisDevice = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeviceRegistered = false;\n\t\t\t\t\t\tdeviceCredentialID = null;\n\t\t\t\t\t\trememberThisDevice = false;\n\t\t\t\t\t}\n\t\t\t\t\tsessionExpired = false;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (res.status === 401) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst s = await fetch('/api/auth/session', { credentials: 'same-origin' });\n\t\t\t\t\t\tif (s.ok) console.debug('[Passkey] Session endpoint OK; will retry list fetch');\n\t\t\t\t\t} catch (e) {}\n\n\t\t\t\t\tif (attempt < maxAttempts) {\n\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 200 * attempt));\n\t\t\t\t\t\treturn attemptFetch();\n\t\t\t\t\t}\n\n\t\t\t\t\tauthenticatorsList = [];\n\t\t\t\t\tdeviceRegistered = false;\n\t\t\t\t\tdeviceCredentialID = null;\n\t\t\t\t\tif (!silent) sessionExpired = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t} catch (e) {\n\t\t\t\tif (attempt < maxAttempts) {\n\t\t\t\t\tawait new Promise((r) => setTimeout(r, 200 * attempt));\n\t\t\t\t\treturn attemptFetch();\n\t\t\t\t}\n\t\t\t\tauthenticatorsList = [];\n\t\t\t\tdeviceRegistered = false;\n\t\t\t\tdeviceCredentialID = null;\n\t\t\t\tif (!silent) sessionExpired = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\t\tawait attemptFetch();\n\t}\n\n\tasync function unregisterThisDevice() {\n\t\tif (!deviceCredentialID) return;\n\t\t// Show sudo mode confirmation dialog instead of browser confirm\n\t\tpendingRemoveCredentialID = deviceCredentialID;\n\t\tpasskeyRemovePassword = '';\n\t\tpasskeyRemoveError = '';\n\t\tshowPasskeyRemoveConfirm = true;\n\t}\n\n\tasync function confirmPasskeyRemoval() {\n\t\tif (!pendingRemoveCredentialID) return;\n\t\tif (!passkeyRemovePassword) {\n\t\t\tpasskeyRemoveError = 'Please enter your password to confirm.';\n\t\t\treturn;\n\t\t}\n\n\t\tunregistering = true;\n\t\tpasskeyRemoveError = '';\n\t\ttry {\n\t\t\tconst res = await csrfFetch('/api/auth/webauthn/delete', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'same-origin',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tcredentialID: pendingRemoveCredentialID,\n\t\t\t\t\tpassword: passkeyRemovePassword\n\t\t\t\t})\n\t\t\t});\n\t\t\tconst json: any = await res.json();\n\t\t\tif (!res.ok) {\n\t\t\t\tif (res.status === 401) {\n\t\t\t\t\tif (json?.error === 'Invalid password') {\n\t\t\t\t\t\tpasskeyRemoveError = 'Incorrect password. Please try again.';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tsessionExpired = true;\n\t\t\t\t\ttoasts.error('Session expired. Please reload or sign in again.');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (res.status === 403 && json?.requiresPassword) {\n\t\t\t\t\tpasskeyRemoveError = 'Password is required to remove passkeys.';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthrow new Error(json?.error || 'Failed to unregister');\n\t\t\t}\n\n\t\t\tsessionExpired = false;\n\t\t\tshowPasskeyRemoveConfirm = false;\n\t\t\tpasskeyRemovePassword = '';\n\t\t\tpendingRemoveCredentialID = null;\n\t\t\tdispatch('success', 'This device was unregistered');\n\t\t\ttoasts.success('This device was unregistered');\n\n\t\t\ttry {\n\t\t\t\tconst raw = localStorage.getItem('passkey:preferred');\n\t\t\t\tif (raw && JSON.parse(raw).credentialID === deviceCredentialID) {\n\t\t\t\t\tlocalStorage.removeItem('passkey:preferred');\n\t\t\t\t\trememberThisDevice = false;\n\t\t\t\t\ttoasts.info('Quick sign-in preference removed for this device');\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\n\t\t\tdeviceRegistered = false;\n\t\t\tdeviceCredentialID = null;\n\t\t\tawait loadAuthenticators();\n\t\t} catch (err) {\n\t\t\tconsole.error('[Passkey] Unregister failed', err);\n\t\t\tpasskeyRemoveError = 'Failed to unregister this device.';\n\t\t} finally {\n\t\t\tunregistering = false;\n\t\t}\n\t}\n\n\tfunction cancelPasskeyRemoval() {\n\t\tshowPasskeyRemoveConfirm = false;\n\t\tpasskeyRemovePassword = '';\n\t\tpasskeyRemoveError = '';\n\t\tpendingRemoveCredentialID = null;\n\t}\n\n\tasync function registerPasskey() {\n\t\tregistering = true;\n\t\ttry {\n\t\t\tawait loadAuthenticators({ silent: true });\n\t\t\tconst optionsRes = await fetch('/api/auth/webauthn?type=register', {\n\t\t\t\tcredentials: 'same-origin'\n\t\t\t});\n\t\t\tif (optionsRes.status === 401) {\n\t\t\t\tsessionExpired = true;\n\t\t\t\tthrow new Error('Session expired while fetching registration options');\n\t\t\t} else {\n\t\t\t\tsessionExpired = false;\n\t\t\t}\n\n\t\t\tconst rawText = await optionsRes.text();\n\t\t\tlet optionsJson: any;\n\t\t\ttry {\n\t\t\t\toptionsJson = JSON.parse(rawText);\n\t\t\t} catch (e) {\n\t\t\t\tthrow new Error('Invalid registration options response');\n\t\t\t}\n\t\t\tif (!optionsRes.ok)\n\t\t\t\tthrow new Error(optionsJson?.error || 'Failed to get registration options');\n\n\t\t\tconst options: any = optionsJson;\n\t\t\tif (options.user && options.user.id && typeof options.user.id !== 'string') {\n\t\t\t\t// Convert buffer to base64url if needed (logic simplified for brevity as modern browsers handle this well,\n\t\t\t\t// but keeping structure from original)\n\t\t\t}\n\n\t\t\tconst credential = await startRegistration({ optionsJSON: options as any });\n\n\t\t\tconst verifyRes = await csrfFetch('/api/auth/webauthn?type=register', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'same-origin',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ credential, deviceName })\n\t\t\t});\n\n\t\t\tconst verifyResult: any = await verifyRes.json();\n\t\t\tif (!verifyRes.ok) throw new Error(verifyResult.error || 'Registration failed');\n\n\t\t\tdispatch(\n\t\t\t\t'success',\n\t\t\t\t'Passkey registered successfully! You can now sign in with your fingerprint or face.'\n\t\t\t);\n\t\t\ttoasts.success('Passkey registered successfully!');\n\n\t\t\tif (verifyResult?.authenticator) {\n\t\t\t\tauthenticatorsList = [...(authenticatorsList || []), verifyResult.authenticator];\n\t\t\t\tif (verifyResult.authenticator.name === deviceName) {\n\t\t\t\t\tdeviceRegistered = true;\n\t\t\t\t\tdeviceCredentialID = verifyResult.authenticator.credentialID;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tawait loadAuthenticators();\n\t\t\t}\n\t\t} catch (error: any) {\n\t\t\tconsole.error('[Passkey] Registration error:', error);\n\t\t\tlet message = 'Failed to register passkey';\n\t\t\tif (error.name === 'NotAllowedError') message = 'Registration was cancelled or timed out';\n\t\t\telse if (error.name === 'NotSupportedError')\n\t\t\t\tmessage = 'Your device does not support passkeys';\n\t\t\telse if (error.message) message = error.message;\n\t\t\ttoasts.error(message);\n\t\t} finally {\n\t\t\tregistering = false;\n\t\t}\n\t}\n\n\tonMount(async () => {\n\t\tdeviceName = getDeviceName();\n\t\t// Simple session check before loading\n\t\ttry {\n\t\t\tconst s = await fetch('/api/auth/session', { credentials: 'same-origin' });\n\t\t\tif (s.ok) await loadAuthenticators();\n\t\t\telse sessionExpired = true;\n\t\t} catch (e) {\n\t\t\tsessionExpired = true;\n\t\t}\n\t});\n</script>\n\n<div class=\"card-stack\">\n\t<CollapsibleCard\n\t\ttitle=\"Security\"\n\t\tsubtitle=\"Password and authentication\"\n\t\tstorageKey=\"settings:security\"\n\t>\n\t\t{#snippet icon()}\n\t\t\t<span>\n\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M15 7H14V5C14 3.67392 13.4732 2.40215 12.5355 1.46447C11.5979 0.526784 10.3261 0 9 0C7.67392 0 6.40215 0.526784 5.46447 1.46447C4.52678 2.40215 4 3.67392 4 5V7H3C2.46957 7 1.96086 7.21071 1.58579 7.58579C1.21071 7.96086 1 8.46957 1 9V17C1 17.5304 1.21071 18.0391 1.58579 18.4142C1.96086 18.7893 2.46957 19 3 19H15C15.5304 19 16.0391 18.7893 16.4142 18.4142C16.7893 18.0391 17 17.5304 17 17V9C17 8.46957 16.7893 7.96086 16.4142 7.58579C16.0391 7.21071 15.5304 7 15 7ZM6 5C6 4.20435 6.31607 3.44129 6.87868 2.87868C7.44129 2.31607 8.20435 2 9 2C9.79565 2 10.5587 2.31607 11.1213 2.87868C11.6839 3.44129 12 4.20435 12 5V7H6V5Z\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</span>\n\t\t{/snippet}\n\n\t\t{#if !showPasswordChange}\n\t\t\t<button class=\"btn-secondary\" on:click={() => (showPasswordChange = true)}\n\t\t\t\t>Change Password</button\n\t\t\t>\n\t\t{:else}\n\t\t\t<div class=\"password-change\">\n\t\t\t\t{#if passwordError}<div class=\"alert error\">{passwordError}</div>{/if}\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"curr-pass\">Current Password</label><input\n\t\t\t\t\t\tid=\"curr-pass\"\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tbind:value={passwordData.current}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"new-pass\">New Password</label><input\n\t\t\t\t\t\tid=\"new-pass\"\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tbind:value={passwordData.new}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"confirm-pass\">Confirm New Password</label><input\n\t\t\t\t\t\tid=\"confirm-pass\"\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tbind:value={passwordData.confirm}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"button-group\">\n\t\t\t\t\t<button class=\"btn-primary\" on:click={changePassword}>Update</button>\n\t\t\t\t\t<button class=\"btn-secondary\" on:click={() => (showPasswordChange = false)}>Cancel</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"divider\"></div>\n\n\t\t<div class=\"passkey-section\">\n\t\t\t<div>\n\t\t\t\t<h3 style=\"font-size: 15px; font-weight: 600; color: #111827; margin-bottom: 4px;\">\n\t\t\t\t\tBiometric Login\n\t\t\t\t</h3>\n\t\t\t\t<p style=\"font-size: 13px; color: #6B7280; margin-bottom: 12px;\">\n\t\t\t\t\tEnable Face ID or Touch ID for faster login.\n\t\t\t\t</p>\n\t\t\t\t<p style=\"font-size: 12px; color: #6B7280; margin-top: 6px;\">\n\t\t\t\t\tThis device: <strong>{deviceName}</strong>{#if deviceRegistered}\n\t\t\t\t\t\t— <em>Registered</em>{/if}\n\t\t\t\t</p>\n\t\t\t\t{#if sessionExpired}\n\t\t\t\t\t<div class=\"alert warning\" style=\"margin-top:8px;\">\n\t\t\t\t\t\tYour session may have expired. <button\n\t\t\t\t\t\t\tclass=\"linkish\"\n\t\t\t\t\t\t\ton:click={() => location.reload()}>Reload</button\n\t\t\t\t\t\t>\n\t\t\t\t\t\tor <a href=\"/logout\">sign in</a> again to manage passkeys.\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t{#if deviceRegistered}\n\t\t\t\t<button\n\t\t\t\t\tclass=\"btn-secondary\"\n\t\t\t\t\ton:click={unregisterThisDevice}\n\t\t\t\t\tdisabled={unregistering || showPasskeyRemoveConfirm}\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstyle=\"margin-right: 8px;\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path d=\"M3 6h18M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6M10 11v6M14 11v6M9 6V4h6v2\" />\n\t\t\t\t\t</svg>\n\t\t\t\t\t{unregistering ? 'Unregistering...' : 'Unregister This Device'}\n\t\t\t\t</button>\n\n\t\t\t\t{#if showPasskeyRemoveConfirm}\n\t\t\t\t\t<div class=\"delete-confirmation\" style=\"margin-top: 12px;\">\n\t\t\t\t\t\t<p class=\"delete-warning\">To confirm passkey removal, please enter your password:</p>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\t\tbind:value={passkeyRemovePassword}\n\t\t\t\t\t\t\tplaceholder=\"Enter your password\"\n\t\t\t\t\t\t\tclass=\"delete-input\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{#if passkeyRemoveError}<p class=\"error-text\">{passkeyRemoveError}</p>{/if}\n\n\t\t\t\t\t\t<div class=\"button-group\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"btn-delete-confirm\"\n\t\t\t\t\t\t\t\ton:click={confirmPasskeyRemoval}\n\t\t\t\t\t\t\t\tdisabled={unregistering}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{unregistering ? 'Removing...' : 'Confirm Removal'}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button class=\"btn-secondary\" on:click={cancelPasskeyRemoval} disabled={unregistering}\n\t\t\t\t\t\t\t\t>Cancel</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<div style=\"margin-top: 8px; display:flex; align-items:center; gap:10px;\">\n\t\t\t\t\t<label style=\"display:flex; align-items:center; gap:8px; font-size:13px; color:#374151;\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\tbind:checked={rememberThisDevice}\n\t\t\t\t\t\t\ton:change={() => {\n\t\t\t\t\t\t\t\tif (rememberThisDevice && deviceCredentialID) {\n\t\t\t\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\t\t\t'passkey:preferred',\n\t\t\t\t\t\t\t\t\t\tJSON.stringify({ credentialID: deviceCredentialID, name: deviceName })\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\ttoasts.success('Quick sign-in enabled on this device');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlocalStorage.removeItem('passkey:preferred');\n\t\t\t\t\t\t\t\t\ttoasts.success('Quick sign-in disabled on this device');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\tRemember this device for quick sign-in\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<button class=\"btn-secondary\" on:click={registerPasskey} disabled={registering}>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstyle=\"margin-right: 8px;\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t{registering ? 'Registering...' : 'Register Device'}\n\t\t\t\t</button>\n\t\t\t{/if}\n\t\t</div>\n\t</CollapsibleCard>\n\n\t<CollapsibleCard\n\t\ttitle=\"Account Actions\"\n\t\tsubtitle=\"Sign out or delete account\"\n\t\tstorageKey=\"settings:account-actions\"\n\t>\n\t\t{#snippet icon()}\n\t\t\t<span>\n\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M7 17H3C2.46957 17 1.96086 16.7893 1.58579 16.4142C1.21071 16.0391 1 15.5304 1 15V3C1 2.46957 1.21071 1.96086 1.58579 1.58579C1.96086 1.21071 2.46957 1 3 1H7M13 13L17 9M17 9L13 5M17 9H7\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</span>\n\t\t{/snippet}\n\t\t<div>\n\t\t\t<h2 class=\"card-title\">Account Actions</h2>\n\t\t\t<p class=\"card-subtitle\">Sign out or delete account</p>\n\t\t</div>\n\n\t\t<div class=\"danger-actions\">\n\t\t\t<button class=\"btn-logout\" on:click={handleLogout}>Logout</button>\n\n\t\t\t{#if !showDeleteConfirm}\n\t\t\t\t<button class=\"btn-delete\" on:click={() => (showDeleteConfirm = true)}\n\t\t\t\t\t>Delete Account</button\n\t\t\t\t>\n\t\t\t{:else}\n\t\t\t\t<div class=\"delete-confirmation\">\n\t\t\t\t\t<p class=\"delete-warning\">To verify, please enter your password:</p>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tbind:value={deletePassword}\n\t\t\t\t\t\tplaceholder=\"Enter your password\"\n\t\t\t\t\t\tclass=\"delete-input\"\n\t\t\t\t\t/>\n\t\t\t\t\t{#if deleteError}<p class=\"error-text\">{deleteError}</p>{/if}\n\n\t\t\t\t\t<div class=\"button-group\">\n\t\t\t\t\t\t<button class=\"btn-delete-confirm\" on:click={handleDeleteAccount} disabled={isDeleting}>\n\t\t\t\t\t\t\t{isDeleting ? 'Deleting...' : 'Permanently Delete Account'}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-secondary\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tshowDeleteConfirm = false;\n\t\t\t\t\t\t\t\tdeletePassword = '';\n\t\t\t\t\t\t\t\tdeleteError = '';\n\t\t\t\t\t\t\t}}>Cancel</button\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</CollapsibleCard>\n</div>\n\n<style>\n\t.card-title {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 4px;\n\t}\n\t.card-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t}\n\t.form-group {\n\t\tmargin-bottom: 20px;\n\t}\n\t.form-group label {\n\t\tdisplay: block;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 8px;\n\t}\n\t.form-group input {\n\t\twidth: 100%;\n\t\tmax-width: 450px;\n\t\tpadding: 12px 16px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 16px;\n\t\tdisplay: block;\n\t\tbox-sizing: border-box;\n\t}\n\t.btn-primary {\n\t\tbackground: linear-gradient(135deg, var(--orange, #ff6a3d) 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\twidth: 100%;\n\t\tpadding: 14px;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t}\n\t.btn-secondary {\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t\tborder: 2px solid #e5e7eb;\n\t\twidth: 100%;\n\t\tpadding: 14px;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t}\n\t.btn-logout {\n\t\tbackground: white;\n\t\tcolor: #dc2626;\n\t\tborder: 2px solid #fee2e2;\n\t\twidth: 100%;\n\t\tpadding: 14px;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t}\n\t.btn-delete {\n\t\tbackground: transparent;\n\t\tcolor: #dc2626;\n\t\tborder: none;\n\t\tmargin-top: 12px;\n\t\tfont-size: 14px;\n\t\ttext-decoration: underline;\n\t\tcursor: pointer;\n\t}\n\t.delete-confirmation {\n\t\tmargin-top: 16px;\n\t\tpadding: 16px;\n\t\tbackground: white;\n\t\tborder-radius: 10px;\n\t\tborder: 1px solid #fecaca;\n\t}\n\t.delete-input {\n\t\twidth: 100%;\n\t\tpadding: 10px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tmargin-bottom: 12px;\n\t}\n\t.btn-delete-confirm {\n\t\tbackground: #dc2626;\n\t\tcolor: white;\n\t\tborder: none;\n\t\tmargin-bottom: 8px;\n\t\twidth: 100%;\n\t\tpadding: 14px;\n\t\tborder-radius: 10px;\n\t\tfont-weight: 600;\n\t}\n\t.alert {\n\t\tpadding: 14px 20px;\n\t\tborder-radius: 12px;\n\t\tfont-size: 14px;\n\t\tfont-weight: 500;\n\t\tmargin-bottom: 24px;\n\t}\n\t.alert.error {\n\t\tbackground: #fef2f2;\n\t\tcolor: #991b1b;\n\t\tborder: 1px solid #fecaca;\n\t}\n\t.alert.warning {\n\t\tbackground: #fff7ed;\n\t\tcolor: #c2410c;\n\t\tborder: 1px solid #fed7aa;\n\t}\n\t.card-stack {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24px;\n\t}\n\n\t.divider {\n\t\theight: 1px;\n\t\tbackground: #e5e7eb;\n\t\tmargin: 24px 0;\n\t}\n\t.button-group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\t.linkish {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcolor: var(--orange, #ff6a3d);\n\t\ttext-decoration: underline;\n\t\tcursor: pointer;\n\t\tpadding: 0;\n\t\tfont: inherit;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\lib\\export-utils-pdf.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 4,
				"column": 27,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 4,
				"endColumn": 30,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [206, 209], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [206, 209], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 9,
				"column": 47,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 9,
				"endColumn": 50,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [432, 435], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [432, 435], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 43,
				"column": 51,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 43,
				"endColumn": 54,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1531, 1534], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1531, 1534], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 45,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 45,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1625, 1628], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1625, 1628], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 46,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 46,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1677, 1680], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1677, 1680], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 50,
				"column": 20,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 50,
				"endColumn": 23,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1785, 1788], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1785, 1788], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 81,
				"column": 37,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 81,
				"endColumn": 40,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3100, 3103], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3100, 3103], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 84,
				"column": 26,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 84,
				"endColumn": 29,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3202, 3205], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3202, 3205], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 94,
				"column": 43,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 94,
				"endColumn": 46,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3472, 3475], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3472, 3475], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 158,
				"column": 32,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 158,
				"endColumn": 35,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5055, 5058], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5055, 5058], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 10,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { getLogoDataUrl, formatCurrency, formatDuration, formatDate } from './export-utils';\n\n// export a lightweight type for jsPDF so callers can use it without extra types here\nexport type PdfDocument = any;\n\n// Re-export other PDF helpers for convenience so the ExportModal can import them from one place\nexport { generateExpensesPDF, generateTaxBundlePDF } from './export-utils';\n\nexport async function generateTripsPDF(trips: any[], dateRangeStr: string): Promise<PdfDocument> {\n\tconst { jsPDF } = await import('jspdf');\n\tconst autoTable = (await import('jspdf-autotable')).default;\n\tconst doc = new jsPDF();\n\tconst logoData = await getLogoDataUrl();\n\tconst pageWidth = doc.internal.pageSize.getWidth();\n\n\t// Header\n\tdoc.setFillColor(255, 127, 80); // Orange\n\tdoc.rect(0, 0, pageWidth, 35, 'F');\n\n\tif (logoData) {\n\t\tdoc.addImage(logoData, 'PNG', 10, 5, 25, 25);\n\t}\n\n\tdoc.setTextColor(255, 255, 255);\n\tdoc.setFontSize(24);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Trip Report', pageWidth / 2, 15, { align: 'center' });\n\n\tdoc.setFontSize(11);\n\tdoc.setFont('helvetica', 'normal');\n\tdoc.text('Go Route Yourself - Professional Route Tracking', pageWidth / 2, 23, {\n\t\talign: 'center'\n\t});\n\n\t// Report metadata\n\tdoc.setTextColor(0, 0, 0);\n\tdoc.setFontSize(9);\n\tdoc.text(`Period: ${dateRangeStr}`, 14, 42);\n\tdoc.text(`Generated: ${new Date().toLocaleString()}`, 14, 47);\n\tdoc.text(`Total Trips: ${trips.length}`, pageWidth - 14, 42, { align: 'right' });\n\n\t// Summary statistics\n\tconst totalMiles = trips.reduce((sum: number, t: any) => sum + (t.totalMiles || 0), 0);\n\tconst totalRevenue = trips.reduce(\n\t\t(sum: number, t: any) =>\n\t\t\tsum + (t.stops?.reduce((s: number, stop: any) => s + (stop.earnings || 0), 0) || 0),\n\t\t0\n\t);\n\tconst totalExpenses = trips.reduce(\n\t\t(sum: number, t: any) =>\n\t\t\tsum + (t.fuelCost || 0) + (t.maintenanceCost || 0) + (t.suppliesCost || 0),\n\t\t0\n\t);\n\tconst netProfit = totalRevenue - totalExpenses;\n\n\tdoc.setFillColor(248, 250, 252);\n\tdoc.roundedRect(14, 52, pageWidth - 28, 28, 3, 3, 'FD');\n\n\tdoc.setFontSize(10);\n\tdoc.setFont('helvetica', 'bold');\n\tconst statY = 60;\n\tconst colWidth = (pageWidth - 28) / 4;\n\n\tdoc.text('Total Miles', 14 + colWidth * 0.5, statY, { align: 'center' });\n\tdoc.text('Total Revenue', 14 + colWidth * 1.5, statY, { align: 'center' });\n\tdoc.text('Total Expenses', 14 + colWidth * 2.5, statY, { align: 'center' });\n\tdoc.text('Net Profit', 14 + colWidth * 3.5, statY, { align: 'center' });\n\n\tdoc.setFontSize(14);\n\tdoc.setTextColor(255, 127, 80);\n\tdoc.text(totalMiles.toFixed(1), 14 + colWidth * 0.5, statY + 10, { align: 'center' });\n\tdoc.setTextColor(34, 197, 94);\n\tdoc.text(formatCurrency(totalRevenue), 14 + colWidth * 1.5, statY + 10, { align: 'center' });\n\tdoc.setTextColor(239, 68, 68);\n\tdoc.text(formatCurrency(totalExpenses), 14 + colWidth * 2.5, statY + 10, { align: 'center' });\n\tdoc.setTextColor(netProfit >= 0 ? 34 : 239, netProfit >= 0 ? 197 : 68, netProfit >= 0 ? 94 : 68);\n\tdoc.text(formatCurrency(netProfit), 14 + colWidth * 3.5, statY + 10, { align: 'center' });\n\n\tdoc.setTextColor(0, 0, 0);\n\n\tconst tableData = trips.map((trip: any) => {\n\t\tconst intermediateStops =\n\t\t\ttrip.stops && trip.stops.length > 0\n\t\t\t\t? trip.stops.map((s: any) => s.address).join('\\n')\n\t\t\t\t: 'None';\n\n\t\tconst endAddr =\n\t\t\ttrip.endAddress ||\n\t\t\t(trip.stops && trip.stops.length > 0 ? trip.stops[trip.stops.length - 1].address : '') ||\n\t\t\ttrip.startAddress ||\n\t\t\t'';\n\n\t\tconst revenue =\n\t\t\ttrip.stops?.reduce((sum: number, stop: any) => sum + (stop.earnings || 0), 0) || 0;\n\t\tconst expenses = (trip.fuelCost || 0) + (trip.maintenanceCost || 0) + (trip.suppliesCost || 0);\n\t\tconst profit = revenue - expenses;\n\n\t\treturn [\n\t\t\tformatDate(trip.date || ''),\n\t\t\ttrip.startAddress || '',\n\t\t\tintermediateStops,\n\t\t\tendAddr,\n\t\t\t(trip.totalMiles || 0).toFixed(1) + ' mi',\n\t\t\tformatDuration(trip.estimatedTime || 0),\n\t\t\t(trip.hoursWorked || 0).toFixed(1) + ' hr',\n\t\t\tformatCurrency(revenue),\n\t\t\tformatCurrency(expenses),\n\t\t\tformatCurrency(profit)\n\t\t];\n\t});\n\n\tautoTable(doc, {\n\t\tstartY: 85,\n\t\thead: [\n\t\t\t[\n\t\t\t\t'Date',\n\t\t\t\t'Start',\n\t\t\t\t'Stops',\n\t\t\t\t'End',\n\t\t\t\t'Miles',\n\t\t\t\t'Drive Time',\n\t\t\t\t'Hours',\n\t\t\t\t'Revenue',\n\t\t\t\t'Expenses',\n\t\t\t\t'Profit'\n\t\t\t]\n\t\t],\n\t\tbody: tableData,\n\t\ttheme: 'striped',\n\t\theadStyles: {\n\t\t\tfillColor: [255, 127, 80],\n\t\t\ttextColor: [255, 255, 255],\n\t\t\tfontSize: 9,\n\t\t\tfontStyle: 'bold',\n\t\t\thalign: 'center'\n\t\t},\n\t\tstyles: {\n\t\t\tfontSize: 8,\n\t\t\tcellPadding: 3,\n\t\t\toverflow: 'linebreak',\n\t\t\tlineColor: [229, 231, 235],\n\t\t\tlineWidth: 0.1\n\t\t},\n\t\tcolumnStyles: {\n\t\t\t0: { cellWidth: 20 },\n\t\t\t1: { cellWidth: 30 },\n\t\t\t2: { cellWidth: 30 },\n\t\t\t3: { cellWidth: 30 },\n\t\t\t4: { halign: 'right', cellWidth: 15 },\n\t\t\t5: { halign: 'center', cellWidth: 18 },\n\t\t\t6: { halign: 'right', cellWidth: 15 },\n\t\t\t7: { halign: 'right', cellWidth: 20, textColor: [34, 197, 94] },\n\t\t\t8: { halign: 'right', cellWidth: 20, textColor: [239, 68, 68] },\n\t\t\t9: { halign: 'right', cellWidth: 20, fontStyle: 'bold' }\n\t\t},\n\t\talternateRowStyles: { fillColor: [249, 250, 251] },\n\t\tmargin: { left: 14, right: 14 },\n\t\tdidDrawPage: function (data: any) {\n\t\t\tconst pageCount = doc.internal.pages.length - 1;\n\t\t\tdoc.setFontSize(8);\n\t\t\tdoc.setTextColor(128, 128, 128);\n\t\t\tdoc.text(\n\t\t\t\t`Page ${data.pageNumber} of ${pageCount}`,\n\t\t\t\tpageWidth / 2,\n\t\t\t\tdoc.internal.pageSize.getHeight() - 10,\n\t\t\t\t{ align: 'center' }\n\t\t\t);\n\t\t\tdoc.text(\n\t\t\t\t'Go Route Yourself - Professional Route Tracking',\n\t\t\t\tpageWidth - 14,\n\t\t\t\tdoc.internal.pageSize.getHeight() - 10,\n\t\t\t\t{ align: 'right' }\n\t\t\t);\n\t\t}\n\t});\n\n\treturn doc;\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\lib\\export-utils.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 58,
				"column": 41,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 58,
				"endColumn": 44,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1664, 1667], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1664, 1667], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 89,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 89,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2451, 2454], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2451, 2454], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 105,
				"column": 43,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 105,
				"endColumn": 46,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3089, 3092], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3089, 3092], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 110,
				"column": 40,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 110,
				"endColumn": 43,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3298, 3301], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3298, 3301], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 116,
				"column": 25,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 116,
				"endColumn": 28,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3530, 3533], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3530, 3533], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 150,
				"column": 46,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 150,
				"endColumn": 49,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4415, 4418], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4415, 4418], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 187,
				"column": 12,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 187,
				"endColumn": 15,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5039, 5042], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5039, 5042], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 188,
				"column": 9,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 188,
				"endColumn": 12,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5054, 5057], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5054, 5057], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 220,
				"column": 41,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 220,
				"endColumn": 44,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5832, 5835], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5832, 5835], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 239,
				"column": 26,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 239,
				"endColumn": 29,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6325, 6328], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6325, 6328], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 306,
				"column": 45,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 306,
				"endColumn": 48,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8176, 8179], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8176, 8179], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 306,
				"column": 62,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 306,
				"endColumn": 65,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8193, 8196], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8193, 8196], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 311,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 311,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8434, 8437], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8434, 8437], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 318,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 318,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8819, 8822], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8819, 8822], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 324,
				"column": 51,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 324,
				"endColumn": 54,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [9114, 9117], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [9114, 9117], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 362,
				"column": 53,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 362,
				"endColumn": 56,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [10567, 10570], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [10567, 10570], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 362,
				"column": 67,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 362,
				"endColumn": 70,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [10581, 10584], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [10581, 10584], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 369,
				"column": 27,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 369,
				"endColumn": 30,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [10864, 10867], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [10864, 10867], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 390,
				"column": 41,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 390,
				"endColumn": 44,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [11349, 11352], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [11349, 11352], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 410,
				"column": 26,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 410,
				"endColumn": 29,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [11835, 11838], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [11835, 11838], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 522,
				"column": 32,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 522,
				"endColumn": 35,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [15078, 15081], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [15078, 15081], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 538,
				"column": 51,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 538,
				"endColumn": 54,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [15425, 15428], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [15425, 15428], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 538,
				"column": 68,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 538,
				"endColumn": 71,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [15442, 15445], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [15442, 15445], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 571,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 571,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16536, 16539], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16536, 16539], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 578,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 578,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [16921, 16924], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [16921, 16924], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 584,
				"column": 51,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 584,
				"endColumn": 54,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [17216, 17219], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [17216, 17219], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 26,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// Lazy-load heavy PDF libs only when needed to avoid inflating the initial bundle\n\n// SECURITY: Prevent CSV Formula Injection\n/**\n * Sanitizes CSV field to prevent formula injection attacks\n * Excel/Sheets interpret cells starting with =, +, -, @, or tab as formulas\n * @param value - The value to sanitize\n * @returns Sanitized value safe for CSV export\n */\nfunction sanitizeCSVField(value: string | number | null | undefined): string {\n\tif (value === null || value === undefined) return '';\n\tconst str = String(value);\n\n\t// If starts with dangerous characters, prefix with single quote\n\tif (str.length > 0 && /^[=+\\-@\\t]/.test(str)) {\n\t\treturn `'${str}`;\n\t}\n\n\treturn str;\n}\n\n// Helper functions\nexport function formatCurrency(amount: number): string {\n\treturn `$${amount.toFixed(2)}`;\n}\n\nexport function formatDuration(minutes: number): string {\n\tif (!minutes) return '0m';\n\tconst h = Math.floor(minutes / 60);\n\tconst m = Math.round(minutes % 60);\n\tif (h > 0) return `${h}h ${m}m`;\n\treturn `${m}m`;\n}\n\nexport function formatDate(dateStr: string): string {\n\tif (!dateStr) return '';\n\tconst date = new Date(dateStr);\n\treturn date.toLocaleDateString();\n}\n\nexport async function getLogoDataUrl(): Promise<string | null> {\n\ttry {\n\t\tconst response = await fetch('/180x75.avif');\n\t\tif (!response.ok) return null;\n\t\tconst blob = await response.blob();\n\t\treturn new Promise((resolve) => {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onloadend = () => resolve(reader.result as string);\n\t\t\treader.readAsDataURL(blob);\n\t\t});\n\t} catch (e) {\n\t\tconsole.warn('Could not load logo for PDF', e);\n\t\treturn null;\n\t}\n}\n\n// Export Functions\nexport function generateTripsCSV(trips: any[], includeSummary: boolean = true): string | null {\n\tif (trips.length === 0) return null;\n\n\tconst headers = [\n\t\t'Date',\n\t\t'Start Address',\n\t\t'Intermediate Stops',\n\t\t'End Address',\n\t\t'Total Miles',\n\t\t'Drive Time',\n\t\t'Hours Worked',\n\t\t'Hourly Pay ($/hr)',\n\t\t'Total Revenue',\n\t\t'Fuel Cost',\n\t\t'Maintenance Cost',\n\t\t'Maintenance Items',\n\t\t'Supply Cost',\n\t\t'Supply Items',\n\t\t'Total Expenses',\n\t\t'Net Profit',\n\t\t'Notes'\n\t];\n\n\tconst rows = trips.map((trip) => {\n\t\tconst date = trip.date ? new Date(trip.date).toLocaleDateString() : '';\n\t\t// SECURITY: Sanitize user addresses to prevent formula injection\n\t\tconst start = `\"${sanitizeCSVField(trip.startAddress || '').replace(/\"/g, '\"\"')}\"`;\n\n\t\tconst intermediateStops =\n\t\t\ttrip.stops && trip.stops.length > 0\n\t\t\t\t? trip.stops\n\t\t\t\t\t\t.map((s: any) => `${sanitizeCSVField(s.address)} ($${(s.earnings || 0).toFixed(2)})`)\n\t\t\t\t\t\t.join(' | ')\n\t\t\t\t: '';\n\t\tconst stopsStr = `\"${intermediateStops.replace(/\"/g, '\"\"')}\"`;\n\n\t\tconst rawEnd =\n\t\t\ttrip.endAddress ||\n\t\t\t(trip.stops && trip.stops.length > 0 ? trip.stops[trip.stops.length - 1].address : '') ||\n\t\t\ttrip.startAddress;\n\t\tconst end = `\"${sanitizeCSVField(rawEnd || '').replace(/\"/g, '\"\"')}\"`;\n\n\t\tconst miles = (trip.totalMiles || 0).toFixed(1);\n\t\tconst driveTime = `\"${formatDuration(trip.estimatedTime || 0)}\"`;\n\t\tconst hoursWorked = (trip.hoursWorked || 0).toFixed(1);\n\n\t\tconst revenue =\n\t\t\ttrip.stops?.reduce((sum: number, stop: any) => sum + (stop.earnings || 0), 0) || 0;\n\t\tconst fuel = trip.fuelCost || 0;\n\n\t\tconst maint = trip.maintenanceCost || 0;\n\t\tconst maintItemsStr = trip.maintenanceItems\n\t\t\t? `\"${trip.maintenanceItems.map((i: any) => `${sanitizeCSVField(i.type)}:${i.cost}`).join(' | ')}\"`\n\t\t\t: '\"\"';\n\n\t\tconst supplies = trip.suppliesCost || 0;\n\t\tconst sItems = trip.suppliesItems || trip.supplyItems;\n\t\tconst supplyItemsStr = sItems\n\t\t\t? `\"${sItems.map((i: any) => `${sanitizeCSVField(i.type)}:${i.cost}`).join(' | ')}\"`\n\t\t\t: '\"\"';\n\n\t\tconst totalExpenses = fuel + maint + supplies;\n\t\tconst netProfit = revenue - totalExpenses;\n\t\tconst hourlyPay = trip.hoursWorked > 0 ? netProfit / trip.hoursWorked : 0;\n\t\t// SECURITY: Sanitize notes field\n\t\tconst notes = `\"${sanitizeCSVField(trip.notes || '').replace(/\"/g, '\"\"')}\"`;\n\n\t\treturn [\n\t\t\tdate,\n\t\t\tstart,\n\t\t\tstopsStr,\n\t\t\tend,\n\t\t\tmiles,\n\t\t\tdriveTime,\n\t\t\thoursWorked,\n\t\t\thourlyPay.toFixed(2),\n\t\t\trevenue.toFixed(2),\n\t\t\tfuel.toFixed(2),\n\t\t\tmaint.toFixed(2),\n\t\t\tmaintItemsStr,\n\t\t\tsupplies.toFixed(2),\n\t\t\tsupplyItemsStr,\n\t\t\ttotalExpenses.toFixed(2),\n\t\t\tnetProfit.toFixed(2),\n\t\t\tnotes\n\t\t].join(',');\n\t});\n\n\tif (includeSummary) {\n\t\tconst totalMiles = trips.reduce((sum, t) => sum + (t.totalMiles || 0), 0);\n\t\tconst totalRevenue = trips.reduce(\n\t\t\t(sum, t) =>\n\t\t\t\tsum + (t.stops?.reduce((s: number, stop: any) => s + (stop.earnings || 0), 0) || 0),\n\t\t\t0\n\t\t);\n\t\tconst totalExpenses = trips.reduce(\n\t\t\t(sum, t) => sum + (t.fuelCost || 0) + (t.maintenanceCost || 0) + (t.suppliesCost || 0),\n\t\t\t0\n\t\t);\n\t\tconst netProfit = totalRevenue - totalExpenses;\n\n\t\trows.push('');\n\t\trows.push(\n\t\t\t[\n\t\t\t\t'TOTALS',\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\ttotalMiles.toFixed(1),\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\ttotalRevenue.toFixed(2),\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\ttotalExpenses.toFixed(2),\n\t\t\t\tnetProfit.toFixed(2),\n\t\t\t\t''\n\t\t\t].join(',')\n\t\t);\n\t}\n\n\treturn [headers.join(','), ...rows].join('\\n');\n}\n\nexport function generateExpensesCSV(\n\texpenses: any[],\n\ttrips: any[],\n\tincludeSummary: boolean = true\n): string | null {\n\tconst allExpenses: Array<{\n\t\tdate: string;\n\t\tcategory: string;\n\t\tamount: number;\n\t\tdescription: string;\n\t}> = [];\n\n\t// 1. Add expenses from expense store\n\texpenses.forEach((expense) => {\n\t\tallExpenses.push({\n\t\t\tdate: expense.date,\n\t\t\tcategory: sanitizeCSVField(expense.category),\n\t\t\tamount: expense.amount,\n\t\t\tdescription: sanitizeCSVField(expense.description || '')\n\t\t});\n\t});\n\n\t// 2. Add trip-level expenses\n\ttrips.forEach((trip) => {\n\t\tif (trip.fuelCost && trip.fuelCost > 0) {\n\t\t\tallExpenses.push({\n\t\t\t\tdate: trip.date || '',\n\t\t\t\tcategory: 'Fuel',\n\t\t\t\tamount: trip.fuelCost,\n\t\t\t\tdescription: 'From trip'\n\t\t\t});\n\t\t}\n\t\t// Maintenance\n\t\tif (trip.maintenanceItems?.length > 0) {\n\t\t\ttrip.maintenanceItems.forEach((item: any) => {\n\t\t\t\tallExpenses.push({\n\t\t\t\t\tdate: trip.date || '',\n\t\t\t\t\tcategory: 'Maintenance',\n\t\t\t\t\tamount: item.cost,\n\t\t\t\t\tdescription: sanitizeCSVField(item.type)\n\t\t\t\t});\n\t\t\t});\n\t\t} else if (trip.maintenanceCost > 0) {\n\t\t\tallExpenses.push({\n\t\t\t\tdate: trip.date || '',\n\t\t\t\tcategory: 'Maintenance',\n\t\t\t\tamount: trip.maintenanceCost,\n\t\t\t\tdescription: 'From trip'\n\t\t\t});\n\t\t}\n\t\t// Supplies\n\t\tconst sItems = trip.suppliesItems || trip.supplyItems;\n\t\tif (sItems?.length > 0) {\n\t\t\tsItems.forEach((item: any) => {\n\t\t\t\tallExpenses.push({\n\t\t\t\t\tdate: trip.date || '',\n\t\t\t\t\tcategory: 'Supplies',\n\t\t\t\t\tamount: item.cost,\n\t\t\t\t\tdescription: sanitizeCSVField(item.type)\n\t\t\t\t});\n\t\t\t});\n\t\t} else if (trip.suppliesCost > 0) {\n\t\t\tallExpenses.push({\n\t\t\t\tdate: trip.date || '',\n\t\t\t\tcategory: 'Supplies',\n\t\t\t\tamount: trip.suppliesCost,\n\t\t\t\tdescription: 'From trip'\n\t\t\t});\n\t\t}\n\t});\n\n\tif (allExpenses.length === 0) return null;\n\n\tallExpenses.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n\n\tconst expensesByDate: Record<string, Record<string, number>> = {};\n\tconst categories = new Set<string>();\n\n\tallExpenses.forEach((exp) => {\n\t\tconst dateKey = exp.date ? formatDate(exp.date) : 'Unknown';\n\t\texpensesByDate[dateKey] = expensesByDate[dateKey] ?? {};\n\t\tcategories.add(exp.category);\n\t\texpensesByDate[dateKey][exp.category] =\n\t\t\t(expensesByDate[dateKey][exp.category] || 0) + exp.amount;\n\t});\n\n\tconst categoryList = Array.from(categories).sort();\n\tlet csv = 'Date,' + categoryList.join(',') + ',Daily Total\\n';\n\n\tconst categoryTotals: Record<string, number> = {};\n\tcategoryList.forEach((cat) => (categoryTotals[cat] = 0));\n\tlet grandTotal = 0;\n\n\tObject.entries(expensesByDate).forEach(([date, cats]) => {\n\t\tconst row: string[] = [date];\n\t\tlet dailyTotal = 0;\n\t\tcategoryList.forEach((category) => {\n\t\t\tconst amount = cats[category] ?? 0;\n\t\t\trow.push(amount.toFixed(2));\n\t\t\tcategoryTotals[category] = (categoryTotals[category] || 0) + amount;\n\t\t\tdailyTotal += amount;\n\t\t});\n\t\trow.push(dailyTotal.toFixed(2));\n\t\tgrandTotal += dailyTotal;\n\t\tcsv += row.join(',') + '\\n';\n\t});\n\n\tif (includeSummary) {\n\t\tcsv += '\\n';\n\t\tconst totalRow = [\n\t\t\t'TOTALS',\n\t\t\t...categoryList.map((cat) => (categoryTotals[cat] || 0).toFixed(2)),\n\t\t\tgrandTotal.toFixed(2)\n\t\t];\n\t\tcsv += totalRow.join(',') + '\\n';\n\t}\n\n\treturn csv;\n}\n\nexport function generateTaxBundleCSV(trips: any[], expenses: any[], dateRangeStr: string): string {\n\t// 1. Calculate Summary Data\n\tconst totalMiles = trips.reduce((sum, t) => sum + (t.totalMiles || 0), 0);\n\tconst mileageDeduction = totalMiles * 0.67; // 2024 Standard Mileage Rate\n\n\tconst allExpenses: any[] = [];\n\texpenses.forEach((e) => allExpenses.push({ ...e, source: 'Expense Log' }));\n\ttrips.forEach((t) => {\n\t\tif (t.fuelCost) allExpenses.push({ category: 'Fuel', amount: t.fuelCost, source: 'Trip' });\n\t\tif (t.maintenanceCost)\n\t\t\tallExpenses.push({ category: 'Maintenance', amount: t.maintenanceCost, source: 'Trip' });\n\t\tif (t.maintenanceItems)\n\t\t\tt.maintenanceItems.forEach((i: any) =>\n\t\t\t\tallExpenses.push({ category: 'Maintenance', amount: i.cost, source: 'Trip' })\n\t\t\t);\n\t\tif (t.suppliesCost)\n\t\t\tallExpenses.push({ category: 'Supplies', amount: t.suppliesCost, source: 'Trip' });\n\t\tif (t.suppliesItems || t.supplyItems)\n\t\t\t(t.suppliesItems || t.supplyItems).forEach((i: any) =>\n\t\t\t\tallExpenses.push({ category: 'Supplies', amount: i.cost, source: 'Trip' })\n\t\t\t);\n\t});\n\tconst totalExpenses = allExpenses.reduce((sum, e) => sum + e.amount, 0);\n\n\t// 2. Build CSV\n\tlet csv = `TAX BUNDLE EXPORT - ${dateRangeStr}\\n`;\n\tcsv += `Generated: ${new Date().toLocaleString()}\\n\\n`;\n\n\tcsv += `SUMMARY COMPARISON\\n`;\n\tcsv += `Method,Details,Deduction Value\\n`;\n\tcsv += `Standard Mileage Deduction,${totalMiles.toFixed(1)} miles @ $0.67/mi,${mileageDeduction.toFixed(2)}\\n`;\n\tcsv += `Actual Expenses Deduction,Sum of all business expenses,${totalExpenses.toFixed(2)}\\n\\n`;\n\n\tcsv += `----------------------------------------\\n`;\n\tcsv += `PART 1: MILEAGE LOG\\n`;\n\tcsv += `----------------------------------------\\n`;\n\tconst tripsCsv = generateTripsCSV(trips, false); // Get trips CSV without summary row\n\tif (tripsCsv) csv += tripsCsv + '\\n\\n';\n\telse csv += 'No trips recorded.\\n\\n';\n\n\tcsv += `----------------------------------------\\n`;\n\tcsv += `PART 2: EXPENSE LOG\\n`;\n\tcsv += `----------------------------------------\\n`;\n\tconst expensesCsv = generateExpensesCSV(expenses, trips, false); // Get expenses CSV without summary row\n\tif (expensesCsv) csv += expensesCsv + '\\n';\n\telse csv += 'No expenses recorded.\\n';\n\n\treturn csv;\n}\n\nexport function generateTripsPDF(): never {\n\tthrow new Error(\n\t\t'moved to export-utils-pdf; import dynamically: await import(\"./export-utils-pdf\")'\n\t);\n}\n\nexport async function generateExpensesPDF(expenses: any[], trips: any[], dateRangeStr: string) {\n\tconst { jsPDF } = await import('jspdf');\n\tconst autoTable = (await import('jspdf-autotable')).default;\n\tconst doc = new jsPDF();\n\tconst logoData = await getLogoDataUrl();\n\tconst pageWidth = doc.internal.pageSize.getWidth();\n\n\tconst allExpenses: Array<any> = [];\n\texpenses.forEach((exp) =>\n\t\tallExpenses.push({\n\t\t\tdate: exp.date,\n\t\t\tcategory: exp.category,\n\t\t\tamount: exp.amount,\n\t\t\tdescription: exp.description || '',\n\t\t\tsource: 'Expense Log'\n\t\t})\n\t);\n\n\ttrips.forEach((trip) => {\n\t\tif (trip.fuelCost > 0)\n\t\t\tallExpenses.push({\n\t\t\t\tdate: trip.date,\n\t\t\t\tcategory: 'Fuel',\n\t\t\t\tamount: trip.fuelCost,\n\t\t\t\tdescription: 'From trip',\n\t\t\t\tsource: 'Trip'\n\t\t\t});\n\t\tif (trip.maintenanceItems?.length > 0) {\n\t\t\ttrip.maintenanceItems.forEach((item: any) =>\n\t\t\t\tallExpenses.push({\n\t\t\t\t\tdate: trip.date,\n\t\t\t\t\tcategory: 'Maintenance',\n\t\t\t\t\tamount: item.cost,\n\t\t\t\t\tdescription: item.type,\n\t\t\t\t\tsource: 'Trip'\n\t\t\t\t})\n\t\t\t);\n\t\t} else if (trip.maintenanceCost > 0) {\n\t\t\tallExpenses.push({\n\t\t\t\tdate: trip.date,\n\t\t\t\tcategory: 'Maintenance',\n\t\t\t\tamount: trip.maintenanceCost,\n\t\t\t\tdescription: 'From trip',\n\t\t\t\tsource: 'Trip'\n\t\t\t});\n\t\t}\n\t\tconst sItems = trip.suppliesItems || trip.supplyItems;\n\t\tif (sItems?.length > 0) {\n\t\t\tsItems.forEach((item: any) =>\n\t\t\t\tallExpenses.push({\n\t\t\t\t\tdate: trip.date,\n\t\t\t\t\tcategory: 'Supplies',\n\t\t\t\t\tamount: item.cost,\n\t\t\t\t\tdescription: item.type,\n\t\t\t\t\tsource: 'Trip'\n\t\t\t\t})\n\t\t\t);\n\t\t} else if (trip.suppliesCost > 0) {\n\t\t\tallExpenses.push({\n\t\t\t\tdate: trip.date,\n\t\t\t\tcategory: 'Supplies',\n\t\t\t\tamount: trip.suppliesCost,\n\t\t\t\tdescription: 'From trip',\n\t\t\t\tsource: 'Trip'\n\t\t\t});\n\t\t}\n\t});\n\n\tallExpenses.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n\n\tdoc.setFillColor(255, 127, 80);\n\tdoc.rect(0, 0, pageWidth, 35, 'F');\n\tif (logoData) doc.addImage(logoData, 'PNG', 10, 5, 25, 25);\n\n\tdoc.setTextColor(255, 255, 255);\n\tdoc.setFontSize(24);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Expense Report', pageWidth / 2, 15, { align: 'center' });\n\tdoc.setFontSize(11);\n\tdoc.setFont('helvetica', 'normal');\n\tdoc.text('Go Route Yourself - Professional Route Tracking', pageWidth / 2, 23, {\n\t\talign: 'center'\n\t});\n\n\tdoc.setTextColor(0, 0, 0);\n\tdoc.setFontSize(9);\n\tdoc.text(`Period: ${dateRangeStr}`, 14, 42);\n\tdoc.text(`Generated: ${new Date().toLocaleString()}`, 14, 47);\n\tdoc.text(`Total Expenses: ${allExpenses.length}`, pageWidth - 14, 42, { align: 'right' });\n\n\tconst categoryTotals: Record<string, number> = {};\n\tlet grandTotal = 0;\n\tallExpenses.forEach((exp) => {\n\t\tif (!categoryTotals[exp.category]) categoryTotals[exp.category] = 0;\n\t\tcategoryTotals[exp.category] += exp.amount;\n\t\tgrandTotal += exp.amount;\n\t});\n\n\tdoc.setFillColor(248, 250, 252);\n\tconst categoryCount = Object.keys(categoryTotals).length;\n\tconst boxHeight = 12 + categoryCount * 6 + 8;\n\tdoc.roundedRect(14, 52, pageWidth - 28, boxHeight, 3, 3, 'FD');\n\n\tdoc.setFontSize(11);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Summary by Category', 20, 60);\n\n\tdoc.setFontSize(9);\n\tdoc.setFont('helvetica', 'normal');\n\tlet yPos = 68;\n\tObject.entries(categoryTotals).forEach(([category, total]) => {\n\t\tdoc.text(category, 20, yPos);\n\t\tdoc.text(formatCurrency(total), pageWidth - 20, yPos, { align: 'right' });\n\t\tyPos += 6;\n\t});\n\n\tdoc.setDrawColor(229, 231, 235);\n\tdoc.line(20, yPos, pageWidth - 20, yPos);\n\tyPos += 6;\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.setFontSize(10);\n\tdoc.text('Total Expenses', 20, yPos);\n\tdoc.setTextColor(239, 68, 68);\n\tdoc.text(formatCurrency(grandTotal), pageWidth - 20, yPos, { align: 'right' });\n\tdoc.setTextColor(0, 0, 0);\n\n\tconst tableData = allExpenses.map((exp) => [\n\t\tformatDate(exp.date),\n\t\texp.description ? `${exp.category} - ${exp.description}` : exp.category,\n\t\tformatCurrency(exp.amount),\n\t\texp.source\n\t]);\n\n\tautoTable(doc, {\n\t\tstartY: 52 + boxHeight + 8,\n\t\thead: [['Date', 'Expense', 'Amount', 'Source']],\n\t\tbody: tableData,\n\t\ttheme: 'striped',\n\t\theadStyles: {\n\t\t\tfillColor: [255, 127, 80],\n\t\t\ttextColor: [255, 255, 255],\n\t\t\tfontSize: 9,\n\t\t\tfontStyle: 'bold',\n\t\t\thalign: 'center'\n\t\t},\n\t\tstyles: {\n\t\t\tfontSize: 9,\n\t\t\tcellPadding: 3,\n\t\t\toverflow: 'linebreak',\n\t\t\tlineColor: [229, 231, 235],\n\t\t\tlineWidth: 0.1\n\t\t},\n\t\tcolumnStyles: {\n\t\t\t0: { cellWidth: 25 },\n\t\t\t1: { cellWidth: 90 },\n\t\t\t2: { halign: 'right', cellWidth: 30, textColor: [239, 68, 68], fontStyle: 'bold' },\n\t\t\t3: { halign: 'center', cellWidth: 30 }\n\t\t},\n\t\talternateRowStyles: { fillColor: [249, 250, 251] },\n\t\tmargin: { left: 14, right: 14 },\n\t\tdidDrawPage: function (data: any) {\n\t\t\tconst pageCount = doc.internal.pages.length - 1;\n\t\t\tdoc.setFontSize(8);\n\t\t\tdoc.setTextColor(128, 128, 128);\n\t\t\tdoc.text(\n\t\t\t\t`Page ${data.pageNumber} of ${pageCount}`,\n\t\t\t\tpageWidth / 2,\n\t\t\t\tdoc.internal.pageSize.getHeight() - 10,\n\t\t\t\t{ align: 'center' }\n\t\t\t);\n\t\t}\n\t});\n\n\treturn doc;\n}\n\nexport async function generateTaxBundlePDF(trips: any[], expenses: any[], dateRangeStr: string) {\n\tconst { jsPDF } = await import('jspdf');\n\tconst autoTable = (await import('jspdf-autotable')).default;\n\tconst doc = new jsPDF();\n\tconst logoData = await getLogoDataUrl();\n\tconst pageWidth = doc.internal.pageSize.getWidth();\n\n\t// Header\n\tdoc.setFillColor(255, 127, 80);\n\tdoc.rect(0, 0, pageWidth, 35, 'F');\n\tif (logoData) doc.addImage(logoData, 'PNG', 10, 5, 25, 25);\n\n\tdoc.setTextColor(255, 255, 255);\n\tdoc.setFontSize(24);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Tax Bundle Report', pageWidth / 2, 15, { align: 'center' });\n\tdoc.setFontSize(11);\n\tdoc.setFont('helvetica', 'normal');\n\tdoc.text('Go Route Yourself - Professional Route Tracking', pageWidth / 2, 23, {\n\t\talign: 'center'\n\t});\n\n\t// Metadata\n\tdoc.setTextColor(0, 0, 0);\n\tdoc.setFontSize(10);\n\tdoc.text(`Period: ${dateRangeStr}`, 14, 45);\n\tdoc.text(`Generated: ${new Date().toLocaleString()}`, 14, 50);\n\n\t// --- CALCULATIONS ---\n\tconst totalMiles = trips.reduce((sum, t) => sum + (t.totalMiles || 0), 0);\n\tconst mileageDeduction = totalMiles * 0.67;\n\n\t// Collate all expenses\n\tconst allExpenses: any[] = [];\n\texpenses.forEach((e) => allExpenses.push({ ...e, source: 'Expense Log' }));\n\ttrips.forEach((t) => {\n\t\tif (t.fuelCost) allExpenses.push({ category: 'Fuel', amount: t.fuelCost, source: 'Trip' });\n\t\tif (t.maintenanceCost)\n\t\t\tallExpenses.push({ category: 'Maintenance', amount: t.maintenanceCost, source: 'Trip' });\n\t\tif (t.maintenanceItems)\n\t\t\tt.maintenanceItems.forEach((i: any) =>\n\t\t\t\tallExpenses.push({ category: 'Maintenance', amount: i.cost, source: 'Trip' })\n\t\t\t);\n\t\tif (t.suppliesCost)\n\t\t\tallExpenses.push({ category: 'Supplies', amount: t.suppliesCost, source: 'Trip' });\n\t\tif (t.suppliesItems || t.supplyItems)\n\t\t\t(t.suppliesItems || t.supplyItems).forEach((i: any) =>\n\t\t\t\tallExpenses.push({ category: 'Supplies', amount: i.cost, source: 'Trip' })\n\t\t\t);\n\t});\n\n\tconst totalExpenses = allExpenses.reduce((sum, e) => sum + e.amount, 0);\n\tconst grandTotalDeduction = mileageDeduction + totalExpenses;\n\n\t// --- SUMMARY BOX ---\n\tdoc.setFillColor(248, 250, 252);\n\tdoc.roundedRect(14, 60, pageWidth - 28, 90, 3, 3, 'FD');\n\n\tlet y = 70;\n\tdoc.setFontSize(14);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Tax Deduction Summary', 20, y);\n\n\ty += 10;\n\tdoc.setFontSize(11);\n\tdoc.text('Mileage Deduction', 20, y);\n\tdoc.setFont('helvetica', 'normal');\n\tdoc.text(`${totalMiles.toFixed(1)} miles @ $0.67/mile`, 20, y + 6);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text(formatCurrency(mileageDeduction), pageWidth - 20, y + 6, { align: 'right' });\n\n\ty += 20;\n\tdoc.text('Business Expenses', 20, y);\n\tdoc.setFont('helvetica', 'normal');\n\tdoc.text(`${allExpenses.length} items recorded`, 20, y + 6);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text(formatCurrency(totalExpenses), pageWidth - 20, y + 6, { align: 'right' });\n\n\ty += 20;\n\tdoc.setDrawColor(200, 200, 200);\n\tdoc.line(20, y, pageWidth - 20, y);\n\ty += 10;\n\n\tdoc.setFontSize(16);\n\tdoc.setTextColor(255, 127, 80);\n\tdoc.text('Estimated Total Deduction', 20, y);\n\tdoc.text(formatCurrency(grandTotalDeduction), pageWidth - 20, y, { align: 'right' });\n\n\ty += 15;\n\tdoc.setFontSize(9);\n\tdoc.setTextColor(100, 100, 100);\n\tdoc.setFont('helvetica', 'italic');\n\tdoc.text(\n\t\t'Note: You must choose either Standard Mileage Deduction OR Actual Expenses for your vehicle.',\n\t\t20,\n\t\ty\n\t);\n\tdoc.text('This report includes both for your comparison.', 20, y + 5);\n\n\t// --- MILEAGE LOG SECTION ---\n\tdoc.addPage();\n\tdoc.setTextColor(255, 127, 80);\n\tdoc.setFontSize(18);\n\tdoc.setFont('helvetica', 'bold');\n\tdoc.text('Mileage Log', 14, 20);\n\n\tconst tripTableData = trips.map((trip) => {\n\t\tconst endAddr =\n\t\t\ttrip.endAddress ||\n\t\t\t(trip.stops && trip.stops.length > 0 ? trip.stops[trip.stops.length - 1].address : '') ||\n\t\t\ttrip.startAddress ||\n\t\t\t'';\n\t\treturn [\n\t\t\tformatDate(trip.date || ''),\n\t\t\ttrip.startAddress || '',\n\t\t\tendAddr,\n\t\t\t(trip.totalMiles || 0).toFixed(1) + ' mi',\n\t\t\t(trip.notes || '').substring(0, 30)\n\t\t];\n\t});\n\n\tautoTable(doc, {\n\t\tstartY: 30,\n\t\thead: [['Date', 'Start', 'End', 'Miles', 'Notes']],\n\t\tbody: tripTableData,\n\t\ttheme: 'striped',\n\t\theadStyles: { fillColor: [255, 127, 80] },\n\t\tstyles: { fontSize: 8, cellPadding: 3 },\n\t\tcolumnStyles: {\n\t\t\t3: { halign: 'right', fontStyle: 'bold' }\n\t\t}\n\t});\n\n\t// --- EXPENSE LOG SECTION ---\n\tdoc.addPage();\n\tdoc.setTextColor(255, 127, 80);\n\tdoc.setFontSize(18);\n\tdoc.text('Expense Log', 14, 20);\n\n\tconst expenseTableData = allExpenses.map((exp) => [\n\t\tformatDate(exp.date),\n\t\texp.description ? `${exp.category} - ${exp.description}` : exp.category,\n\t\tformatCurrency(exp.amount),\n\t\texp.source\n\t]);\n\n\tautoTable(doc, {\n\t\tstartY: 30,\n\t\thead: [['Date', 'Expense', 'Amount', 'Source']],\n\t\tbody: expenseTableData,\n\t\ttheme: 'striped',\n\t\theadStyles: { fillColor: [255, 127, 80] },\n\t\tstyles: { fontSize: 8, cellPadding: 3 },\n\t\tcolumnStyles: {\n\t\t\t2: { halign: 'right', textColor: [239, 68, 68], fontStyle: 'bold' }\n\t\t}\n\t});\n\n\treturn doc;\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\settings\\lib\\save-settings.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 5,
				"column": 44,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 5,
				"endColumn": 47,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [182, 185], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [182, 185], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 7,
				"column": 68,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 7,
				"endColumn": 71,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [288, 291], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [288, 291], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 31,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 31,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1043, 1046], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1043, 1046], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 3,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { get } from 'svelte/store';\nimport { userSettings } from '$lib/stores/userSettings';\nimport { csrfFetch } from '$lib/utils/csrf';\n\nexport type SaveResult = { ok: true; data: any } | { ok: false; error: string };\n\nexport async function saveSettings(payload: Partial<Record<string, any>>): Promise<SaveResult> {\n\t// Optimistically update local store\n\tuserSettings.update((s) => ({ ...s, ...payload }));\n\n\ttry {\n\t\tconst res = await csrfFetch('/api/settings', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\tbody: JSON.stringify({ settings: payload })\n\t\t});\n\n\t\tif (!res.ok) {\n\t\t\tconst text = await res.text().catch(() => '');\n\t\t\tthrow new Error(text || `Save failed: ${res.status}`);\n\t\t}\n\n\t\tconst json = await res.json().catch(() => ({}));\n\n\t\t// Ensure we have an object before merging to avoid spread errors\n\t\tconst safeJson = typeof json === 'object' && json ? json : {};\n\t\tconst current = get(userSettings);\n\t\tuserSettings.set({ ...current, ...safeJson });\n\n\t\treturn { ok: true, data: json };\n\t} catch (err: any) {\n\t\t// Revert not implemented (optimistic), but propagate error to caller\n\t\treturn { ok: false, error: err?.message || String(err) };\n\t}\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trash\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 26,
				"column": 18,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 26,
				"endColumn": 35
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 27,
				"column": 17,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 27,
				"endColumn": 34
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 86,
				"column": 25,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 86,
				"endColumn": 42
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'err' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 246,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 246,
				"endColumn": 15
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'err' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 262,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 262,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 304,
				"column": 56,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 304,
				"endColumn": 86
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 308,
				"column": 56,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 308,
				"endColumn": 85
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 312,
				"column": 56,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 312,
				"endColumn": 83
			}
		],
		"suppressedMessages": [],
		"errorCount": 5,
		"fatalErrorCount": 0,
		"warningCount": 3,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { page } from '$app/stores';\n\timport { trash } from '$lib/stores/trash';\n\timport { goto } from '$app/navigation';\n\timport { base } from '$app/paths';\n\timport { user } from '$lib/stores/auth';\n\timport { getDB } from '$lib/db/indexedDB';\n\timport type { TrashRecord } from '$lib/db/types';\n\timport { get } from 'svelte/store';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { getVehicleDisplayName } from '$lib/utils/vehicle';\n\n\tconst resolve = (href: string) => `${base}${href}`;\n\n\t// Known user-friendly error messages that are safe to display\n\tconst KNOWN_RESTORE_ERROR_MESSAGES = [\n\t\t'Item not found in trash',\n\t\t'Unauthorized',\n\t\t'The parent Trip is currently in the Trash. Please restore the Trip first.',\n\t\t'This mileage log belongs to a trip that has been permanently deleted. It cannot be restored.'\n\t];\n\n\tlet trashedTrips: TrashRecord[] = [];\n\tlet loading = true;\n\tlet restoring = new Set<string>();\n\tlet deleting = new Set<string>();\n\tlet currentTypeParam: string | null = null;\n\tlet _pageUnsub: (() => void) | null = null;\n\n\tonMount(() => {\n\t\tconst params = new URLSearchParams(window.location.search);\n\t\tconst typeParam = params.get('type');\n\t\tconst type =\n\t\t\ttypeParam === 'expenses' ? 'expense' : typeParam === 'mileage' ? 'mileage' : undefined;\n\n\t\t// 1. Load Local\n\t\tloadTrash(type).catch(console.error);\n\n\t\t// 2. [!code fix] Force Cloud Sync on Mount\n\t\tconst userState = get(user);\n\t\t// [!code fix] Strictly use ID.\n\t\tconst userId =\n\t\t\tuserState?.id ||\n\t\t\t(typeof localStorage !== 'undefined' ? localStorage.getItem('offline_user_id') : null);\n\n\t\tif (userId) {\n\t\t\ttrash.syncFromCloud(userId, typeParam || undefined).then(() => loadTrash(type));\n\t\t}\n\n\t\t// Subscribe to page changes\n\t\t_pageUnsub = page.subscribe(async ($p) => {\n\t\t\tconst param = $p.url.searchParams.get('type');\n\t\t\tif (param !== currentTypeParam) {\n\t\t\t\tcurrentTypeParam = param;\n\t\t\t\tconst type = param === 'expenses' ? 'expense' : param === 'mileage' ? 'mileage' : undefined;\n\t\t\t\tloading = true;\n\t\t\t\ttry {\n\t\t\t\t\tawait loadTrash(type);\n\t\t\t\t\tconst userState = get(user);\n\t\t\t\t\t// [!code fix] Strictly use ID.\n\t\t\t\t\tconst userId =\n\t\t\t\t\t\tuserState?.id ||\n\t\t\t\t\t\t(typeof localStorage !== 'undefined' ? localStorage.getItem('offline_user_id') : null);\n\n\t\t\t\t\tif (userId) {\n\t\t\t\t\t\tawait trash.syncFromCloud(userId, param || undefined);\n\t\t\t\t\t\tawait loadTrash(type);\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error('Failed to refresh trash for type change', err);\n\t\t\t\t} finally {\n\t\t\t\t\tloading = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\tonDestroy(() => {\n\t\tif (typeof _pageUnsub === 'function') _pageUnsub();\n\t});\n\n\tasync function loadTrash(type?: string) {\n\t\tloading = true;\n\t\ttry {\n\t\t\tconst potentialIds = new Set<string>();\n\t\t\t// [!code fix] Strictly use ID.\n\t\t\tif ($user?.id) potentialIds.add($user.id);\n\n\t\t\tconst offlineId =\n\t\t\t\ttypeof localStorage !== 'undefined' ? localStorage.getItem('offline_user_id') : null;\n\t\t\tif (offlineId) potentialIds.add(offlineId);\n\n\t\t\tconst db = await getDB();\n\t\t\tconst tx = db.transaction('trash', 'readonly');\n\t\t\tconst index = tx.objectStore('trash').index('userId');\n\n\t\t\tlet allItems: any[] = [];\n\t\t\tfor (const id of potentialIds) {\n\t\t\t\tconst items = await index.getAll(id);\n\t\t\t\tallItems = [...allItems, ...items];\n\t\t\t}\n\n\t\t\t// Normalize/Flatten\n\t\t\tconst uniqueItems = Array.from(\n\t\t\t\tnew Map(\n\t\t\t\t\tallItems.map((item) => {\n\t\t\t\t\t\tlet flat = { ...item };\n\t\t\t\t\t\tif (flat.data && typeof flat.data === 'object') {\n\t\t\t\t\t\t\tflat = { ...flat.data, ...flat };\n\t\t\t\t\t\t\tdelete flat.data;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn [flat.id, flat];\n\t\t\t\t\t})\n\t\t\t\t).values()\n\t\t\t);\n\n\t\t\tconst effectiveType =\n\t\t\t\ttype ??\n\t\t\t\t(currentTypeParam === 'expenses'\n\t\t\t\t\t? 'expense'\n\t\t\t\t\t: currentTypeParam === 'mileage'\n\t\t\t\t\t\t? 'mileage'\n\t\t\t\t\t\t: undefined);\n\n\t\t\tconst filtered = uniqueItems.filter((it: any) => {\n\t\t\t\tconst recordTypes = Array.isArray(it.recordTypes)\n\t\t\t\t\t? it.recordTypes\n\t\t\t\t\t: it.recordType\n\t\t\t\t\t\t? [it.recordType]\n\t\t\t\t\t\t: [];\n\n\t\t\t\tif (recordTypes.length > 0) {\n\t\t\t\t\t// If viewing 'all', show everything; otherwise include items whose recordTypes include the view\n\t\t\t\t\tif (!type && !currentTypeParam) return true;\n\t\t\t\t\treturn recordTypes.includes(effectiveType as any);\n\t\t\t\t}\n\n\t\t\t\t// Fallback: infer from key or shape\n\t\t\t\tconst inferredFromKey =\n\t\t\t\t\tit.recordType ||\n\t\t\t\t\tit.type ||\n\t\t\t\t\t(it.originalKey &&\n\t\t\t\t\t\t(it.originalKey.startsWith('expense:')\n\t\t\t\t\t\t\t? 'expense'\n\t\t\t\t\t\t\t: it.originalKey.startsWith('mileage:')\n\t\t\t\t\t\t\t\t? 'mileage'\n\t\t\t\t\t\t\t\t: 'trip')) ||\n\t\t\t\t\t'trip';\n\t\t\t\tconst hasMileageShape = typeof it.miles === 'number' || Boolean(it.vehicle);\n\t\t\t\tconst inferred = hasMileageShape ? 'mileage' : inferredFromKey;\n\t\t\t\treturn inferred === effectiveType;\n\t\t\t});\n\t\t\tfiltered.sort((a, b) => new Date(b.deletedAt).getTime() - new Date(a.deletedAt).getTime());\n\t\t\ttrashedTrips = filtered;\n\t\t} catch (err) {\n\t\t\tconsole.error('Error loading trash:', err);\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\tasync function restoreTrip(id: string) {\n\t\tif (restoring.has(id)) return;\n\t\tconst item = trashedTrips.find((t) => t.id === id);\n\t\tif (!item) return;\n\n\t\trestoring.add(id);\n\t\trestoring = restoring;\n\n\t\ttry {\n\t\t\t// Prefer current view when restoring ambiguous/merged tombstones\n\t\t\tconst displayType =\n\t\t\t\tcurrentTypeParam === 'expenses'\n\t\t\t\t\t? 'expense'\n\t\t\t\t\t: currentTypeParam === 'mileage'\n\t\t\t\t\t\t? 'mileage'\n\t\t\t\t\t\t: Array.isArray((item as any).recordTypes) && (item as any).recordTypes.length\n\t\t\t\t\t\t\t? (item as any).recordTypes[0]\n\t\t\t\t\t\t\t: (item as any).recordType ||\n\t\t\t\t\t\t\t\t(item as any).type ||\n\t\t\t\t\t\t\t\t(typeof (item as any).miles === 'number' ? 'mileage' : 'trip');\n\n\t\t\t// Actually restore the item from trash (this calls updateLocal internally)\n\t\t\tawait trash.restore(id, item.userId, displayType);\n\n\t\t\t// PERFORMANCE: No need to reload stores - updateLocal already updated them optimistically\n\t\t\t// Just reload trash to remove the restored item from trash view\n\t\t\tawait loadTrash();\n\t\t} catch (err) {\n\t\t\t// Only show known user-friendly error messages, fallback to generic for unknown errors\n\t\t\tconst errorMessage = err instanceof Error ? err.message : '';\n\t\t\tconst message = KNOWN_RESTORE_ERROR_MESSAGES.includes(errorMessage)\n\t\t\t\t? errorMessage\n\t\t\t\t: 'Failed to restore item.';\n\t\t\talert(message);\n\t\t} finally {\n\t\t\trestoring.delete(id);\n\t\t\trestoring = restoring;\n\t\t}\n\t}\n\n\tasync function restoreAll() {\n\t\tif (trashedTrips.length === 0) return;\n\t\tif (!confirm(`Are you sure you want to restore all ${trashedTrips.length} items?`)) return;\n\n\t\tloading = true;\n\t\ttry {\n\t\t\tfor (const trip of trashedTrips) {\n\t\t\t\tconst displayType =\n\t\t\t\t\tcurrentTypeParam === 'expenses'\n\t\t\t\t\t\t? 'expense'\n\t\t\t\t\t\t: currentTypeParam === 'mileage'\n\t\t\t\t\t\t\t? 'mileage'\n\t\t\t\t\t\t\t: Array.isArray((trip as any).recordTypes) && (trip as any).recordTypes.length\n\t\t\t\t\t\t\t\t? (trip as any).recordTypes[0]\n\t\t\t\t\t\t\t\t: (trip as any).recordType ||\n\t\t\t\t\t\t\t\t\t(trip as any).type ||\n\t\t\t\t\t\t\t\t\t(typeof (trip as any).miles === 'number' ? 'mileage' : 'trip');\n\t\t\t\tawait trash.restore(trip.id, trip.userId, displayType);\n\t\t\t}\n\t\t\t// PERFORMANCE: No need to reload stores - updateLocal already updated them\n\t\t\tawait loadTrash();\n\t\t} catch (err) {\n\t\t\t// Only show known user-friendly error messages, fallback to generic for unknown errors\n\t\t\tconst errorMessage = err instanceof Error ? err.message : '';\n\t\t\tconst message = KNOWN_RESTORE_ERROR_MESSAGES.includes(errorMessage)\n\t\t\t\t? errorMessage\n\t\t\t\t: 'Failed to restore some items.';\n\t\t\talert(message);\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\tasync function permanentDelete(id: string) {\n\t\tif (!confirm('Permanently delete this item? Cannot be undone.')) return;\n\n\t\tif (deleting.has(id)) return;\n\t\tdeleting.add(id);\n\t\tdeleting = deleting;\n\n\t\ttry {\n\t\t\tawait trash.permanentDelete(id);\n\t\t\tawait loadTrash();\n\t\t} catch (err) {\n\t\t\talert('Failed to delete item.');\n\t\t} finally {\n\t\t\tdeleting.delete(id);\n\t\t\tdeleting = deleting;\n\t\t}\n\t}\n\n\tasync function emptyTrash() {\n\t\tif (!confirm('Permanently delete ALL items? Cannot be undone.')) return;\n\t\ttry {\n\t\t\tconst uniqueUserIds = new Set(trashedTrips.map((t) => t.userId));\n\t\t\tfor (const uid of uniqueUserIds) {\n\t\t\t\tawait trash.emptyTrash(uid);\n\t\t\t}\n\t\t\tawait loadTrash();\n\t\t} catch (err) {\n\t\t\talert('Failed to empty trash.');\n\t\t}\n\t}\n\n\tfunction formatDate(dateString: string | undefined): string {\n\t\tif (!dateString) return 'Unknown';\n\t\tconst date = new Date(dateString);\n\t\treturn new Intl.DateTimeFormat('en-US', {\n\t\t\tmonth: 'short',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric'\n\t\t}).format(date);\n\t}\n\n\tfunction getDaysUntilExpiration(expiresAt: string | undefined): number {\n\t\tif (!expiresAt) return 0;\n\t\tconst now = new Date();\n\t\tconst expires = new Date(expiresAt);\n\t\tconst diff = expires.getTime() - now.getTime();\n\t\treturn Math.ceil(diff / (1000 * 60 * 60 * 24));\n\t}\n</script>\n\n<svelte:head>\n\t<title>Trash - Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"trash-page\">\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">Trash</h1>\n\t\t\t<p class=\"page-subtitle\">Items deleted > 30 days ago are removed automatically</p>\n\t\t</div>\n\n\t\t<div class=\"header-actions\">\n\t\t\t{#if trashedTrips.length > 0}\n\t\t\t\t<button class=\"btn-success\" on:click={restoreAll}> Restore All </button>\n\t\t\t\t<button class=\"btn-danger\" on:click={emptyTrash}> Empty Trash </button>\n\t\t\t{/if}\n\n\t\t\t{#if currentTypeParam === 'expenses'}\n\t\t\t\t<button class=\"btn-secondary\" on:click={() => goto(resolve('/dashboard/expenses'))}>\n\t\t\t\t\tBack to Expenses\n\t\t\t\t</button>\n\t\t\t{:else if currentTypeParam === 'mileage'}\n\t\t\t\t<button class=\"btn-secondary\" on:click={() => goto(resolve('/dashboard/mileage'))}>\n\t\t\t\t\tBack to Mileage\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<button class=\"btn-secondary\" on:click={() => goto(resolve('/dashboard/trips'))}>\n\t\t\t\t\tBack to Trips\n\t\t\t\t</button>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n\n\t{#if loading}\n\t\t<div class=\"loading\">Loading trash...</div>\n\t{:else if trashedTrips.length === 0}\n\t\t<div class=\"empty-state\">\n\t\t\t<h2>Trash is empty</h2>\n\t\t</div>\n\t{:else}\n\t\t<div class=\"trash-list\">\n\t\t\t{#each trashedTrips as trip (trip.id)}\n\t\t\t\t{@const t = trip as TrashRecord}\n\t\t\t\t{@const expiresAt =\n\t\t\t\t\t(t['expiresAt'] as string | undefined) ||\n\t\t\t\t\t((t['metadata'] as any)?.expiresAt as string | undefined)}\n\t\t\t\t{@const deletedAt =\n\t\t\t\t\t(t['deletedAt'] as string | undefined) ||\n\t\t\t\t\t((t['metadata'] as any)?.deletedAt as string | undefined)}\n\t\t\t\t{@const daysLeft = getDaysUntilExpiration(expiresAt)}\n\n\t\t\t\t{@const displayType =\n\t\t\t\t\tcurrentTypeParam === 'expenses'\n\t\t\t\t\t\t? 'expense'\n\t\t\t\t\t\t: currentTypeParam === 'mileage'\n\t\t\t\t\t\t\t? 'mileage'\n\t\t\t\t\t\t\t: Array.isArray(t['recordTypes']) && t['recordTypes'].length\n\t\t\t\t\t\t\t\t? t['recordTypes'][0]\n\t\t\t\t\t\t\t\t: t['recordType'] ||\n\t\t\t\t\t\t\t\t\tt['type'] ||\n\t\t\t\t\t\t\t\t\t(typeof t['miles'] === 'number' ? 'mileage' : 'trip')}\n\n\t\t\t\t{@const isExpense = displayType === 'expense'}\n\t\t\t\t{@const isMileage = displayType === 'mileage'}\n\t\t\t\t{@const rawVehicleName = getVehicleDisplayName(\n\t\t\t\t\ttrip['vehicle'] as string | undefined,\n\t\t\t\t\t$userSettings?.vehicles\n\t\t\t\t)}\n\t\t\t\t{@const vehicleDisplay =\n\t\t\t\t\trawVehicleName && rawVehicleName !== '-' && rawVehicleName !== 'Unknown vehicle'\n\t\t\t\t\t\t? rawVehicleName\n\t\t\t\t\t\t: null}\n\t\t\t\t{@const mileageLogDate = trip.date || trip.createdAt}\n\n\t\t\t\t<div class=\"trash-item\">\n\t\t\t\t\t<div class=\"trip-info\">\n\t\t\t\t\t\t<div class=\"trip-header\">\n\t\t\t\t\t\t\t<h3 class=\"trip-title\">\n\t\t\t\t\t\t\t\t{#if isExpense}\n\t\t\t\t\t\t\t\t\t<span class=\"badge-expense\">Expense</span>\n\t\t\t\t\t\t\t\t\t<span class=\"expense-category\">{trip.category || 'Uncategorized'}</span>\n\t\t\t\t\t\t\t\t{:else if isMileage}\n\t\t\t\t\t\t\t\t\t<span class=\"badge-mileage\">Mileage</span>\n\t\t\t\t\t\t\t\t\t{vehicleDisplay\n\t\t\t\t\t\t\t\t\t\t? vehicleDisplay\n\t\t\t\t\t\t\t\t\t\t: mileageLogDate\n\t\t\t\t\t\t\t\t\t\t\t? formatDate(mileageLogDate)\n\t\t\t\t\t\t\t\t\t\t\t: 'Mileage Log'}\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<span class=\"badge-trip\">Trip</span>\n\t\t\t\t\t\t\t\t\t{typeof trip.startAddress === 'string'\n\t\t\t\t\t\t\t\t\t\t? trip.startAddress.split(',')[0]\n\t\t\t\t\t\t\t\t\t\t: 'Unknown Trip'}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<div class=\"trip-meta\">\n\t\t\t\t\t\t\t\t<span class=\"deleted-date\">Deleted {formatDate(deletedAt)}</span>\n\t\t\t\t\t\t\t\t<span class=\"expiration\" class:warning={daysLeft <= 7}>\n\t\t\t\t\t\t\t\t\t{daysLeft} days left\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"trip-details\">\n\t\t\t\t\t\t\t{#if isExpense}\n\t\t\t\t\t\t\t\t<span class=\"detail amount\">${Number(trip.amount || 0).toFixed(2)}</span>\n\t\t\t\t\t\t\t\t{#if trip.description}<span class=\"detail\">{trip.description}</span>{/if}\n\t\t\t\t\t\t\t\t<span class=\"detail\"\n\t\t\t\t\t\t\t\t\t>{new Date(trip.date || trip.createdAt || '').toLocaleDateString()}</span\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{:else if isMileage}\n\t\t\t\t\t\t\t\t<span class=\"detail\"\n\t\t\t\t\t\t\t\t\t>{new Date(trip.date || trip.createdAt || '').toLocaleDateString()}</span\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"detail amount\">{Number(trip['miles'] || 0).toFixed(2)} mi</span>\n\t\t\t\t\t\t\t\t{#if trip.notes}<span class=\"detail\">{trip.notes}</span>{/if}\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<span class=\"detail\"\n\t\t\t\t\t\t\t\t\t>{new Date(trip.date || trip.createdAt || '').toLocaleDateString()}</span\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"detail\">{trip.stops?.length || 0} stops</span>\n\t\t\t\t\t\t\t\t{#if trip.totalMiles}<span class=\"detail\"\n\t\t\t\t\t\t\t\t\t\t>{Number(trip.totalMiles).toFixed(1)} mi</span\n\t\t\t\t\t\t\t\t\t>{/if}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"trip-actions\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-restore-item\"\n\t\t\t\t\t\t\ton:click={() => restoreTrip(trip.id)}\n\t\t\t\t\t\t\tdisabled={restoring.has(trip.id)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{restoring.has(trip.id) ? 'Restoring...' : 'Restore'}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-delete-item\"\n\t\t\t\t\t\t\ton:click={() => permanentDelete(trip.id)}\n\t\t\t\t\t\t\tdisabled={deleting.has(trip.id)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tDelete\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t/* Add this new style for mileage badges */\n\t.badge-mileage {\n\t\tbackground-color: #d1fae5;\n\t\tcolor: #065f46;\n\t\tfont-size: 0.8em;\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 4px;\n\t\tmargin-right: 6px;\n\t\tvertical-align: middle;\n\t\tfont-weight: 600;\n\t}\n\t.badge-trip {\n\t\tbackground-color: #dbeafe;\n\t\tcolor: #1e40af;\n\t\tfont-size: 0.8em;\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 4px;\n\t\tmargin-right: 6px;\n\t\tvertical-align: middle;\n\t\tfont-weight: 600;\n\t}\n\t/* Keep existing styles */\n\t.trash-page {\n\t\tpadding: 16px;\n\t\tmax-width: 1200px;\n\t\tmargin: 0 auto;\n\t}\n\t.page-header {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t\tmargin-bottom: 24px;\n\t}\n\t.page-title {\n\t\tfont-size: 24px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0 0 4px 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tmargin: 0;\n\t\tline-height: 1.4;\n\t}\n\t.header-actions {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\twidth: 100%;\n\t}\n\n\t.btn-danger,\n\t.btn-success,\n\t.btn-secondary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 6px;\n\t\tpadding: 10px 16px;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tflex: 1;\n\t\ttext-decoration: none;\n\t}\n\t.btn-danger {\n\t\tbackground: #dc2626;\n\t\tcolor: white;\n\t\tbox-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);\n\t}\n\t.btn-danger:hover {\n\t\tbackground: #b91c1c;\n\t}\n\t.btn-success {\n\t\tbackground: linear-gradient(135deg, #10b981 0%, #059669 100%);\n\t\tcolor: white;\n\t\tbox-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);\n\t}\n\t.btn-success:hover {\n\t\tfilter: brightness(1.1);\n\t}\n\t.btn-secondary {\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t\tborder: 1px solid #e5e7eb;\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n\t}\n\t.btn-secondary:hover {\n\t\tbackground: #f9fafb;\n\t\tborder-color: #d1d5db;\n\t}\n\n\t.trash-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t}\n\t.trash-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t\tpadding: 16px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\ttransition: all 0.2s;\n\t}\n\t.trip-info {\n\t\tflex: 1;\n\t}\n\t.trip-title {\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0 0 8px 0;\n\t\tline-height: 1.3;\n\t}\n\t.trip-meta {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tfont-size: 12px;\n\t\tflex-wrap: wrap;\n\t}\n\t.deleted-date {\n\t\tcolor: #6b7280;\n\t}\n\t.expiration {\n\t\tcolor: #10b981;\n\t\tfont-weight: 600;\n\t}\n\t.expiration.warning {\n\t\tcolor: #f59e0b;\n\t}\n\n\t.trip-details {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tmargin-top: 8px;\n\t\tfont-size: 13px;\n\t\tcolor: #6b7280;\n\t\tflex-wrap: wrap;\n\t}\n\t.detail {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tbackground: #f3f4f6;\n\t\tpadding: 2px 8px;\n\t\tborder-radius: 4px;\n\t}\n\n\t.trip-actions {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 12px;\n\t\twidth: 100%;\n\t}\n\t.btn-restore-item,\n\t.btn-delete-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 6px;\n\t\tpadding: 10px 16px;\n\t\tborder-radius: 8px;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\tborder: none;\n\t\ttransition: all 0.2s;\n\t}\n\t.btn-restore-item {\n\t\tbackground: #dcfce7;\n\t\tcolor: #166534;\n\t}\n\t.btn-delete-item {\n\t\tbackground: #fef2f2;\n\t\tcolor: #dc2626;\n\t}\n\n\t.empty-state {\n\t\ttext-align: center;\n\t\tpadding: 40px 20px;\n\t}\n\n\t.badge-expense {\n\t\tbackground-color: #dbeafe;\n\t\tcolor: #1e40af;\n\t\tfont-size: 0.8em;\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 4px;\n\t\tmargin-right: 6px;\n\t\tvertical-align: middle;\n\t\tfont-weight: 600;\n\t}\n\t.expense-category {\n\t\ttext-transform: capitalize;\n\t}\n\t.amount {\n\t\tcolor: #111827;\n\t\tfont-weight: 700;\n\t}\n\n\t@media (min-width: 640px) {\n\t\t.page-header {\n\t\t\tflex-direction: row;\n\t\t\talign-items: flex-start;\n\t\t\tjustify-content: space-between;\n\t\t}\n\t\t.header-actions {\n\t\t\twidth: auto;\n\t\t}\n\t\t.trash-item {\n\t\t\tflex-direction: row;\n\t\t\talign-items: center;\n\t\t}\n\t\t.trip-actions {\n\t\t\twidth: auto;\n\t\t\tdisplay: flex;\n\t\t}\n\t\t.btn-danger,\n\t\t.btn-success,\n\t\t.btn-secondary {\n\t\t\twidth: auto;\n\t\t\tflex: none;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trips\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 45,
				"column": 22,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 45,
				"endColumn": 39
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Date class. Use SvelteDate instead.",
				"line": 133,
				"column": 22,
				"nodeType": "NewExpression",
				"messageId": "mutableDateUsed",
				"endLine": 133,
				"endColumn": 41
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Date class. Use SvelteDate instead.",
				"line": 136,
				"column": 20,
				"nodeType": "NewExpression",
				"messageId": "mutableDateUsed",
				"endLine": 136,
				"endColumn": 39
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Date class. Use SvelteDate instead.",
				"line": 141,
				"column": 18,
				"nodeType": "NewExpression",
				"messageId": "mutableDateUsed",
				"endLine": 141,
				"endColumn": 35
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'err' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 203,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 203,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in Set class. Use SvelteSet instead.",
				"line": 262,
				"column": 22,
				"nodeType": "NewExpression",
				"messageId": "mutableSetUsed",
				"endLine": 262,
				"endColumn": 39
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 314,
				"column": 26,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 314,
				"endColumn": 53
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 350,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 350,
				"endColumn": 46
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 394,
				"column": 27,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 394,
				"endColumn": 70
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 442,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 442,
				"endColumn": 75
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 449,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 466,
				"endColumn": 19
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 458,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 464,
				"endColumn": 22
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 495,
				"column": 48,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 495,
				"endColumn": 67
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 518,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 518,
				"endColumn": 37
			}
		],
		"suppressedMessages": [],
		"errorCount": 9,
		"fatalErrorCount": 0,
		"warningCount": 5,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { trips } from '$lib/stores/trips';\n\timport AsyncErrorBoundary from '$lib/components/AsyncErrorBoundary.svelte';\n\timport { goto } from '$app/navigation';\n\timport { base } from '$app/paths';\n\timport { user } from '$lib/stores/auth';\n\n\tconst resolve = (href: string) => `${base}${href}`;\n\timport { page } from '$app/stores';\n\timport { toasts } from '$lib/stores/toast';\n\timport { onMount, onDestroy } from 'svelte';\n\timport { calculateNetProfit } from '$lib/utils/trip-helpers';\n\n\t// Import Components\n\timport TripStats from './components/TripStats.svelte';\n\timport TripFilters from './components/TripFilters.svelte';\n\timport TripCard from './components/TripCard.svelte';\n\timport ActionBar from './components/ActionBar.svelte';\n\timport SettingsModal from './components/SettingsModal.svelte';\n\timport UpgradeModal from './components/UpgradeModal.svelte';\n\n\tlet tripsBoundary: any;\n\tlet hasLoadedOnce = false;\n\tlet isMounted = false;\n\tlet lastHadSelections = false;\n\n\t// Filter State\n\tlet searchQuery = '';\n\tlet sortBy = 'date';\n\tlet sortOrder = 'desc';\n\tlet filterProfit = 'all';\n\t// Default to current month (first day to last day)\n\tconst _now = new Date();\n\tfunction _fmtInput(d: Date) {\n\t\treturn d.toISOString().slice(0, 10);\n\t}\n\tlet startDate = _fmtInput(new Date(_now.getFullYear(), _now.getMonth(), 1));\n\tlet endDate = _fmtInput(new Date(_now.getFullYear(), _now.getMonth() + 1, 0));\n\n\t// Pagination\n\tlet currentPage = 1;\n\tconst itemsPerPage = 20;\n\n\t// Selection\n\tlet selectedTrips = new Set<string>();\n\n\t// Modals\n\tlet isSettingsOpen = false;\n\tlet isUpgradeModalOpen = false;\n\n\t$: isPro = ['pro', 'business', 'premium', 'enterprise'].includes($user?.plan || '');\n\t$: API_KEY = $page.data['googleMapsApiKey'];\n\n\t// Reset page when filters change\n\t$: if (searchQuery || sortBy || sortOrder || filterProfit || startDate || endDate) {\n\t\tcurrentPage = 1;\n\t}\n\n\tasync function loadTrips() {\n\t\ttry {\n\t\t\tif ($trips.length > 0) {\n\t\t\t\ttripsBoundary?.setSuccess();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!hasLoadedOnce) tripsBoundary?.setLoading();\n\t\t\tawait trips.load();\n\t\t\thasLoadedOnce = true;\n\t\t\ttripsBoundary?.setSuccess();\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to load trips:', error);\n\t\t\ttripsBoundary?.setError(error as Error);\n\t\t\ttoasts.error('Failed to load trips. Click retry to try again.');\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t// Handle body class for selection bar\n\t$: if (typeof document !== 'undefined' && isMounted) {\n\t\tconst hasSelections = selectedTrips.size > 0;\n\t\tif (hasSelections !== lastHadSelections) {\n\t\t\tif (hasSelections) document.body.classList.add('has-selections');\n\t\t\telse document.body.classList.remove('has-selections');\n\t\t\tlastHadSelections = hasSelections;\n\t\t}\n\t}\n\n\tonMount(() => {\n\t\tdocument.body.classList.remove('has-selections');\n\t\tisMounted = true;\n\t\tloadTrips();\n\t});\n\n\tonDestroy(() => {\n\t\tif (typeof document !== 'undefined') document.body.classList.remove('has-selections');\n\t\tisMounted = false;\n\t});\n\n\t// --- Filtering Logic ---\n\t$: allFilteredTrips = $trips\n\t\t.filter((trip) => {\n\t\t\tconst query = searchQuery.toLowerCase();\n\t\t\tconst supplies = (trip as any)['supplyItems'] || (trip as any)['suppliesItems'] || [];\n\t\t\tconst matchesSearch =\n\t\t\t\t!query ||\n\t\t\t\ttrip.date?.includes(query) ||\n\t\t\t\ttrip.startAddress?.toLowerCase().includes(query) ||\n\t\t\t\ttrip.endAddress?.toLowerCase().includes(query) ||\n\t\t\t\ttrip.notes?.toLowerCase().includes(query) ||\n\t\t\t\ttrip.totalMiles?.toString().includes(query) ||\n\t\t\t\ttrip.fuelCost?.toString().includes(query) ||\n\t\t\t\ttrip.stops?.some(\n\t\t\t\t\t(stop: any) =>\n\t\t\t\t\t\tstop.address?.toLowerCase().includes(query) || stop.earnings?.toString().includes(query)\n\t\t\t\t) ||\n\t\t\t\t(trip as any)['maintenanceItems']?.some(\n\t\t\t\t\t(item: any) =>\n\t\t\t\t\t\titem.type?.toLowerCase().includes(query) || item.cost?.toString().includes(query)\n\t\t\t\t) ||\n\t\t\t\tsupplies.some(\n\t\t\t\t\t(item: any) =>\n\t\t\t\t\t\titem.type?.toLowerCase().includes(query) || item.cost?.toString().includes(query)\n\t\t\t\t);\n\n\t\t\tif (!matchesSearch) return false;\n\n\t\t\tif (filterProfit !== 'all') {\n\t\t\t\tconst profit = calculateNetProfit(trip);\n\t\t\t\tif (filterProfit === 'positive' && profit <= 0) return false;\n\t\t\t\tif (filterProfit === 'negative' && profit >= 0) return false;\n\t\t\t}\n\n\t\t\tif (trip.date) {\n\t\t\t\tconst tripDate = new Date(trip.date);\n\t\t\t\ttripDate.setHours(0, 0, 0, 0);\n\t\t\t\tif (startDate) {\n\t\t\t\t\tconst start = new Date(startDate);\n\t\t\t\t\tstart.setHours(0, 0, 0, 0);\n\t\t\t\t\tif (tripDate < start) return false;\n\t\t\t\t}\n\t\t\t\tif (endDate) {\n\t\t\t\t\tconst end = new Date(endDate);\n\t\t\t\t\tend.setHours(0, 0, 0, 0);\n\t\t\t\t\tif (tripDate > end) return false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t})\n\t\t.sort((a, b) => {\n\t\t\tlet aVal, bVal;\n\t\t\tswitch (sortBy) {\n\t\t\t\tcase 'date':\n\t\t\t\t\taVal = new Date(a.date || 0).getTime();\n\t\t\t\t\tbVal = new Date(b.date || 0).getTime();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'profit':\n\t\t\t\t\taVal = calculateNetProfit(a);\n\t\t\t\t\tbVal = calculateNetProfit(b);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'miles':\n\t\t\t\t\taVal = a.totalMiles || 0;\n\t\t\t\t\tbVal = b.totalMiles || 0;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn 0;\n\t\t\t}\n\t\t\treturn sortOrder === 'asc' ? aVal - bVal : bVal - aVal;\n\t\t});\n\n\t$: totalPages = Math.ceil(allFilteredTrips.length / itemsPerPage);\n\t$: visibleTrips = allFilteredTrips.slice(\n\t\t(currentPage - 1) * itemsPerPage,\n\t\tcurrentPage * itemsPerPage\n\t);\n\t$: allSelected = allFilteredTrips.length > 0 && selectedTrips.size === allFilteredTrips.length;\n\n\tfunction toggleSelection(id: string) {\n\t\tif (selectedTrips.has(id)) selectedTrips.delete(id);\n\t\telse selectedTrips.add(id);\n\t\tselectedTrips = selectedTrips;\n\t}\n\n\tfunction toggleSelectAll() {\n\t\tif (allSelected) selectedTrips = new Set();\n\t\telse selectedTrips = new Set(allFilteredTrips.map((t) => t.id));\n\t}\n\n\tfunction changePage(newPage: number) {\n\t\tif (newPage >= 1 && newPage <= totalPages) {\n\t\t\tcurrentPage = newPage;\n\t\t\twindow.scrollTo({ top: 0, behavior: 'smooth' });\n\t\t}\n\t}\n\n\tasync function deleteTrip(id: string) {\n\t\tif (!confirm('Move trip to trash?')) return;\n\t\ttry {\n\t\t\tconst currentUser = $page.data['user'] || $user;\n\n\t\t\t// [!code fix] Strictly use ID. Removed fallback to name/token and legacy legacy checks.\n\t\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id') || '';\n\n\t\t\tif (userId) await trips.deleteTrip(id, userId as string);\n\t\t} catch (err) {\n\t\t\ttoasts.error('Failed to delete trip. Changes reverted.');\n\t\t}\n\t}\n\n\tasync function deleteSelected() {\n\t\tconst count = selectedTrips.size;\n\t\tif (!confirm(`Are you sure you want to delete ${count} trip(s)?`)) return;\n\t\tconst currentUser = $page.data['user'] || $user;\n\n\t\t// [!code fix] Strictly use ID.\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id') || '';\n\n\t\tif (!userId) {\n\t\t\ttoasts.error('User identity missing.');\n\t\t\treturn;\n\t\t}\n\n\t\tlet successCount = 0;\n\t\tconst ids = Array.from(selectedTrips);\n\t\tfor (const id of ids) {\n\t\t\ttry {\n\t\t\t\tawait trips.deleteTrip(id, userId);\n\t\t\t\tsuccessCount++;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(`Failed to delete trip ${id}`, err);\n\t\t\t}\n\t\t}\n\t\ttoasts.success(`Moved ${successCount} trips to trash.`);\n\t\tselectedTrips = new Set();\n\t}\n\n\tfunction exportSelected() {\n\t\tif (typeof document === 'undefined' || typeof window === 'undefined') return;\n\t\tconst selectedData = allFilteredTrips.filter((t) => selectedTrips.has(t.id));\n\t\tif (selectedData.length === 0) return;\n\t\tconst headers = ['Date', 'Start', 'End', 'Miles', 'Profit', 'Notes'];\n\t\tconst rows = selectedData.map((t) => {\n\t\t\tconst profit = calculateNetProfit(t);\n\t\t\treturn [\n\t\t\t\tt.date,\n\t\t\t\t`\"${t.startAddress}\"`,\n\t\t\t\t`\"${t.endAddress}\"`,\n\t\t\t\tt.totalMiles,\n\t\t\t\tprofit.toFixed(2),\n\t\t\t\t`\"${(t.notes || '').replace(/\"/g, '\"\"')}\"`\n\t\t\t].join(',');\n\t\t});\n\t\tconst csvContent = [headers.join(','), ...rows].join('\\n');\n\t\tconst blob = new Blob([csvContent], { type: 'text/csv' });\n\t\tconst url = window.URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `trips_export_${new Date().toISOString().split('T')[0]}.csv`;\n\t\ta.click();\n\t\ttoasts.success(`Exported ${selectedData.length} trips.`);\n\t\tselectedTrips = new Set();\n\t}\n\n\tlet expandedTrips = new Set<string>();\n\tfunction toggleExpand(id: string) {\n\t\tif (expandedTrips.has(id)) expandedTrips.delete(id);\n\t\telse expandedTrips.add(id);\n\t\texpandedTrips = expandedTrips;\n\t}\n\n\t// Auto-expand a trip when `?id=<tripId>` is present in URL — used when navigating from expenses\n\tlet lastQueryExpandId = '';\n\t$: {\n\t\tconst qId = $page?.url?.searchParams.get('id');\n\t\tif (qId && qId !== lastQueryExpandId && allFilteredTrips?.length > 0) {\n\t\t\tconst idx = allFilteredTrips.findIndex((t) => t.id === qId);\n\t\t\tif (idx !== -1) {\n\t\t\t\tconst newPage = Math.floor(idx / itemsPerPage) + 1;\n\t\t\t\tif (currentPage !== newPage) currentPage = newPage;\n\t\t\t\texpandedTrips = new Set([qId]);\n\t\t\t\tif (typeof document !== 'undefined') {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tconst el = document.getElementById('trip-' + qId);\n\t\t\t\t\t\tif (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });\n\t\t\t\t\t}, 60);\n\t\t\t\t}\n\t\t\t}\n\t\t\tlastQueryExpandId = qId;\n\t\t}\n\t}\n</script>\n\n<svelte:head>\n\t<title>Trips - Go Route Yourself</title>\n\t<style>\n\t\t/* FORCE OVERRIDE: Google Maps Autocomplete z-index */\n\t\t.pac-container {\n\t\t\tz-index: 2147483647 !important;\n\t\t\t/* Positioning removed to allow the action to control absolute/fixed placement */\n\t\t\tpointer-events: auto !important;\n\t\t}\n\t</style>\n</svelte:head>\n\n<AsyncErrorBoundary bind:this={tripsBoundary} onRetry={loadTrips}>\n\t<div class=\"trip-history\">\n\t\t<div class=\"page-header\">\n\t\t\t<div class=\"header-text\">\n\t\t\t\t<h1 class=\"page-title\">Trips</h1>\n\t\t\t\t<p class=\"page-subtitle\">View and manage all your trips</p>\n\t\t\t</div>\n\n\t\t\t<div class=\"header-actions\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"btn-secondary\"\n\t\t\t\t\tonclick={() => goto(resolve('/dashboard/trash'))}\n\t\t\t\t\taria-label=\"View Trash\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t><polyline points=\"3 6 5 6 21 6\"></polyline><path\n\t\t\t\t\t\t\td=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"\n\t\t\t\t\t\t></path></svg\n\t\t\t\t\t>\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"btn-secondary\"\n\t\t\t\t\tonclick={() => (isSettingsOpen = true)}\n\t\t\t\t\taria-label=\"Trip Settings\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t><path\n\t\t\t\t\t\t\td=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"\n\t\t\t\t\t\t></path><circle cx=\"12\" cy=\"12\" r=\"3\"></circle></svg\n\t\t\t\t\t>\n\t\t\t\t</button>\n\t\t\t\t<a href={resolve('/dashboard/trips/new')} class=\"btn-primary\" aria-label=\"Create New Trip\">\n\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" aria-hidden=\"true\"\n\t\t\t\t\t\t><path\n\t\t\t\t\t\t\td=\"M10 4V16M4 10H16\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t/></svg\n\t\t\t\t\t>\n\t\t\t\t\tNew Trip\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<TripStats trips={allFilteredTrips} />\n\n\t\t<TripFilters\n\t\t\tbind:searchQuery\n\t\t\tbind:startDate\n\t\t\tbind:endDate\n\t\t\tbind:filterProfit\n\t\t\tbind:sortBy\n\t\t\tbind:sortOrder\n\t\t/>\n\n\t\t{#if visibleTrips.length > 0}\n\t\t\t<div class=\"batch-header\" class:visible={allFilteredTrips.length > 0}>\n\t\t\t\t<label class=\"checkbox-container\">\n\t\t\t\t\t<input type=\"checkbox\" checked={allSelected} onchange={toggleSelectAll} />\n\t\t\t\t\t<span class=\"checkmark\"></span>\n\t\t\t\t\tSelect All ({allFilteredTrips.length})\n\t\t\t\t</label>\n\t\t\t\t<span class=\"page-info\">Showing {visibleTrips.length} of {allFilteredTrips.length}</span>\n\t\t\t</div>\n\n\t\t\t<div class=\"trip-list-cards\">\n\t\t\t\t{#each visibleTrips as trip (trip.id)}\n\t\t\t\t\t<TripCard\n\t\t\t\t\t\t{trip}\n\t\t\t\t\t\tisExpanded={expandedTrips.has(trip.id)}\n\t\t\t\t\t\tisSelected={selectedTrips.has(trip.id)}\n\t\t\t\t\t\ton:toggleExpand={() => toggleExpand(trip.id)}\n\t\t\t\t\t\ton:toggleSelection={() => toggleSelection(trip.id)}\n\t\t\t\t\t\ton:edit={() => goto(resolve(`/dashboard/trips/edit/${trip.id}`))}\n\t\t\t\t\t\ton:delete={() => deleteTrip(trip.id)}\n\t\t\t\t\t/>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t{#if totalPages > 1}\n\t\t\t\t<div class=\"pagination-controls\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"page-btn\"\n\t\t\t\t\t\tdisabled={currentPage === 1}\n\t\t\t\t\t\tonclick={() => changePage(currentPage - 1)}>← Prev</button\n\t\t\t\t\t>\n\t\t\t\t\t<span class=\"page-status\">Page {currentPage} of {totalPages}</span>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"page-btn\"\n\t\t\t\t\t\tdisabled={currentPage === totalPages}\n\t\t\t\t\t\tonclick={() => changePage(currentPage + 1)}>Next →</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{:else}\n\t\t\t<div class=\"empty-state\">\n\t\t\t\t<p>No trips found matching your filters.</p>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n\n\t{#if selectedTrips.size > 0}\n\t\t<ActionBar\n\t\t\tselectedCount={selectedTrips.size}\n\t\t\t{isPro}\n\t\t\ton:cancel={() => (selectedTrips = new Set())}\n\t\t\ton:export={exportSelected}\n\t\t\ton:delete={deleteSelected}\n\t\t/>\n\t{/if}\n\n\t<SettingsModal bind:open={isSettingsOpen} {API_KEY} />\n\t<UpgradeModal bind:open={isUpgradeModalOpen} />\n\n\t{#snippet loading()}\n\t\t<div class=\"trips-loading\">\n\t\t\t<div class=\"loading-header\">\n\t\t\t\t<div class=\"skeleton skeleton-title\"></div>\n\t\t\t\t<div class=\"skeleton skeleton-button\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"loading-stats\">\n\t\t\t\t{#each Array(4) as _}<div class=\"skeleton skeleton-stat\"></div>{/each}\n\t\t\t</div>\n\t\t\t<div class=\"loading-filters\">\n\t\t\t\t<div class=\"skeleton skeleton-input\"></div>\n\t\t\t\t<div class=\"skeleton skeleton-select\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"trip-list-cards\">\n\t\t\t\t{#each Array(6) as _}<div class=\"trip-skeleton\">\n\t\t\t\t\t\t<div class=\"skeleton-top\">\n\t\t\t\t\t\t\t<div class=\"skeleton skeleton-text\" style=\"width: 30%; height: 14px;\"></div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"skeleton skeleton-text\"\n\t\t\t\t\t\t\t\tstyle=\"width: 60%; height: 18px; margin-top: 8px;\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"skeleton-stats-grid\">\n\t\t\t\t\t\t\t{#each Array(5) as _}<div>\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"skeleton skeleton-text\"\n\t\t\t\t\t\t\t\t\t\tstyle=\"width: 80%; height: 10px; margin-bottom: 4px;\"\n\t\t\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t\t\t<div class=\"skeleton skeleton-text\" style=\"width: 50%; height: 14px;\"></div>\n\t\t\t\t\t\t\t\t</div>{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>{/each}\n\t\t\t</div>\n\t\t</div>\n\t{/snippet}\n\n\t{#snippet error({ error, retry })}\n\t\t<div class=\"trips-error\">\n\t\t\t<div class=\"error-content\">\n\t\t\t\t<div class=\"error-icon\">\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"64\"\n\t\t\t\t\t\theight=\"64\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"10\" /><line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\" /><line\n\t\t\t\t\t\t\tx1=\"12\"\n\t\t\t\t\t\t\ty1=\"16\"\n\t\t\t\t\t\t\tx2=\"12.01\"\n\t\t\t\t\t\t\ty2=\"16\"\n\t\t\t\t\t\t/></svg\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<h2>Failed to Load Trips</h2>\n\t\t\t\t<p class=\"error-message\">\n\t\t\t\t\t{#if error.message.includes('fetch') || error.message.includes('Failed to fetch')}\n\t\t\t\t\t\tUnable to connect to the server. Please check your internet connection and try again.\n\t\t\t\t\t{:else if error.message.includes('401') || error.message.includes('Unauthorized')}\n\t\t\t\t\t\tYour session has expired. Please <a href={resolve('/login')}>log in again</a>.\n\t\t\t\t\t{:else if error.message.includes('403') || error.message.includes('Forbidden')}\n\t\t\t\t\t\tYou don't have permission to view trips. Please contact support if this persists.\n\t\t\t\t\t{:else if error.message.includes('500')}\n\t\t\t\t\t\tA server error occurred. Our team has been notified. Please try again in a few moments.\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t{error.message}\n\t\t\t\t\t{/if}\n\t\t\t\t</p>\n\t\t\t\t<div class=\"error-actions\">\n\t\t\t\t\t<button onclick={retry} class=\"btn-primary\"\n\t\t\t\t\t\t><svg\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t><polyline points=\"23 4 23 10 17 10\" /><path\n\t\t\t\t\t\t\t\td=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"\n\t\t\t\t\t\t\t/></svg\n\t\t\t\t\t\t> Try Again</button\n\t\t\t\t\t>\n\t\t\t\t\t<a href={resolve('/dashboard')} class=\"btn-secondary\">Go to Dashboard</a>\n\t\t\t\t</div>\n\t\t\t\t<details class=\"error-details\">\n\t\t\t\t\t<summary>Technical Details</summary>\n\t\t\t\t\t<pre><code\n\t\t\t\t\t\t\t>{JSON.stringify(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmessage: error.message,\n\t\t\t\t\t\t\t\t\ttime: new Date().toISOString(),\n\t\t\t\t\t\t\t\t\tpath: $page.url.pathname,\n\t\t\t\t\t\t\t\t\tuserAgent: navigator.userAgent\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t\t2\n\t\t\t\t\t\t\t)}</code\n\t\t\t\t\t\t></pre>\n\t\t\t\t</details>\n\t\t\t</div>\n\t\t</div>\n\t{/snippet}\n</AsyncErrorBoundary>\n\n<style>\n\t.trip-history {\n\t\tmax-width: 1400px;\n\t\tmargin: 0 auto;\n\t\tpadding: 16px;\n\t\tpadding-bottom: 80px;\n\t}\n\t.page-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 24px;\n\t}\n\t.page-title {\n\t\tfont-size: 24px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tmargin: 0;\n\t}\n\t.header-actions {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n\t}\n\t.btn-primary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tpadding: 10px 16px;\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\ttext-decoration: none;\n\t\tbox-shadow: 0 2px 8px rgba(255, 127, 80, 0.3);\n\t\ttransition: transform 0.1s;\n\t\tcursor: pointer;\n\t}\n\t.btn-primary:active {\n\t\ttransform: translateY(1px);\n\t}\n\t.btn-secondary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 10px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcursor: pointer;\n\t\ttransition: background 0.2s;\n\t\ttext-decoration: none;\n\t}\n\t.batch-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 12px;\n\t\tpadding: 0 4px;\n\t\tcolor: #6b7280;\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t}\n\t.checkbox-container {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tcursor: pointer;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #4b5563;\n\t\tposition: relative;\n\t\tpadding-left: 28px;\n\t\tuser-select: none;\n\t}\n\t.checkbox-container input {\n\t\tposition: absolute;\n\t\topacity: 0;\n\t\tcursor: pointer;\n\t\theight: 0;\n\t\twidth: 0;\n\t}\n\t.checkmark {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\theight: 20px;\n\t\twidth: 20px;\n\t\tbackground-color: white;\n\t\tborder: 2px solid #d1d5db;\n\t\tborder-radius: 6px;\n\t\ttransition: all 0.2s;\n\t}\n\t.checkbox-container:hover input ~ .checkmark {\n\t\tborder-color: #9ca3af;\n\t}\n\t.checkbox-container input:checked ~ .checkmark {\n\t\tbackground-color: #ff7f50;\n\t\tborder-color: #ff7f50;\n\t}\n\t.checkmark:after {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tdisplay: none;\n\t}\n\t.checkbox-container input:checked ~ .checkmark:after {\n\t\tdisplay: block;\n\t}\n\t.checkbox-container .checkmark:after {\n\t\tleft: 6px;\n\t\ttop: 2px;\n\t\twidth: 5px;\n\t\theight: 10px;\n\t\tborder: solid white;\n\t\tborder-width: 0 2px 2px 0;\n\t\ttransform: rotate(45deg);\n\t}\n\t.trip-list-cards {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t}\n\t.pagination-controls {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tgap: 16px;\n\t\tmargin-top: 32px;\n\t}\n\t.page-btn {\n\t\tpadding: 8px 16px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\t.page-btn:disabled {\n\t\topacity: 0.5;\n\t\tcursor: not-allowed;\n\t}\n\t.page-status {\n\t\tfont-size: 14px;\n\t\tcolor: #4b5563;\n\t\tfont-weight: 500;\n\t}\n\t.empty-state {\n\t\ttext-align: center;\n\t\tpadding: 40px 20px;\n\t\tcolor: #6b7280;\n\t\tfont-size: 15px;\n\t}\n\n\t/* Loading state styles */\n\t.trips-loading {\n\t\tpadding: 2rem;\n\t\tanimation: fadeIn 0.3s ease-out;\n\t}\n\t@keyframes fadeIn {\n\t\tfrom {\n\t\t\topacity: 0;\n\t\t}\n\t\tto {\n\t\t\topacity: 1;\n\t\t}\n\t}\n\t.loading-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 24px;\n\t}\n\t.loading-stats {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(2, 1fr);\n\t\tgap: 12px;\n\t\tmargin-bottom: 24px;\n\t}\n\t.loading-filters {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t\tmargin-bottom: 20px;\n\t}\n\t.skeleton {\n\t\tbackground: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);\n\t\tbackground-size: 200% 100%;\n\t\tanimation: shimmer 1.5s infinite;\n\t\tborder-radius: 0.5rem;\n\t}\n\t.skeleton-title {\n\t\twidth: 200px;\n\t\theight: 2rem;\n\t}\n\t.skeleton-button {\n\t\twidth: 120px;\n\t\theight: 2.5rem;\n\t}\n\t.skeleton-stat {\n\t\theight: 80px;\n\t\tborder-radius: 12px;\n\t}\n\t.skeleton-input {\n\t\tflex: 1;\n\t\theight: 2.5rem;\n\t}\n\t.skeleton-select {\n\t\twidth: 150px;\n\t\theight: 2.5rem;\n\t}\n\t.trip-skeleton {\n\t\tbackground: white;\n\t\tpadding: 1.5rem;\n\t\tborder-radius: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.skeleton-top {\n\t\tmargin-bottom: 1rem;\n\t}\n\t.skeleton-text {\n\t\theight: 1rem;\n\t\tmargin-bottom: 0.5rem;\n\t\tbackground: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);\n\t\tbackground-size: 200% 100%;\n\t\tanimation: shimmer 1.5s infinite;\n\t\tborder-radius: 0.25rem;\n\t}\n\t.skeleton-stats-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(2, 1fr);\n\t\tgap: 12px;\n\t}\n\t@keyframes shimmer {\n\t\t0% {\n\t\t\tbackground-position: 200% 0;\n\t\t}\n\t\t100% {\n\t\t\tbackground-position: -200% 0;\n\t\t}\n\t}\n\n\t/* Error state styles */\n\t.trips-error {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmin-height: 60vh;\n\t\tpadding: 2rem;\n\t\tanimation: fadeIn 0.3s ease-out;\n\t}\n\t.error-content {\n\t\ttext-align: center;\n\t\tmax-width: 500px;\n\t}\n\t.error-icon {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\twidth: 80px;\n\t\theight: 80px;\n\t\tbackground: #fee2e2;\n\t\tborder-radius: 50%;\n\t\tcolor: #dc2626;\n\t\tmargin-bottom: 1.5rem;\n\t}\n\t.trips-error h2 {\n\t\tfont-size: 1.5rem;\n\t\tfont-weight: 600;\n\t\tcolor: #111827;\n\t\tmargin: 0 0 0.5rem;\n\t}\n\t.error-message {\n\t\tcolor: #6b7280;\n\t\tmargin: 0 0 2rem;\n\t\tline-height: 1.6;\n\t}\n\t.error-message a {\n\t\tcolor: #ff7f50;\n\t\ttext-decoration: underline;\n\t\tfont-weight: 600;\n\t}\n\t.error-actions {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 0.75rem;\n\t\tmargin-bottom: 2rem;\n\t}\n\t.error-details {\n\t\tmargin-top: 2rem;\n\t\tpadding: 1rem;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 0.5rem;\n\t\ttext-align: left;\n\t}\n\t.error-details summary {\n\t\tcursor: pointer;\n\t\tcolor: #6b7280;\n\t\tfont-size: 0.875rem;\n\t\tfont-weight: 500;\n\t\tuser-select: none;\n\t}\n\t.error-details summary:hover {\n\t\tcolor: #374151;\n\t}\n\t.error-details pre {\n\t\tmargin-top: 0.5rem;\n\t\tpadding: 0.75rem;\n\t\tbackground: #1f2937;\n\t\tcolor: #f3f4f6;\n\t\tborder-radius: 0.375rem;\n\t\toverflow-x: auto;\n\t\tfont-size: 0.75rem;\n\t\tline-height: 1.5;\n\t}\n\n\t@media (hover: hover) {\n\t\t.btn-secondary:hover {\n\t\t\tbackground: #f9fafb;\n\t\t}\n\t\t.page-btn:hover:not(:disabled) {\n\t\t\tborder-color: #ff7f50;\n\t\t\tcolor: #ff7f50;\n\t\t}\n\t}\n\t@media (min-width: 640px) {\n\t\t.loading-stats {\n\t\t\tgrid-template-columns: repeat(4, 1fr);\n\t\t}\n\t\t.loading-filters {\n\t\t\tflex-direction: row;\n\t\t}\n\t\t.skeleton-stats-grid {\n\t\t\tgrid-template-columns: repeat(5, 1fr);\n\t\t}\n\t\t.error-actions {\n\t\t\tflex-direction: row;\n\t\t\tjustify-content: center;\n\t\t}\n\t}\n\n\t:global(body.has-selections .mobile-footer),\n\t:global(body.has-selections footer),\n\t:global(body.has-selections nav[class*='mobile']),\n\t:global(body.has-selections .bottom-nav) {\n\t\tdisplay: none !important;\n\t}\n\n\t@media (max-width: 640px) {\n\t\t/* Keep only the safe-area inset plus a small buffer so content sits close to the bottom nav */\n\t\t.trip-history {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\n\t\t/* Slightly compact card spacing on small screens */\n\t\t.trip-list-cards {\n\t\t\tgap: 8px;\n\t\t}\n\n\t\t/* Reduce extra space above pagination on mobile */\n\t\t.pagination-controls {\n\t\t\tmargin-top: 16px;\n\t\t}\n\n\t\t/* Compact empty-state padding on mobile */\n\t\t.empty-state {\n\t\t\tpadding: 24px 12px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trips\\components\\ActionBar.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trips\\components\\SettingsModal.svelte",
		"messages": [
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 311,
				"column": 6,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 335,
				"endColumn": 13
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { toasts } from '$lib/stores/toast';\n\timport { autocomplete } from '$lib/utils/autocomplete';\n\timport { saveSettings } from '../../settings/lib/save-settings';\n\timport { createEventDispatcher } from 'svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let open = false;\n\texport let API_KEY: string = '';\n\n\texport let activeCategoryType: 'maintenance' | 'supplies' | 'expenses' = 'maintenance';\n\tlet settingsTab: 'defaults' | 'categories' = 'defaults';\n\tlet newCategoryName = '';\n\tlet settings = { ...$userSettings };\n\n\t// Local primitives for form fields — binding directly to nested object props caused\n\t// inputs to appear uneditable in some browsers. Keep separate staged vars and commit\n\t// them to `settings` on Save.\n\tlet defaultMPGLocal: number | string = settings.defaultMPG;\n\tlet defaultStartLocal: string = settings.defaultStartAddress || '';\n\tlet defaultEndLocal: string = settings.defaultEndAddress || '';\n\n\t/* Initialize from store only when modal is opened. We intentionally avoid a global reactive\n\t   copy from `$userSettings` here because it would overwrite staged overrides while the user\n\t   is typing in the modal and make inputs appear un-editable. */\n\t$: activeCategories =\n\t\tactiveCategoryType === 'maintenance'\n\t\t\t? $userSettings.maintenanceCategories || ['oil change', 'repair']\n\t\t\t: activeCategoryType === 'supplies'\n\t\t\t\t? $userSettings.supplyCategories || ['water', 'snacks']\n\t\t\t\t: $userSettings.expenseCategories || ['maintenance', 'insurance', 'supplies', 'other'];\n\n\tfunction handleAddressSelect(field: 'start' | 'end', e: CustomEvent) {\n\t\tconst val = e.detail.formatted_address || e.detail.name;\n\t\t// Update the staged local value so the input stays editable; commit on Save\n\t\tif (field === 'start') defaultStartLocal = val;\n\t\tif (field === 'end') defaultEndLocal = val;\n\t}\n\n\tlet isSaving = false;\n\tlet didSave = false; // tracks whether user clicked Save Defaults\n\t// When modal opens/closes, keep a copy of persisted settings and reset staged values when closed without saving\n\t$: if (open) {\n\t\tdidSave = false;\n\t\tsettings = { ...$userSettings };\n\t\t// Initialize staged locals from persisted settings\n\t\tdefaultMPGLocal = settings?.defaultMPG ?? '';\n\t\tdefaultStartLocal = settings?.defaultStartAddress || '';\n\t\tdefaultEndLocal = settings?.defaultEndAddress || '';\n\t\tgasDisplay =\n\t\t\tsettings?.defaultGasPrice != null ? Number(settings.defaultGasPrice).toFixed(2) : '';\n\t}\n\t$: if (!open) {\n\t\t// If the modal is being closed without saving, reset staged changes\n\t\tif (!didSave) {\n\t\t\tsettings = { ...$userSettings };\n\t\t\t// Reset staged locals as well\n\t\t\tdefaultMPGLocal = settings?.defaultMPG ?? '';\n\t\t\tdefaultStartLocal = settings?.defaultStartAddress || '';\n\t\t\tdefaultEndLocal = settings?.defaultEndAddress || '';\n\t\t\tgasDisplay =\n\t\t\t\tsettings?.defaultGasPrice != null ? Number(settings.defaultGasPrice).toFixed(2) : '';\n\t\t}\n\t\t// reset flag for next open\n\t\tdidSave = false;\n\t}\n\n\tasync function saveDefaultSettings() {\n\t\tif (isSaving) return;\n\t\tif (console && console.debug) console.debug('[settings] saveDefaultSettings', settings);\n\t\tisSaving = true;\n\n\t\t// Commit staged addresses into settings and parse MPG from the staged local\n\t\tsettings.defaultStartAddress = defaultStartLocal;\n\t\tsettings.defaultEndAddress = defaultEndLocal;\n\n\t\ttry {\n\t\t\tconst mpgParsed = parseFloat(String(defaultMPGLocal).replace(/,/g, '.'));\n\t\t\tsettings.defaultMPG = isNaN(mpgParsed) ? 0 : mpgParsed;\n\t\t} catch (_e) {\n\t\t\t// ignore parsing errors — defaults will be enforced server-side\n\t\t}\n\n\t\ttry {\n\t\t\tconst parsed = parseFloat(String(gasDisplay).replace(/,/g, '.'));\n\t\t\tconst n = isNaN(parsed) ? 0 : parsed;\n\t\t\tsettings.defaultGasPrice = n;\n\t\t} catch (_e) {\n\t\t\t// ignore parsing errors — defaults will be enforced server-side\n\t\t}\n\n\t\t// Persist to the userSettings store and backend\n\t\tuserSettings.set(settings);\n\t\ttry {\n\t\t\tconst result = await saveSettings(settings);\n\t\t\tif (!result.ok) throw new Error(result.error);\n\t\t\ttoasts.success('Default values saved!');\n\t\t\tdispatch('success', 'Default values saved!');\n\t\t\t// Close modal on success\n\t\t\tdidSave = true;\n\t\t\topen = false;\n\t\t} catch (e) {\n\t\t\tconsole.error('Sync error:', e);\n\t\t\ttoasts.error('Saved locally, but cloud sync failed');\n\t\t} finally {\n\t\t\tisSaving = false;\n\t\t}\n\t}\n\n\tasync function updateCategories(newCategories: string[]) {\n\t\tconst updateData: any = {};\n\t\tif (activeCategoryType === 'maintenance') {\n\t\t\tuserSettings.update((s) => ({ ...s, maintenanceCategories: newCategories }));\n\t\t\tupdateData.maintenanceCategories = newCategories;\n\t\t} else if (activeCategoryType === 'supplies') {\n\t\t\tuserSettings.update((s) => ({ ...s, supplyCategories: newCategories }));\n\t\t\tupdateData.supplyCategories = newCategories;\n\t\t} else {\n\t\t\tuserSettings.update((s) => ({ ...s, expenseCategories: newCategories }));\n\t\t\tupdateData.expenseCategories = newCategories;\n\t\t}\n\n\t\ttry {\n\t\t\tconst result = await saveSettings(updateData);\n\t\t\tif (!result.ok) throw new Error(result.error);\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to sync settings', e);\n\t\t\ttoasts.error('Saved locally, but sync failed');\n\t\t}\n\t}\n\n\tasync function addCategory() {\n\t\tif (!newCategoryName.trim()) return;\n\t\tconst val = newCategoryName.trim().toLowerCase();\n\t\tif (activeCategories.includes(val)) {\n\t\t\ttoasts.error('Category already exists');\n\t\t\treturn;\n\t\t}\n\t\tconst updated = [...activeCategories, val];\n\t\tawait updateCategories(updated);\n\t\tnewCategoryName = '';\n\t\ttoasts.success('Category added');\n\t\tdispatch('success', 'Category added');\n\t}\n\n\tasync function removeCategory(cat: string) {\n\t\tif (!confirm(`Delete \"${cat}\" category?`)) return;\n\t\tconst updated = activeCategories.filter((c) => c !== cat);\n\t\tawait updateCategories(updated);\n\t\ttoasts.success('Category removed');\n\t\tdispatch('success', 'Category removed');\n\t}\n\n\t/* Gas price display handling: keep a formatted string for UI and sync to settings */\n\tlet gasDisplay: string =\n\t\tsettings?.defaultGasPrice != null ? Number(settings.defaultGasPrice).toFixed(2) : '';\n\n\t$: if (settings) {\n\t\t// only update display from settings when not actively editing\n\t\tif (\n\t\t\ttypeof document !== 'undefined' &&\n\t\t\tdocument.activeElement &&\n\t\t\t(document.activeElement as HTMLElement).id !== 'default-gas'\n\t\t) {\n\t\t\tgasDisplay =\n\t\t\t\tsettings.defaultGasPrice != null ? Number(settings.defaultGasPrice).toFixed(2) : '';\n\t\t}\n\t}\n\n\tfunction formatGas() {\n\t\t// normalize comma to dot and only update the staged display value.\n\t\tconst parsed = parseFloat(String(gasDisplay).replace(/,/g, '.'));\n\t\tconst n = isNaN(parsed) ? 0 : parsed;\n\t\tconst formatted = n.toFixed(2);\n\t\tgasDisplay = formatted;\n\t\t// NOTE: do NOT write to `settings.defaultGasPrice` here — only commit on Save.\n\t}\n\n\tfunction onGasInput(e: Event) {\n\t\t// allow only digits, dot, comma\n\t\tconst el = e.target as HTMLInputElement;\n\t\tel.value = el.value.replace(/[^0-9.,]/g, '');\n\t\tgasDisplay = el.value;\n\t}\n</script>\n\n<Modal bind:open title=\"Trip Settings\">\n\t<div class=\"settings-modal-content\">\n\t\t<div class=\"top-tabs\">\n\t\t\t<button\n\t\t\t\tclass=\"top-tab-btn\"\n\t\t\t\tclass:active={settingsTab === 'defaults'}\n\t\t\t\ton:click={() => (settingsTab = 'defaults')}>Default Values</button\n\t\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"top-tab-btn\"\n\t\t\t\tclass:active={settingsTab === 'categories'}\n\t\t\t\ton:click={() => (settingsTab = 'categories')}>Categories</button\n\t\t\t>\n\t\t</div>\n\n\t\t{#if settingsTab === 'defaults'}\n\t\t\t<div class=\"settings-form space-y-4\">\n\t\t\t\t<p class=\"text-sm text-gray-500 mb-2\">Pre-fill new trips with these values.</p>\n\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"default-mpg\" class=\"block text-sm font-medium text-gray-700 mb-1\"\n\t\t\t\t\t\t>Default MPG</label\n\t\t\t\t\t>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"default-mpg\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tbind:value={defaultMPGLocal}\n\t\t\t\t\t\tplaceholder=\"25\"\n\t\t\t\t\t\tmin=\"1\"\n\t\t\t\t\t\tstep=\"0.1\"\n\t\t\t\t\t\tclass=\"w-full p-2 border rounded-lg\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"default-gas\" class=\"block text-sm font-medium text-gray-700 mb-1\"\n\t\t\t\t\t\t>Default Gas Price</label\n\t\t\t\t\t>\n\t\t\t\t\t<div class=\"money-input\">\n\t\t\t\t\t\t<span class=\"money-symbol\">$</span>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"default-gas\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tinputmode=\"decimal\"\n\t\t\t\t\t\t\tbind:value={gasDisplay}\n\t\t\t\t\t\t\ton:input={onGasInput}\n\t\t\t\t\t\t\ton:blur={formatGas}\n\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\taria-label=\"Default gas price\"\n\t\t\t\t\t\t\tclass=\"money-input-field\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"default-start\" class=\"block text-sm font-medium text-gray-700 mb-1\"\n\t\t\t\t\t\t>Default Start Address</label\n\t\t\t\t\t>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"default-start\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tbind:value={defaultStartLocal}\n\t\t\t\t\t\tplaceholder=\"Start typing address...\"\n\t\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\t\ton:place-selected={(e: CustomEvent) => handleAddressSelect('start', e)}\n\t\t\t\t\t\tclass=\"w-full p-2 border rounded-lg\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"default-end\" class=\"block text-sm font-medium text-gray-700 mb-1\"\n\t\t\t\t\t\t>Default End Address</label\n\t\t\t\t\t>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"default-end\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tbind:value={defaultEndLocal}\n\t\t\t\t\t\tplaceholder=\"Start typing address...\"\n\t\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\t\ton:place-selected={(e: CustomEvent) => handleAddressSelect('end', e)}\n\t\t\t\t\t\tclass=\"w-full p-2 border rounded-lg\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"modal-actions pt-4\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"btn-primary w-full save-btn\"\n\t\t\t\t\t\ton:click={saveDefaultSettings}\n\t\t\t\t\t\tdisabled={isSaving}>{isSaving ? 'Saving…' : 'Save Defaults'}</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#if settingsTab === 'categories'}\n\t\t\t<div class=\"categories-manager\">\n\t\t\t\t<div class=\"tabs sub-tabs\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"tab-btn\"\n\t\t\t\t\t\tclass:active={activeCategoryType === 'maintenance'}\n\t\t\t\t\t\ton:click={() => (activeCategoryType = 'maintenance')}>Maintenance</button\n\t\t\t\t\t>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"tab-btn\"\n\t\t\t\t\t\tclass:active={activeCategoryType === 'supplies'}\n\t\t\t\t\t\ton:click={() => (activeCategoryType = 'supplies')}>Supplies</button\n\t\t\t\t\t>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"tab-btn\"\n\t\t\t\t\t\tclass:active={activeCategoryType === 'expenses'}\n\t\t\t\t\t\ton:click={() => (activeCategoryType = 'expenses')}>Expenses</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\n\t\t\t\t<p class=\"text-sm text-gray-500 mb-4\">\n\t\t\t\t\tManage {activeCategoryType} options.\n\t\t\t\t</p>\n\n\t\t\t\t<div class=\"cat-list\">\n\t\t\t\t\t{#each activeCategories as cat}\n\t\t\t\t\t\t<div class=\"cat-item\">\n\t\t\t\t\t\t\t<span class=\"cat-badge\">{cat}</span>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"cat-delete\"\n\t\t\t\t\t\t\t\ton:click={() => removeCategory(cat)}\n\t\t\t\t\t\t\t\taria-label=\"Delete Category\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"\n\t\t\t\t\t\t\t\t\t></line></svg\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\"text-sm text-gray-400 italic text-center py-4\">No categories defined.</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"add-cat-form\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tbind:value={newCategoryName}\n\t\t\t\t\t\tplaceholder=\"New category...\"\n\t\t\t\t\t\tclass=\"input-field\"\n\t\t\t\t\t\ton:keydown={(e) => e.key === 'Enter' && addCategory()}\n\t\t\t\t\t/>\n\t\t\t\t\t<button class=\"btn-secondary\" on:click={addCategory}>Add</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"modal-actions mt-6\">\n\t\t\t\t\t<button class=\"btn-cancel w-full\" on:click={() => (open = false)}>Done</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</Modal>\n\n<style>\n\t.categories-manager {\n\t\tpadding: 4px;\n\t}\n\t.top-tabs {\n\t\tdisplay: flex;\n\t\tborder-bottom: 2px solid #e5e7eb;\n\t\tmargin-bottom: 20px;\n\t}\n\t.top-tab-btn {\n\t\tflex: 1;\n\t\tpadding: 12px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\tborder: none;\n\t\tbackground: none;\n\t\tcursor: pointer;\n\t\tborder-bottom: 2px solid transparent;\n\t\tmargin-bottom: -2px;\n\t}\n\t.top-tab-btn.active {\n\t\tcolor: #ff7f50;\n\t\tborder-bottom-color: #ff7f50;\n\t}\n\t.sub-tabs {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\tmargin-bottom: 16px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t}\n\t.tab-btn {\n\t\tpadding: 8px 16px;\n\t\tbackground: none;\n\t\tborder: none;\n\t\tborder-bottom: 2px solid transparent;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\t.tab-btn.active {\n\t\tcolor: #ff7f50;\n\t\tborder-bottom-color: #ff7f50;\n\t}\n\n\t.cat-list {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgap: 8px;\n\t\tmargin-bottom: 20px;\n\t\tmax-height: 200px;\n\t\toverflow-y: auto;\n\t}\n\t.cat-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 4px;\n\t\tbackground: #f3f4f6;\n\t\tpadding: 4px 4px 4px 10px;\n\t\tborder-radius: 20px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.cat-badge {\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t\ttext-transform: capitalize;\n\t\tpadding: 0 4px;\n\t}\n\t.cat-delete {\n\t\tborder: none;\n\t\tbackground: #e5e7eb;\n\t\tcolor: #6b7280;\n\t\tborder-radius: 50%;\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\n\t.add-cat-form {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t}\n\t.add-cat-form .input-field {\n\t\tflex: 1;\n\t\tpadding: 10px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t}\n\t.modal-actions .btn-cancel {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\twidth: 100%;\n\t}\n\n\t.settings-form input:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t\tbox-shadow: 0 0 0 4px rgba(255, 127, 80, 0.08);\n\t}\n\n\t/* Visual-only $ inside the input field */\n\t.money-input {\n\t\tposition: relative;\n\t}\n\t/* Adaptive money input: tighter defaults to avoid excessive spacing */\n\t.money-input {\n\t\tposition: relative;\n\t\t/* anchor the symbol in pixels and compute pad from that + estimated width */\n\t\t--money-symbol-offset: 12px; /* pixel anchor */\n\t\t--money-symbol-gap: 0.5ch; /* small buffer for symbol width */\n\t\t--money-pad: calc(var(--money-symbol-offset) + 1ch + var(--money-symbol-gap));\n\t}\n\t@media (min-width: 768px) {\n\t\t.money-input {\n\t\t\t--money-symbol-offset: 12px;\n\t\t\t--money-symbol-gap: 0.6ch;\n\t\t\t--money-pad: calc(var(--money-symbol-offset) + 1ch + var(--money-symbol-gap));\n\t\t}\n\t}\n\t.money-symbol {\n\t\tposition: absolute;\n\t\tleft: var(--money-symbol-offset);\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\tcolor: #6b7280;\n\t\tfont-weight: 600;\n\t\tpointer-events: none;\n\t\tz-index: 2;\n\t\tmin-width: 1.2ch;\n\t\ttext-align: left;\n\t}\n\t.money-input-field {\n\t\twidth: 100%;\n\t\t/* smaller, balanced minimum padding that keeps the field compact */\n\t\tpadding: 10px 12px 10px 12px; /* fallback */\n\t\tpadding-left: max(var(--money-pad), 1.73rem); /* ~10% reduction from previous */\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tbackground: white;\n\t\tbox-sizing: border-box;\n\t\tfont-size: 16px;\n\t}\n\t/* ensure higher-specificity override inside modal */\n\t.settings-form .money-input .money-input-field {\n\t\tpadding-left: max(var(--money-pad), 1.73rem);\n\t}\n\n\t/* Slightly reduce the enforced minimum on very small screens */\n\t@media (max-width: 420px) {\n\t\t.money-input-field {\n\t\t\tpadding-left: max(var(--money-pad), 1.44rem);\n\t\t}\n\t\t.money-symbol {\n\t\t\tleft: 10px;\n\t\t}\n\t}\n\t.money-input-field:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t\tbox-shadow: 0 0 0 4px rgba(255, 127, 80, 0.08);\n\t}\n\t.money-input-field:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t\tbox-shadow: 0 0 0 4px rgba(255, 127, 80, 0.08);\n\t}\n\n\t.btn-primary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tpadding: 10px 16px;\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\ttext-decoration: none;\n\t\tbox-shadow: 0 2px 8px rgba(255, 127, 80, 0.3);\n\t\ttransition: transform 0.1s;\n\t\tcursor: pointer;\n\t}\n\t.btn-secondary {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 10px;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-size: 14px;\n\t\tcursor: pointer;\n\t\ttransition: background 0.2s;\n\t\ttext-decoration: none;\n\t}\n\t@media (hover: hover) {\n\t\t.btn-secondary:hover {\n\t\t\tbackground: #f9fafb;\n\t\t}\n\t\t.cat-delete:hover {\n\t\t\tbackground: #ef4444;\n\t\t\tcolor: white;\n\t\t}\n\t}\n\n\t/* IMPORTANT: Override Google Maps Autocomplete z-index to appear above the modal */\n\t:global(.pac-container) {\n\t\tz-index: 2147483647 !important;\n\t\t/* Positioning is handled by the autocomplete action (fixed vs absolute) */\n\t\tpointer-events: auto !important;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trips\\components\\TripCard.svelte",
		"messages": [
			{
				"ruleId": "svelte/prefer-svelte-reactivity",
				"severity": 2,
				"message": "Found a mutable instance of the built-in URLSearchParams class. Use SvelteURLSearchParams instead.",
				"line": 88,
				"column": 18,
				"nodeType": "NewExpression",
				"messageId": "mutableURLSearchParamsUsed",
				"endLine": 88,
				"endColumn": 64
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 251,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 283,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 324,
				"column": 9,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 329,
				"endColumn": 16
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 332,
				"column": 9,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 337,
				"endColumn": 16
			}
		],
		"suppressedMessages": [],
		"errorCount": 4,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport {\n\t\tformatCurrency,\n\t\tformatDate,\n\t\tformatTime,\n\t\tformatDuration,\n\t\tformatHours,\n\t\tcalculateNetProfit,\n\t\tcalculateHourlyPay\n\t} from '$lib/utils/trip-helpers';\n\timport { swipeable } from '$lib/actions/swipe';\n\timport { createEventDispatcher } from 'svelte';\n\timport { mileage } from '$lib/stores/mileage';\n\n\texport let trip: any;\n\texport let isExpanded = false;\n\texport let isSelected = false;\n\n\tconst dispatch = createEventDispatcher();\n\n\t// Prefer authoritative mileage when available; fall back to trip.totalMiles\n\tlet displayMiles = 0;\n\t$: displayMiles = $mileage.find((m: any) => m.id === trip.id)?.miles ?? trip.totalMiles ?? 0;\n\n\t$: profit = calculateNetProfit(trip);\n\t$: hourlyPay = calculateHourlyPay(trip);\n\t$: totalCosts = (trip.fuelCost || 0) + (trip.maintenanceCost || 0) + (trip.suppliesCost || 0);\n\t$: supplies = trip.supplyItems || trip.suppliesItems || [];\n\n\tfunction openGoogleMaps(e: MouseEvent, trip: any) {\n\t\te.stopPropagation();\n\t\tconst origin = encodeURIComponent(trip.startAddress || '');\n\t\tconst destination = encodeURIComponent(trip.endAddress || trip.startAddress || '');\n\n\t\tlet url = `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}`;\n\t\tif (trip.stops && trip.stops.length > 0) {\n\t\t\tconst waypoints = trip.stops\n\t\t\t\t.map((s: any) => encodeURIComponent(s.address || ''))\n\t\t\t\t.filter((a: string) => a.length > 0)\n\t\t\t\t.join('|');\n\t\t\tif (waypoints) {\n\t\t\t\turl += `&waypoints=${waypoints}`;\n\t\t\t}\n\t\t}\n\t\twindow.open(url, '_blank');\n\t}\n\n\tasync function openMapToStop(e: MouseEvent, trip: any, stopIndex: number) {\n\t\te.stopPropagation();\n\t\tconst targetStop = trip.stops[stopIndex];\n\t\tconst destination = targetStop.address || '';\n\n\t\t// Try to get the user's current location (with a timeout). If unavailable, omit origin so Google uses current location.\n\t\tlet originParam = '';\n\t\tfunction getCurrentPosition(timeout = 5000) {\n\t\t\treturn new Promise<GeolocationPosition>((resolve, reject) => {\n\t\t\t\tif (!navigator.geolocation) return reject(new Error('Geolocation unsupported'));\n\t\t\t\tlet timedOut = false;\n\t\t\t\tconst timer = setTimeout(() => {\n\t\t\t\t\ttimedOut = true;\n\t\t\t\t\treject(new Error('Geolocation timeout'));\n\t\t\t\t}, timeout);\n\n\t\t\t\tnavigator.geolocation.getCurrentPosition(\n\t\t\t\t\t(pos) => {\n\t\t\t\t\t\tif (timedOut) return;\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t\tresolve(pos);\n\t\t\t\t\t},\n\t\t\t\t\t(err) => {\n\t\t\t\t\t\tif (timedOut) return;\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t},\n\t\t\t\t\t{ enableHighAccuracy: true, maximumAge: 0 }\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tconst pos = await getCurrentPosition(5000);\n\t\t\toriginParam = `${pos.coords.latitude},${pos.coords.longitude}`;\n\t\t} catch (_err) {\n\t\t\t// If we can't get geolocation, omit the origin parameter so Google will use the user's current location.\n\t\t\toriginParam = '';\n\t\t}\n\n\t\tconst params = new URLSearchParams({ api: '1', destination });\n\t\tif (originParam) params.set('origin', originParam);\n\t\t// Note: do not include earlier stops as waypoints — map should go from current location to the selected stop only.\n\n\t\tconst url = `https://www.google.com/maps/dir/?${params.toString()}`;\n\t\twindow.open(url, '_blank');\n\t}\n\n\tfunction handleEdit() {\n\t\tdispatch('edit', trip.id);\n\t}\n\tfunction handleDelete() {\n\t\tdispatch('delete', trip.id);\n\t}\n\tfunction handleExpand() {\n\t\tdispatch('toggleExpand', trip.id);\n\t}\n\tfunction handleSelection() {\n\t\tdispatch('toggleSelection', trip.id);\n\t}\n\n\tfunction handleKeydown(e: KeyboardEvent) {\n\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\te.preventDefault();\n\t\t\thandleExpand();\n\t\t}\n\t}\n</script>\n\n<div class=\"trip-card-wrapper\">\n\t<div class=\"swipe-bg\">\n\t\t<div class=\"swipe-action edit\"><span>Edit</span></div>\n\t\t<div class=\"swipe-action delete\"><span>Delete</span></div>\n\t</div>\n\n\t<div\n\t\tclass=\"trip-card\"\n\t\tid={'trip-' + trip.id}\n\t\tclass:expanded={isExpanded}\n\t\tclass:selected={isSelected}\n\t\ton:click={handleExpand}\n\t\ton:keydown={handleKeydown}\n\t\trole=\"button\"\n\t\ttabindex=\"0\"\n\t\taria-expanded={isExpanded}\n\t\tuse:swipeable={{ onEdit: handleEdit, onDelete: handleDelete }}\n\t>\n\t\t<div class=\"card-top\">\n\t\t\t<div class=\"selection-box\" role=\"none\">\n\t\t\t\t<label class=\"checkbox-container\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\taria-labelledby={'trip-' + trip.id + '-title'}\n\t\t\t\t\t\tchecked={isSelected}\n\t\t\t\t\t\ton:click|stopPropagation\n\t\t\t\t\t\ton:keydown|stopPropagation\n\t\t\t\t\t\ton:change={handleSelection}\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"checkmark\"></span>\n\t\t\t\t</label>\n\t\t\t</div>\n\n\t\t\t<div class=\"trip-route-date\">\n\t\t\t\t<span class=\"trip-date-display\">\n\t\t\t\t\t{formatDate(trip.date || '')}\n\t\t\t\t\t{#if trip.startTime}\n\t\t\t\t\t\t<span class=\"time-range\"\n\t\t\t\t\t\t\t>• {formatTime(trip.startTime)} - {formatTime(trip.endTime || '17:00')}</span\n\t\t\t\t\t\t>\n\t\t\t\t\t{/if}\n\t\t\t\t</span>\n\n\t\t\t\t<div class=\"trip-title-row\">\n\t\t\t\t\t<h3 class=\"trip-route-title\" id={'trip-' + trip.id + '-title'}>\n\t\t\t\t\t\t{typeof trip.startAddress === 'string' ? trip.startAddress.split(',')[0] : 'Unknown'}\n\t\t\t\t\t\t{#if trip.stops && trip.stops.length > 0}\n\t\t\t\t\t\t\t→ {typeof trip.stops[trip.stops.length - 1]?.address === 'string'\n\t\t\t\t\t\t\t\t? trip.stops[trip.stops.length - 1].address.split(',')[0]\n\t\t\t\t\t\t\t\t: 'Stop'}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"map-link-btn\"\n\t\t\t\t\t\ton:click|stopPropagation={(e) => openGoogleMaps(e, trip)}\n\t\t\t\t\t\ttitle=\"View Route in Google Maps\"\n\t\t\t\t\t\taria-label=\"View Route in Google Maps\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path d=\"M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0\"></path>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z\"\n\t\t\t\t\t\t\t></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"profit-display-large\" class:positive={profit >= 0} class:negative={profit < 0}>\n\t\t\t\t{formatCurrency(profit)}\n\t\t\t</div>\n\n\t\t\t<svg\n\t\t\t\tclass=\"expand-icon\"\n\t\t\t\twidth=\"20\"\n\t\t\t\theight=\"20\"\n\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\tfill=\"none\"\n\t\t\t\taria-hidden=\"true\"\n\t\t\t>\n\t\t\t\t<path\n\t\t\t\t\td=\"M6 15L10 11L14 15M14 5L10 9L6 5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</div>\n\n\t\t<div class=\"card-stats\">\n\t\t\t<div class=\"stat-item\">\n\t\t\t\t<span class=\"stat-label\">Miles</span>\n\t\t\t\t<span class=\"stat-value\">{displayMiles?.toFixed(2) || '0.00'}</span>\n\t\t\t</div>\n\t\t\t<div class=\"stat-item\">\n\t\t\t\t<span class=\"stat-label\">Stops</span>\n\t\t\t\t<span class=\"stat-value\">{trip.stops?.length || 0}</span>\n\t\t\t</div>\n\t\t\t<div class=\"stat-item\">\n\t\t\t\t<span class=\"stat-label\">Hours</span>\n\t\t\t\t<span class=\"stat-value\">{formatHours(trip.hoursWorked)}</span>\n\t\t\t</div>\n\t\t\t<div class=\"stat-item\">\n\t\t\t\t<span class=\"stat-label\">Drive</span>\n\t\t\t\t<span class=\"stat-value\">{formatDuration(trip.estimatedTime)}</span>\n\t\t\t</div>\n\n\t\t\t<div class=\"stat-item\">\n\t\t\t\t<span class=\"stat-label\">$/Hr</span>\n\t\t\t\t<span class=\"stat-value hourly-pay\"\n\t\t\t\t\t>{trip.hoursWorked > 0 ? formatCurrency(hourlyPay) : '-'}</span\n\t\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if isExpanded}\n\t\t\t<div class=\"expanded-details\" role=\"group\">\n\t\t\t\t<div class=\"detail-section\">\n\t\t\t\t\t<h4 class=\"section-heading\">Stops & Addresses</h4>\n\t\t\t\t\t<div class=\"address-list\">\n\t\t\t\t\t\t<div class=\"address-row\">\n\t\t\t\t\t\t\t<span class=\"address-text\"><strong>Start:</strong> {trip.startAddress}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#if trip.stops}\n\t\t\t\t\t\t\t{#each trip.stops as stop, i}\n\t\t\t\t\t\t\t\t<div class=\"address-row\">\n\t\t\t\t\t\t\t\t\t<span class=\"address-text\"><strong>Stop {i + 1}:</strong> {stop.address}</span>\n\t\t\t\t\t\t\t\t\t{#if Number(stop.earnings) > 0}\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\tclass=\"stop-amount\"\n\t\t\t\t\t\t\t\t\t\t\ttitle={formatCurrency(Number(stop.earnings))}\n\t\t\t\t\t\t\t\t\t\t\taria-label={`Stop amount ${formatCurrency(Number(stop.earnings))}`}\n\t\t\t\t\t\t\t\t\t\t\tdata-testid={`stop-amount-${i}`}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(Number(stop.earnings))}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"mini-map-btn\"\n\t\t\t\t\t\t\t\t\t\ton:click|stopPropagation={(e) => openMapToStop(e, trip, i)}\n\t\t\t\t\t\t\t\t\t\ttitle=\"Map route from Start to here\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\twidth=\"14\"\n\t\t\t\t\t\t\t\t\t\t\theight=\"14\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<polygon points=\"3 11 22 2 13 21 11 13 3 11\"></polygon>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if trip.endAddress && trip.endAddress !== trip.startAddress}\n\t\t\t\t\t\t\t<div class=\"address-row\">\n\t\t\t\t\t\t\t\t<span class=\"address-text\"><strong>End:</strong> {trip.endAddress}</span>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"mini-map-btn\"\n\t\t\t\t\t\t\t\t\ton:click|stopPropagation={(e) => openGoogleMaps(e, trip)}\n\t\t\t\t\t\t\t\t\ttitle=\"Map full route\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\twidth=\"14\"\n\t\t\t\t\t\t\t\t\t\theight=\"14\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<polygon points=\"3 11 22 2 13 21 11 13 3 11\"></polygon>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{#if totalCosts > 0}\n\t\t\t\t\t<div class=\"detail-section\">\n\t\t\t\t\t\t<h4 class=\"section-heading\">Expenses & Costs</h4>\n\t\t\t\t\t\t<div class=\"expense-list\">\n\t\t\t\t\t\t\t{#if trip.fuelCost > 0}\n\t\t\t\t\t\t\t\t<div class=\"expense-row\">\n\t\t\t\t\t\t\t\t\t<span>Fuel</span>\n\t\t\t\t\t\t\t\t\t<span>{formatCurrency(trip.fuelCost)}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if trip.maintenanceItems}\n\t\t\t\t\t\t\t\t{#each trip.maintenanceItems as item}\n\t\t\t\t\t\t\t\t\t<div class=\"expense-row\">\n\t\t\t\t\t\t\t\t\t\t<span>{item.type}</span>\n\t\t\t\t\t\t\t\t\t\t<span>{formatCurrency(item.cost)}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{#if supplies.length > 0}\n\t\t\t\t\t\t\t\t{#each supplies as item}\n\t\t\t\t\t\t\t\t\t<div class=\"expense-row\">\n\t\t\t\t\t\t\t\t\t\t<span>{item.type}</span>\n\t\t\t\t\t\t\t\t\t\t<span>{formatCurrency(item.cost)}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t<div class=\"expense-row total\">\n\t\t\t\t\t\t\t\t<span>Total Costs</span>\n\t\t\t\t\t\t\t\t<span>{formatCurrency(totalCosts)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t{#if trip.notes}\n\t\t\t\t\t<div class=\"detail-section\">\n\t\t\t\t\t\t<h4 class=\"section-heading\">Notes</h4>\n\t\t\t\t\t\t<p class=\"trip-notes\">{trip.notes}</p>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"action-buttons-footer\">\n\t\t\t\t\t<button class=\"action-btn-lg edit-btn\" on:click|stopPropagation={handleEdit}>\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"\n\t\t\t\t\t\t\t><path\n\t\t\t\t\t\t\t\td=\"M11 2L14 5L5 14H2V11L11 2Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t\tEdit\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class=\"action-btn-lg delete-btn\" on:click|stopPropagation={handleDelete}>\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\"\n\t\t\t\t\t\t\t><path\n\t\t\t\t\t\t\t\td=\"M2 4H14M12 4V13C12 13.5304 11.7893 14.0391 11.4142 14.4142C11.0391 14.7893 10.5304 15 10 15H6C5.46957 15 4.96086 14.7893 4.58579 14.4142C4.21071 14.0391 4 13.5304 4 13V4M5 4V3C5 2.46957 5.21071 1.96086 5.58579 1.58579C5.96086 1.21071 6.46957 1 7 1H9C9.53043 1 10.0391 1.21071 10.4142 1.58579C10.7893 1.96086 11 2.46957 11 3V4\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t\tTrash\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t.trip-card-wrapper {\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t\tborder-radius: 12px;\n\t\tbackground: #f3f4f6;\n\t}\n\t.swipe-bg {\n\t\tposition: absolute;\n\t\tinset: 0;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 0 20px;\n\t\tz-index: 0;\n\t}\n\t.swipe-action {\n\t\tfont-weight: 700;\n\t\tfont-size: 14px;\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 1px;\n\t}\n\t.swipe-action.edit {\n\t\tcolor: #2563eb;\n\t}\n\t.swipe-action.delete {\n\t\tcolor: #dc2626;\n\t}\n\t.trip-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tpadding: 16px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tposition: relative;\n\t\tz-index: 1;\n\t}\n\t.trip-card:active {\n\t\tbackground-color: #f9fafb;\n\t}\n\t.trip-card.expanded {\n\t\tborder-color: #ff7f50;\n\t\tbox-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\n\t}\n\t.trip-card.selected {\n\t\tbackground-color: #fff7ed;\n\t\tborder-color: #ff7f50;\n\t}\n\n\t.card-top {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: auto 1fr auto 20px;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding-bottom: 12px;\n\t\tmargin-bottom: 12px;\n\t\tborder-bottom: 1px solid #f3f4f6;\n\t}\n\t.selection-box {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\t.trip-route-date {\n\t\toverflow: hidden;\n\t}\n\t.trip-date-display {\n\t\tdisplay: block;\n\t\tfont-size: 12px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\tmargin-bottom: 4px;\n\t}\n\t.time-range {\n\t\tcolor: #4b5563;\n\t\tmargin-left: 4px;\n\t\tfont-weight: 500;\n\t}\n\n\t.trip-title-row {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tmin-width: 0;\n\t}\n\t.trip-route-title {\n\t\tfont-size: 16px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tflex: 1;\n\t}\n\n\t.stop-amount {\n\t\tfont-size: 13px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tpadding: 4px 8px;\n\t\tborder-radius: 6px;\n\t\twhite-space: nowrap;\n\t\tflex-shrink: 0;\n\t\tmargin-left: 8px;\n\t\tbox-shadow: 0 1px 0 rgba(16, 24, 40, 0.03);\n\t}\n\n\t.map-link-btn {\n\t\tbackground: none;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t\tpadding: 4px;\n\t\tborder-radius: 6px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\ttransition: all 0.2s;\n\t\tflex-shrink: 0;\n\t\theight: 24px;\n\t\twidth: 24px;\n\t}\n\t.map-link-btn:hover {\n\t\tcolor: #ff7f50;\n\t\tborder-color: #ff7f50;\n\t\tbackground: #fff7ed;\n\t}\n\n\t.address-row {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tmargin: 4px 0;\n\t}\n\t.address-text {\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t\tword-break: break-word;\n\t}\n\n\t.mini-map-btn {\n\t\tbackground: none;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #9ca3af;\n\t\tcursor: pointer;\n\t\tpadding: 4px;\n\t\tborder-radius: 4px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\ttransition: all 0.2s;\n\t\tflex-shrink: 0;\n\t}\n\t.mini-map-btn:hover {\n\t\tcolor: #ff7f50;\n\t\tborder-color: #ff7f50;\n\t\tbackground: #fff7ed;\n\t}\n\n\t.profit-display-large {\n\t\tfont-size: 18px;\n\t\tfont-weight: 800;\n\t\twhite-space: nowrap;\n\t}\n\t.profit-display-large.positive {\n\t\tcolor: #10b981;\n\t}\n\t.profit-display-large.negative {\n\t\tcolor: #dc2626;\n\t}\n\t.expand-icon {\n\t\tcolor: #9ca3af;\n\t\ttransition: transform 0.2s;\n\t}\n\t.trip-card.expanded .expand-icon {\n\t\ttransform: rotate(180deg);\n\t}\n\n\t.card-stats {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(2, 1fr);\n\t\tgap: 12px;\n\t}\n\t.stat-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t}\n\t.stat-label {\n\t\tfont-size: 11px;\n\t\tcolor: #9ca3af;\n\t\ttext-transform: uppercase;\n\t}\n\t.stat-value {\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #4b5563;\n\t}\n\t.hourly-pay {\n\t\tcolor: #059669;\n\t}\n\n\t.expanded-details {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t\tpadding-top: 16px;\n\t\tborder-top: 1px dashed #e5e7eb;\n\t\tmargin-top: 16px;\n\t}\n\t.detail-section {\n\t\tbackground: #f9fafb;\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t}\n\t.section-heading {\n\t\tfont-size: 13px;\n\t\tfont-weight: 700;\n\t\tcolor: #1f2937;\n\t\tmargin-bottom: 8px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t\tpadding-bottom: 6px;\n\t}\n\t.address-text {\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tmargin: 4px 0;\n\t}\n\t.expense-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 4px;\n\t}\n\t.expense-row {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tfont-size: 13px;\n\t\tcolor: #4b5563;\n\t}\n\t.expense-row.total {\n\t\tborder-top: 1px solid #e5e7eb;\n\t\tmargin-top: 4px;\n\t\tpadding-top: 4px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t}\n\t.trip-notes {\n\t\tfont-style: italic;\n\t\tfont-size: 14px;\n\t\tcolor: #4b5563;\n\t\tline-height: 1.4;\n\t}\n\n\t.action-buttons-footer {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t}\n\t.action-btn-lg {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 8px;\n\t\tpadding: 10px;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tfont-family: inherit;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tborder: 2px solid;\n\t\tfont-size: 14px;\n\t}\n\t.edit-btn {\n\t\tbackground: #eff6ff;\n\t\tcolor: #2563eb;\n\t\tborder-color: #2563eb;\n\t}\n\t.delete-btn {\n\t\tbackground: #fef2f2;\n\t\tcolor: #dc2626;\n\t\tborder-color: #dc2626;\n\t}\n\n\t@keyframes pulse-border {\n\t\t0% {\n\t\t\tborder-color: #ff7f50;\n\t\t\tbox-shadow: 0 0 0 0 rgba(255, 127, 80, 0.4);\n\t\t}\n\t\t70% {\n\t\t\tborder-color: #ff7f50;\n\t\t\tbox-shadow: 0 0 0 10px rgba(255, 127, 80, 0);\n\t\t}\n\t\t100% {\n\t\t\tborder-color: #e5e7eb;\n\t\t\tbox-shadow: 0 0 0 0 rgba(255, 127, 80, 0);\n\t\t}\n\t}\n\t:global(.highlight-pulse) {\n\t\tanimation: pulse-border 2s ease-out;\n\t}\n\n\t.checkbox-container {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tcursor: pointer;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #4b5563;\n\t\tposition: relative;\n\t\tpadding-left: 28px;\n\t\tuser-select: none;\n\t}\n\t.checkbox-container input {\n\t\tposition: absolute;\n\t\topacity: 0;\n\t\tcursor: pointer;\n\t\theight: 0;\n\t\twidth: 0;\n\t}\n\t.checkmark {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\theight: 20px;\n\t\twidth: 20px;\n\t\tbackground-color: white;\n\t\tborder: 2px solid #d1d5db;\n\t\tborder-radius: 6px;\n\t\ttransition: all 0.2s;\n\t}\n\t.checkbox-container:hover input ~ .checkmark {\n\t\tborder-color: #9ca3af;\n\t}\n\t.checkbox-container input:checked ~ .checkmark {\n\t\tbackground-color: #ff7f50;\n\t\tborder-color: #ff7f50;\n\t}\n\t.checkmark:after {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tdisplay: none;\n\t}\n\t.checkbox-container input:checked ~ .checkmark:after {\n\t\tdisplay: block;\n\t}\n\t.checkbox-container .checkmark:after {\n\t\tleft: 6px;\n\t\ttop: 2px;\n\t\twidth: 5px;\n\t\theight: 10px;\n\t\tborder: solid white;\n\t\tborder-width: 0 2px 2px 0;\n\t\ttransform: rotate(45deg);\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trips\\components\\TripFilters.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trips\\components\\TripStats.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trips\\components\\UpgradeModal.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 42,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 42,
				"endColumn": 30
			}
		],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport Button from '$lib/components/ui/Button.svelte';\n\n\texport let open = false;\n</script>\n\n<Modal bind:open title=\"Upgrade to Pro\">\n\t<div class=\"space-y-6 text-center py-4\">\n\t\t<div class=\"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4\">\n\t\t\t<span class=\"text-3xl\">🚀</span>\n\t\t</div>\n\n\t\t<h3 class=\"text-xl font-bold text-gray-900\">Unlock Pro Features</h3>\n\n\t\t<p class=\"text-gray-600 text-base leading-relaxed\">\n\t\t\tData Export is a Pro feature. Upgrade now to download your trip history for taxes!\n\t\t</p>\n\n\t\t<div class=\"bg-gray-50 p-4 rounded-lg text-left text-sm space-y-2 border border-gray-100\">\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Unlimited Stops per Trip</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">One-Click Route Optimization</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Unlimited Monthly Trips</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500 text-lg\">✓</span>\n\t\t\t\t<span class=\"text-gray-700\">Data Export</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex gap-3 justify-center pt-2\">\n\t\t\t<Button variant=\"outline\" on:click={() => (open = false)}>Maybe Later</Button>\n\t\t\t<a\n\t\t\t\thref=\"/dashboard/settings\"\n\t\t\t\tclass=\"inline-flex items-center justify-center rounded-lg bg-orange-600 px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600 transition-all\"\n\t\t\t>\n\t\t\t\tUpgrade Now\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</Modal>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trips\\edit\\[id]\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 116,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 116,
				"endColumn": 36
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 793,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 793,
				"endColumn": 36
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 828,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 828,
				"endColumn": 40
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1083,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1084,
				"endColumn": 16
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1091,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1117,
				"endColumn": 19
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1144,
				"column": 8,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1145,
				"endColumn": 16
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1150,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1175,
				"endColumn": 19
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1230,
				"column": 17,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1232,
				"endColumn": 19
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1232,
				"column": 19,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1234,
				"endColumn": 19
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1268,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1292,
				"endColumn": 11
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 1346,
				"column": 10,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 1346,
				"endColumn": 42
			}
		],
		"suppressedMessages": [],
		"errorCount": 7,
		"fatalErrorCount": 0,
		"warningCount": 4,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { trips } from '$lib/stores/trips';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { goto } from '$app/navigation';\n\timport { base } from '$app/paths';\n\n\tconst resolve = (href: string) => `${base}${href}`;\n\timport { user } from '$lib/stores/auth';\n\timport { mileage } from '$lib/stores/mileage';\n\timport { page } from '$app/stores';\n\timport { autocomplete } from '$lib/utils/autocomplete';\n\timport { optimizeRoute } from '$lib/services/maps';\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport { toasts } from '$lib/stores/toast';\n\timport Button from '$lib/components/ui/Button.svelte';\n\timport { PLAN_LIMITS } from '$lib/constants';\n\n\texport let data;\n\t$: API_KEY = String(data.googleMapsApiKey ?? '');\n\tconst tripId = $page.params.id;\n\n\tlet isCalculating = false;\n\tlet dragItemIndex: number | null = null;\n\n\t$: maintenanceOptions =\n\t\t$userSettings.maintenanceCategories?.length > 0\n\t\t\t? $userSettings.maintenanceCategories\n\t\t\t: ['Oil Change', 'Tire Rotation', 'Brake Service', 'Filter Replacement'];\n\n\t$: suppliesOptions =\n\t\t$userSettings.supplyCategories?.length > 0\n\t\t\t? $userSettings.supplyCategories\n\t\t\t: ['Concrete', 'Poles', 'Wire', 'Tools', 'Equipment Rental'];\n\n\tlet selectedMaintenance = '';\n\tlet selectedSupply = '';\n\n\tlet isManageCategoriesOpen = false;\n\tlet activeCategoryType: 'maintenance' | 'supplies' = 'maintenance';\n\tlet newCategoryName = '';\n\t$: activeCategories = activeCategoryType === 'maintenance' ? maintenanceOptions : suppliesOptions;\n\n\tlet showUpgradeModal = false;\n\tlet upgradeMessage = '';\n\n\tfunction getLocalDate(): string {\n\t\tconst now = new Date();\n\t\tconst isoStr = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString();\n\t\treturn isoStr.split('T')[0] ?? '';\n\t}\n\n\t/**\n\t * Normalize any date format to YYYY-MM-DD for HTML date inputs.\n\t * Handles: YYYY-MM-DD, MM/DD/YYYY, ISO timestamp strings\n\t */\n\tfunction normalizeDate(dateStr: string | undefined | null): string {\n\t\tconst fallback = getLocalDate();\n\t\tif (!dateStr) return fallback;\n\n\t\t// If already in YYYY-MM-DD format, return as-is\n\t\tif (/^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)) {\n\t\t\treturn dateStr;\n\t\t}\n\n\t\t// Try MM/DD/YYYY format (from HughesNet)\n\t\tconst slashMatch = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{2,4})$/);\n\t\tif (slashMatch) {\n\t\t\tlet y = slashMatch[3] ?? '1970';\n\t\t\tif (y.length === 2) y = '20' + y;\n\t\t\tconst m = (slashMatch[1] ?? '1').padStart(2, '0');\n\t\t\tconst d = (slashMatch[2] ?? '1').padStart(2, '0');\n\t\t\treturn `${y}-${m}-${d}`;\n\t\t}\n\n\t\t// Try parsing as a Date object (handles ISO timestamps, etc.)\n\t\ttry {\n\t\t\tconst parsed = new Date(dateStr);\n\t\t\tif (!isNaN(parsed.getTime())) {\n\t\t\t\tconst isoStr = parsed.toISOString();\n\t\t\t\treturn isoStr.split('T')[0] ?? fallback;\n\t\t\t}\n\t\t} catch {\n\t\t\t// Fall through\n\t\t}\n\n\t\treturn fallback;\n\t}\n\n\tfunction formatDuration(minutes: number): string {\n\t\tif (!minutes) return '0 min';\n\t\tconst h = Math.floor(minutes / 60);\n\t\tconst m = Math.round(minutes % 60);\n\t\tif (h > 0) return `${h} hr ${m} min`;\n\t\treturn `${m} min`;\n\t}\n\n\timport { onMount } from 'svelte';\n\n\tonMount(() => {\n\t\tloadTripData();\n\t});\n\n\tasync function loadTripData() {\n\t\tconst currentUser = $page.data['user'] || $user;\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id');\n\t\tif (!$trips || $trips.length === 0) {\n\t\t\tif (userId) await trips.load(userId);\n\t\t}\n\t\t// Ensure mileage store is loaded to get accurate totalMiles\n\t\tif (!$mileage || $mileage.length === 0) {\n\t\t\tif (userId) await mileage.load(userId);\n\t\t}\n\t\tconst found = $trips.find((t) => t.id === tripId);\n\t\tif (!found) {\n\t\t\ttoasts.error('Trip not found');\n\t\t\tgoto(resolve('/dashboard/trips'));\n\t\t\treturn;\n\t\t}\n\t\tconst safeStops = (found.stops || []).map((s: any) => ({\n\t\t\t...s,\n\t\t\tid: s.id || crypto.randomUUID(),\n\t\t\taddress: s.address || '',\n\t\t\tdistanceFromPrev: s.distanceFromPrev || 0,\n\t\t\ttimeFromPrev: s.timeFromPrev || 0\n\t\t}));\n\t\tconst safeMaintenance = ((found as any)['maintenanceItems'] || []).map((m: any) => ({\n\t\t\t...m,\n\t\t\tid: m.id || crypto.randomUUID(),\n\t\t\ttaxDeductible: !!m.taxDeductible\n\t\t}));\n\t\tconst rawSupplies = (found as any)['supplyItems'] || (found as any)['suppliesItems'] || [];\n\t\tconst safeSupplies = (rawSupplies || []).map((s: any) => ({\n\t\t\t...s,\n\t\t\tid: s.id || crypto.randomUUID(),\n\t\t\ttaxDeductible: !!s.taxDeductible\n\t\t}));\n\t\tconst to24h = (timeStr?: string): string => {\n\t\t\tif (!timeStr) return '';\n\t\t\t// If already in 24h format (no AM/PM), return as-is\n\t\t\tif (!/AM|PM/i.test(timeStr)) return timeStr;\n\t\t\tconst [time = '', modifier = ''] = timeStr.split(' ');\n\t\t\tconst [hours = '0', minutes = '00'] = (time || '').split(':');\n\t\t\tlet h = parseInt(hours, 10) || 0;\n\t\t\tif (h === 12) h = 0;\n\t\t\tif (modifier && modifier.toUpperCase() === 'PM') h += 12;\n\t\t\treturn `${h.toString().padStart(2, '0')}:${minutes}`;\n\t\t};\n\t\t// Mutating the existing `tripData` preserves the narrow LocalTrip type for the template\n\t\tconst src = JSON.parse(JSON.stringify(found)) as any;\n\t\ttripData.id = String(src.id || tripData.id);\n\t\ttripData.date = normalizeDate(src.date);\n\t\ttripData.payDate = src.payDate ? normalizeDate(src.payDate) : '';\n\t\ttripData.startAddress = String(src.startAddress || '');\n\t\ttripData.endAddress = String(src.endAddress || '');\n\t\ttripData.stops = safeStops as any as LocalStop[];\n\t\ttripData.maintenanceItems = safeMaintenance as any;\n\t\ttripData.suppliesItems = safeSupplies as any;\n\t\t// Use trip's totalMiles as source of truth, mileage store is for display on mileage page\n\t\tconst milesFromMileage = $mileage.find((m: any) => m.id === tripId)?.miles;\n\t\tconst milesValue = Number(milesFromMileage ?? src.totalMiles) || 0;\n\t\ttripData.totalMiles = milesValue;\n\t\ttripData.mpg = Number.isFinite(Number(src.mpg))\n\t\t\t? Number(src.mpg)\n\t\t\t: ($userSettings.defaultMPG ?? 25);\n\t\ttripData.gasPrice = Number.isFinite(Number(src.gasPrice))\n\t\t\t? Number(src.gasPrice)\n\t\t\t: ($userSettings.defaultGasPrice ?? 3.5);\n\t\ttripData.fuelCost = Number(src.fuelCost) || 0;\n\t\ttripData.taxDeductible = !!src.taxDeductible;\n\t\ttripData.hoursWorked = Number(src.hoursWorked) || 0;\n\t\ttripData.estimatedTime = Number(src.estimatedTime) || 0;\n\t\ttripData.startTime = to24h(src.startTime as string | undefined);\n\t\ttripData.endTime = to24h(src.endTime as string | undefined);\n\t\ttripData.notes = String(src.notes || '');\n\n\t\t// Sync local form-bound variables to prevent reactive statements from overwriting\n\t\tstartAddressLocal = tripData.startAddress;\n\t\tendAddressLocal = tripData.endAddress;\n\t\tdateLocal = tripData.date;\n\t\tpayDateLocal = tripData.payDate;\n\t\tstartTimeLocal = tripData.startTime;\n\t\tendTimeLocal = tripData.endTime;\n\t\tmpgLocal = tripData.mpg;\n\t\tgasPriceLocal = tripData.gasPrice;\n\t\ttotalMilesLocal = milesValue;\n\t\tnotesLocal = tripData.notes;\n\t}\n\n\t// Local narrowed types for component-internal safety (NO index-signature inheritance)\n\ttype LocalStop = {\n\t\tid: string;\n\t\taddress: string;\n\t\tearnings: number;\n\t\tnotes: string;\n\t\tdistanceFromPrev: number;\n\t\ttimeFromPrev: number;\n\t\torder: number;\n\t};\n\ttype LocalTrip = {\n\t\tid: string;\n\t\tdate: string;\n\t\tpayDate: string;\n\t\tstartTime: string;\n\t\tendTime: string;\n\t\thoursWorked: number;\n\t\tstartAddress: string;\n\t\tendAddress: string;\n\t\tstops: LocalStop[];\n\t\ttotalMiles: number;\n\t\tmpg: number;\n\t\tgasPrice: number;\n\t\tfuelCost: number;\n\t\testimatedTime: number;\n\t\troundTripMiles: number;\n\t\troundTripTime: number;\n\t\tmaintenanceItems: import('$lib/types').CostItem[];\n\t\tsuppliesItems: import('$lib/types').CostItem[];\n\t\tnotes: string;\n\t\ttaxDeductible: boolean;\n\t};\n\n\t// Fix async narrowing: capture index and re-check after await in loops\n\tasync function recalculateAllLegs() {\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tlet prevAddress = tripData.startAddress;\n\t\t\tfor (let i = 0; i < tripData.stops.length; i++) {\n\t\t\t\tconst idx = i;\n\t\t\t\tconst currentStop = tripData.stops[idx];\n\t\t\t\tif (!currentStop) continue;\n\t\t\t\tconst addr = currentStop.address;\n\t\t\t\tif (!addr) {\n\t\t\t\t\tprevAddress = addr;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (prevAddress) {\n\t\t\t\t\tconst leg = await fetchRouteSegment(prevAddress, addr);\n\t\t\t\t\tif (leg) {\n\t\t\t\t\t\tconst s = tripData.stops[idx];\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\ts.distanceFromPrev = leg.distance;\n\t\t\t\t\t\t\ts.timeFromPrev = leg.duration;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tprevAddress = addr;\n\t\t\t}\n\t\t\tawait recalculateTotals();\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\n\t// Remove duplicate reactive `totalSuppliesCost` if present later in file (kept only one occurrence)\n\tlet tripData: LocalTrip = {\n\t\tid: String(crypto.randomUUID()),\n\t\tdate: String(getLocalDate()),\n\t\tpayDate: String(''),\n\t\tstartTime: String('09:00'),\n\t\tendTime: String('17:00'),\n\t\thoursWorked: 0,\n\t\tstartAddress: '',\n\t\tendAddress: '',\n\t\tstops: [] as LocalStop[],\n\t\ttotalMiles: 0,\n\t\testimatedTime: 0,\n\t\troundTripMiles: 0,\n\t\troundTripTime: 0,\n\t\tmpg: 25,\n\t\tgasPrice: 3.5,\n\t\tfuelCost: 0,\n\t\tmaintenanceItems: [] as import('$lib/types').CostItem[],\n\t\tsuppliesItems: [] as import('$lib/types').CostItem[],\n\t\ttaxDeductible: false,\n\n\t\tnotes: ''\n\t};\n\t// Local form-bound copies — ensure template bindings are primitive-typed for the compiler\n\tlet startAddressLocal: string = tripData.startAddress ?? '';\n\tlet endAddressLocal: string = tripData.endAddress ?? '';\n\tlet dateLocal: string = tripData.date ?? getLocalDate();\n\tlet payDateLocal: string = tripData.payDate ?? '';\n\tlet startTimeLocal: string = tripData.startTime ?? '09:00';\n\tlet endTimeLocal: string = tripData.endTime ?? '17:00';\n\tlet mpgLocal: number = Number(tripData.mpg ?? 25);\n\tlet gasPriceLocal: number = Number(tripData.gasPrice ?? 3.5);\n\tlet totalMilesLocal: number = Number(tripData.totalMiles ?? 0);\n\tlet notesLocal: string = tripData.notes ?? '';\n\t$: tripData.startAddress = startAddressLocal;\n\t$: tripData.endAddress = endAddressLocal;\n\t$: tripData.date = dateLocal;\n\t$: tripData.payDate = payDateLocal;\n\t$: tripData.startTime = startTimeLocal;\n\t$: tripData.endTime = endTimeLocal;\n\t$: tripData.mpg = mpgLocal;\n\t$: tripData.gasPrice = gasPriceLocal;\n\t$: tripData.totalMiles = totalMilesLocal;\n\t// Keep the form-local value in sync when the app recalculates totals (e.g. route API results).\n\t// Guarded assignment prevents an unnecessary reactive cycle when the user edits the input.\n\t$: if (Number(tripData.totalMiles || 0) !== Number(totalMilesLocal || 0))\n\t\ttotalMilesLocal = Number(tripData.totalMiles || 0);\n\t$: tripData.notes = notesLocal;\n\n\tlet newStop = { address: '', earnings: 0, notes: '' };\n\n\tfunction generateRouteKey(start: string, end: string) {\n\t\tconst s = start\n\t\t\t.toLowerCase()\n\t\t\t.trim()\n\t\t\t.replace(/[^a-z0-9]/g, '');\n\t\tconst e = end\n\t\t\t.toLowerCase()\n\t\t\t.trim()\n\t\t\t.replace(/[^a-z0-9]/g, '');\n\t\treturn `kv_route_${s}_to_${e}`;\n\t}\n\tasync function fetchRouteSegment(start: string, end: string) {\n\t\tif (!start || !end) return null;\n\t\tconst localKey = generateRouteKey(start, end);\n\n\t\t// If the addresses are identical, short-circuit and return 0 (cache locally)\n\t\tconst sameAddress = start.toLowerCase().trim() === end.toLowerCase().trim();\n\t\tif (sameAddress) {\n\t\t\tconst mappedResult = { distance: 0, duration: 0 };\n\t\t\tconsole.info('[route] same-address', localKey);\n\t\t\ttry {\n\t\t\t\tlocalStorage.setItem(localKey, JSON.stringify({ ...mappedResult, cachedAt: Date.now() }));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('[route] localStorage write failed', e);\n\t\t\t}\n\t\t\treturn mappedResult;\n\t\t}\n\n\t\t// Prefer server-side KV/cache first\n\t\ttry {\n\t\t\tconst res = await fetch(\n\t\t\t\t`/api/directions/cache?start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`\n\t\t\t);\n\t\t\tconst result: any = await res.json().catch(() => null);\n\t\t\tif (res.ok && result && result.data) {\n\t\t\t\tconst mappedResult = {\n\t\t\t\t\tdistance: result.data.distance * 0.000621371,\n\t\t\t\t\tduration: result.data.duration / 60\n\t\t\t\t};\n\n\t\t\t\t// Only cache valid responses (non-zero)\n\t\t\t\tif ((mappedResult.distance || 0) > 0 && (mappedResult.duration || 0) > 0) {\n\t\t\t\t\tconsole.info('[route] server hit', localKey, { source: result.source });\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\tlocalKey,\n\t\t\t\t\t\t\tJSON.stringify({ ...mappedResult, cachedAt: Date.now() })\n\t\t\t\t\t\t);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('[route] localStorage write failed', e);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.info('[route] server returned invalid metrics; not caching', localKey);\n\t\t\t\t}\n\t\t\t\treturn mappedResult;\n\t\t\t} else {\n\t\t\t\tconsole.info('[route] server miss or error', localKey);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.info('[route] server fetch failed, falling back to local cache', localKey, err);\n\t\t}\n\n\t\t// Fallback to local cache\n\t\ttry {\n\t\t\tconst cached = localStorage.getItem(localKey);\n\t\t\tif (cached) {\n\t\t\t\tconst parsed = JSON.parse(cached);\n\t\t\t\tif ((parsed.distance || 0) > 0 && (parsed.duration || 0) > 0) {\n\t\t\t\t\tconsole.info('[route] cache hit', localKey);\n\t\t\t\t\treturn { distance: parsed.distance, duration: parsed.duration };\n\t\t\t\t} else {\n\t\t\t\t\tconsole.info('[route] cache contained invalid data; ignoring', localKey);\n\t\t\t\t\tlocalStorage.removeItem(localKey);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.info('[route] cache miss', localKey);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.warn('[route] cache read failed', e);\n\t\t}\n\n\t\treturn null;\n\t}\n\t/* duplicate (older) implementation removed — use the stable-index implementation declared earlier */\n\tasync function recalculateTotals() {\n\t\tlet miles = tripData.stops.reduce((acc, s) => acc + (s.distanceFromPrev || 0), 0);\n\t\tlet mins = tripData.stops.reduce((acc, s) => acc + (s.timeFromPrev || 0), 0);\n\t\tlet returnMiles = 0;\n\t\tlet returnMins = 0;\n\n\t\tif (tripData.stops.length > 0) {\n\t\t\tconst lastStop = tripData.stops[tripData.stops.length - 1];\n\t\t\tconst startPoint = lastStop ? lastStop.address : tripData.startAddress;\n\t\t\tconst endPoint = tripData.endAddress || tripData.startAddress;\n\t\t\tif (startPoint && endPoint && endPoint !== startPoint) {\n\t\t\t\tconst finalLeg = await fetchRouteSegment(startPoint, endPoint);\n\t\t\t\tif (finalLeg) {\n\t\t\t\t\tmiles += finalLeg.distance;\n\t\t\t\t\tmins += finalLeg.duration;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst startPoint = tripData.startAddress;\n\t\t\tconst endPoint = tripData.endAddress || tripData.startAddress;\n\t\t\tif (startPoint && endPoint) {\n\t\t\t\tconst finalLeg = await fetchRouteSegment(startPoint, endPoint);\n\t\t\t\tif (finalLeg) {\n\t\t\t\t\tmiles += finalLeg.distance;\n\t\t\t\t\tmins += finalLeg.duration;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\ttripData.endAddress &&\n\t\t\ttripData.startAddress &&\n\t\t\ttripData.endAddress.trim() !== tripData.startAddress.trim()\n\t\t) {\n\t\t\tconst backLeg = await fetchRouteSegment(tripData.endAddress, tripData.startAddress);\n\t\t\tif (backLeg) {\n\t\t\t\treturnMiles = backLeg.distance;\n\t\t\t\treturnMins = backLeg.duration;\n\t\t\t}\n\t\t}\n\n\t\ttripData.totalMiles = parseFloat(miles.toFixed(1));\n\t\ttripData.estimatedTime = Math.round(mins);\n\t\ttripData.roundTripMiles = parseFloat((miles + returnMiles).toFixed(1));\n\t\ttripData.roundTripTime = Math.round(mins + returnMins);\n\t\ttripData = { ...tripData } as LocalTrip;\n\t}\n\n\tasync function handleOptimize() {\n\t\tif (!tripData.startAddress) {\n\t\t\ttoasts.error('Please enter a start address first.');\n\t\t\treturn;\n\t\t}\n\t\tif (tripData.stops.length < 2) {\n\t\t\ttoasts.error('Add at least 2 stops to optimize.');\n\t\t\treturn;\n\t\t}\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tconst result: any = await optimizeRoute(\n\t\t\t\ttripData.startAddress,\n\t\t\t\ttripData.endAddress,\n\t\t\t\ttripData.stops\n\t\t\t);\n\t\t\tif (result && result.optimizedOrder) {\n\t\t\t\tconst currentStops = [...tripData.stops];\n\t\t\t\tlet orderedStops = [];\n\t\t\t\tif (!tripData.endAddress) {\n\t\t\t\t\tconst movingStops = currentStops.slice(0, -1);\n\t\t\t\t\tconst fixedLast = currentStops[currentStops.length - 1];\n\t\t\t\t\torderedStops = result.optimizedOrder.map((i: number) => movingStops[i]);\n\t\t\t\t\torderedStops.push(fixedLast);\n\t\t\t\t} else {\n\t\t\t\t\torderedStops = result.optimizedOrder.map((i: number) => currentStops[i]);\n\t\t\t\t}\n\t\t\t\ttripData.stops = orderedStops.map((s: any, i: number) => ({\n\t\t\t\t\t...s,\n\t\t\t\t\torder: i\n\t\t\t\t})) as LocalStop[];\n\t\t\t\tif (result.legs) {\n\t\t\t\t\ttripData.stops.forEach((stop, i) => {\n\t\t\t\t\t\tif (result.legs[i]) {\n\t\t\t\t\t\t\tstop.distanceFromPrev = result.legs[i].distance.value * 0.000621371;\n\t\t\t\t\t\t\tstop.timeFromPrev = result.legs[i].duration.value / 60;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tawait recalculateTotals();\n\t\t\t\ttoasts.success('Route optimized!');\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\tconsole.error(e);\n\t\t\tconst msg = (e.message || '').toLowerCase();\n\t\t\tif (e.code === 'PLAN_LIMIT' || msg.includes('plan limit') || msg.includes('pro feature')) {\n\t\t\t\tupgradeMessage = e.message || 'Route Optimization is a Pro feature.';\n\t\t\t\tshowUpgradeModal = true;\n\t\t\t} else {\n\t\t\t\ttoasts.error('Optimization failed: ' + e.message);\n\t\t\t}\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\n\tasync function handleStopChange(index: number, placeOrEvent: any) {\n\t\tconst idx = index;\n\t\tconst current = tripData.stops[idx];\n\t\tif (!current) return;\n\t\tconst val = placeOrEvent?.formatted_address || placeOrEvent?.name || current.address;\n\t\tif (!val) return;\n\t\tcurrent.address = val;\n\t\tconsole.info('[route] handleStopChange', { index: idx, val });\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tconst prevLoc = idx === 0 ? tripData.startAddress : tripData.stops[idx - 1]?.address;\n\t\t\tif (prevLoc) {\n\t\t\t\tconst legIn = await fetchRouteSegment(prevLoc, val);\n\t\t\t\tif (legIn) {\n\t\t\t\t\tconst s = tripData.stops[idx];\n\t\t\t\t\tif (s) {\n\t\t\t\t\t\ts.distanceFromPrev = legIn.distance;\n\t\t\t\t\t\ts.timeFromPrev = legIn.duration;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst isSame = prevLoc.toLowerCase().trim() === (val || '').toLowerCase().trim();\n\t\t\t\t\tif (isSame) {\n\t\t\t\t\t\tconsole.info('[route] handleStopChange same-address', { index: idx, val });\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\ttoasts.info('Stop address matches the previous point (0 miles)');\n\t\t\t\t\t\t} catch (_e) {\n\t\t\t\t\t\t\tvoid _e;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst nextIdx = idx + 1;\n\t\t\tconst nextStop = tripData.stops[nextIdx];\n\t\t\tif (nextStop) {\n\t\t\t\tconst legOut = await fetchRouteSegment(val, nextStop.address);\n\t\t\t\tif (legOut) {\n\t\t\t\t\tconst s2 = tripData.stops[nextIdx];\n\t\t\t\t\tif (s2) {\n\t\t\t\t\t\ts2.distanceFromPrev = legOut.distance;\n\t\t\t\t\t\ts2.timeFromPrev = legOut.duration;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait recalculateTotals();\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\tasync function handleMainAddressChange(type: 'start' | 'end', placeOrEvent: any) {\n\t\tconst val =\n\t\t\tplaceOrEvent?.formatted_address ||\n\t\t\tplaceOrEvent?.name ||\n\t\t\t(type === 'start' ? tripData.startAddress : tripData.endAddress);\n\t\tif (type === 'start') tripData.startAddress = val;\n\t\telse tripData.endAddress = val;\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tif (type === 'start' && tripData.stops.length > 0) {\n\t\t\t\tconst firstCandidate = tripData.stops[0];\n\t\t\t\tif (!firstCandidate || !val) {\n\t\t\t\t\t/* no-op: nothing to calculate */\n\t\t\t\t} else {\n\t\t\t\t\tconst leg = await fetchRouteSegment(val, firstCandidate.address);\n\t\t\t\t\tif (leg) {\n\t\t\t\t\t\tfirstCandidate.distanceFromPrev = leg.distance;\n\t\t\t\t\t\tfirstCandidate.timeFromPrev = leg.duration;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait recalculateTotals();\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\tasync function handleNewStopSelect(e: CustomEvent) {\n\t\tconst place = e.detail;\n\t\tif (place?.formatted_address || place?.name) {\n\t\t\tnewStop.address = place.formatted_address || place.name;\n\t\t\tawait addStop();\n\t\t}\n\t}\n\n\tasync function addStop() {\n\t\tif (!newStop.address) return;\n\t\tif (\n\t\t\ttripData.stops.length >= (PLAN_LIMITS.FREE.MAX_STOPS || 5) &&\n\t\t\t($user?.plan === 'free' || !$user?.plan)\n\t\t) {\n\t\t\ttoasts.error(\n\t\t\t\t`The Free plan is limited to ${PLAN_LIMITS.FREE.MAX_STOPS || 5} stops per trip.`\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastStop = tripData.stops[tripData.stops.length - 1];\n\t\tconst segmentStart = lastStop && lastStop.address ? lastStop.address : tripData.startAddress;\n\t\tif (!segmentStart) {\n\t\t\ttoasts.error('Please enter a Starting Address first.');\n\t\t\treturn;\n\t\t}\n\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tconst segmentData: any = await fetchRouteSegment(segmentStart, newStop.address);\n\t\t\tif (!segmentData) throw new Error('Could not calculate route.');\n\n\t\t\ttripData.stops = [\n\t\t\t\t...tripData.stops,\n\t\t\t\t{\n\t\t\t\t\t...newStop,\n\t\t\t\t\tid: crypto.randomUUID(),\n\t\t\t\t\torder: tripData.stops.length,\n\t\t\t\t\tdistanceFromPrev: segmentData.distance,\n\t\t\t\t\ttimeFromPrev: segmentData.duration\n\t\t\t\t} as LocalStop\n\t\t\t];\n\n\t\t\tawait recalculateTotals();\n\t\t\tnewStop = { address: '', earnings: 0, notes: '' };\n\t\t\t// Ensure `order` is present and typed\n\t\t\ttripData.stops = tripData.stops.map((s: LocalStop | any, i: number) => ({\n\t\t\t\t...s,\n\t\t\t\torder: i\n\t\t\t})) as LocalStop[];\n\t\t} catch (err: any) {\n\t\t\tconsole.error('addStop failed', err);\n\t\t\ttoasts.error(err?.message ? String(err.message) : 'Error calculating route segment.');\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\n\tfunction removeStop(id: string) {\n\t\ttripData.stops = tripData.stops.filter((s) => s.id !== id);\n\t\trecalculateAllLegs();\n\t}\n\tfunction handleDragStart(event: DragEvent, index: number) {\n\t\tdragItemIndex = index;\n\t\tif (event.dataTransfer) {\n\t\t\tevent.dataTransfer.effectAllowed = 'move';\n\t\t\tevent.dataTransfer.dropEffect = 'move';\n\t\t\tevent.dataTransfer.setData('text/plain', index.toString());\n\t\t}\n\t}\n\tfunction handleDragOver(event: DragEvent) {\n\t\tevent.preventDefault();\n\t\treturn false;\n\t}\n\tasync function handleDrop(event: DragEvent, dropIndex: number) {\n\t\tevent.preventDefault();\n\t\tif (dragItemIndex === null) return;\n\t\tconst item = tripData.stops[dragItemIndex];\n\t\tif (!item) return;\n\t\tconst newStops = tripData.stops.filter((_, i) => i !== dragItemIndex);\n\t\tnewStops.splice(dropIndex, 0, item);\n\t\ttripData.stops = newStops;\n\t\tdragItemIndex = null;\n\t\tawait recalculateAllLegs();\n\t}\n\tfunction addMaintenanceItem() {\n\t\tif (!selectedMaintenance) return;\n\t\ttripData.maintenanceItems = [\n\t\t\t...tripData.maintenanceItems,\n\t\t\t{ id: crypto.randomUUID(), type: selectedMaintenance, cost: 0, taxDeductible: false }\n\t\t];\n\t\tselectedMaintenance = '';\n\t}\n\tfunction removeMaintenanceItem(id: string) {\n\t\ttripData.maintenanceItems = tripData.maintenanceItems.filter((m) => m.id !== id);\n\t}\n\tfunction addSupplyItem() {\n\t\tif (!selectedSupply) return;\n\t\ttripData.suppliesItems = [\n\t\t\t...tripData.suppliesItems,\n\t\t\t{ id: crypto.randomUUID(), type: selectedSupply, cost: 0, taxDeductible: false }\n\t\t];\n\t\tselectedSupply = '';\n\t}\n\tfunction removeSupplyItem(id: string) {\n\t\ttripData.suppliesItems = tripData.suppliesItems.filter((s) => s.id !== id);\n\t}\n\tfunction openSettings(type: 'maintenance' | 'supplies') {\n\t\tactiveCategoryType = type;\n\t\tisManageCategoriesOpen = true;\n\t}\n\tasync function updateCategories(newCategories: string[]) {\n\t\tconst updateData: any = {};\n\t\tif (activeCategoryType === 'maintenance') {\n\t\t\tuserSettings.update((s) => ({ ...s, maintenanceCategories: newCategories }));\n\t\t\tupdateData.maintenanceCategories = newCategories;\n\t\t} else {\n\t\t\tuserSettings.update((s) => ({ ...s, supplyCategories: newCategories }));\n\t\t\tupdateData.supplyCategories = newCategories;\n\t\t}\n\t\ttry {\n\t\t\tconst { saveSettings } = await import('../../../settings/lib/save-settings');\n\t\t\tconst result = await saveSettings(updateData);\n\t\t\tif (!result.ok) throw new Error(result.error);\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to sync settings', e);\n\t\t\ttoasts.error('Saved locally, but sync failed');\n\t\t}\n\t}\n\tasync function addCategory() {\n\t\tif (!newCategoryName.trim()) return;\n\t\tconst val = newCategoryName.trim();\n\t\tif (activeCategories.some((c) => c.toLowerCase() === val.toLowerCase())) {\n\t\t\ttoasts.error('Category already exists');\n\t\t\treturn;\n\t\t}\n\t\tconst updated = [...activeCategories, val];\n\t\tawait updateCategories(updated);\n\t\tnewCategoryName = '';\n\t\ttoasts.success('Category added');\n\t}\n\tasync function removeCategory(cat: string) {\n\t\tif (!confirm(`Delete \"${cat}\" category?`)) return;\n\t\tconst updated = activeCategories.filter((c) => c !== cat);\n\t\tawait updateCategories(updated);\n\t\ttoasts.success('Category removed');\n\t}\n\n\t$: {\n\t\tif (tripData.totalMiles && tripData.mpg && tripData.gasPrice) {\n\t\t\tconst gallons = tripData.totalMiles / tripData.mpg;\n\t\t\ttripData.fuelCost = Math.round(gallons * tripData.gasPrice * 100) / 100;\n\t\t} else {\n\t\t\ttripData.fuelCost = 0;\n\t\t}\n\t}\n\tlet totalEarnings = 0;\n\tlet totalMaintenanceCost = 0;\n\tlet totalSuppliesCost = 0;\n\tlet totalCosts = 0;\n\tlet totalProfit = 0;\n\t$: totalEarnings = tripData.stops.reduce(\n\t\t(sum, stop) => sum + (parseFloat(String(stop.earnings || 0)) || 0),\n\t\t0\n\t);\n\t$: totalMaintenanceCost = (tripData.maintenanceItems || []).reduce(\n\t\t(sum, item) => sum + (item.cost || 0),\n\t\t0\n\t);\n\t$: totalSuppliesCost = (tripData.suppliesItems || []).reduce(\n\t\t(sum, item) => sum + (item.cost || 0),\n\t\t0\n\t);\n\t$: totalCosts = (tripData.fuelCost || 0) + totalMaintenanceCost + totalSuppliesCost;\n\t$: totalProfit = totalEarnings - totalCosts;\n\t$: {\n\t\tif (tripData.startTime && tripData.endTime) {\n\t\t\tconst [startHour, startMin] = tripData.startTime.split(':').map(Number) as [number, number];\n\t\t\tconst [endHour, endMin] = tripData.endTime.split(':').map(Number) as [number, number];\n\t\t\tlet diff = endHour * 60 + endMin - (startHour * 60 + startMin);\n\t\t\tif (diff < 0) diff += 24 * 60;\n\t\t\ttripData.hoursWorked = Math.round((diff / 60) * 10) / 10;\n\t\t}\n\t}\n\n\tasync function saveTrip() {\n\t\tconst currentUser = $page.data['user'] || $user;\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id');\n\t\tif (!userId) {\n\t\t\ttoasts.error('Authentication error. Please login.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst tripToSave = {\n\t\t\t...tripData,\n\t\t\tid: tripId,\n\t\t\tmaintenanceCost: totalMaintenanceCost,\n\t\t\tsuppliesCost: totalSuppliesCost,\n\t\t\tnetProfit: totalProfit,\n\t\t\t// Ensure `totalMiles` is always present for analytics\n\t\t\ttotalMiles: tripData.totalMiles,\n\t\t\ttotalMileage: tripData.totalMiles,\n\t\t\tfuelCost: tripData.fuelCost,\n\t\t\troundTripMiles: tripData.roundTripMiles,\n\t\t\troundTripTime: tripData.roundTripTime,\n\t\t\tstops: tripData.stops.map((stop, index) => ({\n\t\t\t\t...stop,\n\t\t\t\tid: String(stop.id || crypto.randomUUID()),\n\t\t\t\tearnings: Number(stop.earnings) || 0,\n\t\t\t\torder: index\n\t\t\t})),\n\t\t\tdestinations: tripData.stops.map((stop) => ({\n\t\t\t\taddress: stop.address,\n\t\t\t\tearnings: stop.earnings,\n\t\t\t\tnotes: stop.notes || ''\n\t\t\t})),\n\t\t\tsupplyItems: tripData.suppliesItems,\n\t\t\tsuppliesItems: tripData.suppliesItems,\n\t\t\tupdatedAt: new Date().toISOString()\n\t\t};\n\t\ttry {\n\t\t\t// userId is checked above; coerce to string to satisfy TS\n\t\t\tconst uid = String(userId);\n\t\t\tawait trips.updateTrip(String(tripId), tripToSave, uid);\n\t\t\ttoasts.success('Trip updated successfully!');\n\t\t\tgoto(resolve('/dashboard/trips'));\n\t\t} catch (err: any) {\n\t\t\tconsole.error('Update failed:', err);\n\t\t\tconst message = err?.message || 'Failed to update trip.';\n\t\t\ttoasts.error(message);\n\t\t}\n\t}\n\n\tfunction formatCurrency(amount: number) {\n\t\treturn new Intl.NumberFormat('en-US', {\n\t\t\tstyle: 'currency',\n\t\t\tcurrency: 'USD',\n\t\t\tminimumFractionDigits: 2\n\t\t}).format(amount);\n\t}\n\tfunction formatDateLocal(dateString?: string) {\n\t\tif (!dateString) return '';\n\t\tconst [y, m, d] = dateString.split('-').map(Number);\n\t\tconst yy = y || 0;\n\t\tconst mm = m || 1;\n\t\tconst dd = d || 1;\n\t\treturn new Date(yy, mm - 1, dd).toLocaleDateString('en-US', {\n\t\t\tmonth: 'numeric',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric'\n\t\t});\n\t}\n</script>\n\n<div class=\"trip-form\">\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">Edit Trip</h1>\n\t\t\t<p class=\"page-subtitle\">Update route and expenses</p>\n\t\t</div>\n\t\t<a href={resolve('/dashboard/trips')} class=\"btn-back\"\n\t\t\t><svg width=\"24\" height=\"24\" viewBox=\"0 0 20 20\" fill=\"none\"\n\t\t\t\t><path\n\t\t\t\t\td=\"M12 4L6 10L12 16\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/></svg\n\t\t\t> Back</a\n\t\t>\n\t</div>\n\n\t<div class=\"form-content\">\n\t\t<!-- Basic Information Section -->\n\t\t<div class=\"form-card\">\n\t\t\t<div class=\"card-header\"><h2 class=\"card-title\">Basic Information</h2></div>\n\t\t\t<div class=\"form-grid\">\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"trip-date\">Date</label><input\n\t\t\t\t\t\tid=\"trip-date\"\n\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\tbind:value={dateLocal}\n\t\t\t\t\t\trequired\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"trip-pay-date\">Pay Date <span class=\"hint\">(Optional)</span></label><input\n\t\t\t\t\t\tid=\"trip-pay-date\"\n\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\tbind:value={payDateLocal}\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"hint\">Tax purposes</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-row\">\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"start-time\">Start Time</label><input\n\t\t\t\t\t\t\tid=\"start-time\"\n\t\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\t\tbind:value={startTimeLocal}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"end-time\">End Time</label><input\n\t\t\t\t\t\t\tid=\"end-time\"\n\t\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\t\tbind:value={endTimeLocal}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"hours-display\">Hours Worked</label>\n\t\t\t\t\t<div id=\"hours-display\" class=\"readonly-field\">\n\t\t\t\t\t\t{tripData.hoursWorked.toFixed(1)} hours\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Route & Stops Section -->\n\t\t<div class=\"form-card\">\n\t\t\t<div class=\"card-header\">\n\t\t\t\t<h2 class=\"card-title\">Route & Stops</h2>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\ton:click={handleOptimize}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdisabled={isCalculating}\n\t\t\t\t\ttitle=\"Reorder stops efficiently\">{isCalculating ? 'Optimizing...' : 'Optimize'}</button\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"start-address\">Starting Address</label><input\n\t\t\t\t\tid=\"start-address\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tvalue={startAddressLocal}\n\t\t\t\t\ton:input={(e) => (startAddressLocal = String((e.target as HTMLInputElement).value || ''))}\n\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\ton:place-selected={(e) => handleMainAddressChange('start', e.detail)}\n\t\t\t\t\ton:blur={() =>\n\t\t\t\t\t\thandleMainAddressChange('start', { formatted_address: tripData.startAddress })}\n\t\t\t\t\tclass=\"address-input\"\n\t\t\t\t\tplaceholder=\"Enter start address...\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"stops-container\">\n\t\t\t\t<div class=\"stops-header\">\n\t\t\t\t\t<h3>Stops</h3>\n\t\t\t\t\t<span class=\"count\">{tripData.stops.length} added</span>\n\t\t\t\t</div>\n\t\t\t\t{#if tripData.stops.length > 0}\n\t\t\t\t\t<div class=\"stops-list\">\n\t\t\t\t\t\t{#each tripData.stops as stop, i (stop.id)}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"stop-card\"\n\t\t\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\t\t\tdraggable=\"true\"\n\t\t\t\t\t\t\t\ton:dragstart={(e) => handleDragStart(e, i)}\n\t\t\t\t\t\t\t\ton:drop={(e) => handleDrop(e, i)}\n\t\t\t\t\t\t\t\ton:dragover={handleDragOver}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"stop-header\">\n\t\t\t\t\t\t\t\t\t<div class=\"stop-number\">{i + 1}</div>\n\t\t\t\t\t\t\t\t\t<div class=\"stop-actions\">\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"btn-icon delete\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => removeStop(String(stop.id ?? ''))}>✕</button\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div class=\"drag-handle\">☰</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"stop-inputs\">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\tvalue={String(stop.address ?? '')}\n\t\t\t\t\t\t\t\t\t\ton:input={(e) => (stop.address = (e.target as HTMLInputElement).value || '')}\n\t\t\t\t\t\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\t\t\t\t\t\ton:place-selected={(e) => handleStopChange(i, e.detail)}\n\t\t\t\t\t\t\t\t\t\ton:blur={() => handleStopChange(i, { formatted_address: stop.address })}\n\t\t\t\t\t\t\t\t\t\tclass=\"address-input\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Address\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<div class=\"input-money-wrapper\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"symbol\">$</span><input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"input-money\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={String(stop.earnings ?? 0)}\n\t\t\t\t\t\t\t\t\t\t\ton:input={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t(stop.earnings = Number((e.target as HTMLInputElement).value) || 0)}\n\t\t\t\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Earnings\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t\t<div class=\"add-stop-form\">\n\t\t\t\t\t<div class=\"stop-inputs new\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tbind:value={newStop.address}\n\t\t\t\t\t\t\tplaceholder=\"New stop address...\"\n\t\t\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\t\t\ton:place-selected={handleNewStopSelect}\n\t\t\t\t\t\t\tclass=\"address-input\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"input-money-wrapper\">\n\t\t\t\t\t\t\t<span class=\"symbol\">$</span><input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tclass=\"input-money\"\n\t\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\t\tbind:value={newStop.earnings}\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"end-address\">End Address (Optional)</label><input\n\t\t\t\t\tid=\"end-address\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tvalue={endAddressLocal}\n\t\t\t\t\ton:input={(e) => (endAddressLocal = (e.target as HTMLInputElement).value || '')}\n\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\ton:place-selected={(e) => handleMainAddressChange('end', e.detail)}\n\t\t\t\t\ton:blur={() => handleMainAddressChange('end', { formatted_address: endAddressLocal })}\n\t\t\t\t\tclass=\"address-input\"\n\t\t\t\t\tplaceholder=\"Same as start if empty\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"total-miles\">Total Miles</label><input\n\t\t\t\t\t\tid=\"total-miles\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tbind:value={totalMilesLocal}\n\t\t\t\t\t\tstep=\"0.1\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"drive-time\">Drive Time <span class=\"hint\">(Est)</span></label>\n\t\t\t\t\t<div id=\"drive-time\" class=\"readonly-field\">\n\t\t\t\t\t\t{formatDuration(tripData.estimatedTime)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Costs Section -->\n\t\t<div class=\"form-card\">\n\t\t\t<div class=\"card-header\"><h2 class=\"card-title\">Costs</h2></div>\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"mpg\">MPG</label><input\n\t\t\t\t\t\tid=\"mpg\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tbind:value={mpgLocal}\n\t\t\t\t\t\tstep=\"0.1\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"gas-price\">Gas Price</label>\n\t\t\t\t\t<div class=\"input-money-wrapper\">\n\t\t\t\t\t\t<span class=\"symbol\">$</span><input\n\t\t\t\t\t\t\tid=\"gas-price\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={gasPriceLocal}\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"summary-box\" style=\"margin: 40px 0;\">\n\t\t\t\t<span>Estimated Fuel Cost</span><strong>{formatCurrency(tripData.fuelCost)}</strong>\n\t\t\t</div>\n\n\t\t\t<div class=\"info-note\">\n\t\t\t\t<span\n\t\t\t\t\t><strong>Note:</strong> Use the checkboxes next to each Maintenance or Supplies item to mark\n\t\t\t\t\tthat individual item as tax-deductible.</span\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class=\"section-group\">\n\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t<h3>Maintenance</h3>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\ton:click={() => openSettings('maintenance')}\n\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t\t><svg\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t></button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t<select\n\t\t\t\t\t\tbind:value={selectedMaintenance}\n\t\t\t\t\t\tclass=\"select-input\"\n\t\t\t\t\t\taria-label=\"Maintenance type\"\n\t\t\t\t\t\t><option value=\"\" disabled selected>Select Item...</option\n\t\t\t\t\t\t>{#each maintenanceOptions as option}<option value={option}>{option}</option\n\t\t\t\t\t\t\t>{/each}</select\n\t\t\t\t\t><button\n\t\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\t\ton:click={addMaintenanceItem}\n\t\t\t\t\t\tdisabled={!selectedMaintenance}>Add</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t{#each tripData.maintenanceItems as item}<div class=\"expense-row\">\n\t\t\t\t\t\t<span class=\"name\">{item.type}</span>\n\t\t\t\t\t\t<div class=\"input-money-wrapper small\">\n\t\t\t\t\t\t\t<span class=\"symbol\">$</span><input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tbind:value={item.cost}\n\t\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-controls\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"tax-pill\"\n\t\t\t\t\t\t\t\ton:click={() => (item.taxDeductible = !item.taxDeductible)}\n\t\t\t\t\t\t\t\taria-pressed={item.taxDeductible}\n\t\t\t\t\t\t\t\ttitle=\"Mark this item as tax deductible\"\n\t\t\t\t\t\t\t\t>{item.taxDeductible ? 'Tax' : 'No Tax'}</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<label class=\"inline-label sr-only\"\n\t\t\t\t\t\t\t\t><input type=\"checkbox\" bind:checked={item.taxDeductible} /></label\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-icon delete\"\n\t\t\t\t\t\t\ton:click={() => removeMaintenanceItem(String(item.id ?? ''))}>✕</button\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>{/each}\n\t\t\t</div>\n\t\t\t<div class=\"section-group\">\n\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t<h3>Supplies</h3>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\ton:click={() => openSettings('supplies')}\n\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t\t><svg\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t></button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t<select bind:value={selectedSupply} class=\"select-input\" aria-label=\"Supply type\"\n\t\t\t\t\t\t><option value=\"\" disabled selected>Select Item...</option\n\t\t\t\t\t\t>{#each suppliesOptions as option}<option value={option}>{option}</option\n\t\t\t\t\t\t\t>{/each}</select\n\t\t\t\t\t><button class=\"btn-small primary\" on:click={addSupplyItem} disabled={!selectedSupply}\n\t\t\t\t\t\t>Add</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t{#each tripData.suppliesItems as item}<div class=\"expense-row\">\n\t\t\t\t\t\t<span class=\"name\">{item.type}</span>\n\t\t\t\t\t\t<div class=\"input-money-wrapper small\">\n\t\t\t\t\t\t\t<span class=\"symbol\">$</span><input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tbind:value={item.cost}\n\t\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-controls\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"tax-pill\"\n\t\t\t\t\t\t\t\ton:click={() => (item.taxDeductible = !item.taxDeductible)}\n\t\t\t\t\t\t\t\taria-pressed={item.taxDeductible}\n\t\t\t\t\t\t\t\ttitle=\"Mark this item as tax deductible\"\n\t\t\t\t\t\t\t\t>{item.taxDeductible ? 'Tax' : 'No Tax'}</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<label class=\"inline-label sr-only\"\n\t\t\t\t\t\t\t\t><input type=\"checkbox\" bind:checked={item.taxDeductible} /></label\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button class=\"btn-icon delete\" on:click={() => removeSupplyItem(String(item.id ?? ''))}\n\t\t\t\t\t\t\t>✕</button\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>{/each}\n\t\t\t</div>\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"notes\">Notes</label><textarea\n\t\t\t\t\tid=\"notes\"\n\t\t\t\t\tbind:value={notesLocal}\n\t\t\t\t\trows=\"3\"\n\t\t\t\t\tplaceholder=\"Trip details...\"\n\t\t\t\t></textarea>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Review Section -->\n\t\t<div class=\"form-card\">\n\t\t\t<div class=\"card-header\"><h2 class=\"card-title\">Review</h2></div>\n\t\t\t<div class=\"review-grid\">\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Date</span>\n\t\t\t\t\t<div>{formatDateLocal(String(tripData.date || ''))}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Total Time</span>\n\t\t\t\t\t<div>{tripData.hoursWorked.toFixed(1)} hrs</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Drive Time</span>\n\t\t\t\t\t<div>{formatDuration(tripData.estimatedTime)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Hours Worked</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{Math.max(0, tripData.hoursWorked - tripData.estimatedTime / 60).toFixed(1)} hrs\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Distance</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{tripData.totalMiles} mi\n\t\t\t\t\t\t{#if tripData.roundTripMiles && tripData.roundTripMiles !== tripData.totalMiles}\n\t\t\t\t\t\t\t• Round trip: {tripData.roundTripMiles} mi • {tripData.roundTripTime} min\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Stops</span>\n\t\t\t\t\t<div>{tripData.stops.length}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"financial-summary\">\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<span>Earnings</span> <span class=\"val positive\">{formatCurrency(totalEarnings)}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row subheader\"><span>Expenses Breakdown</span></div>\n\t\t\t\t{#if tripData.fuelCost > 0}<div class=\"row detail\">\n\t\t\t\t\t\t<span>Fuel</span> <span class=\"val\">{formatCurrency(tripData.fuelCost)}</span>\n\t\t\t\t\t</div>{/if}{#each tripData.maintenanceItems as item}<div class=\"row detail\">\n\t\t\t\t\t\t<span>{item.type}</span> <span class=\"val\">{formatCurrency(item.cost)}</span>\n\t\t\t\t\t</div>{/each}{#each tripData.suppliesItems as item}<div class=\"row detail\">\n\t\t\t\t\t\t<span>{item.type}</span> <span class=\"val\">{formatCurrency(item.cost)}</span>\n\t\t\t\t\t</div>{/each}\n\t\t\t\t<div class=\"row total-expenses\">\n\t\t\t\t\t<span>Total Expenses</span>\n\t\t\t\t\t<span class=\"val negative\">-{formatCurrency(totalCosts)}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row total\">\n\t\t\t\t\t<span>Net Profit</span>\n\t\t\t\t\t<span class=\"val\" class:positive={totalProfit >= 0}>{formatCurrency(totalProfit)}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<!-- Save Button -->\n\t\t\t<div class=\"form-actions\">\n\t\t\t\t<button class=\"btn-primary full-width\" on:click={saveTrip}>Update Trip</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<Modal bind:open={isManageCategoriesOpen} title=\"Manage Options\">\n\t<div class=\"categories-manager\">\n\t\t<div class=\"tabs\">\n\t\t\t<button\n\t\t\t\tclass=\"tab-btn\"\n\t\t\t\tclass:active={activeCategoryType === 'maintenance'}\n\t\t\t\ton:click={() => (activeCategoryType = 'maintenance')}>Maintenance</button\n\t\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"tab-btn\"\n\t\t\t\tclass:active={activeCategoryType === 'supplies'}\n\t\t\t\ton:click={() => (activeCategoryType = 'supplies')}>Supplies</button\n\t\t\t>\n\t\t</div>\n\t\t<div class=\"cat-list\">\n\t\t\t{#each activeCategories as cat}\n\t\t\t\t<div class=\"cat-item\">\n\t\t\t\t\t<span class=\"cat-badge\">{cat}</span>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"cat-delete\"\n\t\t\t\t\t\ton:click={() => removeCategory(cat)}\n\t\t\t\t\t\taria-label=\"Delete Category\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"\n\t\t\t\t\t\t\t></line></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"text-sm text-gray-400 italic text-center py-4\">No categories defined.</div>\n\t\t\t{/each}\n\t\t</div>\n\t\t<div class=\"add-cat-form\">\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tbind:value={newCategoryName}\n\t\t\t\tplaceholder=\"New Item Name...\"\n\t\t\t\tclass=\"input-field\"\n\t\t\t\ton:keydown={(e) => e.key === 'Enter' && addCategory()}\n\t\t\t/>\n\t\t\t<button class=\"btn-secondary\" on:click={addCategory}>Add</button>\n\t\t</div>\n\t\t<div class=\"modal-actions mt-6\">\n\t\t\t<button class=\"btn-cancel w-full\" on:click={() => (isManageCategoriesOpen = false)}\n\t\t\t\t>Done</button\n\t\t\t>\n\t\t</div>\n\t</div>\n</Modal>\n\n<Modal bind:open={showUpgradeModal} title=\"Upgrade to Pro\">\n\t<div class=\"space-y-6 text-center py-4\">\n\t\t<div class=\"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4\">\n\t\t\t<span class=\"text-3xl\">🚀</span>\n\t\t</div>\n\n\t\t<h3 class=\"text-xl font-bold text-gray-900\">Unlock Pro Features</h3>\n\n\t\t<p class=\"text-gray-600\">\n\t\t\t{upgradeMessage || \"You've hit the limits of the Free plan.\"}\n\t\t</p>\n\n\t\t<div class=\"bg-gray-50 p-4 rounded-lg text-left text-sm space-y-2 border border-gray-100\">\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500\">✓</span>\n\t\t\t\t<span>Unlimited Stops per Trip</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500\">✓</span>\n\t\t\t\t<span>One-Click Route Optimization</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500\">✓</span>\n\t\t\t\t<span>Unlimited Monthly Trips</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500\">✓</span>\n\t\t\t\t<span>Data Export</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex gap-3 justify-center pt-2\">\n\t\t\t<Button variant=\"outline\" on:click={() => (showUpgradeModal = false)}>Maybe Later</Button>\n\t\t\t<a\n\t\t\t\thref={resolve('/dashboard/settings')}\n\t\t\t\tclass=\"inline-flex items-center justify-center rounded-lg bg-orange-600 px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600\"\n\t\t\t>\n\t\t\t\tUpgrade Now\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</Modal>\n\n<style>\n\t/* Use styles from New Trip page for consistency */\n\t/* Component-level override: hide old pill button and show visible checkbox + label */\n\t.item-controls .tax-pill {\n\t\tdisplay: none !important;\n\t\tvisibility: hidden !important;\n\t}\n\t.item-controls .inline-label.sr-only {\n\t\tposition: static !important;\n\t\twidth: auto !important;\n\t\theight: auto !important;\n\t\tdisplay: inline-flex !important;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t}\n\t.item-controls .inline-label.sr-only input[type='checkbox'] {\n\t\tappearance: checkbox !important;\n\t\tdisplay: inline-block !important;\n\t\topacity: 1 !important;\n\t\twidth: 18px !important;\n\t\theight: 18px !important;\n\t\tmargin-right: 6px !important;\n\t}\n\t.item-controls .inline-label.sr-only::after {\n\t\tcontent: 'Tax deductible';\n\t\tmargin-left: 6px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tfont-size: 13px;\n\t}\n\t.item-controls .inline-label {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t}\n\t.trip-form {\n\t\tmax-width: 1300px;\n\t\tmargin: 0 auto;\n\t\tpadding: 4px;\n\t\tpadding-bottom: 90px;\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.trip-form {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\t}\n\t.page-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 26px;\n\t\tpadding: 0 8px;\n\t}\n\t.page-title {\n\t\tfont-size: 28px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tdisplay: none;\n\t}\n\t.btn-back {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\ttext-decoration: none;\n\t\tfont-size: 14px;\n\t}\n\t.form-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 18px;\n\t\tpadding: 16px;\n\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\t\tmargin-bottom: 20px;\n\t}\n\t.card-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 26px;\n\t}\n\t.card-title {\n\t\tfont-size: 22px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.form-grid {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24px;\n\t}\n\t.form-row {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 20px;\n\t}\n\t.form-group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\tlabel {\n\t\tfont-size: 16px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\t.hint {\n\t\tcolor: #9ca3af;\n\t\tfont-weight: 400;\n\t}\n\tinput,\n\ttextarea {\n\t\twidth: 100%;\n\t\tpadding: 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tfont-size: 18px;\n\t\tbackground: white;\n\t\tbox-sizing: border-box;\n\t}\n\tinput:focus,\n\ttextarea:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t}\n\t.readonly-field {\n\t\tbackground: #f9fafb;\n\t\tpadding: 16px;\n\t\tborder-radius: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #6b7280;\n\t\tfont-weight: 500;\n\t\tfont-size: 18px;\n\t}\n\t.address-input {\n\t\tpadding-top: 20px;\n\t\tpadding-bottom: 20px;\n\t\tfont-size: 19px;\n\t}\n\t.input-money-wrapper {\n\t\tposition: relative;\n\t\twidth: 100%;\n\t}\n\t.input-money-wrapper .symbol {\n\t\tposition: absolute;\n\t\tleft: 16px;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\tcolor: #6b7280;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t}\n\t.input-money-wrapper input {\n\t\tpadding-left: 36px;\n\t}\n\t.input-money-wrapper.small input {\n\t\tpadding: 12px 12px 12px 30px;\n\t\tfont-size: 16px;\n\t}\n\t.input-money-wrapper.small .symbol {\n\t\tleft: 12px;\n\t\tfont-size: 16px;\n\t}\n\t.stops-container {\n\t\tmargin: 26px 0;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 14px;\n\t\tpadding: 16px;\n\t\tbackground: #f9fafb;\n\t}\n\t.stops-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 18px;\n\t\talign-items: center;\n\t}\n\t.stops-header h3 {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tmargin: 0;\n\t}\n\t.stops-header .count {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tbackground: #e5e7eb;\n\t\tpadding: 5px 12px;\n\t\tborder-radius: 10px;\n\t}\n\t.stops-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 18px;\n\t\tmargin-bottom: 22px;\n\t}\n\t.stop-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 14px;\n\t\tpadding: 18px;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 18px;\n\t}\n\t.stop-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t}\n\t.stop-number {\n\t\tbackground: #ff7f50;\n\t\tcolor: white;\n\t\twidth: 30px;\n\t\theight: 30px;\n\t\tborder-radius: 8px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-weight: 700;\n\t\tfont-size: 15px;\n\t}\n\t.stop-actions {\n\t\tdisplay: flex;\n\t\tgap: 18px;\n\t\talign-items: center;\n\t\tcolor: #9ca3af;\n\t}\n\t.stop-inputs {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 14px;\n\t\twidth: 100%;\n\t}\n\t.stop-inputs.new {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 14px;\n\t\tmargin-bottom: 18px;\n\t}\n\t.form-actions {\n\t\tdisplay: flex;\n\t\tgap: 18px;\n\t\tmargin-top: 36px;\n\t\tpadding-top: 26px;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\t.btn-primary,\n\t.btn-secondary {\n\t\tflex: 1;\n\t\tpadding: 18px;\n\t\tborder-radius: 12px;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t\tcursor: pointer;\n\t\tborder: none;\n\t\ttext-align: center;\n\t}\n\t.btn-primary {\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t}\n\t.btn-secondary {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t}\n\t.btn-icon {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tfont-size: 22px;\n\t\tcursor: pointer;\n\t\tcolor: #9ca3af;\n\t\tpadding: 6px;\n\t}\n\t.btn-icon.delete:hover {\n\t\tcolor: #dc2626;\n\t}\n\t.btn-icon.gear {\n\t\tcolor: #6b7280;\n\t\tfont-size: 18px;\n\t\tpadding: 4px;\n\t\ttransition: color 0.2s;\n\t}\n\t.btn-icon.gear:hover {\n\t\tcolor: #374151;\n\t}\n\n\t.btn-small {\n\t\tpadding: 12px 18px;\n\t\tborder-radius: 8px;\n\t\tborder: none;\n\t\tfont-weight: 600;\n\t\tfont-size: 15px;\n\t\tcursor: pointer;\n\t}\n\t.btn-small.primary {\n\t\tbackground: #10b981;\n\t\tcolor: white;\n\t}\n\t.summary-box {\n\t\tbackground: #ecfdf5;\n\t\tborder: 1px solid #a7f3d0;\n\t\tpadding: 22px;\n\t\tborder-radius: 14px;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tcolor: #065f46;\n\t\tmargin-bottom: 36px;\n\t\tfont-size: 18px;\n\t}\n\t.section-group {\n\t\tmargin-bottom: 36px;\n\t}\n\t.section-top {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 18px;\n\t\talign-items: center;\n\t}\n\t.section-top h3 {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tmargin: 0;\n\t}\n\n\t.add-row {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tmargin-bottom: 18px;\n\t}\n\t.select-input {\n\t\tflex: 1;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 16px;\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t}\n\n\t.expense-row {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\tgap: 14px;\n\t\tpadding: 14px 0;\n\t\tborder-bottom: 1px solid #f3f4f6;\n\t}\n\t.expense-row .name {\n\t\tfont-size: 17px;\n\t\tfont-weight: 500;\n\t\tflex: 1;\n\t}\n\t.expense-row .input-money-wrapper {\n\t\twidth: 120px;\n\t}\n\t.review-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 18px;\n\t\tmargin-bottom: 36px;\n\t}\n\t.review-tile {\n\t\tbackground: #f9fafb;\n\t\tpadding: 18px;\n\t\tborder-radius: 14px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.review-tile .review-label {\n\t\tdisplay: block;\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\ttext-transform: uppercase;\n\t\tmargin-bottom: 4px;\n\t}\n\t.review-tile div {\n\t\tfont-weight: 700;\n\t\tfont-size: 18px;\n\t\tcolor: #111827;\n\t}\n\t.financial-summary {\n\t\tbackground: #f9fafb;\n\t\tpadding: 26px;\n\t\tborder-radius: 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.financial-summary .row {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 14px;\n\t\tfont-size: 17px;\n\t}\n\t.financial-summary .row.subheader {\n\t\tfont-weight: 700;\n\t\tcolor: #374151;\n\t\tmargin-top: 18px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t\tpadding-bottom: 4px;\n\t\tmargin-bottom: 8px;\n\t\tfont-size: 15px;\n\t}\n\t.financial-summary .row.detail {\n\t\tfont-size: 15px;\n\t\tcolor: #6b7280;\n\t}\n\t.financial-summary .row.total-expenses {\n\t\tfont-weight: 600;\n\t\tcolor: #4b5563;\n\t\tborder-top: 1px dashed #d1d5db;\n\t\tpadding-top: 8px;\n\t}\n\t.financial-summary .total {\n\t\tborder-top: 2px solid #d1d5db;\n\t\tmargin-top: 18px;\n\t\tpadding-top: 18px;\n\t\tfont-weight: 800;\n\t\tfont-size: 20px;\n\t}\n\t.val.positive {\n\t\tcolor: #059669;\n\t}\n\t.val.negative {\n\t\tcolor: #dc2626;\n\t}\n\n\t.categories-manager {\n\t\tpadding: 4px;\n\t}\n\t.tabs {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\tmargin-bottom: 16px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t}\n\t.tab-btn {\n\t\tpadding: 8px 16px;\n\t\tbackground: none;\n\t\tborder: none;\n\t\tborder-bottom: 2px solid transparent;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\t.tab-btn.active {\n\t\tcolor: #ff7f50;\n\t\tborder-bottom-color: #ff7f50;\n\t}\n\t.cat-list {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgap: 8px;\n\t\tmargin-bottom: 20px;\n\t\tmax-height: 200px;\n\t\toverflow-y: auto;\n\t}\n\t.cat-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 4px;\n\t\tbackground: #f3f4f6;\n\t\tpadding: 4px 4px 4px 10px;\n\t\tborder-radius: 20px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.cat-badge {\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t\ttext-transform: capitalize;\n\t\tpadding: 0 4px;\n\t}\n\t.cat-delete {\n\t\tborder: none;\n\t\tbackground: #e5e7eb;\n\t\tcolor: #6b7280;\n\t\tborder-radius: 50%;\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\t.cat-delete:hover {\n\t\tbackground: #ef4444;\n\t\tcolor: white;\n\t}\n\t.add-cat-form {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t}\n\t.add-cat-form .input-field {\n\t\tflex: 1;\n\t\tpadding: 10px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t}\n\t.modal-actions .btn-cancel {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\twidth: 100%;\n\t}\n\n\t@media (min-width: 768px) {\n\t\t.page-subtitle {\n\t\t\tdisplay: block;\n\t\t}\n\t\t.form-card {\n\t\t\tpadding: 48px;\n\t\t}\n\t\t.stop-card {\n\t\t\tflex-direction: row;\n\t\t\talign-items: center;\n\t\t}\n\t\t.stop-inputs {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: 1fr 160px;\n\t\t}\n\t\t.stop-inputs.new {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: 1fr 160px;\n\t\t}\n\t\t.form-actions {\n\t\t\tjustify-content: flex-end;\n\t\t}\n\t\t.btn-primary,\n\t\t.btn-secondary {\n\t\t\tflex: 0 0 auto;\n\t\t\twidth: auto;\n\t\t\tmin-width: 160px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\dashboard\\trips\\new\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 676,
				"column": 9,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 676,
				"endColumn": 36
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 699,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 699,
				"endColumn": 40
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 959,
				"column": 7,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 961,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 970,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 995,
				"endColumn": 12
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1025,
				"column": 7,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1027,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1034,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1058,
				"endColumn": 12
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1120,
				"column": 17,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1122,
				"endColumn": 19
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1122,
				"column": 19,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1124,
				"endColumn": 19
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 1158,
				"column": 4,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 1182,
				"endColumn": 11
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 1236,
				"column": 11,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 1236,
				"endColumn": 30
			}
		],
		"suppressedMessages": [],
		"errorCount": 7,
		"fatalErrorCount": 0,
		"warningCount": 3,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { trips } from '$lib/stores/trips';\n\timport { userSettings } from '$lib/stores/userSettings';\n\timport { goto } from '$app/navigation';\n\timport { base } from '$app/paths';\n\timport { user } from '$lib/stores/auth';\n\timport { page } from '$app/stores';\n\timport { autocomplete } from '$lib/utils/autocomplete';\n\timport { optimizeRoute } from '$lib/services/maps';\n\timport Modal from '$lib/components/ui/Modal.svelte';\n\timport { toasts } from '$lib/stores/toast';\n\timport Button from '$lib/components/ui/Button.svelte';\n\timport { PLAN_LIMITS } from '$lib/constants';\n\n\tconst resolve = (href: string) => `${base}${href}`;\n\n\texport let data;\n\t$: API_KEY = String(data.googleMapsApiKey ?? '');\n\tlet dragItemIndex: number | null = null;\n\n\t$: maintenanceOptions =\n\t\t$userSettings.maintenanceCategories?.length > 0\n\t\t\t? $userSettings.maintenanceCategories\n\t\t\t: ['Oil Change', 'Tire Rotation', 'Brake Service', 'Filter Replacement'];\n\t$: suppliesOptions =\n\t\t$userSettings.supplyCategories?.length > 0\n\t\t\t? $userSettings.supplyCategories\n\t\t\t: ['Concrete', 'Poles', 'Wire', 'Tools', 'Equipment Rental'];\n\n\tlet selectedMaintenance = '';\n\tlet selectedSupply = '';\n\n\tlet isManageCategoriesOpen = false;\n\tlet activeCategoryType: 'maintenance' | 'supplies' = 'maintenance';\n\tlet newCategoryName = '';\n\t$: activeCategories = activeCategoryType === 'maintenance' ? maintenanceOptions : suppliesOptions;\n\n\t// Upgrade Modal State\n\tlet showUpgradeModal = false;\n\tlet upgradeMessage = '';\n\n\tlet isCalculating = false;\n\tfunction getLocalDate() {\n\t\tconst now = new Date();\n\t\treturn new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().split('T')[0];\n\t}\n\n\t// Local narrowed types for component-internal safety (ensure required fields for bindings)\n\ttype LocalStop = {\n\t\tid: string;\n\t\taddress: string;\n\t\tearnings: number;\n\t\tnotes: string;\n\t\tdistanceFromPrev?: number;\n\t\ttimeFromPrev?: number;\n\t};\n\ttype LocalTrip = {\n\t\tid: string;\n\t\tdate: string;\n\t\tpayDate: string;\n\t\tstartTime: string;\n\t\tendTime: string;\n\t\thoursWorked: number;\n\t\tstartAddress: string;\n\t\tendAddress: string;\n\t\tstops: LocalStop[];\n\t\ttotalMiles: number;\n\t\tmpg: number;\n\t\tgasPrice: number;\n\t\tfuelCost: number;\n\t\testimatedTime: number;\n\t\troundTripMiles: number;\n\t\troundTripTime: number;\n\t\tmaintenanceItems: import('$lib/types').CostItem[];\n\t\tsuppliesItems: import('$lib/types').CostItem[];\n\t\tnotes: string;\n\t\ttaxDeductible: boolean;\n\t};\n\tlet tripData: LocalTrip = {\n\t\tid: String(crypto.randomUUID()),\n\t\tdate: String(getLocalDate()),\n\t\tpayDate: String(''),\n\t\tstartTime: String('09:00'),\n\t\tendTime: String('17:00'),\n\t\thoursWorked: 0,\n\t\tstartAddress: String(($userSettings as any).defaultStartAddress || ''),\n\t\tendAddress: String(($userSettings as any).defaultEndAddress || ''),\n\t\tstops: [] as LocalStop[],\n\t\ttotalMiles: 0,\n\t\testimatedTime: 0,\n\t\troundTripMiles: 0,\n\t\troundTripTime: 0,\n\t\tmpg: $userSettings.defaultMPG ?? 25,\n\t\tgasPrice: $userSettings.defaultGasPrice ?? 3.5,\n\t\tfuelCost: 0,\n\t\tmaintenanceItems: [] as import('$lib/types').CostItem[],\n\t\tsuppliesItems: [] as import('$lib/types').CostItem[],\n\t\ttaxDeductible: false,\n\t\tnotes: ''\n\t};\n\t// Local form-bound copies (narrow types) — ensure template bindings are provably `string`/`number`\n\tlet startAddressLocal: string = tripData.startAddress ?? '';\n\tlet endAddressLocal: string = tripData.endAddress ?? '';\n\tlet dateLocal: string = tripData.date ?? getLocalDate();\n\tlet payDateLocal: string = tripData.payDate ?? '';\n\tlet startTimeLocal: string = tripData.startTime ?? '09:00';\n\tlet endTimeLocal: string = tripData.endTime ?? '17:00';\n\tlet mpgLocal: number = Number(tripData.mpg ?? 25);\n\tlet gasPriceLocal: number = Number(tripData.gasPrice ?? 3.5);\n\tlet totalMilesLocal: number = Number(tripData.totalMiles ?? 0);\n\tlet notesLocal: string = tripData.notes ?? '';\n\t$: tripData.startAddress = startAddressLocal;\n\t$: tripData.endAddress = endAddressLocal;\n\t$: tripData.date = dateLocal;\n\t$: tripData.payDate = payDateLocal;\n\t$: tripData.startTime = startTimeLocal;\n\t$: tripData.endTime = endTimeLocal;\n\t$: tripData.mpg = mpgLocal;\n\t$: tripData.gasPrice = gasPriceLocal;\n\t$: tripData.totalMiles = totalMilesLocal;\n\t// Keep the form-local value in sync when the app recalculates totals (e.g. route API results).\n\t// Guarded assignment prevents an unnecessary reactive cycle when the user edits the input.\n\t$: if (Number(tripData.totalMiles || 0) !== Number(totalMilesLocal || 0))\n\t\ttotalMilesLocal = Number(tripData.totalMiles || 0);\n\t$: tripData.notes = notesLocal;\n\n\tlet newStop = { address: '', earnings: 0, notes: '' };\n\n\tfunction formatDuration(minutes: number): string {\n\t\tif (!minutes) return '0 min';\n\t\tconst h = Math.floor(minutes / 60);\n\t\tconst m = Math.round(minutes % 60);\n\t\tif (h > 0) return `${h} hr ${m} min`;\n\t\treturn `${m} min`;\n\t}\n\n\tfunction generateRouteKey(start: string, end: string) {\n\t\tconst s = start\n\t\t\t.toLowerCase()\n\t\t\t.trim()\n\t\t\t.replace(/[^a-z0-9]/g, '');\n\t\tconst e = end\n\t\t\t.toLowerCase()\n\t\t\t.trim()\n\t\t\t.replace(/[^a-z0-9]/g, '');\n\t\treturn `kv_route_${s}_to_${e}`;\n\t}\n\n\tasync function fetchRouteSegment(start: string, end: string) {\n\t\tif (!start || !end) return null;\n\t\tconst localKey = generateRouteKey(start, end);\n\n\t\t// If the addresses are identical, short-circuit and return 0 (cache locally)\n\t\tconst sameAddress = start.toLowerCase().trim() === end.toLowerCase().trim();\n\t\tif (sameAddress) {\n\t\t\tconst mappedResult = { distance: 0, duration: 0 };\n\t\t\tconsole.info('[route] same-address', localKey);\n\t\t\ttry {\n\t\t\t\tlocalStorage.setItem(localKey, JSON.stringify({ ...mappedResult, cachedAt: Date.now() }));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('[route] localStorage write failed', e);\n\t\t\t}\n\t\t\treturn mappedResult;\n\t\t}\n\n\t\t// Prefer server-side KV/cache first\n\t\ttry {\n\t\t\tconst res = await fetch(\n\t\t\t\t`/api/directions/cache?start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`\n\t\t\t);\n\t\t\tconst result: any = await res.json().catch(() => null);\n\t\t\tif (res.ok && result && result.data) {\n\t\t\t\tconst mappedResult = {\n\t\t\t\t\tdistance: result.data.distance * 0.000621371,\n\t\t\t\t\tduration: result.data.duration / 60\n\t\t\t\t};\n\n\t\t\t\t// Only cache valid responses (non-zero)\n\t\t\t\tif ((mappedResult.distance || 0) > 0 && (mappedResult.duration || 0) > 0) {\n\t\t\t\t\tconsole.info('[route] server hit', localKey, { source: result.source });\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\tlocalKey,\n\t\t\t\t\t\t\tJSON.stringify({ ...mappedResult, cachedAt: Date.now() })\n\t\t\t\t\t\t);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('[route] localStorage write failed', e);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.info('[route] server returned invalid metrics; not caching', localKey);\n\t\t\t\t}\n\t\t\t\treturn mappedResult;\n\t\t\t} else {\n\t\t\t\tconsole.info('[route] server miss or error', localKey);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.info('[route] server fetch failed, falling back to local cache', localKey, err);\n\t\t}\n\n\t\t// Fallback to local cache\n\t\ttry {\n\t\t\tconst cached = localStorage.getItem(localKey);\n\t\t\tif (cached) {\n\t\t\t\tconst parsed = JSON.parse(cached);\n\t\t\t\tif ((parsed.distance || 0) > 0 && (parsed.duration || 0) > 0) {\n\t\t\t\t\tconsole.info('[route] cache hit', localKey);\n\t\t\t\t\treturn { distance: parsed.distance, duration: parsed.duration };\n\t\t\t\t} else {\n\t\t\t\t\tconsole.info('[route] cache contained invalid data; ignoring', localKey);\n\t\t\t\t\tlocalStorage.removeItem(localKey);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.info('[route] cache miss', localKey);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.warn('[route] cache read failed', e);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tasync function recalculateAllLegs() {\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tlet prevAddress = tripData.startAddress;\n\t\t\tfor (let i = 0; i < tripData.stops.length; i++) {\n\t\t\t\tconst idx = i;\n\t\t\t\tconst currentStop = tripData.stops[idx];\n\t\t\t\tif (!currentStop) continue;\n\t\t\t\tconst addr = currentStop.address;\n\t\t\t\tif (!addr) {\n\t\t\t\t\tprevAddress = addr;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (prevAddress) {\n\t\t\t\t\tconst leg = await fetchRouteSegment(prevAddress, addr);\n\t\t\t\t\tif (leg) {\n\t\t\t\t\t\tconst s = tripData.stops[idx];\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\ts.distanceFromPrev = leg.distance;\n\t\t\t\t\t\t\ts.timeFromPrev = leg.duration;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tprevAddress = addr;\n\t\t\t}\n\t\t\tawait recalculateTotals();\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\n\tasync function recalculateTotals() {\n\t\tlet miles = tripData.stops.reduce((acc, s) => acc + (s.distanceFromPrev || 0), 0);\n\t\tlet mins = tripData.stops.reduce((acc, s) => acc + (s.timeFromPrev || 0), 0);\n\t\tlet returnMiles = 0;\n\t\tlet returnMins = 0;\n\n\t\t// If there are stops, use the sum of per-leg distances (already populated by recalculateAllLegs/handleStopChange)\n\t\t// and add the final leg from last stop -> endAddress when present.\n\t\tif (tripData.stops.length > 0) {\n\t\t\tconst lastStop = tripData.stops[tripData.stops.length - 1];\n\t\t\tif (!lastStop) return;\n\t\t\tconst startPoint = lastStop.address || tripData.startAddress;\n\t\t\tconst endPoint = tripData.endAddress || tripData.startAddress;\n\t\t\tif (startPoint && endPoint && endPoint !== startPoint) {\n\t\t\t\tconst finalLeg = await fetchRouteSegment(startPoint, endPoint);\n\t\t\t\tif (finalLeg) {\n\t\t\t\t\tmiles += finalLeg.distance;\n\t\t\t\t\tmins += finalLeg.duration;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// No stops: single leg from start -> end\n\t\t\tconst startPoint = tripData.startAddress;\n\t\t\tconst endPoint = tripData.endAddress || tripData.startAddress;\n\t\t\tif (startPoint && endPoint) {\n\t\t\t\tconst finalLeg = await fetchRouteSegment(startPoint, endPoint);\n\t\t\t\tif (finalLeg) {\n\t\t\t\t\tmiles += finalLeg.distance;\n\t\t\t\t\tmins += finalLeg.duration;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Compute return leg (end -> start) to show round-trip totals if end provided and different\n\t\tif (\n\t\t\ttripData.endAddress &&\n\t\t\ttripData.startAddress &&\n\t\t\ttripData.endAddress.trim() !== tripData.startAddress.trim()\n\t\t) {\n\t\t\tconst backLeg = await fetchRouteSegment(tripData.endAddress, tripData.startAddress);\n\t\t\tif (backLeg) {\n\t\t\t\treturnMiles = backLeg.distance;\n\t\t\t\treturnMins = backLeg.duration;\n\t\t\t}\n\t\t}\n\n\t\ttripData.totalMiles = parseFloat(miles.toFixed(1));\n\t\ttripData.estimatedTime = Math.round(mins);\n\t\t// Store round-trip values\n\t\ttripData.roundTripMiles = parseFloat((miles + returnMiles).toFixed(1));\n\t\ttripData.roundTripTime = Math.round(mins + returnMins);\n\n\t\t// Debug: surface calculation results to the page console for e2e troubleshooting\n\t\tconsole.log('[Trip] recalculated totals', {\n\t\t\tmiles: tripData.totalMiles,\n\t\t\tminutes: tripData.estimatedTime,\n\t\t\troundTripMiles: tripData.roundTripMiles,\n\t\t\troundTripMinutes: tripData.roundTripTime,\n\t\t\tstops: tripData.stops\n\t\t});\n\t\ttripData = { ...tripData } as LocalTrip;\n\t}\n\n\tasync function handleOptimize() {\n\t\tif (!tripData.startAddress) return toasts.error('Please enter a start address first.');\n\n\t\tif (tripData.stops.length < 2) return toasts.error('Add at least 2 stops to optimize.');\n\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tconst result: any = await optimizeRoute(\n\t\t\t\ttripData.startAddress,\n\t\t\t\ttripData.endAddress,\n\t\t\t\ttripData.stops\n\t\t\t);\n\t\t\tif (result && result.optimizedOrder) {\n\t\t\t\tconst currentStops = [...tripData.stops];\n\t\t\t\tlet orderedStops = [];\n\t\t\t\tif (!tripData.endAddress) {\n\t\t\t\t\tconst movingStops = currentStops.slice(0, -1);\n\t\t\t\t\tconst fixedLast = currentStops[currentStops.length - 1];\n\t\t\t\t\torderedStops = result.optimizedOrder.map((i: number) => movingStops[i]);\n\t\t\t\t\torderedStops.push(fixedLast);\n\t\t\t\t} else {\n\t\t\t\t\torderedStops = result.optimizedOrder.map((i: number) => currentStops[i]);\n\t\t\t\t}\n\n\t\t\t\ttripData.stops = orderedStops.map((s: any, i: number) => ({\n\t\t\t\t\t...s,\n\t\t\t\t\torder: i\n\t\t\t\t})) as LocalStop[];\n\t\t\t\tif (result.legs) {\n\t\t\t\t\ttripData.stops.forEach((stop, i) => {\n\t\t\t\t\t\tif (result.legs[i]) {\n\t\t\t\t\t\t\tstop.distanceFromPrev = result.legs[i].distance.value * 0.000621371;\n\t\t\t\t\t\t\tstop.timeFromPrev = result.legs[i].duration.value / 60;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tawait recalculateTotals();\n\t\t\t\ttoasts.success('Route optimized!');\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\tconsole.error(e);\n\t\t\tconst msg = (e.message || '').toLowerCase();\n\t\t\tif (e.code === 'PLAN_LIMIT' || msg.includes('plan limit') || msg.includes('pro feature')) {\n\t\t\t\tupgradeMessage = e.message || 'Route Optimization is a Pro feature.';\n\t\t\t\tshowUpgradeModal = true;\n\t\t\t} else {\n\t\t\t\ttoasts.error('Optimization failed: ' + e.message);\n\t\t\t}\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\n\tasync function handleStopChange(index: number, placeOrEvent: any) {\n\t\tconst idx = index;\n\t\tconst currentStop = tripData.stops[idx];\n\t\tif (!currentStop) return;\n\t\tconst val = placeOrEvent?.formatted_address || placeOrEvent?.name || currentStop.address;\n\t\tif (!val) return;\n\t\tcurrentStop.address = val;\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tconst prevLoc = idx === 0 ? tripData.startAddress : tripData.stops[idx - 1]?.address;\n\t\t\tif (prevLoc) {\n\t\t\t\tconst legIn = await fetchRouteSegment(prevLoc, val);\n\t\t\t\tif (legIn) {\n\t\t\t\t\tconst s = tripData.stops[idx];\n\t\t\t\t\tif (s) {\n\t\t\t\t\t\ts.distanceFromPrev = legIn.distance;\n\t\t\t\t\t\ts.timeFromPrev = legIn.duration;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst nextIdx = idx + 1;\n\t\t\tconst nextStop = tripData.stops[nextIdx];\n\t\t\tif (nextStop) {\n\t\t\t\tconst legOut = await fetchRouteSegment(val, nextStop.address);\n\t\t\t\tif (legOut) {\n\t\t\t\t\tconst s2 = tripData.stops[nextIdx];\n\t\t\t\t\tif (s2) {\n\t\t\t\t\t\ts2.distanceFromPrev = legOut.distance;\n\t\t\t\t\t\ts2.timeFromPrev = legOut.duration;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait recalculateTotals();\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\n\tasync function handleMainAddressChange(type: 'start' | 'end', placeOrEvent: any) {\n\t\tconst val =\n\t\t\tplaceOrEvent?.formatted_address ||\n\t\t\tplaceOrEvent?.name ||\n\t\t\t(type === 'start' ? tripData.startAddress : tripData.endAddress);\n\t\tif (type === 'start') tripData.startAddress = String(val || '');\n\t\telse tripData.endAddress = String(val || '');\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tif (type === 'start' && tripData.stops.length > 0) {\n\t\t\t\tconst idx = 0;\n\t\t\t\tconst firstStop = tripData.stops[idx];\n\t\t\t\tif (firstStop && val) {\n\t\t\t\t\tconst leg = await fetchRouteSegment(val, firstStop.address);\n\t\t\t\t\tif (leg) {\n\t\t\t\t\t\tconst s = tripData.stops[idx];\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\ts.distanceFromPrev = leg.distance;\n\t\t\t\t\t\t\ts.timeFromPrev = leg.duration;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait recalculateTotals();\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\n\tasync function handleNewStopSelect(e: CustomEvent) {\n\t\tconst place = e.detail;\n\t\tif (place?.formatted_address || place?.name) {\n\t\t\tnewStop.address = place.formatted_address || place.name;\n\t\t\tawait addStop();\n\t\t}\n\t}\n\n\tasync function addStop() {\n\t\tif (!newStop.address) return;\n\n\t\tif (\n\t\t\ttripData.stops.length >= (PLAN_LIMITS.FREE.MAX_STOPS || 5) &&\n\t\t\t($user?.plan === 'free' || !$user?.plan)\n\t\t) {\n\t\t\ttoasts.error(\n\t\t\t\t`The Free plan is limited to ${PLAN_LIMITS.FREE.MAX_STOPS || 5} stops per trip.`\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastStop = tripData.stops[tripData.stops.length - 1];\n\t\tconst segmentStart = lastStop && lastStop.address ? lastStop.address : tripData.startAddress;\n\t\tif (!segmentStart) {\n\t\t\ttoasts.error('Please enter a Starting Address first.');\n\t\t\treturn;\n\t\t}\n\n\t\t// Diagnostic: log addresses being used to calculate the leg\n\t\tconsole.info('[route] addStop', { segmentStart, newStopAddress: newStop.address });\n\n\t\t// If the stop equals the segment start, surface UI hint and still add it as 0-mile stop\n\t\tconst isSame =\n\t\t\tsegmentStart.toLowerCase().trim() === (newStop.address || '').toLowerCase().trim();\n\t\tif (isSame) {\n\t\t\tconsole.info('[route] adding identical stop (0 miles)', segmentStart);\n\t\t\ttoasts.info('Stop address is the same as previous point — distance will be 0');\n\t\t}\n\n\t\tisCalculating = true;\n\t\ttry {\n\t\t\tconst segmentData: any = await fetchRouteSegment(segmentStart, newStop.address);\n\t\t\tif (!segmentData) throw new Error('Could not calculate route.');\n\n\t\t\ttripData.stops = [\n\t\t\t\t...tripData.stops,\n\t\t\t\t{\n\t\t\t\t\t...newStop,\n\t\t\t\t\tid: crypto.randomUUID(),\n\t\t\t\t\torder: tripData.stops.length,\n\t\t\t\t\tdistanceFromPrev: segmentData.distance,\n\t\t\t\t\ttimeFromPrev: segmentData.duration\n\t\t\t\t} as LocalStop\n\t\t\t];\n\n\t\t\tawait recalculateTotals();\n\t\t\tnewStop = { address: '', earnings: 0, notes: '' };\n\t\t\t// Ensure `order` is present and typed\n\t\t\ttripData.stops = tripData.stops.map((s: LocalStop | any, i: number) => ({\n\t\t\t\t...s,\n\t\t\t\torder: i\n\t\t\t})) as LocalStop[];\n\t\t} catch (err: any) {\n\t\t\tconsole.error('addStop failed', err);\n\t\t\ttoasts.error(err?.message ? String(err.message) : 'Error calculating route.');\n\t\t} finally {\n\t\t\tisCalculating = false;\n\t\t}\n\t}\n\n\tfunction removeStop(id: string) {\n\t\ttripData.stops = tripData.stops.filter((s) => s.id !== id);\n\t\trecalculateAllLegs();\n\t}\n\n\tfunction handleDragStart(event: DragEvent, index: number) {\n\t\tdragItemIndex = index;\n\t\tif (event.dataTransfer) {\n\t\t\tevent.dataTransfer.effectAllowed = 'move';\n\t\t\tevent.dataTransfer.dropEffect = 'move';\n\t\t\tevent.dataTransfer.setData('text/plain', index.toString());\n\t\t}\n\t}\n\n\tfunction handleDragOver(event: DragEvent) {\n\t\tevent.preventDefault();\n\t\treturn false;\n\t}\n\n\tasync function handleDrop(event: DragEvent, dropIndex: number) {\n\t\tevent.preventDefault();\n\t\tif (dragItemIndex === null) return;\n\t\tconst item = tripData.stops[dragItemIndex];\n\t\tif (!item) return;\n\t\tconst newStops = tripData.stops.filter((_, i) => i !== dragItemIndex);\n\t\tnewStops.splice(dropIndex, 0, item);\n\t\ttripData.stops = newStops;\n\t\tdragItemIndex = null;\n\t\tawait recalculateAllLegs();\n\t}\n\n\tfunction addMaintenanceItem() {\n\t\tif (!selectedMaintenance) return;\n\t\ttripData.maintenanceItems = [\n\t\t\t...tripData.maintenanceItems,\n\t\t\t{ id: crypto.randomUUID(), type: selectedMaintenance, cost: 0, taxDeductible: false }\n\t\t];\n\t\tselectedMaintenance = '';\n\t}\n\tfunction removeMaintenanceItem(id: string) {\n\t\ttripData.maintenanceItems = tripData.maintenanceItems.filter((m) => m.id !== id);\n\t}\n\tfunction addSupplyItem() {\n\t\tif (!selectedSupply) return;\n\t\ttripData.suppliesItems = [\n\t\t\t...tripData.suppliesItems,\n\t\t\t{ id: crypto.randomUUID(), type: selectedSupply, cost: 0, taxDeductible: false }\n\t\t];\n\t\tselectedSupply = '';\n\t}\n\tfunction removeSupplyItem(id: string) {\n\t\ttripData.suppliesItems = tripData.suppliesItems.filter((s) => s.id !== id);\n\t}\n\n\tfunction openSettings(type: 'maintenance' | 'supplies') {\n\t\tactiveCategoryType = type;\n\t\tisManageCategoriesOpen = true;\n\t}\n\tasync function updateCategories(newCategories: string[]) {\n\t\tconst updateData: any = {};\n\t\tif (activeCategoryType === 'maintenance') {\n\t\t\tuserSettings.update((s) => ({ ...s, maintenanceCategories: newCategories }));\n\t\t\tupdateData.maintenanceCategories = newCategories;\n\t\t} else {\n\t\t\tuserSettings.update((s) => ({ ...s, supplyCategories: newCategories }));\n\t\t\tupdateData.supplyCategories = newCategories;\n\t\t}\n\t\ttry {\n\t\t\tconst { saveSettings } = await import('../../settings/lib/save-settings');\n\t\t\tconst result = await saveSettings(updateData);\n\t\t\tif (!result.ok) throw new Error(result.error);\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to sync settings', e);\n\t\t\ttoasts.error('Saved locally, but sync failed');\n\t\t}\n\t}\n\tasync function addCategory() {\n\t\tif (!newCategoryName.trim()) return;\n\t\tconst val = newCategoryName.trim().toLowerCase();\n\t\tif (activeCategories.some((c) => c.toLowerCase() === val.toLowerCase())) {\n\t\t\ttoasts.error('Category already exists');\n\t\t\treturn;\n\t\t}\n\t\tconst updated = [...activeCategories, newCategoryName.trim()];\n\t\tawait updateCategories(updated);\n\t\tnewCategoryName = '';\n\t\ttoasts.success('Category added');\n\t}\n\tasync function removeCategory(cat: string) {\n\t\tif (!confirm(`Delete \"${cat}\" category?`)) return;\n\t\tconst updated = activeCategories.filter((c) => c !== cat);\n\t\tawait updateCategories(updated);\n\t\ttoasts.success('Category removed');\n\t}\n\n\t$: {\n\t\tconst totalMiles = Number(tripData.totalMiles || 0);\n\t\tconst mpg = Number(tripData.mpg || 0);\n\t\tconst gasPrice = Number(tripData.gasPrice || 0);\n\t\tif (totalMiles && mpg && gasPrice) {\n\t\t\tconst gallons = totalMiles / mpg;\n\t\t\ttripData.fuelCost = Math.round(gallons * gasPrice * 100) / 100;\n\t\t} else {\n\t\t\ttripData.fuelCost = 0;\n\t\t}\n\t}\n\tlet totalEarnings = 0;\n\tlet totalMaintenanceCost = 0;\n\tlet totalSuppliesCost = 0;\n\tlet totalCosts = 0;\n\tlet totalProfit = 0;\n\t$: totalEarnings = tripData.stops.reduce(\n\t\t(sum, stop) => sum + (parseFloat(String(stop.earnings || 0)) || 0),\n\t\t0\n\t);\n\t$: totalMaintenanceCost = tripData.maintenanceItems.reduce(\n\t\t(sum, item) => sum + (item.cost || 0),\n\t\t0\n\t);\n\t$: totalSuppliesCost = tripData.suppliesItems.reduce((sum, item) => sum + (item.cost || 0), 0);\n\t$: totalCosts = (tripData.fuelCost || 0) + totalMaintenanceCost + totalSuppliesCost;\n\t$: totalProfit = totalEarnings - totalCosts;\n\t$: {\n\t\tconst startTime = typeof tripData.startTime === 'string' ? tripData.startTime : '';\n\t\tconst endTime = typeof tripData.endTime === 'string' ? tripData.endTime : '';\n\t\tif (startTime && endTime) {\n\t\t\tconst [startHour, startMin] = startTime.split(':').map(Number) as [number, number];\n\t\t\tconst [endHour, endMin] = endTime.split(':').map(Number) as [number, number];\n\t\t\tlet diff = endHour * 60 + endMin - (startHour * 60 + startMin);\n\t\t\tif (diff < 0) diff += 24 * 60;\n\t\t\ttripData.hoursWorked = Math.round((diff / 60) * 10) / 10;\n\t\t}\n\t}\n\n\tasync function saveTrip() {\n\t\tconst currentUser = $page.data['user'] || $user;\n\t\tconst userId = currentUser?.id || localStorage.getItem('offline_user_id');\n\t\tif (!userId) {\n\t\t\ttoasts.error('Authentication error.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst tripToSave = {\n\t\t\t...tripData,\n\t\t\tmaintenanceCost: totalMaintenanceCost,\n\t\t\tsuppliesCost: totalSuppliesCost,\n\t\t\tnetProfit: totalProfit,\n\t\t\t// Include both keys for compatibility but ensure `totalMiles` is present\n\t\t\ttotalMiles: Number(tripData.totalMiles || 0),\n\t\t\ttotalMileage: Number(tripData.totalMiles || 0),\n\t\t\tfuelCost: Number(tripData.fuelCost || 0),\n\t\t\troundTripMiles: Number(tripData.roundTripMiles || 0),\n\t\t\troundTripTime: Number(tripData.roundTripTime || 0),\n\t\t\tstops: tripData.stops.map((stop, index) => ({\n\t\t\t\t...stop,\n\t\t\t\tid: String(stop.id || crypto.randomUUID()),\n\t\t\t\tearnings: Number(stop.earnings) || 0,\n\t\t\t\torder: index\n\t\t\t})),\n\n\t\t\tdestinations: tripData.stops.map((stop) => ({\n\t\t\t\taddress: stop.address,\n\t\t\t\tearnings: stop.earnings,\n\t\t\t\tnotes: stop.notes || ''\n\t\t\t})),\n\t\t\tlastModified: new Date().toISOString()\n\t\t};\n\n\t\ttry {\n\t\t\tawait trips.create(tripToSave, userId);\n\t\t\tgoto(resolve('/dashboard/trips'));\n\t\t} catch (err: any) {\n\t\t\tconsole.error('Save failed:', err);\n\t\t\tconst message = err?.message || 'Failed to create trip.';\n\t\t\ttoasts.error(message);\n\t\t}\n\t}\n\n\tfunction formatCurrency(amount: number) {\n\t\treturn new Intl.NumberFormat('en-US', {\n\t\t\tstyle: 'currency',\n\t\t\tcurrency: 'USD',\n\t\t\tminimumFractionDigits: 2\n\t\t}).format(amount);\n\t}\n</script>\n\n<div class=\"trip-form\">\n\t<div class=\"page-header\">\n\t\t<div>\n\t\t\t<h1 class=\"page-title\">New Trip</h1>\n\t\t\t<p class=\"page-subtitle\">Plan details & earnings</p>\n\t\t</div>\n\t\t<a href={resolve('/dashboard/trips')} class=\"btn-back\">\n\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 20 20\" fill=\"none\"\n\t\t\t\t><path\n\t\t\t\t\td=\"M12 4L6 10L12 16\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t/></svg\n\t\t\t> Back\n\t\t</a>\n\t</div>\n\n\t<div class=\"form-content\">\n\t\t<!-- Basic Information Section -->\n\t\t<div class=\"form-card\">\n\t\t\t<div class=\"card-header\"><h2 class=\"card-title\">Basic Information</h2></div>\n\t\t\t<div class=\"form-grid\">\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"trip-date\">Date</label><input\n\t\t\t\t\t\tid=\"trip-date\"\n\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\tbind:value={dateLocal}\n\t\t\t\t\t\trequired\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"trip-pay-date\">Pay Date <span class=\"hint\">(Optional)</span></label><input\n\t\t\t\t\t\tid=\"trip-pay-date\"\n\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\tbind:value={payDateLocal}\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"hint\">Tax purposes</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-row\">\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"start-time\">Start Time</label><input\n\t\t\t\t\t\t\tid=\"start-time\"\n\t\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\t\tbind:value={startTimeLocal}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t<label for=\"end-time\">End Time</label><input\n\t\t\t\t\t\t\tid=\"end-time\"\n\t\t\t\t\t\t\ttype=\"time\"\n\t\t\t\t\t\t\tbind:value={endTimeLocal}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"hours-display\">Hours Worked</label>\n\t\t\t\t\t<div id=\"hours-display\" class=\"readonly-field\">\n\t\t\t\t\t\t{tripData.hoursWorked.toFixed(1)} hours\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Route & Stops Section -->\n\t\t<div class=\"form-card\">\n\t\t\t<div class=\"card-header\">\n\t\t\t\t<h2 class=\"card-title\">Route & Stops</h2>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\ton:click={handleOptimize}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdisabled={isCalculating}\n\t\t\t\t\ttitle=\"Reorder stops efficiently\">{isCalculating ? 'Optimizing...' : 'Optimize'}</button\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"start-address\">Starting Address</label>\n\t\t\t\t<input\n\t\t\t\t\tid=\"start-address\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tvalue={startAddressLocal}\n\t\t\t\t\ton:input={(e) => (startAddressLocal = (e.target as HTMLInputElement).value || '')}\n\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\ton:place-selected={(e) => handleMainAddressChange('start', e.detail)}\n\t\t\t\t\ton:blur={() => handleMainAddressChange('start', { formatted_address: startAddressLocal })}\n\t\t\t\t\tclass=\"address-input\"\n\t\t\t\t\tplaceholder=\"Enter start address...\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"stops-container\">\n\t\t\t\t<div class=\"stops-header\">\n\t\t\t\t\t<h3>Stops</h3>\n\t\t\t\t\t<span class=\"count\">{tripData.stops.length} added</span>\n\t\t\t\t</div>\n\t\t\t\t{#if tripData.stops.length > 0}\n\t\t\t\t\t<div class=\"stops-list\">\n\t\t\t\t\t\t{#each tripData.stops as stop, i (stop.id)}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"stop-card\"\n\t\t\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\t\t\tdraggable=\"true\"\n\t\t\t\t\t\t\t\ton:dragstart={(e) => handleDragStart(e, i)}\n\t\t\t\t\t\t\t\ton:drop={(e) => handleDrop(e, i)}\n\t\t\t\t\t\t\t\ton:dragover={handleDragOver}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"stop-header\">\n\t\t\t\t\t\t\t\t\t<div class=\"stop-number\">{i + 1}</div>\n\t\t\t\t\t\t\t\t\t<div class=\"stop-actions\">\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"btn-icon delete\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => removeStop(String(stop.id ?? ''))}>✕</button\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div class=\"drag-handle\">☰</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"stop-inputs\">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\tvalue={String(stop.address ?? '')}\n\t\t\t\t\t\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\t\t\t\t\t\ton:place-selected={(e) => handleStopChange(i, e.detail)}\n\t\t\t\t\t\t\t\t\t\ton:blur={() => handleStopChange(i, { formatted_address: stop.address })}\n\t\t\t\t\t\t\t\t\t\tclass=\"address-input\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Stop address\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<div class=\"input-money-wrapper\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"symbol\">$</span><input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"input-money\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={String(stop.earnings ?? 0)}\n\t\t\t\t\t\t\t\t\t\t\ton:input={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t(stop.earnings = Number((e.target as HTMLInputElement).value) || 0)}\n\t\t\t\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Earnings\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t\t<div class=\"add-stop-form\">\n\t\t\t\t\t<div class=\"stop-inputs new\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tvalue={String(newStop.address ?? '')}\n\t\t\t\t\t\t\ton:input={(e) => (newStop.address = (e.target as HTMLInputElement).value || '')}\n\t\t\t\t\t\t\tplaceholder=\"New stop address...\"\n\t\t\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\t\t\ton:place-selected={handleNewStopSelect}\n\t\t\t\t\t\t\tclass=\"address-input\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"input-money-wrapper\">\n\t\t\t\t\t\t\t<span class=\"symbol\">$</span><input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tclass=\"input-money\"\n\t\t\t\t\t\t\t\tplaceholder=\"0.00\"\n\t\t\t\t\t\t\t\tvalue={String(newStop.earnings ?? 0)}\n\t\t\t\t\t\t\t\ton:input={(e) =>\n\t\t\t\t\t\t\t\t\t(newStop.earnings = Number((e.target as HTMLInputElement).value) || 0)}\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"end-address\">End Address (Optional)</label>\n\t\t\t\t<input\n\t\t\t\t\tid=\"end-address\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={endAddressLocal}\n\t\t\t\t\tuse:autocomplete={{ apiKey: API_KEY }}\n\t\t\t\t\ton:place-selected={(e) => handleMainAddressChange('end', e.detail)}\n\t\t\t\t\ton:blur={() => handleMainAddressChange('end', { formatted_address: endAddressLocal })}\n\t\t\t\t\tclass=\"address-input\"\n\t\t\t\t\tplaceholder=\"Same as start if empty\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"total-miles\">Total Miles</label><input\n\t\t\t\t\t\tid=\"total-miles\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tbind:value={totalMilesLocal}\n\t\t\t\t\t\tstep=\"0.1\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"drive-time\">Drive Time <span class=\"hint\">(Est)</span></label>\n\t\t\t\t\t<div id=\"drive-time\" class=\"readonly-field\">\n\t\t\t\t\t\t{formatDuration(tripData.estimatedTime)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Costs Section -->\n\t\t<div class=\"form-card\">\n\t\t\t<div class=\"card-header\"><h2 class=\"card-title\">Costs</h2></div>\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"mpg\">MPG</label><input\n\t\t\t\t\t\tid=\"mpg\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tbind:value={mpgLocal}\n\t\t\t\t\t\tstep=\"0.1\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<label for=\"gas-price\">Gas Price</label>\n\t\t\t\t\t<div class=\"input-money-wrapper\">\n\t\t\t\t\t\t<span class=\"symbol\">$</span><input\n\t\t\t\t\t\t\tid=\"gas-price\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tbind:value={gasPriceLocal}\n\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"summary-box\" style=\"margin: 40px 0;\">\n\t\t\t\t<span>Estimated Fuel Cost</span><strong>{formatCurrency(tripData.fuelCost)}</strong>\n\t\t\t</div>\n\n\t\t\t<div class=\"info-note\">\n\t\t\t\t<span\n\t\t\t\t\t><strong>Note:</strong> Use the checkboxes next to each Maintenance or Supplies item to mark\n\t\t\t\t\tthat individual item as tax-deductible.</span\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class=\"section-group\">\n\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t<h3>Maintenance</h3>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\ton:click={() => openSettings('maintenance')}\n\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t<select\n\t\t\t\t\t\tbind:value={selectedMaintenance}\n\t\t\t\t\t\tclass=\"select-input\"\n\t\t\t\t\t\taria-label=\"Maintenance type\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option value=\"\" disabled selected>Select Item...</option>\n\t\t\t\t\t\t{#each maintenanceOptions as option}\n\t\t\t\t\t\t\t<option value={option}>{option}</option>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</select>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"btn-small primary\"\n\t\t\t\t\t\ton:click={addMaintenanceItem}\n\t\t\t\t\t\tdisabled={!selectedMaintenance}>Add</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\n\t\t\t\t{#each tripData.maintenanceItems as item}\n\t\t\t\t\t<div class=\"expense-row\">\n\t\t\t\t\t\t<span class=\"name\">{item.type}</span>\n\t\t\t\t\t\t<div class=\"input-money-wrapper small\">\n\t\t\t\t\t\t\t<span class=\"symbol\">$</span>\n\t\t\t\t\t\t\t<input type=\"number\" bind:value={item.cost} placeholder=\"0.00\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-controls\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"tax-pill\"\n\t\t\t\t\t\t\t\ton:click={() => (item.taxDeductible = !item.taxDeductible)}\n\t\t\t\t\t\t\t\taria-pressed={item.taxDeductible}\n\t\t\t\t\t\t\t\ttitle=\"Mark this item as tax deductible\"\n\t\t\t\t\t\t\t\t>{item.taxDeductible ? 'Tax' : 'No Tax'}</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<label class=\"inline-label sr-only\"\n\t\t\t\t\t\t\t\t><input type=\"checkbox\" bind:checked={item.taxDeductible} /></label\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn-icon delete\"\n\t\t\t\t\t\t\ton:click={() => removeMaintenanceItem(String(item.id ?? ''))}>✕</button\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t<div class=\"section-group\">\n\t\t\t\t<div class=\"section-top\">\n\t\t\t\t\t<h3>Supplies</h3>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"btn-icon gear\"\n\t\t\t\t\t\ton:click={() => openSettings('supplies')}\n\t\t\t\t\t\ttitle=\"Manage Options\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path\n\t\t\t\t\t\t\t\td=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n\t\t\t\t\t\t\t></path></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"add-row\">\n\t\t\t\t\t<select bind:value={selectedSupply} class=\"select-input\" aria-label=\"Supply type\">\n\t\t\t\t\t\t<option value=\"\" disabled selected>Select Item...</option>\n\t\t\t\t\t\t{#each suppliesOptions as option}\n\t\t\t\t\t\t\t<option value={option}>{option}</option>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</select>\n\t\t\t\t\t<button class=\"btn-small primary\" on:click={addSupplyItem} disabled={!selectedSupply}\n\t\t\t\t\t\t>Add</button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\n\t\t\t\t{#each tripData.suppliesItems as item}\n\t\t\t\t\t<div class=\"expense-row\">\n\t\t\t\t\t\t<span class=\"name\">{item.type}</span>\n\t\t\t\t\t\t<div class=\"input-money-wrapper small\">\n\t\t\t\t\t\t\t<span class=\"symbol\">$</span>\n\t\t\t\t\t\t\t<input type=\"number\" bind:value={item.cost} placeholder=\"0.00\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-controls\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"tax-pill\"\n\t\t\t\t\t\t\t\ton:click={() => (item.taxDeductible = !item.taxDeductible)}\n\t\t\t\t\t\t\t\taria-pressed={item.taxDeductible}\n\t\t\t\t\t\t\t\ttitle=\"Mark this item as tax deductible\"\n\t\t\t\t\t\t\t\t>{item.taxDeductible ? 'Tax' : 'No Tax'}</button\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<label class=\"inline-label sr-only\"\n\t\t\t\t\t\t\t\t><input type=\"checkbox\" bind:checked={item.taxDeductible} /></label\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button class=\"btn-icon delete\" on:click={() => removeSupplyItem(String(item.id ?? ''))}\n\t\t\t\t\t\t\t>✕</button\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<label for=\"notes\">Notes</label><textarea\n\t\t\t\t\tid=\"notes\"\n\t\t\t\t\tbind:value={notesLocal}\n\t\t\t\t\trows=\"3\"\n\t\t\t\t\tplaceholder=\"Trip details...\"\n\t\t\t\t></textarea>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Review Section -->\n\t\t<div class=\"form-card\">\n\t\t\t<div class=\"card-header\"><h2 class=\"card-title\">Review</h2></div>\n\t\t\t<div class=\"review-grid\">\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Date</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{new Date(tripData.date || '').toLocaleDateString('en-US', {\n\t\t\t\t\t\t\tmonth: 'numeric',\n\t\t\t\t\t\t\tday: 'numeric',\n\t\t\t\t\t\t\tyear: 'numeric'\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Total Time</span>\n\t\t\t\t\t<div>{tripData.hoursWorked.toFixed(1)} hrs</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Drive Time</span>\n\t\t\t\t\t<div>{formatDuration(tripData.estimatedTime)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Hours Worked</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{Math.max(0, tripData.hoursWorked - tripData.estimatedTime / 60).toFixed(1)} hrs\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Distance</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{tripData.totalMiles} mi\n\t\t\t\t\t\t{#if tripData.roundTripMiles && tripData.roundTripMiles !== tripData.totalMiles}\n\t\t\t\t\t\t\t• Round trip: {tripData.roundTripMiles} mi • {tripData.roundTripTime} min\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"review-tile\">\n\t\t\t\t\t<span class=\"review-label\">Stops</span>\n\t\t\t\t\t<div>{tripData.stops.length}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"financial-summary\">\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<span>Earnings</span> <span class=\"val positive\">{formatCurrency(totalEarnings)}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row subheader\"><span>Expenses Breakdown</span></div>\n\t\t\t\t{#if tripData.fuelCost > 0}<div class=\"row detail\">\n\t\t\t\t\t\t<span>Fuel</span> <span class=\"val\">{formatCurrency(tripData.fuelCost)}</span>\n\t\t\t\t\t</div>{/if}{#each tripData.maintenanceItems as item}<div class=\"row detail\">\n\t\t\t\t\t\t<span>{item.type}</span> <span class=\"val\">{formatCurrency(item.cost)}</span>\n\t\t\t\t\t</div>{/each}{#each tripData.suppliesItems as item}<div class=\"row detail\">\n\t\t\t\t\t\t<span>{item.type}</span> <span class=\"val\">{formatCurrency(item.cost)}</span>\n\t\t\t\t\t</div>{/each}\n\t\t\t\t<div class=\"row total-expenses\">\n\t\t\t\t\t<span>Total Expenses</span>\n\t\t\t\t\t<span class=\"val negative\">-{formatCurrency(totalCosts)}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row total\">\n\t\t\t\t\t<span>Net Profit</span>\n\t\t\t\t\t<span class=\"val\" class:positive={totalProfit >= 0}>{formatCurrency(totalProfit)}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<!-- Save Button -->\n\t\t\t<div class=\"form-actions\">\n\t\t\t\t<button class=\"btn-primary full-width\" on:click={saveTrip}>Save Trip</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<Modal bind:open={isManageCategoriesOpen} title=\"Manage Options\">\n\t<div class=\"categories-manager\">\n\t\t<div class=\"tabs\">\n\t\t\t<button\n\t\t\t\tclass=\"tab-btn\"\n\t\t\t\tclass:active={activeCategoryType === 'maintenance'}\n\t\t\t\ton:click={() => (activeCategoryType = 'maintenance')}>Maintenance</button\n\t\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"tab-btn\"\n\t\t\t\tclass:active={activeCategoryType === 'supplies'}\n\t\t\t\ton:click={() => (activeCategoryType = 'supplies')}>Supplies</button\n\t\t\t>\n\t\t</div>\n\t\t<div class=\"cat-list\">\n\t\t\t{#each activeCategories as cat}\n\t\t\t\t<div class=\"cat-item\">\n\t\t\t\t\t<span class=\"cat-badge\">{cat}</span>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"cat-delete\"\n\t\t\t\t\t\ton:click={() => removeCategory(cat)}\n\t\t\t\t\t\taria-label=\"Delete Category\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"\n\t\t\t\t\t\t\t></line></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"text-sm text-gray-400 italic text-center py-4\">No categories defined.</div>\n\t\t\t{/each}\n\t\t</div>\n\t\t<div class=\"add-cat-form\">\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tbind:value={newCategoryName}\n\t\t\t\tplaceholder=\"New Item Name...\"\n\t\t\t\tclass=\"input-field\"\n\t\t\t\ton:keydown={(e) => e.key === 'Enter' && addCategory()}\n\t\t\t/>\n\t\t\t<button class=\"btn-secondary\" on:click={addCategory}>Add</button>\n\t\t</div>\n\t\t<div class=\"modal-actions mt-6\">\n\t\t\t<button class=\"btn-cancel w-full\" on:click={() => (isManageCategoriesOpen = false)}\n\t\t\t\t>Done</button\n\t\t\t>\n\t\t</div>\n\t</div>\n</Modal>\n\n<Modal bind:open={showUpgradeModal} title=\"Upgrade to Pro\">\n\t<div class=\"space-y-6 text-center py-4\">\n\t\t<div class=\"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4\">\n\t\t\t<span class=\"text-3xl\">🚀</span>\n\t\t</div>\n\n\t\t<h3 class=\"text-xl font-bold text-gray-900\">Unlock Pro Features</h3>\n\n\t\t<p class=\"text-gray-600\">\n\t\t\t{upgradeMessage || \"You've hit the limits of the Free plan.\"}\n\t\t</p>\n\n\t\t<div class=\"bg-gray-50 p-4 rounded-lg text-left text-sm space-y-2 border border-gray-100\">\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500\">✓</span>\n\t\t\t\t<span>Unlimited Stops per Trip</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500\">✓</span>\n\t\t\t\t<span>One-Click Route Optimization</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500\">✓</span>\n\t\t\t\t<span>Unlimited Monthly Trips</span>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<span class=\"text-green-500\">✓</span>\n\t\t\t\t<span>Data Export</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex gap-3 justify-center pt-2\">\n\t\t\t<Button variant=\"outline\" on:click={() => (showUpgradeModal = false)}>Maybe Later</Button>\n\t\t\t<a\n\t\t\t\thref=\"/dashboard/settings\"\n\t\t\t\tclass=\"inline-flex items-center justify-center rounded-lg bg-orange-600 px-6 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600\"\n\t\t\t>\n\t\t\t\tUpgrade Now\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</Modal>\n\n<style>\n\t/* Use styles from New Trip page for consistency */\n\t/* Component-level override: hide old pill button and show visible checkbox + label */\n\t.item-controls .tax-pill {\n\t\tdisplay: none !important;\n\t\tvisibility: hidden !important;\n\t}\n\t.item-controls .inline-label.sr-only {\n\t\tposition: static !important;\n\t\twidth: auto !important;\n\t\theight: auto !important;\n\t\tdisplay: inline-flex !important;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t}\n\t.item-controls .inline-label.sr-only input[type='checkbox'] {\n\t\tappearance: checkbox !important;\n\t\tdisplay: inline-block !important;\n\t\topacity: 1 !important;\n\t\twidth: 18px !important;\n\t\theight: 18px !important;\n\t\tmargin-right: 6px !important;\n\t}\n\t.item-controls .inline-label.sr-only::after {\n\t\tcontent: 'Tax deductible';\n\t\tmargin-left: 6px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tfont-size: 13px;\n\t}\n\t.item-controls .inline-label {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t}\n\t.trip-form {\n\t\tmax-width: 1300px;\n\t\tmargin: 0 auto;\n\t\tpadding: 4px;\n\t\tpadding-bottom: 90px;\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.trip-form {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\t}\n\t.page-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 26px;\n\t\tpadding: 0 8px;\n\t}\n\t.page-title {\n\t\tfont-size: 28px;\n\t\tfont-weight: 800;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.page-subtitle {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tdisplay: none;\n\t}\n\t.btn-back {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\ttext-decoration: none;\n\t\tfont-size: 14px;\n\t}\n\t.form-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 18px;\n\t\tpadding: 16px;\n\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\t\tmargin-bottom: 20px;\n\t}\n\t.card-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 26px;\n\t}\n\t.card-title {\n\t\tfont-size: 22px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 0;\n\t}\n\t.form-grid {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24px;\n\t}\n\t.form-row {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 20px;\n\t}\n\t.form-group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\tlabel {\n\t\tfont-size: 16px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\t.hint {\n\t\tcolor: #9ca3af;\n\t\tfont-weight: 400;\n\t}\n\tinput,\n\ttextarea {\n\t\twidth: 100%;\n\t\tpadding: 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tfont-size: 18px;\n\t\tbackground: white;\n\t\tbox-sizing: border-box;\n\t}\n\tinput:focus,\n\ttextarea:focus {\n\t\toutline: none;\n\t\tborder-color: #ff7f50;\n\t}\n\t.readonly-field {\n\t\tbackground: #f9fafb;\n\t\tpadding: 16px;\n\t\tborder-radius: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #6b7280;\n\t\tfont-weight: 500;\n\t\tfont-size: 18px;\n\t}\n\t.address-input {\n\t\tpadding-top: 20px;\n\t\tpadding-bottom: 20px;\n\t\tfont-size: 19px;\n\t}\n\t.input-money-wrapper {\n\t\tposition: relative;\n\t\twidth: 100%;\n\t}\n\t.input-money-wrapper .symbol {\n\t\tposition: absolute;\n\t\tleft: 16px;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\tcolor: #6b7280;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t}\n\t.input-money-wrapper input {\n\t\tpadding-left: 36px;\n\t}\n\t.input-money-wrapper.small input {\n\t\tpadding: 12px 12px 12px 30px;\n\t\tfont-size: 16px;\n\t}\n\t.input-money-wrapper.small .symbol {\n\t\tleft: 12px;\n\t\tfont-size: 16px;\n\t}\n\t.stops-container {\n\t\tmargin: 26px 0;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 14px;\n\t\tpadding: 16px;\n\t\tbackground: #f9fafb;\n\t}\n\t.stops-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 18px;\n\t\talign-items: center;\n\t}\n\t.stops-header h3 {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tmargin: 0;\n\t}\n\t.stops-header .count {\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\tbackground: #e5e7eb;\n\t\tpadding: 5px 12px;\n\t\tborder-radius: 10px;\n\t}\n\t.stops-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 18px;\n\t\tmargin-bottom: 22px;\n\t}\n\t.stop-card {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 14px;\n\t\tpadding: 18px;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 18px;\n\t}\n\t.stop-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t}\n\t.stop-number {\n\t\tbackground: #ff7f50;\n\t\tcolor: white;\n\t\twidth: 30px;\n\t\theight: 30px;\n\t\tborder-radius: 8px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-weight: 700;\n\t\tfont-size: 15px;\n\t}\n\t.stop-actions {\n\t\tdisplay: flex;\n\t\tgap: 18px;\n\t\talign-items: center;\n\t\tcolor: #9ca3af;\n\t}\n\t.stop-inputs {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 14px;\n\t\twidth: 100%;\n\t}\n\t.stop-inputs.new {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 14px;\n\t\tmargin-bottom: 18px;\n\t}\n\t.form-actions {\n\t\tdisplay: flex;\n\t\tgap: 18px;\n\t\tmargin-top: 36px;\n\t\tpadding-top: 26px;\n\t\tborder-top: 1px solid #e5e7eb;\n\t}\n\t.btn-primary,\n\t.btn-secondary {\n\t\tflex: 1;\n\t\tpadding: 18px;\n\t\tborder-radius: 12px;\n\t\tfont-weight: 600;\n\t\tfont-size: 18px;\n\t\tcursor: pointer;\n\t\tborder: none;\n\t\ttext-align: center;\n\t}\n\t.btn-primary {\n\t\tbackground: linear-gradient(135deg, #ff7f50 0%, #ff6a3d 100%);\n\t\tcolor: white;\n\t}\n\t.btn-secondary {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t}\n\t.btn-icon {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tfont-size: 22px;\n\t\tcursor: pointer;\n\t\tcolor: #9ca3af;\n\t\tpadding: 6px;\n\t}\n\t.btn-icon.delete:hover {\n\t\tcolor: #dc2626;\n\t}\n\t.btn-icon.gear {\n\t\tcolor: #6b7280;\n\t\tfont-size: 18px;\n\t\tpadding: 4px;\n\t\ttransition: color 0.2s;\n\t}\n\t.btn-icon.gear:hover {\n\t\tcolor: #374151;\n\t}\n\n\t.btn-small {\n\t\tpadding: 12px 18px;\n\t\tborder-radius: 8px;\n\t\tborder: none;\n\t\tfont-weight: 600;\n\t\tfont-size: 15px;\n\t\tcursor: pointer;\n\t}\n\t.btn-small.primary {\n\t\tbackground: #10b981;\n\t\tcolor: white;\n\t}\n\t.summary-box {\n\t\tbackground: #ecfdf5;\n\t\tborder: 1px solid #a7f3d0;\n\t\tpadding: 22px;\n\t\tborder-radius: 14px;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tcolor: #065f46;\n\t\tmargin-bottom: 36px;\n\t\tfont-size: 18px;\n\t}\n\t.section-group {\n\t\tmargin-bottom: 36px;\n\t}\n\t.section-top {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 18px;\n\t\talign-items: center;\n\t}\n\t.section-top h3 {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tmargin: 0;\n\t}\n\n\t.add-row {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tmargin-bottom: 18px;\n\t}\n\t.select-input {\n\t\tflex: 1;\n\t\tpadding: 12px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 10px;\n\t\tfont-size: 16px;\n\t\tbackground: white;\n\t\tcolor: #374151;\n\t}\n\n\t.expense-row {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\tgap: 14px;\n\t\tpadding: 14px 0;\n\t\tborder-bottom: 1px solid #f3f4f6;\n\t}\n\n\t.expense-row .name {\n\t\tfont-size: 17px;\n\t\tfont-weight: 500;\n\t\tflex: 1;\n\t}\n\t.expense-row .input-money-wrapper {\n\t\twidth: 120px;\n\t}\n\t.review-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 18px;\n\t\tmargin-bottom: 36px;\n\t}\n\t.review-tile {\n\t\tbackground: #f9fafb;\n\t\tpadding: 18px;\n\t\tborder-radius: 14px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.review-tile .review-label {\n\t\tdisplay: block;\n\t\tfont-size: 14px;\n\t\tcolor: #6b7280;\n\t\ttext-transform: uppercase;\n\t\tmargin-bottom: 4px;\n\t}\n\t.review-tile div {\n\t\tfont-weight: 700;\n\t\tfont-size: 18px;\n\t\tcolor: #111827;\n\t}\n\t.financial-summary {\n\t\tbackground: #f9fafb;\n\t\tpadding: 26px;\n\t\tborder-radius: 16px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tmargin-bottom: 26px;\n\t}\n\t.financial-summary .row {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 14px;\n\t\tfont-size: 17px;\n\t}\n\t.financial-summary .row.subheader {\n\t\tfont-weight: 700;\n\t\tcolor: #374151;\n\t\tmargin-top: 18px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t\tpadding-bottom: 4px;\n\t\tmargin-bottom: 8px;\n\t\tfont-size: 15px;\n\t}\n\t.financial-summary .row.detail {\n\t\tfont-size: 15px;\n\t\tcolor: #6b7280;\n\t}\n\t.financial-summary .row.total-expenses {\n\t\tfont-weight: 600;\n\t\tcolor: #4b5563;\n\t\tborder-top: 1px dashed #d1d5db;\n\t\tpadding-top: 8px;\n\t}\n\t.financial-summary .total {\n\t\tborder-top: 2px solid #d1d5db;\n\t\tmargin-top: 18px;\n\t\tpadding-top: 18px;\n\t\tfont-weight: 800;\n\t\tfont-size: 20px;\n\t}\n\t.val.positive {\n\t\tcolor: #059669;\n\t}\n\t.val.negative {\n\t\tcolor: #dc2626;\n\t}\n\t.categories-manager {\n\t\tpadding: 4px;\n\t}\n\t.tabs {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\tmargin-bottom: 16px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t}\n\t.tab-btn {\n\t\tpadding: 8px 16px;\n\t\tbackground: none;\n\t\tborder: none;\n\t\tborder-bottom: 2px solid transparent;\n\t\tfont-weight: 600;\n\t\tcolor: #6b7280;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\t.tab-btn.active {\n\t\tcolor: #ff7f50;\n\t\tborder-bottom-color: #ff7f50;\n\t}\n\t.cat-list {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgap: 8px;\n\t\tmargin-bottom: 20px;\n\t\tmax-height: 200px;\n\t\toverflow-y: auto;\n\t}\n\t.cat-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 4px;\n\t\tbackground: #f3f4f6;\n\t\tpadding: 4px 4px 4px 10px;\n\t\tborder-radius: 20px;\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\t.cat-badge {\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t\ttext-transform: capitalize;\n\t\tpadding: 0 4px;\n\t}\n\t.cat-delete {\n\t\tborder: none;\n\t\tbackground: #e5e7eb;\n\t\tcolor: #6b7280;\n\t\tborder-radius: 50%;\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t}\n\t.cat-delete:hover {\n\t\tbackground: #ef4444;\n\t\tcolor: white;\n\t}\n\t.add-cat-form {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t}\n\t.add-cat-form .input-field {\n\t\tflex: 1;\n\t\tpadding: 10px;\n\t\tborder: 1px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t}\n\t.modal-actions .btn-cancel {\n\t\tbackground: white;\n\t\tborder: 1px solid #e5e7eb;\n\t\tcolor: #374151;\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\twidth: 100%;\n\t}\n\n\t@media (min-width: 768px) {\n\t\t.page-subtitle {\n\t\t\tdisplay: block;\n\t\t}\n\t\t.form-card {\n\t\t\tpadding: 48px;\n\t\t}\n\t\t.stop-card {\n\t\t\tflex-direction: row;\n\t\t\talign-items: center;\n\t\t}\n\t\t.stop-inputs {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: 1fr 160px;\n\t\t}\n\t\t.stop-inputs.new {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: 1fr 160px;\n\t\t}\n\t\t.form-actions {\n\t\t\tjustify-content: flex-end;\n\t\t}\n\t\t.btn-primary,\n\t\t.btn-secondary {\n\t\t\tflex: 0 0 auto;\n\t\t\twidth: auto;\n\t\t\tmin-width: 160px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\debug\\passkey-demo\\+page.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\debug\\passkey-demo\\+page.svelte",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 85,
				"column": 14,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 85,
				"endColumn": 15
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { startRegistration } from '@simplewebauthn/browser';\n\tlet message = '';\n\tlet loading = false;\n\n\tasync function runDemo() {\n\t\tloading = true;\n\t\tmessage = '';\n\t\ttry {\n\t\t\tconst res = await fetch('/debug/webauthn-test');\n\t\t\tif (!res.ok) throw new Error('Failed to get options');\n\t\t\tconst data: any = await res.json();\n\t\t\tconst options = data.full;\n\n\t\t\t// Ensure challenge is string\n\t\t\tif (options.challenge && typeof options.challenge !== 'string') {\n\t\t\t\tconst bytes = new Uint8Array(options.challenge);\n\t\t\t\tlet binary = '';\n\t\t\t\tfor (let i = 0; i < bytes.length; i++) binary += String.fromCharCode(Number(bytes[i] ?? 0));\n\t\t\t\toptions.challenge = btoa(binary).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n\t\t\t}\n\n\t\t\t// Call startRegistration\n\t\t\tconst cred = await startRegistration({ optionsJSON: options as any });\n\t\t\tconsole.log('Demo credential:', cred);\n\n\t\t\t// Normalize ArrayBuffer fields to base64url strings\n\t\t\tfunction bufferToBase64Url(buffer: ArrayBuffer | Uint8Array) {\n\t\t\t\tconst bytes = buffer instanceof Uint8Array ? buffer : new Uint8Array(buffer);\n\t\t\t\tlet binary = '';\n\t\t\t\tfor (let i = 0; i < bytes.byteLength; i++)\n\t\t\t\t\tbinary += String.fromCharCode(Number(bytes[i] ?? 0));\n\t\t\t\treturn btoa(binary).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n\t\t\t}\n\n\t\t\tconst normalised: any = { ...cred } as any;\n\t\t\tif (\n\t\t\t\tnormalised.rawId &&\n\t\t\t\t(normalised.rawId instanceof ArrayBuffer || ArrayBuffer.isView(normalised.rawId))\n\t\t\t) {\n\t\t\t\tnormalised.rawId = bufferToBase64Url(normalised.rawId as ArrayBuffer);\n\t\t\t}\n\t\t\tconst resp = normalised.response || {};\n\t\t\tif (\n\t\t\t\tresp.attestationObject &&\n\t\t\t\t(resp.attestationObject instanceof ArrayBuffer ||\n\t\t\t\t\tArrayBuffer.isView(resp.attestationObject))\n\t\t\t)\n\t\t\t\tresp.attestationObject = bufferToBase64Url(resp.attestationObject);\n\t\t\tif (\n\t\t\t\tresp.clientDataJSON &&\n\t\t\t\t(resp.clientDataJSON instanceof ArrayBuffer || ArrayBuffer.isView(resp.clientDataJSON))\n\t\t\t)\n\t\t\t\tresp.clientDataJSON = bufferToBase64Url(resp.clientDataJSON);\n\n\t\t\t// POST to verification endpoint\n\t\t\ttry {\n\t\t\t\t// Compute device name to send to server (prefill using UA info)\n\t\t\t\tfunction getDeviceName() {\n\t\t\t\t\tconst uaData = (navigator as any).userAgentData;\n\t\t\t\t\tif (uaData && uaData.platform) {\n\t\t\t\t\t\tconst brand =\n\t\t\t\t\t\t\t(uaData.brands && uaData.brands[0] && uaData.brands[0].brand) || 'Browser';\n\t\t\t\t\t\treturn `${brand} on ${uaData.platform}`;\n\t\t\t\t\t}\n\t\t\t\t\tconst ua = navigator.userAgent || '';\n\t\t\t\t\tif (/Android/i.test(ua)) return 'Android device';\n\t\t\t\t\tif (/Windows/i.test(ua)) return 'Windows device';\n\t\t\t\t\tif (/Mac|Macintosh/i.test(ua)) return 'Mac device';\n\t\t\t\t\tif (/iPhone|iPad/i.test(ua)) return 'iOS device';\n\t\t\t\t\treturn 'Unknown device';\n\t\t\t\t}\n\n\t\t\t\tconst deviceName = getDeviceName();\n\n\t\t\t\tconst verifyRes = await fetch('/api/auth/webauthn?type=register', {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\tbody: JSON.stringify({ credential: normalised, deviceName })\n\t\t\t\t});\n\n\t\t\t\tlet verifyJson: any = {};\n\t\t\t\ttry {\n\t\t\t\t\tverifyJson = await verifyRes.json();\n\t\t\t\t} catch (e) {\n\t\t\t\t\t/* ignore parse errors */\n\t\t\t\t}\n\n\t\t\t\tif (verifyRes.ok && verifyJson.verified) {\n\t\t\t\t\tmessage = 'Registered and verified by server';\n\t\t\t\t} else {\n\t\t\t\t\tmessage =\n\t\t\t\t\t\t'Server verification failed: ' +\n\t\t\t\t\t\t(verifyJson && (verifyJson.error || JSON.stringify(verifyJson)));\n\t\t\t\t}\n\t\t\t} catch (err: any) {\n\t\t\t\tconsole.error('Verification POST error', err);\n\t\t\t\tmessage = 'Verification POST failed: ' + (err?.message || String(err));\n\t\t\t}\n\t\t} catch (err: any) {\n\t\t\tconsole.error('Demo error', err);\n\t\t\tmessage = err?.message || String(err);\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n</script>\n\n<svelte:head>\n\t<title>Passkey Demo</title>\n</svelte:head>\n\n<main style=\"padding: 24px;\">\n\t<h1>Passkey Demo</h1>\n\t<p>Fetches registration options from a debug endpoint and runs <code>startRegistration</code>.</p>\n\t<div style=\"margin-top: 16px;\">\n\t\t<button on:click={runDemo} disabled={loading}\n\t\t\t>{loading ? 'Running...' : 'Register Demo Passkey'}</button\n\t\t>\n\t</div>\n\t{#if message}\n\t\t<div style=\"margin-top: 12px;\">Result: {message}</div>\n\t{/if}\n</main>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\debug\\webauthn-test\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 21,
				"column": 65,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 21,
				"endColumn": 68,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [671, 674], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [671, 674], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 21,
				"column": 78,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 21,
				"endColumn": 81,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [684, 687], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [684, 687], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 23,
				"column": 27,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 23,
				"endColumn": 30,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [717, 720], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [717, 720], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 35,
				"column": 63,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 35,
				"endColumn": 66,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1064, 1067], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1064, 1067], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 4,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import type { RequestHandler } from './$types';\nimport { generateRegistrationOptions } from '$lib/server/webauthn';\nimport { dev } from '$app/environment';\nimport { json } from '@sveltejs/kit';\n\nexport const GET: RequestHandler = async () => {\n\t// [SECURITY] Debug endpoints must not be accessible in production\n\tif (!dev && process.env['NODE_ENV'] === 'production') {\n\t\treturn json({ error: 'Not available in production' }, { status: 403 });\n\t}\n\n\ttry {\n\t\tconst mockUser = {\n\t\t\tid: 'test-user-123',\n\t\t\temail: 'test@example.com',\n\t\t\tname: 'Test User',\n\t\t\tauthenticators: []\n\t\t};\n\n\t\tconst rpID = 'localhost';\n\t\tconst options = await generateRegistrationOptions(mockUser as any, rpID as any);\n\n\t\tfunction fieldInfo(val: any) {\n\t\t\treturn {\n\t\t\t\ttype: typeof val,\n\t\t\t\tctor: val && (val.constructor ? val.constructor.name : undefined),\n\t\t\t\tlen: val && (val.byteLength || val.length)\n\t\t\t};\n\t\t}\n\n\t\treturn new Response(\n\t\t\tJSON.stringify({\n\t\t\t\toptionsPreview: {\n\t\t\t\t\tchallengeInfo: fieldInfo(options.challenge),\n\t\t\t\t\texcludeCreds: (options.excludeCredentials || []).map((c: any) => ({\n\t\t\t\t\t\tidInfo: fieldInfo(c.id)\n\t\t\t\t\t}))\n\t\t\t\t},\n\t\t\t\tfull: options\n\t\t\t}),\n\t\t\t{ headers: { 'Content-Type': 'application/json' } }\n\t\t);\n\t} catch (err) {\n\t\treturn new Response(\n\t\t\tJSON.stringify({\n\t\t\t\terror: err instanceof Error ? err.message : String(err),\n\t\t\t\tstack: err instanceof Error ? err.stack : undefined\n\t\t\t}),\n\t\t\t{ status: 500, headers: { 'Content-Type': 'application/json' } }\n\t\t);\n\t}\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\docs\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 60,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 60,
				"endColumn": 47
			}
		],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport Header from '$lib/components/layout/Header.svelte';\n\timport { base } from '$app/paths';\n\tconst resolve = (href: string) => `${base}${href}`;\n\n\t// Simple smooth scroll handler\n\tfunction scrollToSection(id: string) {\n\t\tif (typeof document === 'undefined') return;\n\t\tconst element = document.getElementById(id);\n\t\tif (element) {\n\t\t\telement.scrollIntoView({ behavior: 'smooth' });\n\t\t}\n\t}\n</script>\n\n<svelte:head>\n\t<title>Documentation - Go Route Yourself</title>\n\t<meta\n\t\tname=\"description\"\n\t\tcontent=\"API documentation, user guides, and FAQs for Go Route Yourself.\"\n\t/>\n</svelte:head>\n\n<Header />\n\n<div class=\"docs-page\">\n\t<div class=\"container\">\n\t\t<div class=\"docs-layout\">\n\t\t\t<aside class=\"sidebar\">\n\t\t\t\t<div class=\"sidebar-content\">\n\t\t\t\t\t<h3 class=\"nav-title\">User Guide</h3>\n\t\t\t\t\t<button on:click={() => scrollToSection('getting-started')}>Getting Started</button>\n\t\t\t\t\t<button on:click={() => scrollToSection('profit-tracking')}>Profit Tracking</button>\n\t\t\t\t\t<button on:click={() => scrollToSection('exporting')}>Exporting Reports</button>\n\n\t\t\t\t\t<h3 class=\"nav-title\">API Reference</h3>\n\t\t\t\t\t<button on:click={() => scrollToSection('authentication')}>Authentication</button>\n\t\t\t\t\t<button on:click={() => scrollToSection('endpoints')}>Endpoints</button>\n\n\t\t\t\t\t<h3 class=\"nav-title\">Support</h3>\n\t\t\t\t\t<button on:click={() => scrollToSection('faq')}>FAQs</button>\n\t\t\t\t</div>\n\t\t\t</aside>\n\n\t\t\t<main class=\"content\">\n\t\t\t\t<div class=\"page-header\">\n\t\t\t\t\t<h1>Documentation</h1>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tEverything you need to manage your routes, track profits, and integrate with our\n\t\t\t\t\t\tplatform.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<section id=\"getting-started\" class=\"doc-section\">\n\t\t\t\t\t<h2>Getting Started</h2>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tGo Route Yourself helps drivers plan efficient routes and track their net profit in\n\t\t\t\t\t\treal-time. To begin, create an account and set your default values (MPG, Gas Price) in\n\t\t\t\t\t\tthe\n\t\t\t\t\t\t<a href={resolve('/dashboard/settings')}>Settings</a> menu.\n\t\t\t\t\t</p>\n\t\t\t\t</section>\n\n\t\t\t\t<section id=\"profit-tracking\" class=\"doc-section\">\n\t\t\t\t\t<h2>Profit Tracking</h2>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tUnlike standard GPS apps, we focus on your bottom line. Here is how we calculate your\n\t\t\t\t\t\t\"True Profit\":\n\t\t\t\t\t</p>\n\t\t\t\t\t<div class=\"info-box\">\n\t\t\t\t\t\t<strong>Formula:</strong><br />\n\t\t\t\t\t\t<code>(Stop Earnings) - (Fuel Cost + Maintenance + Supplies) = Net Profit</code>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li><strong>Earnings:</strong> Assign a dollar value to every stop or delivery.</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Fuel:</strong> Calculated automatically based on your vehicle's MPG and local gas\n\t\t\t\t\t\t\tprices, or entered manually.\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<strong>Maintenance:</strong> Log oil changes, repairs, or set a \"per-mile\" wear-and-tear\n\t\t\t\t\t\t\tcost.\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</section>\n\n\t\t\t\t<section id=\"exporting\" class=\"doc-section\">\n\t\t\t\t\t<h2>Exporting Reports</h2>\n\t\t\t\t\t<p>You can export your data for tax purposes or team reporting.</p>\n\t\t\t\t\t<ol>\n\t\t\t\t\t\t<li>Navigate to <strong>Settings > Data Management</strong>.</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\tChoose <strong>Export All Trips (CSV)</strong> for a spreadsheet compatible with Excel/Google\n\t\t\t\t\t\t\tSheets.\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\tFor a visual summary, use the <strong>Print/PDF</strong> button on the Dashboard.\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ol>\n\t\t\t\t</section>\n\n\t\t\t\t<hr class=\"divider\" />\n\n\t\t\t\t<section id=\"authentication\" class=\"doc-section\">\n\t\t\t\t\t<div class=\"badge-api\">Business Plan Only</div>\n\t\t\t\t\t<h2>API Authentication</h2>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tThe Go Route Yourself API allows Business Plan users to integrate route data directly\n\t\t\t\t\t\tinto their own systems. All API requests require a Bearer Token.\n\t\t\t\t\t</p>\n\t\t\t\t\t<div class=\"code-block\">\n\t\t\t\t\t\t<div class=\"code-header\">Header Format</div>\n\t\t\t\t\t\t<pre>Authorization: Bearer YOUR_API_KEY</pre>\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\n\t\t\t\t<section id=\"endpoints\" class=\"doc-section\">\n\t\t\t\t\t<h2>Endpoints</h2>\n\n\t\t\t\t\t<div class=\"endpoint\">\n\t\t\t\t\t\t<div class=\"endpoint-header\">\n\t\t\t\t\t\t\t<span class=\"method get\">GET</span>\n\t\t\t\t\t\t\t<span class=\"url\">/v1/trips</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p>Retrieve a list of all trips within a date range.</p>\n\t\t\t\t\t\t<div class=\"code-block\">\n\t\t\t\t\t\t\t<pre>\n// Request\nGET /v1/trips?start=2025-01-01&end=2025-01-31\n\n// Response\n&#123;\n  \"data\": [\n    &#123;\n      \"id\": \"trip_123\",\n      \"date\": \"2025-01-15\",\n      \"netProfit\": 145.50,\n      \"totalMiles\": 45.2\n    &#125;\n  ]\n&#125;</pre>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"endpoint\">\n\t\t\t\t\t\t<div class=\"endpoint-header\">\n\t\t\t\t\t\t\t<span class=\"method post\">POST</span>\n\t\t\t\t\t\t\t<span class=\"url\">/v1/routes/optimize</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p>Submit a list of stops to receive an optimized route order.</p>\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\n\t\t\t\t<hr class=\"divider\" />\n\n\t\t\t\t<section id=\"faq\" class=\"doc-section\">\n\t\t\t\t\t<h2>Frequently Asked Questions</h2>\n\n\t\t\t\t\t<div class=\"faq-item\">\n\t\t\t\t\t\t<h4>How accurate is the GPS mileage?</h4>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tWe use the Google Maps API for high-accuracy routing. However, actual mileage may vary\n\t\t\t\t\t\t\tslightly due to road detours or GPS drift.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"faq-item\">\n\t\t\t\t\t\t<h4>Can I cancel my subscription?</h4>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tYes, you can cancel anytime from the Settings page. Your data will be preserved for 30\n\t\t\t\t\t\t\tdays in case you decide to return.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"faq-item\">\n\t\t\t\t\t\t<h4>Do you support team accounts?</h4>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tYes! The Business Plan allows you to add multiple drivers and view a consolidated\n\t\t\t\t\t\t\tdashboard of all fleet earnings.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t</main>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t:global(:root) {\n\t\t--navy: #2c4a6e;\n\t\t--orange: #ff7f50;\n\t\t--blue: #29abe2;\n\t\t--gray-100: #f3f4f6;\n\t\t--gray-200: #e5e7eb;\n\t\t--gray-600: #4b5563;\n\t\t--gray-800: #1f2937;\n\t\t--gray-900: #111827;\n\t\t--bg-light: #f9fafb;\n\t}\n\n\t.docs-page {\n\t\tbackground-color: var(--bg-light);\n\t\tmin-height: 100vh;\n\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n\t\tcolor: var(--gray-900);\n\t\tline-height: 1.6;\n\t}\n\n\t.container {\n\t\tmax-width: 1200px;\n\t\tmargin: 0 auto;\n\t\tpadding: 0 20px;\n\t}\n\n\t.docs-layout {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 250px 1fr;\n\t\tgap: 40px;\n\t\tpadding: 40px 0;\n\t}\n\n\t/* Sidebar */\n\t.sidebar {\n\t\tposition: sticky;\n\t\ttop: 100px; /* Offset for fixed header */\n\t\theight: calc(100vh - 140px);\n\t\toverflow-y: auto;\n\t}\n\n\t.nav-title {\n\t\tfont-size: 12px;\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 0.05em;\n\t\tcolor: var(--gray-600);\n\t\tfont-weight: 700;\n\t\tmargin: 24px 0 12px;\n\t}\n\n\t.sidebar button {\n\t\tdisplay: block;\n\t\twidth: 100%;\n\t\ttext-align: left;\n\t\tbackground: none;\n\t\tborder: none;\n\t\tpadding: 8px 0;\n\t\tcolor: var(--gray-600);\n\t\tcursor: pointer;\n\t\tfont-size: 15px;\n\t\ttransition: color 0.2s;\n\t}\n\n\t.sidebar button:hover {\n\t\tcolor: var(--orange);\n\t}\n\n\t/* Content */\n\t.content {\n\t\tbackground: white;\n\t\tpadding: 48px;\n\t\tborder-radius: 16px;\n\t\tbox-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);\n\t\tborder: 1px solid var(--gray-200);\n\t}\n\n\t.page-header {\n\t\tmargin-bottom: 48px;\n\t\tborder-bottom: 1px solid var(--gray-200);\n\t\tpadding-bottom: 24px;\n\t}\n\n\th1 {\n\t\tfont-size: 42px;\n\t\tfont-weight: 800;\n\t\tcolor: var(--navy);\n\t\tmargin-bottom: 16px;\n\t}\n\n\t.doc-section {\n\t\tmargin-bottom: 60px;\n\t\tscroll-margin-top: 100px; /* For sticky header clearance */\n\t}\n\n\th2 {\n\t\tfont-size: 28px;\n\t\tfont-weight: 700;\n\t\tcolor: var(--navy);\n\t\tmargin-bottom: 24px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t}\n\n\tp,\n\tli {\n\t\tcolor: var(--gray-600);\n\t\tmargin-bottom: 16px;\n\t\tfont-size: 16px;\n\t}\n\n\tul,\n\tol {\n\t\tpadding-left: 24px;\n\t\tmargin-bottom: 24px;\n\t}\n\n\tli {\n\t\tmargin-bottom: 8px;\n\t}\n\n\ta {\n\t\tcolor: var(--orange);\n\t\ttext-decoration: none;\n\t\tfont-weight: 500;\n\t}\n\ta:hover {\n\t\ttext-decoration: underline;\n\t}\n\n\t/* API Styles */\n\t.badge-api {\n\t\tdisplay: inline-block;\n\t\tbackground: var(--navy);\n\t\tcolor: white;\n\t\tfont-size: 11px;\n\t\tfont-weight: 700;\n\t\tpadding: 4px 8px;\n\t\tborder-radius: 4px;\n\t\tmargin-bottom: 8px;\n\t\ttext-transform: uppercase;\n\t}\n\n\t.code-block {\n\t\tbackground: var(--gray-900);\n\t\tcolor: var(--gray-100);\n\t\tborder-radius: 8px;\n\t\tpadding: 20px;\n\t\tfont-family: 'Monaco', 'Consolas', monospace;\n\t\tfont-size: 14px;\n\t\toverflow-x: auto;\n\t\tmargin: 16px 0;\n\t}\n\n\t.endpoint {\n\t\tmargin-bottom: 32px;\n\t\tborder: 1px solid var(--gray-200);\n\t\tborder-radius: 8px;\n\t\tpadding: 20px;\n\t}\n\n\t.endpoint-header {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tmargin-bottom: 12px;\n\t\tfont-family: monospace;\n\t\tfont-size: 16px;\n\t}\n\n\t.method {\n\t\tfont-weight: 700;\n\t\tpadding: 4px 8px;\n\t\tborder-radius: 4px;\n\t\tcolor: white;\n\t}\n\t.method.get {\n\t\tbackground-color: var(--blue);\n\t}\n\t.method.post {\n\t\tbackground-color: var(--orange);\n\t}\n\n\t.info-box {\n\t\tbackground: #eff6ff; /* Light blue */\n\t\tborder-left: 4px solid var(--blue);\n\t\tpadding: 16px;\n\t\tmargin-bottom: 24px;\n\t\tcolor: var(--navy);\n\t}\n\n\t.divider {\n\t\tborder: 0;\n\t\theight: 1px;\n\t\tbackground: var(--gray-200);\n\t\tmargin: 40px 0;\n\t}\n\n\t.faq-item {\n\t\tmargin-bottom: 32px;\n\t}\n\n\t.faq-item h4 {\n\t\tfont-size: 18px;\n\t\tfont-weight: 600;\n\t\tcolor: var(--gray-900);\n\t\tmargin-bottom: 8px;\n\t}\n\n\t/* Responsive */\n\t@media (max-width: 900px) {\n\t\t.docs-layout {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\t\t.sidebar {\n\t\t\tdisplay: none; /* Hide sidebar on mobile for simplicity, or make it a dropdown */\n\t\t}\n\t\t.content {\n\t\t\tpadding: 24px;\n\t\t}\n\t\th1 {\n\t\t\tfont-size: 32px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\forgot-password\\+page.svelte",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 22,
				"column": 13,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 22,
				"endColumn": 14
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'err' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 32,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 32,
				"endColumn": 15
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 47,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 47,
				"endColumn": 19
			}
		],
		"suppressedMessages": [],
		"errorCount": 2,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\tlet email = '';\n\tlet loading = false;\n\tlet message = '';\n\tlet error = '';\n\n\tasync function handleSubmit() {\n\t\tloading = true;\n\t\tmessage = '';\n\t\terror = '';\n\n\t\ttry {\n\t\t\tconst res = await fetch('/forgot-password', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ email })\n\t\t\t});\n\n\t\t\tlet data: any = {};\n\t\t\ttry {\n\t\t\t\tdata = await res.json();\n\t\t\t} catch (e) {\n\t\t\t\t/* ignore parse errors */\n\t\t\t}\n\n\t\t\tif (res.ok) {\n\t\t\t\tmessage = 'If an account exists with that email, we have sent a reset link.';\n\t\t\t\temail = ''; // Clear form\n\t\t\t} else {\n\t\t\t\terror = (data && data.message) || 'An error occurred.';\n\t\t\t}\n\t\t} catch (err) {\n\t\t\terror = 'Network error. Please try again.';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n</script>\n\n<svelte:head>\n\t<title>Forgot Password - Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"auth-page\">\n\t<div class=\"form-container\">\n\t\t<div class=\"form-header\">\n\t\t\t<a href=\"/login\" class=\"back-link\">← Back to Login</a>\n\t\t\t<h1>Reset Password</h1>\n\t\t\t<p>Enter your email to receive a reset link.</p>\n\t\t</div>\n\n\t\t{#if message}\n\t\t\t<div class=\"alert success\">{message}</div>\n\t\t{/if}\n\n\t\t{#if error}\n\t\t\t<div class=\"alert error\">{error}</div>\n\t\t{/if}\n\n\t\t<form on:submit|preventDefault={handleSubmit}>\n\t\t\t<div class=\"field-group\">\n\t\t\t\t<label for=\"email\">Email Address</label>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"email\"\n\t\t\t\t\tid=\"email\"\n\t\t\t\t\tbind:value={email}\n\t\t\t\t\trequired\n\t\t\t\t\tplaceholder=\"Enter your email\"\n\t\t\t\t\tclass=\"input-field\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<button type=\"submit\" class=\"btn-submit\" disabled={loading}>\n\t\t\t\t{loading ? 'Sending...' : 'Send Reset Link'}\n\t\t\t</button>\n\t\t</form>\n\t</div>\n</div>\n\n<style>\n\t/* Reusing similar styles to your login page for consistency */\n\t.auth-page {\n\t\tmin-height: 100vh;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbackground: #f9fafb;\n\t\tfont-family: 'Inter', sans-serif;\n\t}\n\t.form-container {\n\t\tbackground: white;\n\t\tpadding: 40px;\n\t\tborder-radius: 12px;\n\t\tbox-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n\t\twidth: 100%;\n\t\tmax-width: 400px;\n\t}\n\t.form-header {\n\t\tmargin-bottom: 24px;\n\t\ttext-align: center;\n\t}\n\th1 {\n\t\tfont-size: 24px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 10px 0;\n\t}\n\tp {\n\t\tcolor: #6b7280;\n\t\tfont-size: 14px;\n\t}\n\t.back-link {\n\t\tcolor: #ff7f50;\n\t\ttext-decoration: none;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t}\n\t.input-field {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-size: 15px;\n\t\tmargin-top: 6px;\n\t}\n\t.field-group {\n\t\tmargin-bottom: 20px;\n\t}\n\t.btn-submit {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tbackground: #ff7f50;\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t}\n\t.btn-submit:disabled {\n\t\topacity: 0.7;\n\t}\n\t.alert {\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tmargin-bottom: 20px;\n\t\tfont-size: 14px;\n\t}\n\t.alert.success {\n\t\tbackground: #f0fdf4;\n\t\tcolor: #166534;\n\t}\n\t.alert.error {\n\t\tbackground: #fef2f2;\n\t\tcolor: #991b1b;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\forgot-password\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\login\\+page.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\login\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 30,
				"column": 8,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 30,
				"endColumn": 33
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 110,
				"column": 13,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 110,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 210,
				"column": 16,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 210,
				"endColumn": 28
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 231,
				"column": 13,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 231,
				"endColumn": 14
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 256,
				"column": 13,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 256,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 342,
				"column": 16,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 342,
				"endColumn": 28
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 387,
				"column": 17,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 387,
				"endColumn": 29
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 429,
				"column": 13,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 429,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 771,
				"column": 18,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 771,
				"endColumn": 34
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 815,
				"column": 48,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 815,
				"endColumn": 54
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 816,
				"column": 16,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 816,
				"endColumn": 24
			}
		],
		"suppressedMessages": [],
		"errorCount": 3,
		"fatalErrorCount": 0,
		"warningCount": 8,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\timport { onMount } from 'svelte';\n\timport { toasts } from '$lib/stores/toast';\n\t// See Documentation/Simple Web Auth and Documentation/Svelte 5 for guidance on quick-sign and biometric flows\n\t// [!code ++] Import WebAuthn helper\n\timport { startAuthentication } from '@simplewebauthn/browser';\n\n\tlet username = '';\n\tlet email = '';\n\tlet password = '';\n\tlet confirmPassword = '';\n\tlet responseError: string | null = null;\n\tlet loading = false;\n\tlet registrationSuccess = false;\n\tlet submittedEmail = '';\n\n\t// Quick sign-in state: read from localStorage key 'passkey:preferred' (credentialID/email/name)\n\tlet quickPasskey: { credentialID: string; email?: string; name?: string } | null = null;\n\tlet quickLoading = false;\n\n\t// Check if we are in register mode based on URL query param\n\t$: isLogin = $page.url.searchParams.get('view') !== 'register';\n\n\tfunction toggleMode() {\n\t\tconst url = new URL($page.url);\n\t\tif (isLogin) url.searchParams.set('view', 'register');\n\t\telse url.searchParams.delete('view');\n\t\tgoto(url.pathname + url.search, { replaceState: true });\n\n\t\tusername = '';\n\t\temail = '';\n\t\tpassword = '';\n\t\tconfirmPassword = '';\n\t\tresponseError = null;\n\t\tregistrationSuccess = false;\n\t}\n\n\t// [!code ++] Biometric Login Handler\n\texport function base64UrlToBuffer(base64url: any): Uint8Array {\n\t\t// If already an ArrayBuffer or TypedArray, return a Uint8Array view\n\t\tif (!base64url) return new Uint8Array();\n\t\tif (base64url instanceof ArrayBuffer) return new Uint8Array(base64url);\n\t\tif (ArrayBuffer.isView(base64url))\n\t\t\treturn new Uint8Array(\n\t\t\t\t(base64url as any).buffer,\n\t\t\t\t(base64url as any).byteOffset || 0,\n\t\t\t\t(base64url as any).byteLength || (base64url as any).length\n\t\t\t);\n\n\t\t// Otherwise assume base64url string and decode\n\t\tif (typeof base64url !== 'string') base64url = String(base64url);\n\t\tconst pad = '=='.slice(0, (4 - (base64url.length % 4)) % 4);\n\t\tconst b64 = base64url.replace(/-/g, '+').replace(/_/g, '/') + pad;\n\t\tconst binary = atob(b64);\n\t\tconst len = binary.length;\n\t\tconst bytes = new Uint8Array(len);\n\t\tfor (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);\n\t\treturn bytes;\n\t}\n\n\tasync function handleBiometricLogin() {\n\t\tloading = true;\n\t\tresponseError = null;\n\n\t\ttry {\n\t\t\t// Optionally let user pick a named device first (better UX when multiple passkeys exist)\n\t\t\tlet requestedCredential: string | null = null;\n\t\t\tif (username) {\n\t\t\t\ttry {\n\t\t\t\t\tconst listResp = await fetch(\n\t\t\t\t\t\t`/api/auth/webauthn/list-for-email?email=${encodeURIComponent(username)}`\n\t\t\t\t\t);\n\t\t\t\t\tif (listResp.ok) {\n\t\t\t\t\t\tconst json: any = await listResp.json();\n\t\t\t\t\t\tconst auths = json.authenticators || [];\n\t\t\t\t\t\tif (auths.length > 1) {\n\t\t\t\t\t\t\t// Simple selection prompt (can be replaced with nicer UI)\n\t\t\t\t\t\t\tconst choices = auths\n\t\t\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t\t\t(a: any, i: number) =>\n\t\t\t\t\t\t\t\t\t\t`${i + 1}. ${a.name || 'Unnamed'} (${a.transports?.join(', ') || 'device'})`\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.join('\\n');\n\t\t\t\t\t\t\tconst sel = prompt(`Choose a passkey:\\n${choices}\\nEnter the number to use:`);\n\t\t\t\t\t\t\tconst idx = parseInt(String(sel || ''), 10);\n\t\t\t\t\t\t\tif (!isNaN(idx) && idx >= 1 && idx <= auths.length) {\n\t\t\t\t\t\t\t\trequestedCredential = auths[idx - 1].credentialID;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (auths.length === 1) {\n\t\t\t\t\t\t\t// If only one passkey exists for this email, pre-select it\n\t\t\t\t\t\t\trequestedCredential = auths[0].credentialID;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Could not fetch passkey list for email', e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 1. Request challenge from your server\n\t\t\tconst optionsResp = await fetch(\n\t\t\t\t`/api/auth/webauthn${requestedCredential ? `?credential=${encodeURIComponent(requestedCredential)}` : ''}`,\n\t\t\t\t{ credentials: 'same-origin' }\n\t\t\t);\n\t\t\tconst rawText = await optionsResp.text();\n\t\t\tlet optionsJson: any;\n\t\t\ttry {\n\t\t\t\toptionsJson = JSON.parse(rawText);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('[Passkey] Failed to parse auth options JSON:', rawText);\n\t\t\t\tthrow new Error('Invalid authentication options response');\n\t\t\t}\n\n\t\t\tif (!optionsResp.ok) {\n\t\t\t\tconsole.error('[Passkey] Auth options request failed:', optionsResp.status, optionsJson);\n\t\t\t\tthrow new Error(optionsJson?.error || 'Biometric login not available');\n\t\t\t}\n\n\t\t\tconst options: any = optionsJson;\n\n\t\t\tconsole.log('[Passkey] Auth options from server (raw):', rawText);\n\t\t\tif (!options || typeof options !== 'object') {\n\t\t\t\tconsole.error('[Passkey] Invalid auth options payload:', optionsJson);\n\t\t\t\tthrow new Error('Invalid authentication options from server');\n\t\t\t}\n\n\t\t\tif (!options.challenge) {\n\t\t\t\tconsole.error('[Passkey] Missing challenge in auth options:', options);\n\t\t\t\tthrow new Error('Authentication options missing challenge');\n\t\t\t}\n\n\t\t\t// Ensure challenge is a base64url string (don't convert to ArrayBuffer; the helper will manage it)\n\t\t\tif (typeof options.challenge !== 'string') {\n\t\t\t\tconsole.warn('[Passkey] Unexpected challenge type; converting to base64url string');\n\t\t\t\tconst bytes =\n\t\t\t\t\toptions.challenge instanceof Uint8Array\n\t\t\t\t\t\t? options.challenge\n\t\t\t\t\t\t: new Uint8Array(options.challenge);\n\t\t\t\tlet binary = '';\n\t\t\t\tfor (let i = 0; i < bytes.byteLength; i++)\n\t\t\t\t\tbinary += String.fromCharCode(Number(bytes[i] ?? 0));\n\t\t\t\toptions.challenge = btoa(binary).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n\t\t\t}\n\n\t\t\tif (Array.isArray(options.allowCredentials)) {\n\t\t\t\toptions.allowCredentials = options.allowCredentials.map((c: any) => ({\n\t\t\t\t\t...c,\n\t\t\t\t\tid: String(c.id)\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\t// 2. Prompt user for FaceID/TouchID (Browser Native Modal)\n\t\t\tconst authResp = await startAuthentication({ optionsJSON: options as any });\n\n\t\t\t// 3. Verify signature with server (ensure credential.serializable fields are sent)\n\t\t\tfunction bufferToBase64Url(buffer: ArrayBuffer | Uint8Array) {\n\t\t\t\tconst bytes = buffer instanceof Uint8Array ? buffer : new Uint8Array(buffer);\n\t\t\t\tlet binary = '';\n\t\t\t\tfor (let i = 0; i < bytes.byteLength; i++)\n\t\t\t\t\tbinary += String.fromCharCode(Number(bytes[i] ?? 0));\n\t\t\t\treturn btoa(binary).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n\t\t\t}\n\n\t\t\tconst normalised: any = { ...authResp } as any;\n\t\t\tif (\n\t\t\t\tnormalised.rawId &&\n\t\t\t\t(normalised.rawId instanceof ArrayBuffer || ArrayBuffer.isView(normalised.rawId))\n\t\t\t) {\n\t\t\t\tnormalised.rawId = bufferToBase64Url(normalised.rawId as ArrayBuffer);\n\t\t\t}\n\t\t\tconst resp = normalised.response || {};\n\t\t\tif (\n\t\t\t\tresp.authenticatorData &&\n\t\t\t\t(resp.authenticatorData instanceof ArrayBuffer ||\n\t\t\t\t\tArrayBuffer.isView(resp.authenticatorData))\n\t\t\t)\n\t\t\t\tresp.authenticatorData = bufferToBase64Url(resp.authenticatorData);\n\t\t\tif (\n\t\t\t\tresp.clientDataJSON &&\n\t\t\t\t(resp.clientDataJSON instanceof ArrayBuffer || ArrayBuffer.isView(resp.clientDataJSON))\n\t\t\t)\n\t\t\t\tresp.clientDataJSON = bufferToBase64Url(resp.clientDataJSON);\n\t\t\tif (\n\t\t\t\tresp.signature &&\n\t\t\t\t(resp.signature instanceof ArrayBuffer || ArrayBuffer.isView(resp.signature))\n\t\t\t)\n\t\t\t\tresp.signature = bufferToBase64Url(resp.signature);\n\t\t\tif (\n\t\t\t\tresp.userHandle &&\n\t\t\t\t(resp.userHandle instanceof ArrayBuffer || ArrayBuffer.isView(resp.userHandle))\n\t\t\t)\n\t\t\t\tresp.userHandle = bufferToBase64Url(resp.userHandle);\n\n\t\t\tconst verificationResp = await fetch('/api/auth/webauthn', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'same-origin',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify(normalised)\n\t\t\t});\n\n\t\t\tif (!verificationResp.ok) {\n\t\t\t\tconst err: any = await verificationResp.json();\n\t\t\t\tthrow new Error(err.error || 'Verification failed');\n\t\t\t}\n\n\t\t\tconst verificationJSON: any = await verificationResp.json();\n\n\t\t\tif (verificationJSON.verified) {\n\t\t\t\tawait goto('/dashboard', { invalidateAll: true });\n\t\t\t} else {\n\t\t\t\tresponseError = 'Biometric verification failed.';\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\tconsole.error('Biometric error:', e);\n\t\t\t// Don't show error if user just cancelled the dialog\n\t\t\tif (e.name !== 'NotAllowedError') {\n\t\t\t\tresponseError = e.message || 'Biometric login failed.';\n\t\t\t}\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\t// Load any preferred passkey saved on this device\n\tonMount(() => {\n\t\tconst raw = localStorage.getItem('passkey:preferred');\n\t\tif (raw) {\n\t\t\ttry {\n\t\t\t\tquickPasskey = JSON.parse(raw);\n\t\t\t} catch (e) {\n\t\t\t\tquickPasskey = null;\n\t\t\t}\n\t\t}\n\t});\n\n\tasync function quickSignIn() {\n\t\tif (!quickPasskey) return;\n\t\tquickLoading = true;\n\t\tresponseError = null;\n\t\ttry {\n\t\t\tconst requestedCredential = quickPasskey.credentialID;\n\t\t\tconst optionsResp = await fetch(\n\t\t\t\t`/api/auth/webauthn?credential=${encodeURIComponent(requestedCredential)}`,\n\t\t\t\t{ credentials: 'same-origin' }\n\t\t\t);\n\t\t\tif (optionsResp.status === 401) {\n\t\t\t\ttoasts.error('Session expired. Please sign in with password.');\n\t\t\t\tquickLoading = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst rawText = await optionsResp.text();\n\t\t\tlet optionsJson: any;\n\t\t\ttry {\n\t\t\t\toptionsJson = JSON.parse(rawText);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('[Passkey] Failed to parse auth options JSON:', rawText);\n\t\t\t\tthrow new Error('Invalid authentication options response');\n\t\t\t}\n\n\t\t\tif (!optionsResp.ok) {\n\t\t\t\tthrow new Error(optionsJson?.error || 'Biometric login not available');\n\t\t\t}\n\n\t\t\tconst options: any = optionsJson;\n\t\t\tif (!options.challenge) throw new Error('Authentication options missing challenge');\n\t\t\tif (typeof options.challenge !== 'string') {\n\t\t\t\tconst bytes =\n\t\t\t\t\toptions.challenge instanceof Uint8Array\n\t\t\t\t\t\t? options.challenge\n\t\t\t\t\t\t: new Uint8Array(options.challenge);\n\t\t\t\tlet binary = '';\n\t\t\t\tfor (let i = 0; i < bytes.byteLength; i++)\n\t\t\t\t\tbinary += String.fromCharCode(Number(bytes[i] ?? 0));\n\t\t\t\toptions.challenge = btoa(binary).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n\t\t\t}\n\n\t\t\tif (Array.isArray(options.allowCredentials)) {\n\t\t\t\toptions.allowCredentials = options.allowCredentials.map((c: any) => ({\n\t\t\t\t\t...c,\n\t\t\t\t\tid: String(c.id)\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tconst authResp = await startAuthentication({ optionsJSON: options as any });\n\n\t\t\tfunction bufferToBase64Url(buffer: ArrayBuffer | Uint8Array) {\n\t\t\t\tconst bytes = buffer instanceof Uint8Array ? buffer : new Uint8Array(buffer);\n\t\t\t\tlet binary = '';\n\t\t\t\tfor (let i = 0; i < bytes.byteLength; i++)\n\t\t\t\t\tbinary += String.fromCharCode(Number(bytes[i] ?? 0));\n\t\t\t\treturn btoa(binary).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n\t\t\t}\n\n\t\t\tconst normalised: any = { ...authResp } as any;\n\t\t\tif (\n\t\t\t\tnormalised.rawId &&\n\t\t\t\t(normalised.rawId instanceof ArrayBuffer || ArrayBuffer.isView(normalised.rawId))\n\t\t\t) {\n\t\t\t\tnormalised.rawId = bufferToBase64Url(normalised.rawId as ArrayBuffer);\n\t\t\t}\n\t\t\tconst resp = normalised.response || {};\n\t\t\tif (\n\t\t\t\tresp.authenticatorData &&\n\t\t\t\t(resp.authenticatorData instanceof ArrayBuffer ||\n\t\t\t\t\tArrayBuffer.isView(resp.authenticatorData))\n\t\t\t)\n\t\t\t\tresp.authenticatorData = bufferToBase64Url(resp.authenticatorData);\n\t\t\tif (\n\t\t\t\tresp.clientDataJSON &&\n\t\t\t\t(resp.clientDataJSON instanceof ArrayBuffer || ArrayBuffer.isView(resp.clientDataJSON))\n\t\t\t)\n\t\t\t\tresp.clientDataJSON = bufferToBase64Url(resp.clientDataJSON);\n\t\t\tif (\n\t\t\t\tresp.signature &&\n\t\t\t\t(resp.signature instanceof ArrayBuffer || ArrayBuffer.isView(resp.signature))\n\t\t\t)\n\t\t\t\tresp.signature = bufferToBase64Url(resp.signature);\n\t\t\tif (\n\t\t\t\tresp.userHandle &&\n\t\t\t\t(resp.userHandle instanceof ArrayBuffer || ArrayBuffer.isView(resp.userHandle))\n\t\t\t)\n\t\t\t\tresp.userHandle = bufferToBase64Url(resp.userHandle);\n\n\t\t\tconst verificationResp = await fetch('/api/auth/webauthn', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'same-origin',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify(normalised)\n\t\t\t});\n\n\t\t\tif (!verificationResp.ok) {\n\t\t\t\tconst err: any = await verificationResp\n\t\t\t\t\t.json()\n\t\t\t\t\t.catch(() => ({ error: 'Verification failed' }));\n\t\t\t\tthrow new Error(err.error || 'Verification failed');\n\t\t\t}\n\n\t\t\tconst verificationJSON: any = await verificationResp.json();\n\n\t\t\tif (verificationJSON.verified) {\n\t\t\t\tawait goto('/dashboard', { invalidateAll: true });\n\t\t\t} else {\n\t\t\t\tresponseError = 'Biometric verification failed.';\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\tconsole.error('Quick Biometric error:', e);\n\t\t\tif (e.name !== 'NotAllowedError') {\n\t\t\t\ttoasts.error(e.message || 'Biometric login failed.');\n\t\t\t\tresponseError = e.message || 'Biometric login failed.';\n\t\t\t}\n\t\t} finally {\n\t\t\tquickLoading = false;\n\t\t}\n\t}\n\n\tasync function submitHandler() {\n\t\tresponseError = null;\n\t\tloading = true;\n\n\t\tconst endpoint = isLogin ? '/login' : '/register';\n\n\t\tlet payload = {};\n\t\tif (isLogin) {\n\t\t\tpayload = { email: username, password };\n\t\t} else {\n\t\t\tif (password !== confirmPassword) {\n\t\t\t\tresponseError = \"Passwords don't match\";\n\t\t\t\tloading = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpayload = { username, email, password };\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(endpoint, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'same-origin',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify(payload)\n\t\t\t});\n\n\t\t\tconst result: any = await response.json();\n\n\t\t\tif (response.ok) {\n\t\t\t\tif (isLogin) {\n\t\t\t\t\tawait goto('/dashboard', { invalidateAll: true });\n\t\t\t\t} else {\n\t\t\t\t\tsubmittedEmail = email;\n\t\t\t\t\tregistrationSuccess = true;\n\t\t\t\t\tusername = '';\n\t\t\t\t\temail = '';\n\t\t\t\t\tpassword = '';\n\t\t\t\t\tconfirmPassword = '';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresponseError = result.message || result.error || 'An error occurred.';\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Fetch error:', e);\n\t\t\tresponseError = 'Network error. Please try again.';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n</script>\n\n<svelte:head>\n\t<title>{isLogin ? 'Sign In' : 'Create Account'} - Go Route Yourself</title>\n\t<meta\n\t\tname=\"description\"\n\t\tcontent={isLogin\n\t\t\t? 'Sign in to Go Route Yourself to access your route plans, profit tracking, and mileage logs.'\n\t\t\t: 'Create your free Go Route Yourself account. Start tracking routes, profits, and mileage in minutes.'}\n\t/>\n\t<meta name=\"robots\" content=\"noindex, follow\" />\n\t<link rel=\"canonical\" href=\"https://gorouteyourself.com/login\" />\n\t<link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n\t<link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin=\"anonymous\" />\n\t<link\n\t\thref=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap\"\n\t\trel=\"stylesheet\"\n\t/>\n</svelte:head>\n\n<div class=\"auth-page\">\n\t<div class=\"auth-brand\">\n\t\t<div class=\"brand-content\">\n\t\t\t<a href=\"/\" class=\"brand-logo\">\n\t\t\t\t<picture>\n\t\t\t\t\t<source type=\"image/avif\" srcset=\"/180x75.avif 48w\" sizes=\"48px\" />\n\t\t\t\t\t<img\n\t\t\t\t\t\tsrc=\"/180x75.avif\"\n\t\t\t\t\t\talt=\"Go Route Yourself\"\n\t\t\t\t\t\twidth=\"180\"\n\t\t\t\t\t\theight=\"75\"\n\t\t\t\t\t\tdecoding=\"async\"\n\t\t\t\t\t\tstyle=\"width:180px; height:75px; object-fit:contain;\"\n\t\t\t\t\t/>\n\t\t\t\t</picture>\n\t\t\t</a>\n\n\t\t\t<div class=\"brand-text\">\n\t\t\t\t<h1>Welcome to Go Route Yourself</h1>\n\t\t\t\t<p>\n\t\t\t\t\tProfessional route planning and profit tracking for delivery drivers and field workers.\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t<div class=\"brand-features\">\n\t\t\t\t<div class=\"feature-item\">\n\t\t\t\t\t<div class=\"feature-icon\">\n\t\t\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M9 11L12 14L22 4\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M21 12V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"feature-text\">\n\t\t\t\t\t\t<h3>Smart Route Planning</h3>\n\t\t\t\t\t\t<p>AI-powered optimization</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"feature-item\">\n\t\t\t\t\t<div class=\"feature-icon\">\n\t\t\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M12 2L2 7L12 12L22 7L12 2Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M2 17L12 22L22 17\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M2 12L12 17L22 12\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"feature-text\">\n\t\t\t\t\t\t<h3>Real-Time Analytics</h3>\n\t\t\t\t\t\t<p>Track every dollar</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"feature-item\">\n\t\t\t\t\t<div class=\"feature-icon\">\n\t\t\t\t\t\t<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M21 16V8C20.9996 7.64927 20.9071 7.30481 20.7315 7.00116C20.556 6.69751 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69751 3.26846 7.00116C3.09294 7.30481 3.00036 7.64927 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.9979 12 21.9979C12.3511 21.9979 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"feature-text\">\n\t\t\t\t\t\t<h3>Cloud Sync</h3>\n\t\t\t\t\t\t<p>Access anywhere</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"brand-stats\">\n\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t<div class=\"stat-value\">10K+</div>\n\t\t\t\t\t<div class=\"stat-label\">Routes</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t<div class=\"stat-value\">$2.5M+</div>\n\t\t\t\t\t<div class=\"stat-label\">Tracked</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"stat\">\n\t\t\t\t\t<div class=\"stat-value\">4.9/5</div>\n\t\t\t\t\t<div class=\"stat-label\">Rating</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"auth-form\">\n\t\t<div class=\"form-container\">\n\t\t\t{#if registrationSuccess}\n\t\t\t\t<div style=\"text-align: center;\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"alert success\"\n\t\t\t\t\t\tstyle=\"display: block; text-align: center; background: #F0FDF4; border-color: #BBF7D0;\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\twidth=\"48\"\n\t\t\t\t\t\t\theight=\"48\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tstroke=\"#166534\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\tstyle=\"margin: 0 auto 16px auto; display: block;\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\td=\"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z\"\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<h3 style=\"font-size: 20px; font-weight: 700; margin-bottom: 8px; color: #166534;\">\n\t\t\t\t\t\t\tCheck your inbox!\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<p style=\"font-size: 15px; color: #166534;\">\n\t\t\t\t\t\t\tWe've sent a verification link to <strong>{submittedEmail}</strong>.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"toggle-link\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tregistrationSuccess = false;\n\t\t\t\t\t\t\ttoggleMode();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\tBack to Sign In\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"form-header\">\n\t\t\t\t\t<h2>{isLogin ? 'Sign in to your account' : 'Create your account'}</h2>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{isLogin ? \"Don't have an account?\" : 'Already have an account?'}\n\t\t\t\t\t\t<button class=\"toggle-link\" on:click={toggleMode}>\n\t\t\t\t\t\t\t{isLogin ? 'Sign up' : 'Sign in'}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<form on:submit|preventDefault={submitHandler}>\n\t\t\t\t\t{#if isLogin}\n\t\t\t\t\t\t{#if quickPasskey && (!username || username === quickPasskey.email)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"btn-secondary\"\n\t\t\t\t\t\t\t\ton:click={quickSignIn}\n\t\t\t\t\t\t\t\tdisabled={quickLoading}\n\t\t\t\t\t\t\t\tstyle=\"margin-bottom:8px; display:flex; align-items:center; justify-content:center;\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\t\t\theight=\"16\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstyle=\"margin-right:8px;\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t{quickLoading\n\t\t\t\t\t\t\t\t\t? 'Signing in...'\n\t\t\t\t\t\t\t\t\t: `Quick sign-in${quickPasskey?.name ? ' (' + quickPasskey.name + ')' : ''}`}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclass=\"btn-biometric\"\n\t\t\t\t\t\t\ton:click={handleBiometricLogin}\n\t\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\twidth=\"24\"\n\t\t\t\t\t\t\t\theight=\"24\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M2 12C2 6.48 6.48 2 12 2s10 4.48 10 10-4.48 10-10 10S2 17.52 2 12zm10 6c3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6 2.69 6 6 6z\"\n\t\t\t\t\t\t\t\t\tstroke-opacity=\"0.3\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\tSign in with Face ID / Touch ID\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<div class=\"divider\">\n\t\t\t\t\t\t\t<span>OR</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<div class=\"form-fields\">\n\t\t\t\t\t\t<div class=\"field-group\">\n\t\t\t\t\t\t\t<label for=\"username\">\n\t\t\t\t\t\t\t\t{isLogin ? 'Username or Email' : 'Username'}\n\t\t\t\t\t\t\t\t<span class=\"required\">*</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<div class=\"input-wrapper\">\n\t\t\t\t\t\t\t\t<svg class=\"input-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"M10 10C12.7614 10 15 7.76142 15 5C15 2.23858 12.7614 0 10 0C7.23858 0 5 2.23858 5 5C5 7.76142 7.23858 10 10 10Z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"M10 12C4.47715 12 0 15.3579 0 19.5C0 19.7761 0.223858 20 0.5 20H19.5C19.7761 20 20 19.7761 20 19.5C20 15.3579 15.5228 12 10 12Z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tid=\"username\"\n\t\t\t\t\t\t\t\t\tbind:value={username}\n\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\tplaceholder={isLogin ? 'Enter username or email' : 'Choose a username'}\n\t\t\t\t\t\t\t\t\tautocomplete=\"username\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if !isLogin}\n\t\t\t\t\t\t\t<div class=\"field-group\">\n\t\t\t\t\t\t\t\t<label for=\"email\">\n\t\t\t\t\t\t\t\t\tEmail Address\n\t\t\t\t\t\t\t\t\t<span class=\"required\">*</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<div class=\"input-wrapper\">\n\t\t\t\t\t\t\t\t\t<svg class=\"input-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M2 4C2 3.44772 2.44772 3 3 3H17C17.5523 3 18 3.44772 18 4V16C18 16.5523 17.5523 17 17 17H3C2.44772 17 2 16.5523 2 16V4Z\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M18 4L10 10.5L2 4\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\t\t\tid=\"email\"\n\t\t\t\t\t\t\t\t\t\tbind:value={email}\n\t\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Enter your email address\"\n\t\t\t\t\t\t\t\t\t\tautocomplete=\"email\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<div class=\"field-group\">\n\t\t\t\t\t\t\t<label for=\"password\">\n\t\t\t\t\t\t\t\tPassword\n\t\t\t\t\t\t\t\t<span class=\"required\">*</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<div class=\"input-wrapper\">\n\t\t\t\t\t\t\t\t<svg class=\"input-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"M15 7H14V5C14 3.67392 13.4732 2.40215 12.5355 1.46447C11.5979 0.526784 10.3261 0 9 0C7.67392 0 6.40215 0.526784 5.46447 1.46447C4.52678 2.40215 4 3.67392 4 5V7H3C2.46957 7 1.96086 7.21071 1.58579 7.58579C1.21071 7.96086 1 8.46957 1 9V17C1 17.5304 1.21071 18.0391 1.58579 18.4142C1.96086 18.7893 2.46957 19 3 19H15C15.5304 19 16.0391 18.7893 16.4142 18.4142C16.7893 18.0391 17 17.5304 17 17V9C17 8.46957 16.7893 7.96086 16.4142 7.58579C16.0391 7.21071 15.5304 7 15 7ZM6 5C6 4.20435 6.31607 3.44129 6.87868 2.87868C7.44129 2.31607 8.20435 2 9 2C9.79565 2 10.5587 2.31607 11.1213 2.87868C11.6839 3.44129 12 4.20435 12 5V7H6V5Z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\t\t\t\tid=\"password\"\n\t\t\t\t\t\t\t\t\tbind:value={password}\n\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\tplaceholder=\"Enter your password\"\n\t\t\t\t\t\t\t\t\tautocomplete={isLogin ? 'current-password' : 'new-password'}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if !isLogin}\n\t\t\t\t\t\t\t<div class=\"field-group\">\n\t\t\t\t\t\t\t\t<label for=\"confirmPassword\">\n\t\t\t\t\t\t\t\t\tConfirm Password\n\t\t\t\t\t\t\t\t\t<span class=\"required\">*</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<div class=\"input-wrapper\">\n\t\t\t\t\t\t\t\t\t<svg class=\"input-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M15 7H14V5C14 3.67392 13.4732 2.40215 12.5355 1.46447C11.5979 0.526784 10.3261 0 9 0C7.67392 0 6.40215 0.526784 5.46447 1.46447C4.52678 2.40215 4 3.67392 4 5V7H3C2.46957 7 1.96086 7.21071 1.58579 7.58579C1.21071 7.96086 1 8.46957 1 9V17C1 17.5304 1.21071 18.0391 1.58579 18.4142C1.96086 18.7893 2.46957 19 3 19H15C15.5304 19 16.0391 18.7893 16.4142 18.4142C16.7893 18.0391 17 17.5304 17 17V9C17 8.46957 16.7893 7.96086 16.4142 7.58579C16.0391 7.21071 15.5304 7 15 7ZM6 5C6 4.20435 6.31607 3.44129 6.87868 2.87868C7.44129 2.31607 8.20435 2 9 2C9.79565 2 10.5587 2.31607 11.1213 2.87868C11.6839 3.44129 12 4.20435 12 5V7H6V5Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\t\t\t\t\tid=\"confirmPassword\"\n\t\t\t\t\t\t\t\t\t\tbind:value={confirmPassword}\n\t\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Confirm your password\"\n\t\t\t\t\t\t\t\t\t\tautocomplete=\"new-password\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if isLogin}\n\t\t\t\t\t\t\t<div class=\"form-options\">\n\t\t\t\t\t\t\t\t<label class=\"checkbox-label\">\n\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"remember\" />\n\t\t\t\t\t\t\t\t\t<span>Remember me</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<a href=\"/forgot-password\" class=\"forgot-link\">Forgot password?</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if responseError}\n\t\t\t\t\t\t<div class=\"alert error\">\n\t\t\t\t\t\t\t<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM11 15H9V13H11V15ZM11 11H9V5H11V11Z\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t{responseError}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<button type=\"submit\" class=\"btn-submit\" disabled={loading}>\n\t\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t\t<svg class=\"spinner\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n\t\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\t\tcx=\"10\"\n\t\t\t\t\t\t\t\t\tcy=\"10\"\n\t\t\t\t\t\t\t\t\tr=\"8\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\topacity=\"0.25\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M10 2C10 2 10 2 10 2C14.4183 2 18 5.58172 18 10\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\tProcessing...\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{isLogin ? 'Sign In' : 'Create Account'}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</button>\n\t\t\t\t</form>\n\n\t\t\t\t<div class=\"form-footer\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\tBy continuing, you agree to our <a href=\"/terms\">Terms of Service</a> and\n\t\t\t\t\t\t<a href=\"/privacy\">Privacy Policy</a>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t/* font import moved to `src/app.css` */\n\t:root {\n\t\t--orange: #ff7f50;\n\t\t--blue: #29abe2;\n\t\t--navy: #2c4a6e;\n\t\t--green: #8dc63f;\n\t\t--purple: #8b5a9e;\n\t\t--gray-50: #f9fafb;\n\t\t--gray-100: #f3f4f6;\n\t\t--gray-600: #4b5563;\n\t\t--gray-900: #111827;\n\t}\n\n\t* {\n\t\tmargin: 0;\n\t\tpadding: 0;\n\t\tbox-sizing: border-box;\n\t}\n\n\t.auth-page {\n\t\tfont-family:\n\t\t\t'Inter',\n\t\t\t-apple-system,\n\t\t\tBlinkMacSystemFont,\n\t\t\t'Segoe UI',\n\t\t\tsans-serif;\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 45% 55%;\n\t\t/* UPDATED: Dynamic viewport height */\n\t\tmin-height: 100dvh;\n\t}\n\n\t/* Left Side - Branding */\n\t.auth-brand {\n\t\tbackground: var(--gray-50);\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t\tpadding: 48px;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tborder-right: 1px solid var(--gray-100);\n\t}\n\n\t.auth-brand::after {\n\t\tdisplay: none;\n\t}\n\n\t.brand-content {\n\t\tposition: relative;\n\t\tz-index: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\theight: 100%;\n\t}\n\n\t.brand-logo {\n\t\tdisplay: block;\n\t\tmargin-bottom: 64px;\n\t}\n\n\t.brand-logo img {\n\t\twidth: 180px;\n\t\theight: 75px;\n\t\tobject-fit: contain;\n\t}\n\n\t.brand-text {\n\t\tmargin-bottom: 64px;\n\t}\n\n\t.brand-text h1 {\n\t\tfont-size: 36px;\n\t\tfont-weight: 800;\n\t\tcolor: var(--navy);\n\t\tmargin-bottom: 16px;\n\t\tline-height: 1.2;\n\t}\n\n\t.brand-text p {\n\t\tfont-size: 18px;\n\t\tcolor: var(--gray-600);\n\t\tline-height: 1.6;\n\t}\n\n\t.brand-features {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24px;\n\t\tmargin-bottom: auto;\n\t}\n\n\t.feature-item {\n\t\tdisplay: flex;\n\t\tgap: 16px;\n\t\talign-items: start;\n\t}\n\n\t.feature-icon {\n\t\twidth: 48px;\n\t\theight: 48px;\n\t\tbackground: white;\n\t\tborder: 1px solid var(--gray-100);\n\t\tborder-radius: 12px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcolor: var(--orange);\n\t\tflex-shrink: 0;\n\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n\t}\n\n\t.feature-text h3 {\n\t\tfont-size: 16px;\n\t\tfont-weight: 600;\n\t\tcolor: var(--navy);\n\t\tmargin-bottom: 4px;\n\t}\n\n\t.feature-text p {\n\t\tfont-size: 14px;\n\t\tcolor: var(--gray-600);\n\t}\n\n\t.brand-stats {\n\t\tdisplay: flex;\n\t\tgap: 48px;\n\t\tpadding-top: 48px;\n\t\tborder-top: 1px solid var(--gray-200);\n\t}\n\n\t.stat {\n\t\ttext-align: center;\n\t}\n\n\t.stat-value {\n\t\tfont-size: 24px;\n\t\tfont-weight: 800;\n\t\tcolor: var(--navy);\n\t\tmargin-bottom: 4px;\n\t}\n\n\t.stat-label {\n\t\tfont-size: 13px;\n\t\tcolor: var(--gray-600);\n\t}\n\n\t/* Right Side - Form */\n\t.auth-form {\n\t\tbackground: white;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 48px;\n\t}\n\n\t.form-container {\n\t\twidth: 100%;\n\t\tmax-width: 440px;\n\t}\n\n\t.form-header {\n\t\tmargin-bottom: 32px;\n\t}\n\n\t.form-header h2 {\n\t\tfont-size: 28px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.form-header p {\n\t\tfont-size: 15px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.toggle-link {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcolor: var(--orange);\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\ttext-decoration: underline;\n\t}\n\n\t.form-fields {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 20px;\n\t\tmargin-bottom: 24px;\n\t}\n\n\t.field-group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\n\tlabel {\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t}\n\n\t.required {\n\t\tcolor: var(--orange);\n\t}\n\n\t.input-wrapper {\n\t\tposition: relative;\n\t}\n\n\t.input-icon {\n\t\tposition: absolute;\n\t\tleft: 16px;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\tcolor: #9ca3af;\n\t\tpointer-events: none;\n\t}\n\n\tinput[type='text'],\n\tinput[type='email'],\n\tinput[type='password'] {\n\t\twidth: 100%;\n\t\tpadding: 14px 16px 14px 48px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\t/* UPDATED: Increased font size to prevent iOS zoom */\n\t\tfont-size: 16px;\n\t\tfont-family: inherit;\n\t\tbackground: white;\n\t\ttransition: all 0.2s;\n\t}\n\n\tinput:focus {\n\t\toutline: none;\n\t\tborder-color: var(--orange);\n\t\tbox-shadow: 0 0 0 3px rgba(255, 127, 80, 0.1);\n\t}\n\n\t.form-options {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t}\n\n\t.checkbox-label {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tfont-size: 14px;\n\t\tcolor: #374151;\n\t\tcursor: pointer;\n\t}\n\n\t.checkbox-label input[type='checkbox'] {\n\t\twidth: 18px;\n\t\theight: 18px;\n\t\tcursor: pointer;\n\t}\n\n\t.forgot-link {\n\t\tfont-size: 14px;\n\t\tcolor: var(--orange);\n\t\ttext-decoration: none;\n\t\tfont-weight: 600;\n\t}\n\n\t/* UPDATED: Wrap hover in media query */\n\t@media (hover: hover) {\n\t\t.forgot-link:hover {\n\t\t\ttext-decoration: underline;\n\t\t}\n\t}\n\n\t.alert {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tpadding: 14px 16px;\n\t\tborder-radius: 12px;\n\t\tfont-size: 14px;\n\t\tmargin-bottom: 20px;\n\t}\n\n\t.alert.error {\n\t\tbackground: #fef2f2;\n\t\tcolor: #991b1b;\n\t}\n\n\t.alert.success {\n\t\tbackground: #f0fdf4;\n\t\tcolor: #166534;\n\t}\n\n\t.btn-submit {\n\t\twidth: 100%;\n\t\tpadding: 16px;\n\t\tbackground: var(--orange);\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 12px;\n\t\tfont-size: 16px;\n\t\tfont-weight: 600;\n\t\tfont-family: inherit;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 8px;\n\t}\n\n\t/* UPDATED: Wrap hover in media query */\n\t@media (hover: hover) {\n\t\t.btn-submit:hover:not(:disabled) {\n\t\t\tbackground: #ff6a3d;\n\t\t\ttransform: translateY(-1px);\n\t\t\tbox-shadow: 0 8px 16px rgba(255, 127, 80, 0.3);\n\t\t}\n\t}\n\n\t.btn-submit:disabled {\n\t\topacity: 0.6;\n\t\tcursor: not-allowed;\n\t}\n\n\t.spinner {\n\t\tanimation: spin 1s linear infinite;\n\t}\n\n\t@keyframes spin {\n\t\tfrom {\n\t\t\ttransform: rotate(0deg);\n\t\t}\n\t\tto {\n\t\t\ttransform: rotate(360deg);\n\t\t}\n\t}\n\n\t.form-footer {\n\t\tmargin-top: 24px;\n\t\ttext-align: center;\n\t}\n\n\t.form-footer p {\n\t\tfont-size: 13px;\n\t\tcolor: #6b7280;\n\t}\n\n\t.form-footer a {\n\t\tcolor: var(--orange);\n\t\ttext-decoration: none;\n\t\tfont-weight: 500;\n\t}\n\n\t/* UPDATED: Wrap hover in media query */\n\t@media (hover: hover) {\n\t\t.form-footer a:hover {\n\t\t\ttext-decoration: underline;\n\t\t}\n\t}\n\n\t/* [!code ++] New Styles for Biometrics */\n\t.btn-biometric {\n\t\twidth: 100%;\n\t\tpadding: 14px;\n\t\tbackground: white;\n\t\tcolor: var(--gray-900);\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 12px;\n\t\tfont-size: 16px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 12px;\n\t\tmargin-bottom: 24px;\n\t\ttransition: all 0.2s;\n\t\tfont-family: inherit;\n\t}\n\n\t@media (hover: hover) {\n\t\t.btn-biometric:hover:not(:disabled) {\n\t\t\tbackground: var(--gray-50);\n\t\t\tborder-color: #d1d5db;\n\t\t}\n\t}\n\n\t.divider {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\ttext-align: center;\n\t\tmargin-bottom: 24px;\n\t\tcolor: #6b7280;\n\t\tfont-size: 13px;\n\t\tfont-weight: 500;\n\t}\n\n\t.divider::before,\n\t.divider::after {\n\t\tcontent: '';\n\t\tflex: 1;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t}\n\n\t.divider span {\n\t\tpadding: 0 12px;\n\t\tcolor: #9ca3af;\n\t\tfont-weight: 600;\n\t\tfont-size: 12px;\n\t}\n\n\t/* Responsive */\n\t@media (max-width: 1024px) {\n\t\t.auth-page {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\n\t\t.auth-brand {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.auth-form {\n\t\t\tpadding: 24px;\n\t\t}\n\n\t\t.form-header h2 {\n\t\t\tfont-size: 24px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\login\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 107,
				"column": 39,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 107,
				"endColumn": 42,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3859, 3862], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3859, 3862], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 109,
				"column": 41,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 109,
				"endColumn": 44,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3922, 3925], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3922, 3925], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 110,
				"column": 23,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 110,
				"endColumn": 26,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3949, 3952], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3949, 3952], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 111,
				"column": 25,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 111,
				"endColumn": 28,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3978, 3981], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3978, 3981], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 115,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 115,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4094, 4097], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4094, 4097], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 5,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/routes/login/+server.ts\nimport { json } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { authenticateUser } from '$lib/server/auth';\nimport { getEnv, safeKV, safeDO } from '$lib/server/env';\nimport { createSession } from '$lib/server/sessionService';\nimport { findUserById } from '$lib/server/userService';\nimport { makeTripService } from '$lib/server/tripService';\nimport { checkRateLimit } from '$lib/server/rateLimit';\nimport { dev } from '$app/environment';\nimport { log } from '$lib/server/log';\n\nexport const POST: RequestHandler = async ({ request, platform, cookies, getClientAddress }) => {\n\ttry {\n\t\tconst env = getEnv(platform);\n\t\tconst kv = safeKV(env, 'BETA_USERS_KV');\n\t\tconst sessionKv = safeKV(env, 'BETA_SESSIONS_KV');\n\n\t\t// 1. Check Bindings\n\t\tif (!kv || !sessionKv) {\n\t\t\tlog.error('KV binding missing');\n\t\t\tif (!dev) return json({ error: 'Service Unavailable' }, { status: 503 });\n\t\t}\n\n\t\t// 2. Rate Limiting (Prevent Credential Stuffing)\n\t\t// [!code fix] Issue #50: Use higher limit in dev instead of completely disabling\n\t\tif (kv) {\n\t\t\tconst clientIp = request.headers.get('CF-Connecting-IP') || getClientAddress();\n\n\t\t\t// Dev mode: 50 attempts per 60s (more lenient but still protected)\n\t\t\t// Prod mode: 5 attempts per 60s\n\t\t\tconst limit = dev ? 50 : 5;\n\t\t\tconst limitResult = await checkRateLimit(kv, clientIp, 'login_attempt', limit, 60);\n\n\t\t\tif (!limitResult.allowed) {\n\t\t\t\treturn json(\n\t\t\t\t\t{\n\t\t\t\t\t\terror: `Too many login attempts. Please try again in a minute.${dev ? ' (Dev mode: limit 50/min)' : ''}`\n\t\t\t\t\t},\n\t\t\t\t\t{ status: 429 }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// 3. Parse Body\n\t\tconst body = (await request.json()) as { email?: string; password?: string };\n\t\tconst { email, password } = body;\n\n\t\t// 4. Authenticate\n\t\t// @ts-expect-error - authenticateUser has broader types; casting result safely below\n\t\tconst authResult = await authenticateUser(kv, email, password);\n\n\t\tif (!authResult) {\n\t\t\treturn json({ error: 'Invalid credentials' }, { status: 401 });\n\t\t}\n\n\t\t// 5. Fetch Full User details\n\t\tconst fullUser = await findUserById(kv as unknown as KVNamespace, authResult.id);\n\t\tconst now = new Date().toISOString();\n\n\t\t// 6. Prepare Session Data (Do NOT rely on authResult for sensitive fields)\n\t\tconst sessionData = {\n\t\t\tid: authResult.id,\n\t\t\tname: fullUser?.name ?? fullUser?.username ?? '',\n\t\t\temail: fullUser?.email ?? '',\n\t\t\tplan: fullUser?.plan || 'free',\n\t\t\ttripsThisMonth: fullUser?.tripsThisMonth || 0,\n\t\t\tmaxTrips: fullUser?.maxTrips || 10,\n\t\t\tresetDate: fullUser?.resetDate || now,\n\t\t\trole:\n\t\t\t\tfullUser && typeof (fullUser as { role?: string }).role === 'string'\n\t\t\t\t\t? (fullUser as { role?: string }).role\n\t\t\t\t\t: 'user'\n\t\t};\n\n\t\t// 7. Create Session in SESSIONS_KV\n\t\t// @ts-expect-error - createSession signature is broad in some environments\n\t\tconst sessionId = await createSession(sessionKv, sessionData);\n\n\t\t// 8. Set Cookie (Issue #5: Changed sameSite from 'none' to 'lax' for better security)\n\t\tcookies.set('session_id', sessionId, {\n\t\t\tpath: '/',\n\t\t\thttpOnly: true,\n\t\t\tsameSite: 'lax', // [!code fix] Changed from 'none' for CSRF protection\n\t\t\tsecure: true,\n\t\t\tmaxAge: 60 * 60 * 24 * 7\n\t\t});\n\n\t\t// 9. AUTO-MIGRATION\n\t\t// Move legacy data (username key) to new storage (UUID key) in background\n\t\tif (\n\t\t\tplatform?.context &&\n\t\t\tsafeKV(env, 'BETA_LOGS_KV') &&\n\t\t\t(safeDO(env, 'TRIP_INDEX_DO') || (env as unknown as Record<string, unknown>)['TRIP_INDEX_DO'])\n\t\t) {\n\t\t\tconst userId = authResult.id;\n\t\t\tconst username = fullUser?.username ?? '';\n\n\t\t\tplatform.context.waitUntil(\n\t\t\t\t(async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst tripIndexDO =\n\t\t\t\t\t\t\tsafeDO(env, 'TRIP_INDEX_DO') ||\n\t\t\t\t\t\t\t(env as unknown as Record<string, unknown>)['TRIP_INDEX_DO'];\n\t\t\t\t\t\tconst placesIndexDO = safeDO(env, 'PLACES_INDEX_DO') || tripIndexDO;\n\t\t\t\t\t\tconst svc = makeTripService(\n\t\t\t\t\t\t\tsafeKV(env, 'BETA_LOGS_KV') as any,\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tsafeKV(env, 'BETA_PLACES_KV') as any,\n\t\t\t\t\t\t\ttripIndexDO as any,\n\t\t\t\t\t\t\tplacesIndexDO as any\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// Trigger the move. If keys exist under 'username', they move to 'userId'.\n\t\t\t\t\t\tawait (svc as any).migrateUser?.(username, userId);\n\t\t\t\t\t} catch (e: unknown) {\n\t\t\t\t\t\tconst msg = e instanceof Error ? e.message : String(e);\n\t\t\t\t\t\tlog.error('[Auto-Migration] Failed', { username, message: msg });\n\t\t\t\t\t}\n\t\t\t\t})()\n\t\t\t);\n\t\t}\n\n\t\treturn json({ user: sessionData });\n\t} catch (err: unknown) {\n\t\tconst msg = err instanceof Error ? err.message : String(err);\n\t\tlog.error('Login error', { message: msg });\n\t\treturn json({ error: 'Internal Server Error' }, { status: 500 });\n\t}\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\logout\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\privacy\\+page.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\register\\+page.server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\register\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\reset-password\\+page.svelte",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 35,
				"column": 13,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 35,
				"endColumn": 14
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected goto() call without resolve().",
				"line": 41,
				"column": 27,
				"nodeType": null,
				"messageId": "gotoWithoutResolve",
				"endLine": 41,
				"endColumn": 44
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 45,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 45,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 61,
				"column": 12,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 61,
				"endColumn": 41
			}
		],
		"suppressedMessages": [],
		"errorCount": 2,
		"fatalErrorCount": 0,
		"warningCount": 2,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport { page } from '$app/stores';\n\timport { goto } from '$app/navigation';\n\timport { base } from '$app/paths';\n\tconst resolve = (href: string) => `${base}${href}`;\n\n\tlet password = '';\n\tlet confirmPassword = '';\n\tlet loading = false;\n\tlet error = '';\n\tlet success = false;\n\n\t// Get token from URL\n\t$: token = $page.url.searchParams.get('token');\n\n\tasync function handleReset() {\n\t\tif (password !== confirmPassword) {\n\t\t\terror = 'Passwords do not match';\n\t\t\treturn;\n\t\t}\n\n\t\tloading = true;\n\t\terror = '';\n\n\t\ttry {\n\t\t\tconst res = await fetch('/reset-password', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ token, password })\n\t\t\t});\n\n\t\t\tlet data: any = {};\n\t\t\ttry {\n\t\t\t\tdata = (await res.json()) as any;\n\t\t\t} catch (e) {\n\t\t\t\t// ignore parse errors\n\t\t\t}\n\n\t\t\tif (res.ok) {\n\t\t\t\tsuccess = true;\n\t\t\t\tsetTimeout(() => goto(resolve('/login')), 3000);\n\t\t\t} else {\n\t\t\t\terror = (data && data.message) || 'Failed to reset password.';\n\t\t\t}\n\t\t} catch (e) {\n\t\t\terror = 'Network error occurred.';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n</script>\n\n<svelte:head>\n\t<title>Set New Password - Go Route Yourself</title>\n</svelte:head>\n\n<div class=\"auth-page\">\n\t<div class=\"form-container\">\n\t\t{#if !token}\n\t\t\t<div class=\"alert error\">Invalid link. Please request a new password reset.</div>\n\t\t\t<a href={resolve('/forgot-password')} class=\"back-link\">Go to Forgot Password</a>\n\t\t{:else if success}\n\t\t\t<div class=\"alert success\">\n\t\t\t\t<h3>Success!</h3>\n\t\t\t\t<p>Your password has been reset. Redirecting to login...</p>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"form-header\">\n\t\t\t\t<h1>New Password</h1>\n\t\t\t\t<p>Enter your new secure password.</p>\n\t\t\t</div>\n\n\t\t\t{#if error}\n\t\t\t\t<div class=\"alert error\">{error}</div>\n\t\t\t{/if}\n\n\t\t\t<form on:submit|preventDefault={handleReset}>\n\t\t\t\t<div class=\"field-group\">\n\t\t\t\t\t<label for=\"pass\">New Password</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tid=\"pass\"\n\t\t\t\t\t\tbind:value={password}\n\t\t\t\t\t\trequired\n\t\t\t\t\t\tclass=\"input-field\"\n\t\t\t\t\t\tminlength=\"6\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"field-group\">\n\t\t\t\t\t<label for=\"conf\">Confirm Password</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tid=\"conf\"\n\t\t\t\t\t\tbind:value={confirmPassword}\n\t\t\t\t\t\trequired\n\t\t\t\t\t\tclass=\"input-field\"\n\t\t\t\t\t\tminlength=\"6\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<button type=\"submit\" class=\"btn-submit\" disabled={loading}>\n\t\t\t\t\t{loading ? 'Updating...' : 'Set Password'}\n\t\t\t\t</button>\n\t\t\t</form>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t/* Same styles as above */\n\t.auth-page {\n\t\tmin-height: 100vh;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbackground: #f9fafb;\n\t\tfont-family: 'Inter', sans-serif;\n\t}\n\t.form-container {\n\t\tbackground: white;\n\t\tpadding: 40px;\n\t\tborder-radius: 12px;\n\t\tbox-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n\t\twidth: 100%;\n\t\tmax-width: 400px;\n\t}\n\t.form-header {\n\t\tmargin-bottom: 24px;\n\t\ttext-align: center;\n\t}\n\th1 {\n\t\tfont-size: 24px;\n\t\tfont-weight: 700;\n\t\tcolor: #111827;\n\t\tmargin: 10px 0;\n\t}\n\tp {\n\t\tcolor: #6b7280;\n\t\tfont-size: 14px;\n\t}\n\t.input-field {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tborder: 2px solid #e5e7eb;\n\t\tborder-radius: 8px;\n\t\tfont-size: 15px;\n\t\tmargin-top: 6px;\n\t}\n\t.field-group {\n\t\tmargin-bottom: 20px;\n\t}\n\t.btn-submit {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tbackground: #ff7f50;\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t}\n\t.alert {\n\t\tpadding: 12px;\n\t\tborder-radius: 8px;\n\t\tmargin-bottom: 20px;\n\t\tfont-size: 14px;\n\t}\n\t.alert.success {\n\t\tbackground: #f0fdf4;\n\t\tcolor: #166534;\n\t\ttext-align: center;\n\t}\n\t.alert.error {\n\t\tbackground: #fef2f2;\n\t\tcolor: #991b1b;\n\t}\n\t.back-link {\n\t\tdisplay: block;\n\t\ttext-align: center;\n\t\tcolor: #ff7f50;\n\t\tmargin-top: 20px;\n\t\ttext-decoration: none;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\reset-password\\+server.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\support\\+page.svelte",
		"messages": [
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 39,
				"column": 14,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 39,
				"endColumn": 30
			}
		],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\timport Header from '$lib/components/layout/Header.svelte';\n</script>\n\n<svelte:head>\n\t<title>Support - Go Route Yourself</title>\n</svelte:head>\n\n<Header />\n\n<div class=\"support-page\">\n\t<div class=\"container\">\n\t\t<div class=\"page-header\">\n\t\t\t<h1 class=\"title\">Support Center</h1>\n\t\t\t<p class=\"subtitle\">Need help? We've got you covered.</p>\n\t\t</div>\n\n\t\t<div class=\"content\">\n\t\t\t<section>\n\t\t\t\t<h2>Contact Us</h2>\n\t\t\t\t<p>\n\t\t\t\t\tWhether you have a question about features, pricing, need a demo, or anything else, our\n\t\t\t\t\tteam is ready to answer all your questions.\n\t\t\t\t</p>\n\t\t\t\t<div class=\"contact-box\">\n\t\t\t\t\t<strong>Email Support</strong><br />\n\t\t\t\t\tFor general inquiries and technical support:<br />\n\t\t\t\t\t<a href=\"mailto:support@gorouteyourself.com\">support@gorouteyourself.com</a>\n\t\t\t\t</div>\n\t\t\t</section>\n\n\t\t\t<section>\n\t\t\t\t<h2>Frequently Asked Questions</h2>\n\n\t\t\t\t<div class=\"faq-item\">\n\t\t\t\t\t<h3>How do I reset my password?</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tIf you've forgotten your password, you can request a reset link by visiting the <a\n\t\t\t\t\t\t\thref=\"/forgot-password\">Forgot Password</a\n\t\t\t\t\t\t> page.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"faq-item\">\n\t\t\t\t\t<h3>How does data syncing work?</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tYour trips and routes automatically sync across all your devices when you are logged in.\n\t\t\t\t\t\tIf you notice data missing, check the \"Sync Status\" indicator in the navigation bar to\n\t\t\t\t\t\tensure you are connected.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"faq-item\">\n\t\t\t\t\t<h3>Can I export my route data?</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tYes. You can export your tracks and logs in standard formats like GPX or JSON from your\n\t\t\t\t\t\tDashboard. Visit the \"Data\" tab in your dashboard to manage your exports.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"faq-item\">\n\t\t\t\t\t<h3>How do I report a bug?</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tPlease email us at <a href=\"mailto:support@gorouteyourself.com\"\n\t\t\t\t\t\t\t>support@gorouteyourself.com</a\n\t\t\t\t\t\t> with a description of the issue. Including screenshots and details about your device helps\n\t\t\t\t\t\tus resolve issues faster.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</section>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t/* Styles consistent with Privacy/Terms pages */\n\t:global(:root) {\n\t\t--navy: #2c4a6e;\n\t\t--orange: #ff7f50;\n\t\t--gray-600: #4b5563;\n\t\t--gray-900: #111827;\n\t\t--bg-light: #f9fafb;\n\t}\n\n\t.support-page {\n\t\tbackground-color: var(--bg-light);\n\t\tmin-height: 100vh;\n\t\tpadding-bottom: 80px;\n\t\tfont-family:\n\t\t\t-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n\t\tcolor: var(--gray-900);\n\t\tline-height: 1.6;\n\t}\n\n\t@media (max-width: 640px) {\n\t\t.support-page {\n\t\t\tpadding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1px);\n\t\t}\n\t}\n\n\t.container {\n\t\tmax-width: 800px;\n\t\tmargin: 0 auto;\n\t\tpadding: 40px 20px;\n\t}\n\n\t.page-header {\n\t\ttext-align: center;\n\t\tmargin-bottom: 60px;\n\t\tpadding-bottom: 40px;\n\t\tborder-bottom: 1px solid #e5e7eb;\n\t}\n\n\t.title {\n\t\tfont-size: 42px;\n\t\tfont-weight: 800;\n\t\tcolor: var(--navy);\n\t\tmargin-bottom: 16px;\n\t}\n\n\t.subtitle {\n\t\tfont-size: 18px;\n\t\tcolor: var(--gray-600);\n\t}\n\n\t.content {\n\t\tbackground: white;\n\t\tpadding: 48px;\n\t\tborder-radius: 16px;\n\t\tbox-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);\n\t\tborder: 1px solid #e5e7eb;\n\t}\n\n\tsection {\n\t\tmargin-bottom: 40px;\n\t}\n\n\th2 {\n\t\tfont-size: 24px;\n\t\tfont-weight: 700;\n\t\tcolor: var(--navy);\n\t\tmargin-bottom: 20px;\n\t\tpadding-bottom: 10px;\n\t\tborder-bottom: 2px solid #f3f4f6;\n\t}\n\n\th3 {\n\t\tfont-size: 18px;\n\t\tfont-weight: 600;\n\t\tcolor: var(--navy);\n\t\tmargin: 24px 0 8px;\n\t}\n\n\tp {\n\t\tmargin-bottom: 16px;\n\t\tcolor: var(--gray-600);\n\t\tfont-size: 16px;\n\t}\n\n\t.contact-box {\n\t\tbackground: #f3f4f6;\n\t\tpadding: 24px;\n\t\tborder-radius: 8px;\n\t\tmargin-top: 20px;\n\t\tcolor: var(--navy);\n\t\tborder-left: 4px solid var(--orange);\n\t}\n\n\t.faq-item {\n\t\tmargin-bottom: 24px;\n\t}\n\n\ta {\n\t\tcolor: var(--orange);\n\t\ttext-decoration: none;\n\t\tfont-weight: 500;\n\t}\n\n\ta:hover {\n\t\ttext-decoration: underline;\n\t}\n\n\t@media (max-width: 768px) {\n\t\t.content {\n\t\t\tpadding: 24px;\n\t\t}\n\t\t.title {\n\t\t\tfont-size: 32px;\n\t\t}\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\terms\\+page.svelte",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\tools\\assign-stops\\+page.server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 16,
				"column": 12,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 16,
				"endColumn": 15,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [509, 512], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [509, 512], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import { redirect } from '@sveltejs/kit';\nimport { env as publicEnv } from '$env/dynamic/public';\nimport { env as privateEnv } from '$env/dynamic/private';\nimport { log } from '$lib/server/log';\n\nexport const load = async ({ locals, platform }) => {\n\tif (!locals.user) {\n\t\tthrow redirect(303, '/login');\n\t}\n\n\tlet clientApiKey = publicEnv['PUBLIC_GOOGLE_MAPS_API_KEY'];\n\tif (!clientApiKey) {\n\t\tconst { getEnv } = await import('$lib/server/env');\n\t\tconst env = getEnv(platform);\n\t\tconst privateKey =\n\t\t\t(env as any)['PRIVATE_GOOGLE_MAPS_API_KEY'] || privateEnv['PRIVATE_GOOGLE_MAPS_API_KEY'];\n\t\tif (privateKey) {\n\t\t\tlog.warn('Using PRIVATE key for frontend on tools/assign-stops (fallback)');\n\t\t\tclientApiKey = privateKey;\n\t\t}\n\t}\n\n\treturn {\n\t\tgoogleMapsApiKey: clientApiKey\n\t};\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\tools\\assign-stops\\+page.svelte",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 216,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 216,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 341,
				"column": 5,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 352,
				"endColumn": 12
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 382,
				"column": 6,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 388,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 406,
				"column": 3,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 442,
				"endColumn": 10
			},
			{
				"ruleId": "svelte/require-each-key",
				"severity": 2,
				"message": "Each block should have a key",
				"line": 429,
				"column": 6,
				"nodeType": "SvelteEachBlock",
				"messageId": "expectedKey",
				"endLine": 431,
				"endColumn": 13
			},
			{
				"ruleId": "svelte/no-navigation-without-resolve",
				"severity": 1,
				"message": "Unexpected href link without resolve().",
				"line": 436,
				"column": 15,
				"nodeType": null,
				"messageId": "linkWithoutResolve",
				"endLine": 436,
				"endColumn": 48
			}
		],
		"suppressedMessages": [],
		"errorCount": 5,
		"fatalErrorCount": 0,
		"warningCount": 1,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "<script lang=\"ts\">\n\t// Svelte 5 runes\n\timport { autocomplete, loadGoogleMaps } from '$lib/utils/autocomplete';\n\timport { csrfFetch } from '$lib/utils/csrf';\n\n\tconst { data } = $props();\n\tconst API_KEY = $derived(() => String((data as any)?.googleMapsApiKey ?? ''));\n\n\ttype Place = {\n\t\tgeometry?: { location: { lat: number; lng: number } };\n\t\tformatted_address?: string;\n\t\tname?: string;\n\t\tplace_id?: string;\n\t};\n\ttype Tech = {\n\t\tid: string;\n\t\tname: string;\n\t\tstart: string;\n\t\tend: string;\n\t\tstartPlace?: Place | null;\n\t\tendPlace?: Place | null;\n\t};\n\ttype Stop = { id: string; address: string; rank?: number | null; place?: Place | null };\n\ttype Assignment = {\n\t\ttech: {\n\t\t\tname: string;\n\t\t\tstartLoc?: { lat: number; lon: number };\n\t\t\tendLoc?: { lat: number; lon: number };\n\t\t};\n\t\tstops: Array<{ address: string; rank?: number | null; loc?: { lat: number; lon: number } }>;\n\t\tmiles: number;\n\t\tminutes: number;\n\t};\n\ttype Result = { assignments: Assignment[]; totals: { miles: number; minutes: number } };\n\n\t// Static map generation removed in favor of interactive JS maps (use the built-in map preview).\n\n\tfunction buildGoogleMapsDirectionsUrl(a: Assignment) {\n\t\tconst origin = a.tech.startLoc\n\t\t\t? `${a.tech.startLoc.lat},${a.tech.startLoc.lon}`\n\t\t\t: encodeURIComponent(a.stops[0]?.address || '');\n\t\tconst destination = a.tech.endLoc\n\t\t\t? `${a.tech.endLoc.lat},${a.tech.endLoc.lon}`\n\t\t\t: encodeURIComponent(a.stops[a.stops.length - 1]?.address || '');\n\t\tconst waypoints = a.stops\n\t\t\t.map((s) => (s.loc ? `${s.loc.lat},${s.loc.lon}` : s.address))\n\t\t\t.join('|');\n\t\treturn `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}&travelmode=driving${waypoints ? `&waypoints=${encodeURIComponent(waypoints)}` : ''}`;\n\t}\n\n\tfunction formatMinutes(mins: number) {\n\t\tif (!isFinite(mins) || isNaN(mins)) return '-';\n\t\tconst total = Math.round(mins);\n\t\tconst hrs = Math.floor(total / 60);\n\t\tconst m = total % 60;\n\t\treturn hrs > 0 ? `${hrs}h ${m}m` : `${m}m`;\n\t}\n\n\tlet techName = $state('');\n\tlet techStart = $state('');\n\tlet techEnd = $state('');\n\tlet techStartPlace: Place | null = $state(null);\n\tlet techEndPlace: Place | null = $state(null);\n\tlet techs = $state<Tech[]>([]);\n\n\tlet stopAddress = $state('');\n\tlet stopRank = $state<number | null>(null); // null or number\n\tlet stopPlace: Place | null = $state(null);\n\tlet stops = $state<Stop[]>([]);\n\n\timport { onMount } from 'svelte';\n\tlet loading = $state(false);\n\tlet message = $state('');\n\tlet result = $state<Result | null>(null);\n\n\tlet techStartInput: HTMLInputElement | null = null;\n\tlet techEndInput: HTMLInputElement | null = null;\n\tlet stopInput: HTMLInputElement | null = null;\n\n\tonMount(() => {\n\t\tif (techStartInput)\n\t\t\ttechStartInput.addEventListener('place-selected', onTechStartSelected as EventListener);\n\t\tif (techEndInput)\n\t\t\ttechEndInput.addEventListener('place-selected', onTechEndSelected as EventListener);\n\t\tif (stopInput) stopInput.addEventListener('place-selected', onStopSelected as EventListener);\n\n\t\treturn () => {\n\t\t\tif (techStartInput)\n\t\t\t\ttechStartInput.removeEventListener('place-selected', onTechStartSelected as EventListener);\n\t\t\tif (techEndInput)\n\t\t\t\ttechEndInput.removeEventListener('place-selected', onTechEndSelected as EventListener);\n\t\t\tif (stopInput)\n\t\t\t\tstopInput.removeEventListener('place-selected', onStopSelected as EventListener);\n\t\t};\n\t});\n\tfunction addTech() {\n\t\tif (!techName || !techStart) return;\n\t\ttechs = [\n\t\t\t...techs,\n\t\t\t{\n\t\t\t\tid: crypto.randomUUID(),\n\t\t\t\tname: techName,\n\t\t\t\tstart: techStart,\n\t\t\t\tend: techEnd || techStart,\n\t\t\t\tstartPlace: techStartPlace,\n\t\t\t\tendPlace: techEndPlace\n\t\t\t}\n\t\t];\n\t\ttechName = '';\n\t\ttechStart = '';\n\t\ttechEnd = '';\n\t\ttechStartPlace = null;\n\t\ttechEndPlace = null;\n\t\tresult = null;\n\t}\n\n\tfunction removeTech(id: string) {\n\t\ttechs = techs.filter((t) => t.id !== id);\n\t\tresult = null;\n\t}\n\n\tfunction addStop() {\n\t\tif (!stopAddress) return;\n\t\tstops = [\n\t\t\t...stops,\n\t\t\t{ id: crypto.randomUUID(), address: stopAddress, rank: stopRank, place: stopPlace }\n\t\t];\n\t\tstopAddress = '';\n\t\tstopRank = null;\n\t\tstopPlace = null;\n\t\tresult = null;\n\t}\n\n\tfunction removeStop(id: string) {\n\t\tstops = stops.filter((s) => s.id !== id);\n\t\tresult = null;\n\t}\n\n\tfunction onTechStartSelected(e: CustomEvent) {\n\t\ttechStartPlace = e.detail;\n\t\ttechStart = (e.detail.formatted_address as string) || (e.detail.name as string) || techStart;\n\t}\n\n\tfunction onTechEndSelected(e: CustomEvent) {\n\t\ttechEndPlace = e.detail;\n\t\ttechEnd = (e.detail.formatted_address as string) || (e.detail.name as string) || techEnd;\n\t}\n\n\tfunction onStopSelected(e: CustomEvent) {\n\t\tstopPlace = e.detail;\n\t\tstopAddress =\n\t\t\t(e.detail.formatted_address as string) || (e.detail.name as string) || stopAddress;\n\t}\n\n\tasync function optimize() {\n\t\tmessage = '';\n\t\tresult = null;\n\t\tif (techs.length === 0) {\n\t\t\tmessage = 'Add at least one tech.';\n\t\t\treturn;\n\t\t}\n\t\tif (stops.length === 0) {\n\t\t\tmessage = 'Add at least one stop.';\n\t\t\treturn;\n\t\t}\n\n\t\tloading = true;\n\t\ttry {\n\t\t\t// Send place geometry when available to avoid extra server geocoding\n\t\t\tconst payload = {\n\t\t\t\ttechs: techs.map((t) => ({\n\t\t\t\t\tname: t.name,\n\t\t\t\t\tstart: t.start,\n\t\t\t\t\tend: t.end,\n\t\t\t\t\tstartLoc: t.startPlace?.geometry\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tlat: t.startPlace!.geometry!.location.lat,\n\t\t\t\t\t\t\t\tlon: t.startPlace!.geometry!.location.lng,\n\t\t\t\t\t\t\t\taddress: t.startPlace!.formatted_address || t.start\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tendLoc: t.endPlace?.geometry\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tlat: t.endPlace!.geometry!.location.lat,\n\t\t\t\t\t\t\t\tlon: t.endPlace!.geometry!.location.lng,\n\t\t\t\t\t\t\t\taddress: t.endPlace!.formatted_address || t.end\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: undefined\n\t\t\t\t})),\n\t\t\t\tstops: stops.map((s) => ({\n\t\t\t\t\taddress: s.address,\n\t\t\t\t\trank: s.rank,\n\t\t\t\t\tloc: s.place?.geometry\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tlat: s.place!.geometry!.location.lat,\n\t\t\t\t\t\t\t\tlon: s.place!.geometry!.location.lng,\n\t\t\t\t\t\t\t\taddress: s.place!.formatted_address || s.address\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: undefined\n\t\t\t\t}))\n\t\t\t};\n\n\t\t\tconst res = await csrfFetch(location.pathname, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify(payload)\n\t\t\t});\n\t\t\tif (!res.ok) {\n\t\t\t\tconst err = (await res.json().catch(() => null)) as any;\n\t\t\t\tmessage = err?.error || 'Server error';\n\t\t\t\tloading = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = await res.json();\n\t\t\tmessage = '';\n\t\t} catch (e) {\n\t\t\tmessage = 'Network error';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\tfunction initMap(node: HTMLElement, params: { assignment: Assignment }) {\n\t\tlet map: google.maps.Map | null = null;\n\t\tlet poly: google.maps.Polyline | null = null;\n\t\tlet markers: google.maps.Marker[] = [];\n\t\tlet destroyed = false;\n\n\t\tloadGoogleMaps(API_KEY())\n\t\t\t.then(() => {\n\t\t\t\tif (destroyed) return;\n\t\t\t\tconst a = params.assignment;\n\t\t\t\tconst path: google.maps.LatLngLiteral[] = [];\n\t\t\t\tif (a.tech.startLoc) path.push({ lat: a.tech.startLoc.lat, lng: a.tech.startLoc.lon });\n\t\t\t\ta.stops.forEach((s) => {\n\t\t\t\t\tif (s.loc) path.push({ lat: s.loc.lat, lng: s.loc.lon });\n\t\t\t\t});\n\t\t\t\tif (a.tech.endLoc) path.push({ lat: a.tech.endLoc.lat, lng: a.tech.endLoc.lon });\n\n\t\t\t\tif (path.length === 0) return;\n\t\t\t\tmap = new google.maps.Map(node, {\n\t\t\t\t\tcenter: path[0],\n\t\t\t\t\tzoom: 12,\n\t\t\t\t\tgestureHandling: 'none',\n\t\t\t\t\tdisableDefaultUI: true\n\t\t\t\t});\n\n\t\t\t\tpoly = new google.maps.Polyline({\n\t\t\t\t\tpath,\n\t\t\t\t\tstrokeColor: '#1FA8DB',\n\t\t\t\t\tstrokeOpacity: 0.95,\n\t\t\t\t\tstrokeWeight: 3,\n\t\t\t\t\tclickable: false\n\t\t\t\t});\n\t\t\t\tpoly.setMap(map);\n\n\t\t\t\tif (a.tech.startLoc)\n\t\t\t\t\tmarkers.push(\n\t\t\t\t\t\tnew google.maps.Marker({\n\t\t\t\t\t\t\tposition: { lat: a.tech.startLoc.lat, lng: a.tech.startLoc.lon },\n\t\t\t\t\t\t\tmap,\n\t\t\t\t\t\t\tlabel: 'S'\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\ta.stops.forEach((s, idx) => {\n\t\t\t\t\tif (s.loc)\n\t\t\t\t\t\tmarkers.push(\n\t\t\t\t\t\t\tnew google.maps.Marker({\n\t\t\t\t\t\t\t\tposition: { lat: s.loc.lat, lng: s.loc.lon },\n\t\t\t\t\t\t\t\tmap,\n\t\t\t\t\t\t\t\tlabel: ((idx + 1) % 10).toString()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\tif (a.tech.endLoc)\n\t\t\t\t\tmarkers.push(\n\t\t\t\t\t\tnew google.maps.Marker({\n\t\t\t\t\t\t\tposition: { lat: a.tech.endLoc.lat, lng: a.tech.endLoc.lon },\n\t\t\t\t\t\t\tmap,\n\t\t\t\t\t\t\tlabel: 'E'\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\tconst bounds = new google.maps.LatLngBounds();\n\t\t\t\tpath.forEach((p) => bounds.extend(p));\n\t\t\t\tmap.fitBounds(bounds);\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconsole.warn('[Map] load failed', e);\n\t\t\t});\n\n\t\treturn {\n\t\t\tupdate(_newParams: { assignment: Assignment }) {\n\t\t\t\t// No-op for now. Could implement rerendering if assignments change.\n\t\t\t},\n\t\t\tdestroy() {\n\t\t\t\tdestroyed = true;\n\t\t\t\tif (poly) poly.setMap(null);\n\t\t\t\tmarkers.forEach((m) => m.setMap(null));\n\t\t\t\tmarkers = [];\n\t\t\t}\n\t\t};\n\t}\n</script>\n\n<svelte:head>\n\t<title>Assign Stops to Techs — Tools</title>\n</svelte:head>\n\n<div class=\"card\">\n\t<h1>Assign Stops to Techs</h1>\n\t<p class=\"muted\">\n\t\tThis page is not linked in the app; open directly via URL. Create techs and stops, mark stop\n\t\tordering positions (1 = first, 2 = second...), then click <strong>Optimize</strong> to assign stops\n\t\tto techs fairly.\n\t</p>\n\n\t<hr />\n\n\t<section>\n\t\t<h2>Techs</h2>\n\t\t<div class=\"form-row\">\n\t\t\t<input placeholder=\"Tech name\" bind:value={techName} />\n\t\t\t<input\n\t\t\t\tplaceholder=\"Start address\"\n\t\t\t\tbind:value={techStart}\n\t\t\t\tuse:autocomplete={{ apiKey: API_KEY() }}\n\t\t\t\tbind:this={techStartInput}\n\t\t\t/>\n\t\t\t<input\n\t\t\t\tplaceholder=\"End address (optional)\"\n\t\t\t\tbind:value={techEnd}\n\t\t\t\tuse:autocomplete={{ apiKey: API_KEY() }}\n\t\t\t\tbind:this={techEndInput}\n\t\t\t/>\n\t\t\t<button class=\"btn-secondary\" onclick={addTech}>Add Tech</button>\n\t\t</div>\n\n\t\t{#if techs.length > 0}\n\t\t\t<ul class=\"list tech-list\">\n\t\t\t\t{#each techs as t}\n\t\t\t\t\t<li class=\"tech-row\">\n\t\t\t\t\t\t<div class=\"tech-head\">\n\t\t\t\t\t\t\t<strong class=\"tech-name\">{t.name}</strong>\n\t\t\t\t\t\t\t<button class=\"small\" onclick={() => removeTech(t.id)}>Remove</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"tech-addrs\">\n\t\t\t\t\t\t\t<div class=\"addr\"><span class=\"label\">Start:</span> {t.start}</div>\n\t\t\t\t\t\t\t<div class=\"addr\"><span class=\"label\">End:</span> {t.end}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t{/each}\n\t\t\t</ul>\n\t\t{/if}\n\t</section>\n\n\t<section style=\"margin-top:1rem\">\n\t\t<h2>Stops</h2>\n\t\t<div class=\"form-row\">\n\t\t\t<input\n\t\t\t\tplaceholder=\"Stop address\"\n\t\t\t\tbind:value={stopAddress}\n\t\t\t\tuse:autocomplete={{ apiKey: API_KEY() }}\n\t\t\t\tbind:this={stopInput}\n\t\t\t/>\n\t\t\t<select bind:value={stopRank}>\n\t\t\t\t<option value={null}>No rank</option>\n\t\t\t\t<option value={1}>First (1)</option>\n\t\t\t\t<option value={2}>Second (2)</option>\n\t\t\t\t<option value={3}>Third (3)</option>\n\t\t\t\t<option value={4}>Fourth (4)</option>\n\t\t\t</select>\n\t\t\t<button class=\"btn-secondary\" onclick={addStop}>Add Stop</button>\n\t\t</div>\n\n\t\t{#if stops.length > 0}\n\t\t\t<table class=\"table\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr><th>Address</th><th>Rank</th><th></th></tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t{#each stops as s}\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>{s.address}</td>\n\t\t\t\t\t\t\t<td>{s.rank ?? '-'}</td>\n\t\t\t\t\t\t\t<td><button class=\"small\" onclick={() => removeStop(s.id)}>Remove</button></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t{/each}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t{/if}\n\t</section>\n\n\t<section style=\"margin-top:1rem\">\n\t\t<button class=\"btn-primary\" onclick={optimize} disabled={loading}\n\t\t\t>{loading ? 'Optimizing…' : 'Optimize'}</button\n\t\t>\n\t\t{#if message}\n\t\t\t<p class=\"error\">{message}</p>\n\t\t{/if}\n\t</section>\n\n\t{#if result}\n\t\t<hr />\n\t\t<h2>Assignment Result</h2>\n\t\t{#each result.assignments as a}\n\t\t\t<div class=\"card small-card\">\n\t\t\t\t<div class=\"card-head\">\n\t\t\t\t\t<h3>{a.tech.name}</h3>\n\t\t\t\t\t<div class=\"tech-addrs\">\n\t\t\t\t\t\t<div class=\"addr\">\n\t\t\t\t\t\t\t<span class=\"label\">Start:</span>\n\t\t\t\t\t\t\t{a.tech.startLoc\n\t\t\t\t\t\t\t\t? `${a.tech.startLoc.lat.toFixed(5)}, ${a.tech.startLoc.lon.toFixed(5)}`\n\t\t\t\t\t\t\t\t: '—'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"addr\">\n\t\t\t\t\t\t\t<span class=\"label\">End:</span>\n\t\t\t\t\t\t\t{a.tech.endLoc\n\t\t\t\t\t\t\t\t? `${a.tech.endLoc.lat.toFixed(5)}, ${a.tech.endLoc.lon.toFixed(5)}`\n\t\t\t\t\t\t\t\t: '—'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<p><strong>Stops:</strong> {a.stops.length}</p>\n\t\t\t\t<p><strong>Mileage:</strong> {a.miles.toFixed(1)} mi</p>\n\t\t\t\t<p><strong>Drive time:</strong> {formatMinutes(a.minutes)}</p>\n\t\t\t\t<ul>\n\t\t\t\t\t{#each a.stops as s}\n\t\t\t\t\t\t<li>{s.address} {s.rank ? ` (rank ${s.rank})` : ''}</li>\n\t\t\t\t\t{/each}\n\t\t\t\t</ul>\n\t\t\t\t{#if API_KEY() && (a.tech.startLoc || a.tech.endLoc || a.stops.some((s) => s.loc))}\n\t\t\t\t\t<div class=\"map-preview interactive-map\" use:initMap={{ assignment: a }}></div>\n\t\t\t\t\t<p class=\"map-link\">\n\t\t\t\t\t\t<a href={buildGoogleMapsDirectionsUrl(a)} target=\"_blank\" rel=\"noopener\"\n\t\t\t\t\t\t\t>Open in Google Maps</a\n\t\t\t\t\t\t>\n\t\t\t\t\t</p>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t{/each}\n\n\t\t<div style=\"margin-top:1rem\">\n\t\t\t<p><strong>Total miles:</strong> {result.totals.miles.toFixed(1)} mi</p>\n\t\t\t<p><strong>Total time:</strong> {formatMinutes(result.totals.minutes)}</p>\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t.card {\n\t\tpadding: 1rem;\n\t\tbackground: var(--card-bg, #fff);\n\t\tborder-radius: 6px;\n\t\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);\n\t}\n\t.form-row {\n\t\tdisplay: flex;\n\t\tgap: 0.5rem;\n\t\talign-items: center;\n\t}\n\t.form-row input,\n\t.form-row select {\n\t\tpadding: 0.6rem;\n\t\tflex: 1;\n\t\tborder: 1px solid var(--border, #e6e6e6);\n\t\tborder-radius: 6px;\n\t}\n\t.btn-primary {\n\t\tbackground: var(--primary, #f68a2e);\n\t\tcolor: #fff;\n\t\tpadding: 0.6rem 1rem;\n\t\tborder-radius: 6px;\n\t}\n\t.btn-secondary {\n\t\tbackground: #fff;\n\t\tborder: 1px solid var(--border, #e6e6e6);\n\t\tpadding: 0.5rem 0.8rem;\n\t\tborder-radius: 6px;\n\t}\n\t.btn-secondary:hover {\n\t\tbackground: #fafafa;\n\t}\n\t.small {\n\t\tbackground: transparent;\n\t\tborder: 1px solid #eee;\n\t\tpadding: 0.25rem 0.5rem;\n\t}\n\t.table {\n\t\twidth: 100%;\n\t\tborder-collapse: collapse;\n\t}\n\t.table th,\n\t.table td {\n\t\ttext-align: left;\n\t\tpadding: 0.5rem;\n\t\tborder-bottom: 1px solid #f0f0f0;\n\t}\n\t.small-card {\n\t\tmargin-bottom: 0.5rem;\n\t\tpadding: 0.75rem;\n\t\tborder-radius: 6px;\n\t\tbackground: var(--card-bg, #fff);\n\t\tborder: 1px solid var(--border, #eaeaea);\n\t}\n\t.map-preview.interactive-map {\n\t\twidth: 100%;\n\t\theight: 160px;\n\t\tborder-radius: 6px;\n\t\toverflow: hidden;\n\t\tbackground: #f5f7fa;\n\t}\n\t.map-link {\n\t\tmargin-top: 0.5rem;\n\t\tfont-size: 0.9rem;\n\t\tdisplay: block;\n\t}\n\t.error {\n\t\tcolor: #b00020;\n\t}\n\t.muted {\n\t\tcolor: #666;\n\t\tfont-size: 0.9rem;\n\t}\n\n\t/* Layout: 2-column on wide screens */\n\t@media (min-width: 900px) {\n\t\t.card {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: 1fr 1fr;\n\t\t\tgap: 1rem;\n\t\t}\n\t\t.card > section {\n\t\t\tmargin-top: 0;\n\t\t}\n\t\t.card > section:first-of-type {\n\t\t\tgrid-column: 1 / 2;\n\t\t}\n\t\t.card > section:nth-of-type(2) {\n\t\t\tgrid-column: 2 / 3;\n\t\t}\n\t\t.card > section:nth-of-type(3) {\n\t\t\tgrid-column: 1 / 3;\n\t\t}\n\t}\n\n\t/* Tech list and card layout improvements */\n\t.tech-list {\n\t\tlist-style: none;\n\t\tpadding: 0;\n\t\tmargin: 0;\n\t}\n\t.tech-row {\n\t\tpadding: 0.5rem 0;\n\t\tborder-bottom: 1px solid #f5f5f5;\n\t}\n\t.tech-head {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tgap: 0.5rem;\n\t}\n\t.tech-name {\n\t\tfont-size: 1.05rem;\n\t}\n\t.tech-addrs {\n\t\tmargin-top: 0.4rem;\n\t\tfont-size: 0.9rem;\n\t\tcolor: #444;\n\t}\n\t.addr {\n\t\tdisplay: block;\n\t\twhite-space: normal;\n\t\tword-break: break-word;\n\t}\n\t.label {\n\t\tfont-weight: 600;\n\t\tcolor: #666;\n\t\tmargin-right: 0.25rem;\n\t}\n\n\t.card-head {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: flex-start;\n\t\tgap: 0.8rem;\n\t}\n</style>\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\routes\\tools\\assign-stops\\+server.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 35,
				"column": 7,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 35,
				"endColumn": 10,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1462, 1465], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1462, 1465], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 51,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 51,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1951, 1954], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1951, 1954], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 88,
				"column": 15,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 88,
				"endColumn": 18,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [3212, 3215], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [3212, 3215], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 133,
				"column": 69,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 133,
				"endColumn": 72,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4580, 4583], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4580, 4583], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 133,
				"column": 84,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 133,
				"endColumn": 87,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4595, 4598], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4595, 4598], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 157,
				"column": 35,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 157,
				"endColumn": 38,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [5388, 5391], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [5388, 5391], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 180,
				"column": 22,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 180,
				"endColumn": 25,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [6274, 6277], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [6274, 6277], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 211,
				"column": 22,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 211,
				"endColumn": 25,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7051, 7054], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7051, 7054], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 233,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 233,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [7706, 7709], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [7706, 7709], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 256,
				"column": 64,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 256,
				"endColumn": 67,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8431, 8434], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8431, 8434], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 259,
				"column": 37,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 259,
				"endColumn": 40,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8542, 8545], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8542, 8545], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 259,
				"column": 61,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 259,
				"endColumn": 64,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8566, 8569], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8566, 8569], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 260,
				"column": 37,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 260,
				"endColumn": 40,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8619, 8622], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8619, 8622], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 267,
				"column": 26,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 267,
				"endColumn": 29,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [8982, 8985], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [8982, 8985], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 271,
				"column": 16,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 271,
				"endColumn": 19,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [9190, 9193], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [9190, 9193], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 271,
				"column": 24,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 271,
				"endColumn": 27,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [9198, 9201], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [9198, 9201], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 373,
				"column": 22,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 373,
				"endColumn": 25,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [12561, 12564], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [12561, 12564], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 401,
				"column": 33,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 401,
				"endColumn": 36,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [13428, 13431], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [13428, 13431], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 401,
				"column": 57,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 401,
				"endColumn": 60,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [13452, 13455], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [13452, 13455], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 429,
				"column": 19,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 429,
				"endColumn": 22,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [14562, 14565], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [14562, 14565], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 20,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "import type { RequestHandler } from './$types';\nimport { geocode } from '$lib/server/geocode';\nimport { log } from '$lib/server/log';\n\nfunction haversineMiles(a: { lat: number; lon: number }, b: { lat: number; lon: number }) {\n\tconst R = 3958.8; // miles\n\tconst toRad = (deg: number) => (deg * Math.PI) / 180;\n\tconst dLat = toRad(b.lat - a.lat);\n\tconst dLon = toRad(b.lon - a.lon);\n\tconst lat1 = toRad(a.lat);\n\tconst lat2 = toRad(b.lat);\n\tconst sinDLat = Math.sin(dLat / 2);\n\tconst sinDLon = Math.sin(dLon / 2);\n\tconst c =\n\t\t2 *\n\t\tMath.asin(Math.sqrt(sinDLat * sinDLat + Math.cos(lat1) * Math.cos(lat2) * sinDLon * sinDLon));\n\treturn R * c;\n}\n\n// Estimate road miles by adding a small multiplier to haversine distance\nconst ROAD_FACTOR = 1.25; // conservative multiplier\nconst EST_SPEED_MPH = 35; // for drive time estimate\n\n// Helper: Distance Matrix caching keys (per origin/destination pair)\nfunction dmKey(o: { lat: number; lon: number }, d: { lat: number; lon: number }) {\n\treturn `dm:${Number(o.lat).toFixed(5)},${Number(o.lon).toFixed(5)}:${Number(d.lat).toFixed(5)},${Number(d.lon).toFixed(5)}`;\n}\n\n// Get pairwise distances (meters) and durations (seconds) between an array of origins and destinations\n// Uses KV cache (BETA_PLACES_KV) -> Google Distance Matrix -> caches individual pair results\nasync function getDistanceMatrix(\n\torigins: Array<{ lat: number; lon: number }>,\n\tdestinations: Array<{ lat: number; lon: number }>,\n\tapiKey?: string,\n\tkv?: any\n): Promise<number[][]> {\n\t// Build cache lookups\n\tconst out: number[][] = Array.from({ length: origins.length }, () =>\n\t\tArray(destinations.length).fill(NaN)\n\t);\n\tconst missingPairs: { oIdx: number; dIdx: number }[] = [];\n\n\tfor (let i = 0; i < origins.length; i++) {\n\t\tfor (let j = 0; j < destinations.length; j++) {\n\t\t\tconst dest = destinations[j]!;\n\t\t\tconst key = dmKey(origins[i]!, dest);\n\t\t\ttry {\n\t\t\t\tif (kv) {\n\t\t\t\t\tconst raw = await kv.get(key);\n\t\t\t\t\tif (raw) {\n\t\t\t\t\t\tlet cached: any = null;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcached = JSON.parse(String(raw));\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlog.warn('[DM CACHE] Invalid JSON in cache', { key, err: (e as Error).message });\n\t\t\t\t\t\t\tcached = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (cached) {\n\t\t\t\t\t\t\tconst row = out[i]!;\n\t\t\t\t\t\t\trow[j] = Number(cached.distanceMeters ?? NaN) || NaN;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tlog.warn('[DM CACHE] KV read failed for pair', {\n\t\t\t\t\torigin: `${origins[i]!.lat},${origins[i]!.lon}`,\n\t\t\t\t\tdest: `${destinations[j]!.lat},${destinations[j]!.lon}`,\n\t\t\t\t\terr: (e as Error).message\n\t\t\t\t});\n\t\t\t}\n\t\t\tmissingPairs.push({ oIdx: i, dIdx: j });\n\t\t}\n\t}\n\n\tif (missingPairs.length === 0) return out; // all cached\n\n\t// If no API key, return what's available (may contain NaN)\n\tif (!apiKey) return out;\n\n\t// Prepare origin/destination strings for Distance Matrix request\n\tconst originsStr = origins.map((o) => `${o.lat},${o.lon}`).join('|');\n\tconst destinationsStr = destinations.map((d) => `${d.lat},${d.lon}`).join('|');\n\n\ttry {\n\t\tconst url = `https://maps.googleapis.com/maps/api/distancematrix/json?origins=${encodeURIComponent(originsStr)}&destinations=${encodeURIComponent(destinationsStr)}&key=${apiKey}&mode=driving&units=metric`;\n\t\tconst res = await fetch(url);\n\t\tconst data: any = await res.json();\n\t\tif (data && data.status === 'OK' && Array.isArray(data.rows)) {\n\t\t\tfor (let i = 0; i < data.rows.length; i++) {\n\t\t\t\tconst elements = (data.rows[i] && data.rows[i].elements) || [];\n\t\t\t\tfor (let j = 0; j < elements.length; j++) {\n\t\t\t\t\tconst elem = elements[j];\n\t\t\t\t\tif (elem && elem.status === 'OK') {\n\t\t\t\t\t\tconst distanceMeters = Number((elem.distance && elem.distance.value) ?? 0);\n\t\t\t\t\t\tconst durationSeconds = Number((elem.duration && elem.duration.value) ?? 0);\n\t\t\t\t\t\tconst row = out[i]!;\n\t\t\t\t\t\trow[j] = distanceMeters;\n\n\t\t\t\t\t\t// Cache individual pair\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (kv) {\n\t\t\t\t\t\t\t\tconst key = dmKey(origins[i]!, destinations[j]!);\n\t\t\t\t\t\t\t\tawait kv.put(\n\t\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\t\tJSON.stringify({\n\t\t\t\t\t\t\t\t\t\tdistanceMeters,\n\t\t\t\t\t\t\t\t\t\tdurationSeconds,\n\t\t\t\t\t\t\t\t\t\tcachedAt: new Date().toISOString()\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlog.warn('[DM CACHE] write failed', { err: (e as Error).message });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (e) {\n\t\tlog.warn('[DM] request failed', { err: (e as Error).message });\n\t}\n\n\treturn out;\n}\n\nexport const POST: RequestHandler = async ({ request, locals, platform }) => {\n\t// Enforce authentication\n\tif (!locals.user) {\n\t\treturn new Response(JSON.stringify({ error: 'Unauthorized' }), { status: 401 });\n\t}\n\n\tconst body = (await request.json().catch(() => null)) as { techs?: any[]; stops?: any[] } | null;\n\tif (!body || !Array.isArray(body.techs) || !Array.isArray(body.stops)) {\n\t\treturn new Response(JSON.stringify({ error: 'Invalid payload' }), { status: 400 });\n\t}\n\n\t// SECURITY: Limit array sizes to prevent DoS/complexity attacks\n\tconst MAX_TECHS = 20;\n\tconst MAX_STOPS = 100;\n\n\tif (body.techs.length > MAX_TECHS) {\n\t\treturn new Response(JSON.stringify({ error: `Maximum ${MAX_TECHS} technicians allowed` }), {\n\t\t\tstatus: 400\n\t\t});\n\t}\n\tif (body.stops.length > MAX_STOPS) {\n\t\treturn new Response(JSON.stringify({ error: `Maximum ${MAX_STOPS} stops allowed` }), {\n\t\t\tstatus: 400\n\t\t});\n\t}\n\n\tconst rawTechs = body.techs || [];\n\tconst rawStops = body.stops || [];\n\n\t// Geocode all addresses server-side (use PRIVATE_GOOGLE_MAPS_API_KEY if present)\n\tconst apiKey = (platform?.env as any)?.PRIVATE_GOOGLE_MAPS_API_KEY || undefined;\n\n\t// Helper to geocode and return point. Accepts either a string address or a pre-resolved loc object\n\tasync function geocodeAddress(\n\t\tinput: string | { lat: number; lon: number; address?: string } | undefined\n\t) {\n\t\tif (!input) return null;\n\t\t// If client provided geometry, trust it (do not persist from here — client selections are cached by /api/autocomplete)\n\t\tif (\n\t\t\ttypeof input === 'object' &&\n\t\t\ttypeof input.lat === 'number' &&\n\t\t\ttypeof input.lon === 'number'\n\t\t) {\n\t\t\treturn { lat: Number(input.lat), lon: Number(input.lon), address: input.address };\n\t\t}\n\n\t\t// otherwise, resolve via server-side geocode\n\t\tconst g = await geocode(String(input), apiKey);\n\t\tif (!g) return null;\n\t\treturn { lat: g.lat, lon: g.lon, address: g.formattedAddress || String(input) };\n\t}\n\n\t// Geocode tech starts/ends and stops\n\tconst techs = [] as any[];\n\tfor (const t of rawTechs) {\n\t\tif (!t.name || !(t.start || t.startLoc))\n\t\t\treturn new Response(JSON.stringify({ error: 'Techs must have name and start' }), {\n\t\t\t\tstatus: 400\n\t\t\t});\n\n\t\tconst startLoc = await geocodeAddress(t.startLoc ?? t.start);\n\t\tif (!startLoc)\n\t\t\treturn new Response(\n\t\t\t\tJSON.stringify({\n\t\t\t\t\terror: `Cannot geocode tech start: ${t.start || JSON.stringify(t.startLoc)}`\n\t\t\t\t}),\n\t\t\t\t{\n\t\t\t\t\tstatus: 400\n\t\t\t\t}\n\t\t\t);\n\n\t\tconst endInput = t.endLoc ?? t.end ?? t.start;\n\t\tconst endLoc = await geocodeAddress(endInput);\n\t\tif (!endLoc)\n\t\t\treturn new Response(\n\t\t\t\tJSON.stringify({ error: `Cannot geocode tech end: ${t.end || JSON.stringify(t.endLoc)}` }),\n\t\t\t\t{\n\t\t\t\t\tstatus: 400\n\t\t\t\t}\n\t\t\t);\n\n\t\ttechs.push({ ...t, startLoc, endLoc });\n\t}\n\n\tconst stops = [] as any[];\n\tfor (const s of rawStops) {\n\t\tif (!(s.address || s.loc))\n\t\t\treturn new Response(JSON.stringify({ error: 'Stops must have address or loc' }), {\n\t\t\t\tstatus: 400\n\t\t\t});\n\t\tconst loc = await geocodeAddress(s.loc ?? s.address);\n\t\tif (!loc)\n\t\t\treturn new Response(\n\t\t\t\tJSON.stringify({ error: `Cannot geocode stop: ${s.address || JSON.stringify(s.loc)}` }),\n\t\t\t\t{\n\t\t\t\t\tstatus: 400\n\t\t\t\t}\n\t\t\t);\n\t\tstops.push({ ...s, loc });\n\t}\n\n\tconst T = techs.length;\n\tif (T === 0)\n\t\treturn new Response(JSON.stringify({ error: 'At least one tech required' }), { status: 400 });\n\n\t// Validate rank constraints: for each rank, count stops\n\tconst rankMap = new Map<number, any[]>();\n\tfor (const s of stops) {\n\t\tif (s.rank != null) {\n\t\t\tconst r = Number(s.rank);\n\t\t\tif (!rankMap.has(r)) rankMap.set(r, []);\n\t\t\trankMap.get(r)!.push(s);\n\t\t}\n\t}\n\n\tfor (const r of Array.from(rankMap.keys())) {\n\t\tconst arr = rankMap.get(r)!;\n\t\tif (arr.length > T) {\n\t\t\treturn new Response(\n\t\t\t\tJSON.stringify({\n\t\t\t\t\terror: `Too many stops marked rank ${r} (${arr.length}) for ${T} tech(s)`\n\t\t\t\t}),\n\t\t\t\t{ status: 400 }\n\t\t\t);\n\t\t}\n\t}\n\n\t// Preassign rank-marked stops: ensure each equally maps to distinct techs per rank\n\t// For each rank, assign each stop to the nearest available tech (based on Distance Matrix or haversine) and mark them taken for that rank\n\tconst assignments = techs.map((t) => ({ tech: t, stops: [] as any[] }));\n\n\t// Use Distance Matrix to decide nearest techs where possible\n\tconst placesKV = (platform?.env as any)?.BETA_PLACES_KV as any | undefined;\n\tconst dmApiKey = (platform?.env as any)?.PRIVATE_GOOGLE_MAPS_API_KEY || undefined;\n\n\tconst techOrigins = techs.map((t) => ({ lat: t.startLoc!.lat, lon: t.startLoc!.lon }));\n\tconst stopDests = stops.map((s) => ({ lat: s.loc!.lat, lon: s.loc!.lon }));\n\tconst dm = await getDistanceMatrix(techOrigins, stopDests, dmApiKey, placesKV);\n\n\tfor (const pair of rankMap.entries()) {\n\t\tconst arr = pair[1] as any[];\n\t\t// copy of tech indices that can accept this rank\n\t\tconst available = new Set(techs.map((_, i) => i));\n\t\t// sort stops by nearest tech distance to make greedy assignment deterministic\n\t\tarr.sort((a: any, b: any) => {\n\t\t\tconst aIdx = stops.indexOf(a);\n\t\t\tconst bIdx = stops.indexOf(b);\n\t\t\tconst aMin = Math.min(\n\t\t\t\t...techs.map(\n\t\t\t\t\t(_, ti) => Number(dm?.[ti]?.[aIdx] ?? NaN) || haversineMiles(techs[ti].startLoc, a.loc)\n\t\t\t\t)\n\t\t\t);\n\t\t\tconst bMin = Math.min(\n\t\t\t\t...techs.map(\n\t\t\t\t\t(_, ti) => Number(dm?.[ti]?.[bIdx] ?? NaN) || haversineMiles(techs[ti].startLoc, b.loc)\n\t\t\t\t)\n\t\t\t);\n\t\t\treturn aMin - bMin;\n\t\t});\n\n\t\tfor (const s of arr) {\n\t\t\t// find nearest available tech\n\t\t\tlet bestIdx = -1;\n\t\t\tlet bestDist = Infinity;\n\t\t\tconst sIdx = stops.indexOf(s);\n\t\t\tfor (const i of available) {\n\t\t\t\tconst d = Number(dm?.[i]?.[sIdx] ?? NaN) || haversineMiles(techs[i].startLoc, s.loc);\n\t\t\t\tif (d < bestDist) {\n\t\t\t\t\tbestDist = d;\n\t\t\t\t\tbestIdx = i;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (bestIdx === -1) {\n\t\t\t\t// should not happen due to earlier check\n\t\t\t\treturn new Response(\n\t\t\t\t\tJSON.stringify({ error: 'Assignment failed due to rank constraints' }),\n\t\t\t\t\t{ status: 400 }\n\t\t\t\t);\n\t\t\t}\n\t\t\tassignments[bestIdx]!.stops.push(s);\n\t\t\tavailable.delete(bestIdx);\n\t\t}\n\t}\n\n\t// Remaining stops (unranked) - assign to balance counts and minimize distance\n\tconst unassigned = stops.filter((s) => s.rank == null);\n\n\t// target sizes: distribute total stops evenly across techs\n\tconst totalStops = stops.length;\n\tconst base = Math.floor(totalStops / T);\n\tconst extra = totalStops % T; // first `extra` techs get +1\n\tconst target = assignments.map((_, idx) => base + (idx < extra ? 1 : 0));\n\n\t// Reduce target by already preassigned counts\n\tfor (let i = 0; i < assignments.length; i++) {\n\t\tconst pre = assignments[i]!.stops.length;\n\t\ttarget[i] = Math.max(0, (target[i] ?? 0) - pre);\n\t}\n\n\t// Prepare DM rows for tech starts -> unassigned stops\n\tconst unassignedIdxs = unassigned.map((s) => stops.indexOf(s)).filter((i) => i >= 0);\n\tconst unassignedDests = unassignedIdxs\n\t\t.map((i) => stopDests[i])\n\t\t.filter((p): p is { lat: number; lon: number } => !!p);\n\tconst dmForUnassigned =\n\t\tunassignedDests.length > 0\n\t\t\t? await getDistanceMatrix(techOrigins, unassignedDests, dmApiKey, placesKV)\n\t\t\t: Array.from({ length: techOrigins.length }, () => []);\n\n\t// For each unassigned stop, assign to nearest tech with remaining capacity using DM when available\n\tfor (let u = 0; u < unassigned.length; u++) {\n\t\tconst s = unassigned[u];\n\t\tlet bestIdx = -1;\n\t\tlet bestCost = Infinity;\n\t\tfor (let i = 0; i < techs.length; i++) {\n\t\t\tif ((target[i] ?? 0) <= 0) continue;\n\t\t\tconst d =\n\t\t\t\tNumber(dmForUnassigned?.[i]?.[u] ?? NaN) || haversineMiles(techs[i].startLoc, s.loc);\n\t\t\tif (d < bestCost) {\n\t\t\t\tbestCost = d;\n\t\t\t\tbestIdx = i;\n\t\t\t}\n\t\t}\n\t\t// If no one left with capacity, assign to the tech with minimal distance irrespective of capacity\n\t\tif (bestIdx === -1) {\n\t\t\tlet bestIdx2 = 0;\n\t\t\tlet bestInc = Infinity;\n\t\t\tfor (let i = 0; i < techs.length; i++) {\n\t\t\t\tconst d =\n\t\t\t\t\tNumber(dmForUnassigned?.[i]?.[u] ?? NaN) || haversineMiles(techs[i].startLoc, s.loc);\n\t\t\t\tif (d < bestInc) {\n\t\t\t\t\tbestInc = d;\n\t\t\t\t\tbestIdx2 = i;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbestIdx = bestIdx2;\n\t\t} else {\n\t\t\tif (typeof target[bestIdx] === 'number') target[bestIdx]!--;\n\t\t}\n\t\tassignments[bestIdx]!.stops.push(s);\n\t}\n\n\t// For each tech, order stops with nearest-neighbor heuristic starting from tech.startLoc and ending at tech.endLoc\n\tconst totals = { miles: 0, minutes: 0 };\n\tconst withEstimates = await Promise.all(\n\t\tassignments.map(async (a) => {\n\t\t\tconst seq = [] as any[];\n\t\t\tconst remaining = a.stops.slice();\n\t\t\tlet cursor = a.tech.startLoc;\n\t\t\twhile (remaining.length > 0) {\n\t\t\t\tlet bestI = 0;\n\t\t\t\tlet bestD = Infinity;\n\t\t\t\tfor (let i = 0; i < remaining.length; i++) {\n\t\t\t\t\tconst d = haversineMiles(cursor, remaining[i].loc);\n\t\t\t\t\tif (d < bestD) {\n\t\t\t\t\t\tbestD = d;\n\t\t\t\t\t\tbestI = i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst picked = remaining.splice(bestI, 1)[0];\n\t\t\t\tseq.push(picked);\n\t\t\t\tcursor = picked.loc;\n\t\t\t}\n\n\t\t\t// compute miles and time for route: start -> each stop -> end\n\t\t\tlet m = 0;\n\t\t\tlet minutes = 0;\n\n\t\t\t// Build canonical route signature for caching\n\t\t\tconst routePoints = [a.tech.startLoc, ...seq.map((s) => s.loc), a.tech.endLoc];\n\t\t\tconst canonical = routePoints\n\t\t\t\t.map((p) => `${Number(p.lat).toFixed(5)},${Number(p.lon).toFixed(5)}`)\n\t\t\t\t.join(':');\n\t\t\tconst cacheKey = `route:${canonical}`;\n\t\t\tconst kv = (platform?.env as any)?.BETA_PLACES_KV as any | undefined;\n\n\t\t\t// Try KV cache first\n\t\t\ttry {\n\t\t\t\tif (kv) {\n\t\t\t\t\tconst cachedRaw = await kv.get(cacheKey);\n\t\t\t\t\tif (cachedRaw) {\n\t\t\t\t\t\tconst cached = JSON.parse(cachedRaw);\n\t\t\t\t\t\tm = Number(cached.miles) || 0;\n\t\t\t\t\t\tminutes = Number(cached.minutes) || 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tlog.warn('[ROUTE CACHE] read failed', { key: cacheKey, err: (e as Error).message });\n\t\t\t}\n\n\t\t\t// If not cached, try Google Directions (server-side) and cache result\n\t\t\tif ((!m || !minutes) && apiKey) {\n\t\t\t\ttry {\n\t\t\t\t\tconst origin = `${routePoints[0].lat},${routePoints[0].lon}`;\n\t\t\t\t\tconst destination = `${routePoints[routePoints.length - 1].lat},${routePoints[routePoints.length - 1].lon}`;\n\t\t\t\t\tconst waypoints = routePoints\n\t\t\t\t\t\t.slice(1, -1)\n\t\t\t\t\t\t.map((p) => `${p.lat},${p.lon}`)\n\t\t\t\t\t\t.join('|');\n\t\t\t\t\tconst wayParam = waypoints ? `&waypoints=${encodeURIComponent(waypoints)}` : '';\n\t\t\t\t\tconst url = `https://maps.googleapis.com/maps/api/directions/json?origin=${origin}&destination=${destination}${wayParam}&key=${apiKey}&mode=driving&units=imperial`;\n\t\t\t\t\tconst dres = await fetch(url);\n\t\t\t\t\tconst ddata: any = await dres.json();\n\t\t\t\t\tif (ddata && ddata.status === 'OK' && ddata.routes && ddata.routes[0]) {\n\t\t\t\t\t\tconst legs = ddata.routes[0].legs || [];\n\t\t\t\t\t\tlet totalMeters = 0;\n\t\t\t\t\t\tlet totalSeconds = 0;\n\t\t\t\t\t\tfor (const leg of legs) {\n\t\t\t\t\t\t\ttotalMeters += (leg.distance && leg.distance.value) || 0;\n\t\t\t\t\t\t\ttotalSeconds += (leg.duration && leg.duration.value) || 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tm = totalMeters / 1609.344; // meters -> miles\n\t\t\t\t\t\tminutes = totalSeconds / 60;\n\n\t\t\t\t\t\t// Cache result for future\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (kv) {\n\t\t\t\t\t\t\t\tawait kv.put(\n\t\t\t\t\t\t\t\t\tcacheKey,\n\t\t\t\t\t\t\t\t\tJSON.stringify({\n\t\t\t\t\t\t\t\t\t\tmiles: m,\n\t\t\t\t\t\t\t\t\t\tminutes,\n\t\t\t\t\t\t\t\t\t\tcachedAt: new Date().toISOString(),\n\t\t\t\t\t\t\t\t\t\tsource: 'directions'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlog.warn('[ROUTE CACHE] write failed', { key: cacheKey, err: (e as Error).message });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlog.warn('[DIRECTIONS] failed', { err: (e as Error).message });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fallback to haversine estimate if Google not available or failed\n\t\t\tif (!m || !minutes) {\n\t\t\t\tlet prev = a.tech.startLoc;\n\t\t\t\tfor (const s of seq) {\n\t\t\t\t\tconst leg = haversineMiles(prev, s.loc) * ROAD_FACTOR;\n\t\t\t\t\tm += leg;\n\t\t\t\t\tminutes += (leg / EST_SPEED_MPH) * 60;\n\t\t\t\t\tprev = s.loc;\n\t\t\t\t}\n\t\t\t\tm += haversineMiles(prev, a.tech.endLoc) * ROAD_FACTOR;\n\t\t\t\tminutes += ((haversineMiles(prev, a.tech.endLoc) * ROAD_FACTOR) / EST_SPEED_MPH) * 60;\n\t\t\t}\n\n\t\t\ttotals.miles += m;\n\t\t\ttotals.minutes += minutes;\n\n\t\t\treturn {\n\t\t\t\ttech: { name: a.tech.name, startLoc: a.tech.startLoc, endLoc: a.tech.endLoc },\n\t\t\t\tstops: seq.map((s) => ({ address: s.address, rank: s.rank, loc: s.loc })),\n\t\t\t\tmiles: m,\n\t\t\t\tminutes: minutes\n\t\t\t};\n\t\t})\n\t);\n\n\treturn new Response(JSON.stringify({ assignments: withEstimates, totals }), { status: 200 });\n};\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\service-worker.ts",
		"messages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 140,
				"column": 39,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 140,
				"endColumn": 42,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [4112, 4115], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [4112, 4115], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				]
			}
		],
		"suppressedMessages": [],
		"errorCount": 1,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"source": "// src/service-worker.ts\n/// <reference types=\"@sveltejs/kit\" />\nimport { build, files, version } from '$service-worker';\n\n// Create a unique cache name for this deployment\nconst CACHE = `cache-${version}`;\n\nconst ASSETS = [\n\t...build, // the app itself\n\t...files // everything in `static`\n];\n\nself.addEventListener('install', (event) => {\n\t// Create a new cache and add all files to it\n\tasync function addFilesToCache() {\n\t\tconst cache = await caches.open(CACHE);\n\n\t\t// Fast path: try adding everything at once. If any request fails, fall back to\n\t\t// fetching assets individually so we can skip/log failures and avoid the\n\t\t// whole installation failing.\n\t\ttry {\n\t\t\tawait cache.addAll(ASSETS);\n\t\t\treturn;\n\t\t} catch (err) {\n\t\t\t// addAll failed (often because one asset returned a non-OK response).\n\t\t\tconsole.warn('service-worker: cache.addAll failed, retrying assets individually', err);\n\t\t}\n\n\t\t// Fetch and add assets individually, logging failures but continuing.\n\t\tfor (const asset of ASSETS) {\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(asset, { cache: 'no-cache' });\n\t\t\t\tif (!res || !res.ok) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`service-worker: failed to fetch ${asset}: ${res && res.status} ${res && res.statusText}`\n\t\t\t\t\t);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tawait cache.put(asset, res.clone());\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn(`service-worker: error fetching ${asset}`, e);\n\t\t\t}\n\t\t}\n\t}\n\n\tevent.waitUntil(addFilesToCache());\n});\n\nself.addEventListener('activate', (event) => {\n\t// Remove previous caches\n\tasync function deleteOldCaches() {\n\t\tfor (const key of await caches.keys()) {\n\t\t\tif (key !== CACHE) await caches.delete(key);\n\t\t}\n\t}\n\n\tevent.waitUntil(deleteOldCaches());\n});\n\nself.addEventListener('fetch', (event) => {\n\t// ignore non-GET requests\n\tif (event.request.method !== 'GET') return;\n\n\tconst url = new URL(event.request.url);\n\n\t// SECURITY: Never cache API responses (may contain user data)\n\t// Also exclude auth-related routes and external URLs\n\tif (\n\t\turl.pathname.startsWith('/api/') ||\n\t\turl.pathname.startsWith('/login') ||\n\t\turl.pathname.startsWith('/register') ||\n\t\turl.pathname.startsWith('/logout') ||\n\t\turl.pathname.startsWith('/reset-password') ||\n\t\turl.pathname.startsWith('/forgot-password') ||\n\t\turl.origin !== self.location.origin\n\t) {\n\t\treturn; // Let the browser handle these requests without service worker interference\n\t}\n\n\t// Handle navigation requests (HTML pages) with a network-first strategy\n\tif (event.request.mode === 'navigate') {\n\t\tevent.respondWith(\n\t\t\t(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst networkResponse = await fetch(event.request);\n\t\t\t\t\tif (networkResponse && networkResponse.status === 200) {\n\t\t\t\t\t\tconst cache = await caches.open(CACHE);\n\t\t\t\t\t\tcache.put(event.request, networkResponse.clone());\n\t\t\t\t\t}\n\t\t\t\t\treturn networkResponse;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconst cache = await caches.open(CACHE);\n\t\t\t\t\tconst cached = (await cache.match('/offline.html')) || (await cache.match('/'));\n\t\t\t\t\tif (cached) return cached;\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t})()\n\t\t);\n\t\treturn;\n\t}\n\n\tasync function respond() {\n\t\tconst url = new URL(event.request.url);\n\t\tconst cache = await caches.open(CACHE);\n\n\t\t// Serve build assets from cache directly\n\t\tif (ASSETS.includes(url.pathname)) {\n\t\t\tconst response = await cache.match(url.pathname);\n\t\t\tif (response) return response;\n\t\t}\n\n\t\t// For everything else, try the network first, then cache\n\t\ttry {\n\t\t\tconst response = await fetch(event.request);\n\n\t\t\t// if we're offline, fetch can return a value that is not a Response\n\t\t\t// instead of throwing - and we only want to cache valid responses\n\t\t\tif (!(response instanceof Response)) {\n\t\t\t\tthrow new Error('invalid response from fetch');\n\t\t\t}\n\n\t\t\tif (response.status === 200) {\n\t\t\t\tcache.put(event.request, response.clone());\n\t\t\t}\n\n\t\t\treturn response;\n\t\t} catch (err) {\n\t\t\tconst response = await cache.match(event.request);\n\t\t\tif (response) return response;\n\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\tevent.respondWith(respond());\n});\n\n// Background sync for failed requests (future enhancement)\n// Note: 'sync' event type needs explicit 'any' cast or interface augmentation in some TS setups\nself.addEventListener('sync', (event: any) => {\n\tif (event.tag === 'sync-logs') {\n\t\tevent.waitUntil(syncPendingLogs());\n\t}\n});\n\nasync function syncPendingLogs() {\n\t// This will be called when the device comes back online\n\tconsole.log('⚡ Background sync triggered: syncing pending logs');\n\t// Logic to replay failed requests would go here (e.g. reading from IndexedDB)\n}\n",
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\types\\simplewebauthn.d.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\src\\worker-entry.ts",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\subscription-integration.js",
		"messages": [],
		"suppressedMessages": [
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'upgradeToPlan' is defined but never used. Allowed unused vars must match /^_/u.",
				"line": 330,
				"column": 16,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 330,
				"endColumn": 29,
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "@typescript-eslint/no-unused-vars",
				"severity": 2,
				"message": "'e' is defined but never used. Allowed unused caught errors must match /^_/u.",
				"line": 388,
				"column": 12,
				"nodeType": null,
				"messageId": "unusedVar",
				"endLine": 388,
				"endColumn": 13,
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\svelte.config.js",
		"messages": [],
		"suppressedMessages": [],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\tailwind.config.js",
		"messages": [],
		"suppressedMessages": [
			{
				"ruleId": "@typescript-eslint/no-require-imports",
				"severity": 2,
				"message": "A `require()` style import is forbidden.",
				"line": 70,
				"column": 12,
				"nodeType": "CallExpression",
				"messageId": "noRequireImports",
				"endLine": 70,
				"endColumn": 41,
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	},
	{
		"filePath": "C:\\Users\\James\\Desktop\\Beta Go Route Yourself\\SvelteKit Rebuild\\Go Route Yourslef Svelte 5\\vite.config.ts",
		"messages": [],
		"suppressedMessages": [
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 34,
				"column": 34,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 34,
				"endColumn": 37,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1378, 1381], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1378, 1381], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 36,
				"column": 21,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 36,
				"endColumn": 24,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1487, 1490], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1487, 1490], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 36,
				"column": 31,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 36,
				"endColumn": 34,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1497, 1500], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1497, 1500], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 36,
				"column": 42,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 36,
				"endColumn": 45,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1508, 1511], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1508, 1511], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 53,
				"column": 33,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 53,
				"endColumn": 36,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [1953, 1956], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [1953, 1956], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 56,
				"column": 42,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 56,
				"endColumn": 45,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2100, 2103], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2100, 2103], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			},
			{
				"ruleId": "@typescript-eslint/no-explicit-any",
				"severity": 2,
				"message": "Unexpected any. Specify a different type.",
				"line": 64,
				"column": 7,
				"nodeType": "TSAnyKeyword",
				"messageId": "unexpectedAny",
				"endLine": 64,
				"endColumn": 10,
				"suggestions": [
					{
						"messageId": "suggestUnknown",
						"fix": { "range": [2245, 2248], "text": "unknown" },
						"desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
					},
					{
						"messageId": "suggestNever",
						"fix": { "range": [2245, 2248], "text": "never" },
						"desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
					}
				],
				"suppressions": [{ "kind": "directive", "justification": "" }]
			}
		],
		"errorCount": 0,
		"fatalErrorCount": 0,
		"warningCount": 0,
		"fixableErrorCount": 0,
		"fixableWarningCount": 0,
		"usedDeprecatedRules": []
	}
]
