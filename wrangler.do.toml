name = "trip-index-worker"
main = "src/do-worker.ts"
compatibility_date = "2024-12-05"
compatibility_flags = ["nodejs_compat"]

# 1. Trip Index DO Binding (Points to the NEW Fresh class)
[[durable_objects.bindings]]
name = "TRIP_INDEX_DO"
class_name = "TripIndexFresh"

# 2. Places Index DO Binding
[[durable_objects.bindings]]
name = "PLACES_INDEX_DO"
class_name = "PlacesIndexSQL"

# --- KV BINDINGS ---

[[kv_namespaces]]
binding = "BETA_DIRECTIONS_KV"
id = "5392d9ff847542a29abf58c5f0624011"

[[kv_namespaces]]
binding = "BETA_LOGS_KV"
id = "9551bf35d9cc4f75a5210c52d906da24"

[[kv_namespaces]]
binding = "BETA_PLACES_KV"
id = "2030b20c6baa46fe8c7bb620aaf0f8c1"

# --- MIGRATIONS ---

[[migrations]]
tag = "v1"
new_classes = ["TripIndexDO"]

[[migrations]]
tag = "v2"
new_classes = ["PlacesIndexDO"]

[[migrations]]
tag = "v3"
new_sqlite_classes = ["TripIndexSQL", "PlacesIndexSQL"]

# v4: ONLY provision the new class. Do NOT delete the old one yet.
[[migrations]]
tag = "v4"
new_sqlite_classes = ["TripIndexFresh"]