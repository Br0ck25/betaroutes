name = "trip-index-worker"
main = "src/do-worker.ts"
compatibility_date = "2024-12-05"
compatibility_flags = ["nodejs_compat"]

# 1. Trip Index DO Definition
[[durable_objects.bindings]]
name = "TRIP_INDEX_DO"
class_name = "TripIndexSQL"

# 2. Places Index DO Definition
[[durable_objects.bindings]]
name = "PLACES_INDEX_DO"
class_name = "PlacesIndexSQL"

# --- MIGRATIONS ---

# Previous migrations (safe to keep)
[[migrations]]
tag = "v1"
new_classes = ["TripIndexDO"]

[[migrations]]
tag = "v2"
new_classes = ["PlacesIndexDO"]

# [!code fix] Ensure this tag is present to force SQLite
[[migrations]]
tag = "v3"
new_sqlite_classes = ["TripIndexSQL", "PlacesIndexSQL"]