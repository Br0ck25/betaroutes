<!doctype html>
<html lang="en" style="padding-bottom: env(safe-area-inset-bottom); background: white">
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="Cross-Origin-Opener-Policy" content="unsafe-none" />
    <title>
      Go Route Yourself - Route and Cost Calculator with Log - Plan, Optimize, and Track Your Trips
    </title>

    <meta
      name="description"
      content="Easily calculate driving routes, optimize stops, track trip costs, and log your earnings. Save your routes securely and export your trip logs."
    />

    <!-- Open Graph (for social sharing) -->
    <meta property="og:title" content="Route and Cost Calculator with Log" />
    <meta
      property="og:description"
      content="Plan routes, calculate costs, optimize trips, and track your earnings with our smart route logging tool."
    />
    <meta property="og:url" content="https://gorouteyourself.com/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://gorouteyourself.com/logo.png" />
    <meta property="og:site_name" content="Route and Cost Calculator" />

    <link rel="icon" href="/logo512.png" sizes="512x512" type="image/png" />
    <link rel="apple-touch-icon" href="/logo512.png" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="Route Calculator" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="manifest" href="/manifest.json" />

    <!-- Boot script moved to external file to satisfy CSP (no inline scripts) -->
    <script src="/js/boot.js" defer></script>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCOdfe7j11yw9ENkX8c7hYsIjwqcQeqJGQ&libraries=places&callback=initMap"
      defer
    ></script>

    <!-- External Stylesheet -->
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="g_id_signin"></div>

    <!-- Fixed Top Bar -->
    <div
      id="top-bar"
      style="
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: white;
        padding: 25px 0;
        width: 100%;
        max-width: 900px;
        margin: 0 auto;
        border-radius: 0;
        box-shadow: none;
        transition: none;
      "
    >
      <!-- Left: Hamburger -->
      <div style="position: absolute; left: 12px; display: flex; align-items: center; height: 100%">
        <button
          id="hamburger-button"
          style="
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: black;
            padding: 6px 10px;
            border-radius: 8px;
            transition: background-color 0.3s;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
          "
        >
          <span class="material-icons">menu</span>
        </button>
      </div>

      <!-- Centered Logo -->
      <img
        id="logo-image"
        src="/logo.png"
        alt="Logo"
        style="height: 50px; max-height: 70px; cursor: pointer"
      />

      <!-- Right: Username -->
      <div
        style="position: absolute; right: 22px; display: flex; align-items: center; height: 100%"
      >
        <span
          id="username-display"
          style="
            font-size: 16px;
            font-weight: bold;
            background: none;
            padding: 6px 10px;
            border-radius: 8px;
            color: black;
            transition: background-color 0.3s;
          "
        ></span>
      </div>
    </div>

    <!-- Scrollable Auth Message (Sign In Banner) -->
    <div
      id="auth-message"
      style="
        display: none;
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
        border-radius: 6px;
        padding: 15px 20px;
        text-align: center;
        font-size: 16px;
        max-width: 600px;
        margin: 80px auto 20px auto;
        position: relative;
        z-index: 500;
      "
    >
      Your trips are saved locally.
      <a
        id="show-signup-link"
        href="#"
        style="color: #0d6efd; font-weight: bold; text-decoration: none"
        >Create an account</a
      >
      or
      <a
        id="show-login-link"
        href="#"
        style="color: #0d6efd; font-weight: bold; text-decoration: none"
        >Sign In</a
      >
      to sync across all your devices!
    </div>

    <!-- Offline Mode Banner (same style as sign-in banner) -->
    <div
      id="offline-banner"
      style="
        display: none;
        background-color: #fffae6;
        color: #856404;
        border: 1px solid #ffd700;
        border-radius: 6px;
        padding: 15px 20px;
        text-align: center;
        font-size: 16px;
        max-width: 600px;
        margin: 120px auto 20px auto; /*  Increased top margin for signed-in layout */
        position: relative;
        z-index: 500;
      "
    >
      Offline Mode: Showing cached routes.
    </div>

    <!--  FIX: Wrap in #logout-message -->
    <div id="logout-message" style="display: none; margin: 20px auto; max-width: 100%">
      <div id="account-menu">
        <!--  Close Button -->
        <div style="position: relative; width: 100%; height: 50px">
          <button
            id="logout-close-btn"
            style="
              position: absolute;
              top: 10px;
              right: 10px;
              background: none;
              border: none;
              font-size: 24px;
              font-weight: bold;
              color: black;
              cursor: pointer;
              line-height: 1;
              transition: transform 0.2s;
            "
          ></button>
        </div>

        <!--  Logo -->
        <div style="text-align: center; margin: 20px 0">
          <img src="/logo.png" alt="Logo" style="height: 40px" />
        </div>

        <!-- üí≥ Subscription Info Card -->
        <div
          id="subscription-info"
          style="
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
          "
        >
          <div id="plan-name" style="font-size: 18px; font-weight: bold; margin-bottom: 5px">
            Free Plan
          </div>
          <div id="plan-details" style="font-size: 13px; color: #666; margin-bottom: 10px">
            <!-- Trip count will be inserted here -->
          </div>
          <button
            id="upgrade-button"
            onclick="showUpgradePage()"
            style="
              background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
              color: white;
              border: none;
              padding: 10px 16px;
              border-radius: 6px;
              cursor: pointer;
              font-size: 14px;
              font-weight: 600;
              width: 100%;
              transition:
                transform 0.2s,
                box-shadow 0.2s;
            "
            onmouseover="
              this.style.transform = 'translateY(-2px)';
              this.style.boxShadow = '0 4px 12px rgba(76, 175, 80, 0.3)';
            "
            onmouseout="
              this.style.transform = 'translateY(0)';
              this.style.boxShadow = 'none';
            "
          >
            ‚≠ê Upgrade to Pro
          </button>
          <button
            id="manage-subscription-button"
            onclick="openCustomerPortal()"
            style="
              display: none;
              background: white;
              color: #4caf50;
              border: 2px solid #4caf50;
              padding: 8px 14px;
              border-radius: 6px;
              cursor: pointer;
              font-size: 13px;
              font-weight: 600;
              width: 100%;
              margin-top: 8px;
              transition: background-color 0.2s;
            "
            onmouseover="this.style.backgroundColor = '#f0f0f0'"
            onmouseout="this.style.backgroundColor = 'white'"
          >
            üíº Manage Subscription
          </button>
        </div>

        <!--  Menu Items -->

        <!-- Dashboard Link -->
        <button
          data-action="go-dashboard"
          style="
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            max-width: 220px;
            display: block;
            margin: 10px auto;
            box-sizing: border-box;
            transition: all 0.2s ease;
            text-align: center;
          "
          onmouseover="
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 10px 25px rgba(102, 126, 234, 0.4)';
          "
          onmouseout="
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
          "
        >
          üìä Dashboard
        </button>

        <!--  New Manage Account collapsible section -->
        <div style="margin-top: 10px">
          <button id="hamburger-manage-account-toggle" onclick="toggleHamburgerManageAccountMenu()">
            Manage Account
            <span
              id="hamburger-manage-account-arrow"
              style="display: inline-block; transition: transform 0.3s"
              >&#9660;</span
            >
          </button>
          <div
            id="hamburger-manage-account-menu"
            style="
              max-height: 0;
              overflow: hidden;
              transition: max-height 0.3s ease;
              background: white;
              border: 1px solid #ccc;
              border-radius: 6px;
              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
              margin-top: 5px;
              text-align: center;
              padding: 0 10px;
            "
          >
            <button
              onclick="
                closeMenu();
                showPasswordModal();
              "
            >
              Change Password
            </button>
            <button
              onclick="
                closeMenu();
                showDeleteModal();
              "
              class="danger"
            >
              Delete Account
            </button>
          </div>
        </div>

        <!--  NEW Manage Log button (collapsible) -->
        <!-- Manage Log Toggle -->
        <button id="hamburger-manage-toggle" onclick="toggleHamburgerManageLogMenu()">
          Manage Log
          <span
            id="hamburger-manage-arrow"
            style="display: inline-block; transition: transform 0.3s"
            >&#9660;</span
          >
        </button>

        <!-- Dropdown Menu -->
        <div
          id="hamburger-manage-log-menu"
          style="
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            margin-top: 5px;
            text-align: center;
            padding: 0 10px;
          "
        >
          <button data-action="trigger-import">Import CSV</button>
          <button data-action="export-csv">Export CSV</button>
          <button data-action="export-pdf">Export PDF</button>
        </div>

        <!--  New Settings Dropdown -->
        <!--  New Settings Dropdown -->
        <button id="hamburger-settings-toggle" onclick="toggleHamburgerSettingsMenu()">
          Settings
          <span
            id="hamburger-settings-arrow"
            style="display: inline-block; transition: transform 0.3s"
            >&#9660;</span
          >
        </button>

        <div
          id="hamburger-settings-menu"
          style="
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            margin-top: 5px;
            text-align: center;
            padding: 0 10px;
          "
        >
          <button data-action="install-app">Install App</button>
          <button onclick="window.open('/privacy-policy.html', '_blank')">Privacy Policy</button>
          <button onclick="window.open('/faq.html', '_blank')">FAQ</button>
        </div>

        <div style="padding: 0 10px">
          <button
            onclick="
              closeMenu();
              logout();
            "
          >
            Log Out
          </button>
        </div>
      </div>
      <!--  closes #account-menu -->
    </div>
    <!--  closes #logout-message -->

    <div class="container" style="margin-top: 15px">
      <label for="log-date">Date</label>
      <input type="date" id="log-date" required />

      <label for="start-address">Start Address</label>
      <input type="text" id="start-address" placeholder="Enter start address" required />

      <div id="destinations-container">
        <div class="destination">
          <label for="destination-1">Destination 1</label>
          <input
            type="text"
            id="destination-1"
            list="recent-destinations"
            placeholder="Enter destination address"
            required
          />
          <datalist id="recent-destinations"></datalist>

          <label for="earnings-1">Earnings for Destination 1</label>
          <input
            type="number"
            id="earnings-1"
            placeholder="Enter earnings for destination"
            required
          />
          <div class="destination-actions">
            <button class="delete-btn" onclick="deleteDestination(this)">Delete</button>
            <button class="move-btn" onclick="moveDestinationUp(this)">Move Up</button>
            <button class="move-btn" onclick="moveDestinationDown(this)">Move Down</button>
          </div>
        </div>
      </div>

      <button onclick="addDestination()">Add Destination</button>
      <label for="end-address">End Address</label>
      <input type="text" id="end-address" placeholder="Enter end address" required />

      <label for="mpg">Miles per Gallon (MPG)</label>
      <input type="number" id="mpg" placeholder="Enter miles per gallon" required />

      <label for="gas-price">Fuel Price per Gallon</label>
      <input type="number" id="gas-price" placeholder="Enter fuel price per gallon" required />

      <label for="start-time">Start Time</label>
      <input type="time" id="start-time" placeholder="Enter start time" />

      <label for="end-time">End Time</label>
      <input type="time" id="end-time" placeholder="Enter end time" />

      <label for="total-hours">Total Hours</label>

      <div>
        <input
          type="text"
          id="total-hours"
          placeholder="Auto-filled from Start/End Time"
          readonly
          style="background-color: #eee; cursor: not-allowed"
        />

        <div id="hours-display" style="margin-top: 4px; font-size: 14px; color: #555"></div>
      </div>

      <div class="optional-costs">
        <h3>Optional Daily Costs</h3>

        <label>Vehicle Maintenance Cost (Optional)</label>
        <div id="maintenance-container">
          <!-- Maintenance items will be added here dynamically -->
        </div>
        <button type="button" onclick="addMaintenanceItem()" style="margin-top: 10px">
          Add Maintenance Item
        </button>

        <label style="margin-top: 20px">Supplies Cost (Optional)</label>
        <div id="supplies-container">
          <!-- Supplies items will be added here dynamically -->
        </div>
        <button type="button" onclick="addSupplyItem()" style="margin-top: 10px">
          Add Supply Item
        </button>
      </div>
      <label for="log-notes" style="margin-top: 8px; display: block; font-weight: bold; color: #555"
        >Notes (Optional)</label
      >
      <textarea
        id="log-notes"
        rows="4"
        placeholder="Enter any notes for this trip"
        style="
          width: 100%;
          box-sizing: border-box;
          font-size: 16px;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          padding: 10px;
          margin-top: 4px;
          margin-bottom: 12px;
          border-radius: 5px;
          border: 1px solid #ccc;
          resize: vertical;
        "
      ></textarea>

      <div
        id="confirmation-message"
        style="display: none; color: green; font-weight: bold; margin-top: 10px"
      ></div>

      <div class="container" style="padding: 0">
        <div id="results" class="hidden">
          <p>Mileage: <span id="total-mileage"></span> miles</p>
          <p>Drive Time: <span id="total-time"></span></p>
          <p>Total Earnings: $<span id="total-earnings"></span></p>
          <p>Fuel Cost: $<span id="fuel-cost"></span></p>
          <p>Maintenance Cost: $<span id="maintenance-cost-result"></span></p>
          <p>Supplies Cost: $<span id="supplies-cost-result"></span></p>
          <p>Total Hours: <span id="total-hours-result"></span></p>

          <p>Net Profit: $<span id="net-profit"></span></p>
          <p>Net Profit per Hour (including drive time): $<span id="profit-per-hour"></span></p>
        </div>
      </div>

      <div id="map" class="hidden"></div>
      <div id="detailed-results" style="margin-top: 20px"></div>
      <div
        id="mileage-display"
        style="text-align: center; font-weight: bold; margin-top: 10px"
      ></div>
      <div
        id="optimized-mileage-display"
        style="text-align: center; font-weight: bold; margin-top: 10px"
      ></div>
    </div>

    <div id="log-container">
      <!--  Step 1: Centered Title and Summary -->
      <div
        id="log-header"
        style="display: flex; flex-direction: column; align-items: center; margin-bottom: 10px"
      >
        <!-- Log Title Centered -->
        <h2 style="margin: 0 0 20px 0; text-align: center">Log</h2>

        <!-- Net Profit and Profit Per Hour Centered -->
        <div
          id="log-summary"
          style="
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            margin-top: 10px;
            margin-bottom: 20px;
          "
        >
          <!-- Net profit and profit per hour will dynamically go here -->
        </div>
      </div>

      <!--  Step 2: Centered Filters Row -->
      <div
        id="log-title-bar"
        style="
          display: flex;
          justify-content: center;
          flex-wrap: wrap;
          gap: 20px;
          margin-bottom: 20px;
        "
      >
        <div class="date-filter" style="display: flex; flex-direction: column; align-items: center">
          <label for="filter-start-date">Start Date:</label>
          <input type="date" id="filter-start-date" onchange="onStartDateChange()" />
        </div>

        <div class="date-filter" style="display: flex; flex-direction: column; align-items: center">
          <label for="filter-end-date">End Date:</label>
          <input type="date" id="filter-end-date" onchange="filterLogs()" />
        </div>

        <div class="filter-section">
          <label for="filter-search">Search:</label>
          <input
            type="text"
            id="filter-search"
            placeholder="Search anything..."
            oninput="filterLogs()"
          />
        </div>

        <div class="filter-section">
          <button onclick="clearFilters()">Clear</button>
        </div>
      </div>

      <!-- Step 3: Log Entries (list stays exactly as it was) -->
      <ul id="log-list">
        <!-- Log entries are dynamically added here -->
      </ul>
    </div>
    <!-- end of #log-container -->

    <input
      type="file"
      id="import-file"
      accept=".csv"
      style="display: none"
      onchange="importLog()"
    />

    <div id="overlay" class="hidden"></div>
    <div id="edit-form-container" class="edit-form-container hidden">
      <h3>Edit Log Entry</h3>
      <label for="edit-date">Date</label>
      <input type="date" id="edit-date" />

      <div class="edit-form-group">
        <label for="edit-start-time">Start Time</label>
        <input type="time" id="edit-start-time" />
      </div>

      <div class="edit-form-group">
        <label for="edit-end-time">End Time</label>
        <input type="time" id="edit-end-time" />
      </div>

      <label for="edit-start-address">Start Address</label>
      <input type="text" id="edit-start-address" />

      <div id="edit-destinations-container"></div>
      <button type="button" onclick="addEditDestination()">Add Destination</button>

      <label for="edit-end-address">End Address</label>
      <input type="text" id="edit-end-address" />

      <label for="edit-mpg">Miles Per Gallon (MPG)</label>
      <input type="number" id="edit-mpg" placeholder="Enter MPG" oninput="updateEditFuelCost()" />

      <label for="edit-gas-price">Fuel Price Per Gallon</label>
      <input
        type="number"
        id="edit-gas-price"
        placeholder="Enter Gas Price"
        oninput="updateEditFuelCost()"
      />

      <label for="edit-total-earnings">Total Earnings</label>
      <input type="number" id="edit-total-earnings" />

      <label for="edit-fuel-cost">Fuel Cost</label>
      <input type="number" id="edit-fuel-cost" />

      <label>Maintenance Cost</label>
      <div id="edit-maintenance-container">
        <!-- Maintenance items will be added here dynamically -->
      </div>
      <button type="button" onclick="addEditMaintenanceItem()" style="margin-top: 10px">
        Add Maintenance Item
      </button>

      <label style="margin-top: 20px">Supplies Cost</label>
      <div id="edit-supplies-container">
        <!-- Supplies items will be added here dynamically -->
      </div>
      <button type="button" onclick="addEditSupplyItem()" style="margin-top: 10px">
        Add Supply Item
      </button>

      <label for="edit-total-mileage">Mileage</label>
      <input type="number" id="edit-total-mileage" oninput="updateEditFuelCost()" />

      <label for="edit-total-time">Drive Time</label>
      <input type="text" id="edit-total-time" placeholder="e.g., 1 hour 30 minutes" />

      <label for="edit-hours-worked">Total Hours</label>
      <input
        type="text"
        id="edit-hours-worked"
        placeholder="Enter times above to calculate."
        readonly
        style="background-color: #f0f0f0; cursor: not-allowed"
      />
      <div id="edit-hours-message" style="font-size: 14px; color: #666; margin-top: 4px"></div>

      <label
        for="edit-notes"
        style="margin-top: 8px; display: block; font-weight: bold; color: #555"
        >Notes</label
      >
      <textarea
        id="edit-notes"
        rows="4"
        placeholder="Enter notes here..."
        style="
          width: 100%;
          box-sizing: border-box;
          font-size: 16px;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          padding: 10px;
          margin-top: 4px;
          margin-bottom: 12px;
          border-radius: 5px;
          border: 1px solid #ccc;
          resize: vertical;
        "
      ></textarea>

      <button type="button" class="save-btn" onclick="saveEditedLogEntry()">Save</button>
      <button type="button" class="cancel-btn" onclick="closeEditForm()">Cancel</button>
      <input type="hidden" id="edit-index" />
    </div>

    <div
      id="resume-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 3000;
        justify-content: center;
        align-items: center;
      "
    >
      <div
        class="modal-box"
        style="
          background: white;
          padding: 30px;
          border-radius: 10px;
          width: 90%;
          max-width: 400px;
          text-align: center;
        "
      >
        <h3>Resume your last unsaved trip?</h3>
        <p style="margin-bottom: 20px">
          We found a previous trip that wasn't saved. Would you like to continue editing it?
        </p>
        <button onclick="resumeDraftTrip()">Resume</button>
        <button
          onclick="discardDraftTrip()"
          style="margin-top: 10px; background-color: #ccc; color: black"
        >
          Discard
        </button>
      </div>
    </div>

    <!-- External JavaScript -->

    <div
      id="auth-modal"
      onclick="closeAuthModal()"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
        z-index: 2000;
      "
    >
      <div onclick="event.stopPropagation()" class="modal-box">
        <h3 id="auth-title">Sign In</h3>
        <input
          type="text"
          id="auth-username"
          placeholder="Username"
          style="
            width: 100%;
            margin-bottom: 10px;
            box-sizing: border-box;
            padding: 10px;
            font-size: 16px;
            line-height: 1.4;
          "
        />

        <input
          type="password"
          id="auth-password"
          placeholder="Password"
          style="
            width: 100%;
            margin-bottom: 10px;
            box-sizing: border-box;
            padding: 10px;
            font-size: 16px;
            line-height: 1.4;
          "
        />

        <button onclick="submitAuth()" style="width: 100%">Submit</button>
        <button
          onclick="closeAuthModal()"
          style="width: 100%; margin-top: 10px; background-color: #ccc; color: #333"
        >
          Cancel
        </button>

        <p style="text-align: center; margin-top: 10px">
          <a href="#" onclick="toggleAuthMode()">
            Switch to <span id="auth-switch-label">Sign Up</span> </a
          ><br />
          <a href="#" onclick="showResetModal()" style="font-size: 0.9em; color: #0d6efd">
            Forgot Password?
          </a>
        </p>
      </div>
    </div>

    <div
      id="change-password-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
        z-index: 2000;
      "
    >
      <div onclick="event.stopPropagation()" class="modal-box">
        <h3>Change Password</h3>

        <input
          type="password"
          id="current-password"
          placeholder="Current password"
          style="
            width: 100%;
            margin-bottom: 10px;
            box-sizing: border-box;
            padding: 10px;
            font-size: 16px;
            line-height: 1.4;
          "
        />

        <input
          type="password"
          id="new-password"
          placeholder="New password"
          style="
            width: 100%;
            margin-bottom: 10px;
            box-sizing: border-box;
            padding: 10px;
            font-size: 16px;
            line-height: 1.4;
          "
        />

        <input
          type="password"
          id="confirm-password"
          placeholder="Confirm new password"
          style="
            width: 100%;
            margin-bottom: 10px;
            box-sizing: border-box;
            padding: 10px;
            font-size: 16px;
            line-height: 1.4;
          "
        />

        <button
          onclick="submitPasswordChange()"
          style="width: 100%; padding: 10px; font-size: 16px"
        >
          Submit
        </button>
        <button
          onclick="closePasswordModal()"
          style="width: 100%; margin-top: 10px; background: #ccc; padding: 10px; font-size: 16px"
        >
          Cancel
        </button>
      </div>
    </div>

    <div
      id="reset-password-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
        z-index: 2000;
      "
    >
      <div onclick="event.stopPropagation()" class="modal-box">
        <h3>Reset Password</h3>
        <input
          type="text"
          id="reset-username"
          placeholder="Username"
          style="width: 100%; margin-bottom: 10px; padding: 10px"
        />
        <input
          type="text"
          id="reset-key"
          placeholder="Reset Key (shown at signup)"
          style="width: 100%; margin-bottom: 10px; padding: 10px"
        />
        <input
          type="password"
          id="reset-new-password"
          placeholder="New Password"
          style="width: 100%; margin-bottom: 10px; padding: 10px"
        />
        <button onclick="submitResetPassword()" style="width: 100%">Submit</button>
        <button onclick="closeResetModal()" style="width: 100%; margin-top: 10px; background: #ccc">
          Cancel
        </button>
      </div>
    </div>

    <div
      id="delete-account-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
        z-index: 2000;
      "
    >
      <div onclick="event.stopPropagation()" class="modal-box">
        <h3>Delete Account</h3>
        <p style="font-size: 14px; color: red">This action is permanent.</p>
        <input
          type="password"
          id="delete-password"
          placeholder="Confirm password"
          style="
            width: 100%;
            max-width: 400px;
            margin: 0 auto 10px auto;
            display: block;
            padding: 10px;
            box-sizing: border-box;
          "
        />

        <button onclick="submitDeleteAccount()" style="width: 100%; background: red; color: white">
          Delete My Account
        </button>
        <button
          onclick="closeDeleteModal()"
          style="width: 100%; margin-top: 10px; background: #ccc"
        >
          Cancel
        </button>
      </div>
    </div>

    <script src="app.js"></script>

    <div
      id="universal-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 3000;
        justify-content: center;
        align-items: center;
      "
    >
      <div
        class="modal-box"
        style="
          background: white;
          padding: 30px;
          border-radius: 10px;
          width: 90%;
          max-width: 400px;
          text-align: center;
        "
      >
        <h3 id="universal-modal-message"></h3>
        <div id="universal-modal-buttons" style="margin-top: 20px"></div>
      </div>
    </div>

    <div id="bottom-bar">
      <button onclick="calculateRoute()">
        <span class="material-icons">calculate</span>
        <span>Calculate</span>
      </button>

      <button onclick="optimizeRoute()">
        <span class="material-icons">tune</span>
        <span>Optimize</span>
      </button>
      <button onclick="logResults()">
        <span class="material-icons">edit_note</span>
        <span>Log</span>
      </button>
      <button onclick="openInGoogleMaps()">
        <span class="material-icons">map</span>
        <span>Map</span>
      </button>
    </div>

    <div
      id="edit-bottom-bar"
      style="
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-top: 1px solid #ddd;
        justify-content: space-around;
        align-items: center;
        padding: 0;
        padding-bottom: env(safe-area-inset-bottom);
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
        z-index: 1000;
        touch-action: manipulation;
      "
    >
      <button
        onclick="saveEditedLogEntry()"
        style="
          flex: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 8px 0;
          font-size: 12px;
          color: #333;
          background-color: transparent;
        "
      >
        <span class="material-icons" style="font-size: 35px; color: #4caf50">save</span>
        <span>Save</span>
      </button>
      <button
        onclick="closeEditForm()"
        style="
          flex: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 8px 0;
          font-size: 12px;
          color: #333;
          background-color: transparent;
        "
      >
        <span class="material-icons" style="font-size: 35px; color: #dc3545">cancel</span>
        <span>Cancel</span>
      </button>
    </div>

    <script>
      function blurButtonOnInteraction(e) {
        const btn = e.target.closest('button');
        if (btn) btn.blur();
      }

      document.addEventListener('click', blurButtonOnInteraction);
      document.addEventListener('touchend', blurButtonOnInteraction);
    </script>
  </body>
</html>
